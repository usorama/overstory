{"id":"overstory-036f","title":"Coordinator session stuck in booting state","description":"The coordinator agent's session state never transitions from 'booting' to 'working'. The booting-\u003eworking transition in log.ts:68-71 depends on updateLastActivity being called via the overstory log hook, but for the coordinator running at project root the hook doesn't seem to fire or doesn't pass the correct agent name. The lastActivity timestamp stays at the initial startedAt value, confirming no log events were processed. Investigate whether the coordinator's hooks are correctly configured to call overstory log with --agent coordinator.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:42:35.949443-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:45:22.676038-08:00","closed_at":"2026-02-13T06:45:22.676038-08:00","close_reason":"Fixed coordinator stuck in booting: moved session recording before beacon send in both coordinator.ts and sling.ts so updateLastActivity can find the session entry when hooks fire"}
{"id":"overstory-03z1","title":"Write agent identity tests (identity.test.ts)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:21:13.546232-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:41:51.800521-08:00","closed_at":"2026-02-13T08:41:51.800521-08:00","close_reason":"Agent identity tests written: 24 tests covering createIdentity, loadIdentity, updateIdentity with round-trip YAML serialization"}
{"id":"overstory-05o","title":"[Epic] Layer 1: Core Infrastructure","description":"All core infrastructure modules. 8 parallel tasks. Depends on Layer 0 completion.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:20.538883-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:28:35.03906-08:00","closed_at":"2026-02-12T07:28:35.03906-08:00","close_reason":"All 8 L1 subtasks completed","dependencies":[{"issue_id":"overstory-05o","depends_on_id":"overstory-0kf","type":"blocks","created_at":"2026-02-12T07:11:59.539909-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-05o","depends_on_id":"overstory-50l","type":"blocks","created_at":"2026-02-12T07:12:00.489658-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-05o","depends_on_id":"overstory-640","type":"blocks","created_at":"2026-02-12T07:12:01.240132-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-05o","depends_on_id":"overstory-gr3","type":"blocks","created_at":"2026-02-12T07:12:02.301808-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-05o","depends_on_id":"overstory-5y5","type":"blocks","created_at":"2026-02-12T07:12:03.04026-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-05o","depends_on_id":"overstory-l2e","type":"blocks","created_at":"2026-02-12T07:12:03.789317-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-05o","depends_on_id":"overstory-41f","type":"blocks","created_at":"2026-02-12T07:12:04.563558-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-05o","depends_on_id":"overstory-gtj","type":"blocks","created_at":"2026-02-12T07:12:05.415018-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-06l7","title":"Make init deploy agent definition .md files to target project","description":"overstory init doesn't copy agent definition files (scout.md, builder.md, etc.) from overstory's install dir to the target project. Sling fails in external projects because manifest.load() resolves agent files relative to config.project.root. Fix: copy agents/*.md to .overstory/agent-defs/ during init, update default config agents.baseDir accordingly. Agent defs should be git-tracked (not gitignored) so the project is self-contained.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:57:48.2158-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:27:26.758772-08:00","closed_at":"2026-02-12T13:27:26.758772-08:00","close_reason":"init now copies agents/*.md from overstory install dir to .overstory/agent-defs/ via readdir + Bun.write. 3 tests added."}
{"id":"overstory-07iy","title":"Dynamic task redistribution: builder work pool","description":"Instead of builders closing after completing their task, they should check bd ready for unassigned work and pick up the next task. Requires: a work pool concept where supervisor/lead has a queue of decomposed tasks, builders that check for more work after closing current task, and a new available_for_work mail type. This enables true swarm parallelism.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-16T08:05:58.26639-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T19:08:50.027443-08:00","closed_at":"2026-02-16T19:08:50.027443-08:00","close_reason":"Contradicts core architecture: agents are disposable (spawn, run, kill). Reusing builders across tasks means context accumulation, potential compaction, stale state. Leads already handle task queuing and spawn fresh builders per task. Spawn overhead is not worth sacrificing the clean-context guarantee.","dependencies":[{"issue_id":"overstory-07iy","depends_on_id":"overstory-givh","type":"blocks","created_at":"2026-02-16T08:06:13.624179-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-07iy","depends_on_id":"overstory-18zt","type":"blocks","created_at":"2026-02-16T08:06:13.780822-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-07jl","title":"Fix sling to use resolveModel() for config-level model overrides","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T07:26:14.396637-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T07:27:51.595069-08:00","closed_at":"2026-02-18T07:27:51.595069-08:00","close_reason":"Fixed sling to use resolveModel() instead of agentDef.model directly, so config.models overrides in config.yaml apply to sling-spawned agents. Two lines changed in src/commands/sling.ts: import and usage."}
{"id":"overstory-08ox","title":"Doctor: worktree/tmux/session three-way consistency","description":"Verify consistency between git worktrees, tmux sessions, and the sessions database. This is the most complex check — follows the ZFC principle from watchdog/health.ts: observable state (tmux, process) \u003e recorded state (sessions.db).\n\nChecks:\n- List all git worktrees via 'git worktree list --porcelain'\n- List all tmux sessions matching 'overstory-*' pattern\n- Query sessions.db for all non-completed sessions\n- Cross-reference all three sources:\n\nOrphaned worktrees:\n- Worktree directory exists in .overstory/worktrees/ but NOT in 'git worktree list' output\n- Worktree in git but directory missing on disk (ghost worktree)\n\nTmux/worktree misalignment:\n- Tmux session exists but no corresponding worktree\n- Worktree exists but no corresponding tmux session (process died)\n\nSession/reality misalignment:\n- Session state is 'working' or 'booting' but tmux session is dead\n- Session state is 'working' but PID is dead (kill -0 check)\n- Session exists but worktree doesn't\n\nDangling branches:\n- Branches matching 'overstory/*' pattern with no worktree or session\n\nSource references:\n- src/worktree/manager.ts — worktree list parsing, naming convention\n- src/worktree/tmux.ts — tmux session naming (overstory-{project}-{agent}), liveness check\n- src/sessions/store.ts — session state, agent_name uniqueness\n- src/watchdog/health.ts — ZFC principle, evaluateHealth(), signal priority\n\nOutput: pass/warn/fail. Reuse evaluateHealth() logic where possible. Report each inconsistency with specific remediation (e.g. 'run overstory worktree clean' or 'kill tmux session X').","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:59:35.604636-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:49:18.832688-08:00","closed_at":"2026-02-15T12:49:18.832688-08:00","close_reason":"Implemented worktree/tmux/session three-way consistency check with comprehensive tests and path normalization","dependencies":[{"issue_id":"overstory-08ox","depends_on_id":"overstory-m55s","type":"blocks","created_at":"2026-02-13T22:00:18.772432-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-0fuu","title":"Auto-detect mulch domains from file scope in sling","description":"sling.ts passes config.mulch.domains to the overlay but those are project-level defaults, usually empty. The overlay shows 'No specific expertise domains configured' for most agents, giving them nothing useful to prime. Use inferDomain() logic from src/insights/analyzer.ts to auto-detect domains from file paths at spawn time. E.g. .ts files → typescript domain, src/commands/ → cli domain. Agents get actionable prime commands instead of empty placeholder.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-20T13:09:39.138161-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:21:04.632964-08:00","closed_at":"2026-02-20T13:21:04.632964-08:00","close_reason":"Added inferDomainsFromFiles() to sling.ts: auto-detects mulch domains from file scope using inferDomain() from analyzer.ts, deduplicates and sorts results, falls back to config defaults. 13 tests added."}
{"id":"overstory-0kf","title":"L1-1: Implement logging system (src/logging/*)","description":"Multi-format logger (human-readable + NDJSON), secret sanitizer with redaction patterns (API keys, tokens, Bearer), ANSI console reporter. Files: src/logging/logger.ts, src/logging/sanitizer.ts, src/logging/reporter.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:25.178092-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:25:12.811655-08:00","closed_at":"2026-02-12T07:25:12.811655-08:00","close_reason":"Implemented logging system: logger.ts (multi-format writer), sanitizer.ts (secret redaction), reporter.ts (ANSI console output)","dependencies":[{"issue_id":"overstory-0kf","depends_on_id":"overstory-68p","type":"blocks","created_at":"2026-02-12T07:13:38.814912-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-0kwf","title":"Enforce coordinator -\u003e lead -\u003e builder delegation hierarchy","description":"During e2e testing, the coordinator delegated directly to builders, bypassing team leads. While this works functionally, the intended architecture is coordinator -\u003e lead -\u003e builder. The hierarchy enforcement via validateHierarchy in sling.ts exists but the coordinator's behavioral prompting doesn't strongly enough discourage direct builder spawning. Steps: (1) Review current hierarchy validation logic, (2) Strengthen coordinator overlay to prefer spawning leads over builders, (3) Consider a soft warning when coordinator spawns builders directly, (4) Ensure leads have clear instructions on how to manage their builder sub-teams.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T11:50:10.286601-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T12:35:10.76989-08:00","closed_at":"2026-02-13T12:35:10.76989-08:00","close_reason":"Coordinator beacon now includes explicit HIERARCHY instruction reinforcing lead-only spawning. Combined with existing validateHierarchy code enforcement in sling.ts and base definition injection via --append-system-prompt."}
{"id":"overstory-0l52","title":"Add merge_ready reviewer validation in mail.ts","description":"Add structural enforcement to mail send: warn when merge_ready sent without reviewer evidence","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T08:01:21.922474-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T08:05:35.510968-08:00","closed_at":"2026-02-17T08:05:35.510968-08:00","close_reason":"Added merge_ready reviewer validation: checks SessionStore for reviewers when --type merge_ready is sent, emits warnings to stderr if coverage is missing. All tests pass."}
{"id":"overstory-0mt9","title":"Agent reputation tracking system","description":"Track success/failure rates per agent type per task category. Store in mulch as project-agnostic records (e.g., 'builder agent completed typescript-refactoring in 12min, all tests passed'). Use for intelligent task routing in sling command. Query before spawning to find best-fit agent.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:50.328058-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T19:07:29.74272-08:00","closed_at":"2026-02-16T19:07:29.74272-08:00","close_reason":"Invalid: agents are disposable (spawned once, run to completion, killed). No persistent identity to track reputation against. And with only ~5 agent types (builder/scout/reviewer/lead/merger), per-capability tracking isn't justified either.","dependencies":[{"issue_id":"overstory-0mt9","depends_on_id":"overstory-f0kl","type":"blocks","created_at":"2026-02-15T17:05:32.274994-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-0puy","title":"Wire tier2Enabled into monitor.ts and update stale comments in types.ts/config.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T17:00:33.350483-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T17:05:30.389082-08:00","closed_at":"2026-02-18T17:05:30.389082-08:00","close_reason":"Wired tier2Enabled into startMonitor() as AgentError gate; updated stale 'not yet implemented' comments in types.ts and config.ts; added 2 tests verifying the disabled guard; fixed import ordering in monitor.ts and monitor.test.ts"}
{"id":"overstory-0rav","title":"Mulch-powered code review enhancement","description":"Reviewer agents query mulch for known patterns, past bugs, and conventions before reviewing. Instead of generic review, they check for project-specific issues. Requires overlay.ts to inject relevant mulch context into reviewer agents.","status":"open","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:57.056672-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T17:04:57.056672-08:00"}
{"id":"overstory-0sw","title":"sling'd agents may not have 'overstory' on PATH in tmux","description":"Agent tmux sessions launched by 'overstory sling' rely on hooks that call 'overstory prime', 'overstory mail check', and 'overstory log'. However, if overstory is installed via 'bun link' (which adds it to ~/.bun/bin/), the tmux session may not inherit the PATH that includes ~/.bun/bin/. This would cause all hooks to silently fail. The sling command should either: 1) Verify overstory is globally accessible, 2) Use an absolute path to the overstory binary in hooks, or 3) Ensure the tmux session inherits the necessary PATH.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:20:22.02265-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:32:31.447904-08:00","closed_at":"2026-02-12T08:32:31.447904-08:00","close_reason":"tmux createSession now detects overstory binary path and prepends it to PATH in spawned sessions"}
{"id":"overstory-0wfq","title":"Phase 1: Harden for Open Source","description":"Foundation hardening before pushing new features. Fix documentation gaps, concurrency bugs, and CLI ergonomics for open-source readiness.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:17.727289-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T14:00:07.296979-08:00","closed_at":"2026-02-16T14:00:07.296979-08:00","close_reason":"Phase 1 hardening complete. All 9 sub-issues resolved across 7 leads, 35 total sessions. Merged: mandatory review loop (lead.md), scout-first workflow (lead.md), mulch completion gate (all agent defs + overlay), overstory logs command, real-time token tracking (costs --live), unified feed command, mulch learn hook fix, coordinator --monitor flag, mulch enhancements scoped as external."}
{"id":"overstory-0ze","title":"mail send --agent flag undocumented in help (works as alias for --from)","description":"The mail send command accepts an --agent flag as an alias for --from, but the help text only documents --from. The overlay CLAUDE.md template shows examples using --agent for all mail commands. The help should document --agent or the overlay examples should use --from for consistency.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:41:00.130316-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:47:20.593863-08:00","closed_at":"2026-02-12T09:47:20.593863-08:00","close_reason":"Documented --agent as alias for --from in mail send and reply help text"}
{"id":"overstory-166","title":"Strengthen agent prompts with named failure modes and propulsion principle","description":"Add Propulsion Principle to all agent definitions: Read your assignment, execute immediately, no confirmation. Add named failure modes per role: Builder FILE_SCOPE_VIOLATION (editing outside assigned scope), Builder CANONICAL_BRANCH_WRITE (committing to canonical branch), Scout READ_ONLY_VIOLATION (using Write/Edit/destructive bash), Lead UNNECESSARY_SPAWN (spawning for tasks small enough to do directly), Lead OVERLAPPING_FILE_SCOPE (assigning same file to multiple builders), All SILENT_FAILURE (not reporting errors via mail), All INCOMPLETE_CLOSE (bd close without passing quality gates or sending result mail). Add cost-awareness: every mail costs tokens. Add explicit completion protocol per role.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:13:06.430871-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:25:40.483006-08:00","closed_at":"2026-02-12T12:25:40.483006-08:00","close_reason":"Added propulsion principle, named failure modes, cost awareness, and completion protocol to all agent definitions (scout, builder, reviewer, lead, merger)"}
{"id":"overstory-16g","title":"Epic: Adopt 'never mock what you can use for real' testing philosophy","description":"Overhaul the test suite to follow the principle: never mock what you can use for real. Currently 4 of 12 test files use Bun.spawn mocks for external tools (worktree, beads-client, resolver, tmux). Most of these can be replaced with real implementations using temp directories, real git repos, real SQLite, and real bd. Only tmux and external AI services truly need mocking. This epic also covers relocating tests from __tests__/ to colocated with source files.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:55:47.248182-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:14:41.040434-08:00","closed_at":"2026-02-12T09:14:41.040434-08:00","close_reason":"All tasks complete: tests colocated, test harness created, CLAUDE.md updated, tmux mock documented, worktree/resolver/beads-client tests rewritten with real implementations. Found and fixed real bd CLI parsing bugs."}
{"id":"overstory-18zt","title":"Scout-first workflow: leads spawn scouts before builders","description":"Update lead.md to spawn 1-2 scouts first (in parallel for different aspects) before planning builder work. Currently leads do their own scouting, which blocks them from managing concurrent builders and produces lower quality specs than a specialized scout would.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-16T08:05:54.20244-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:33:59.130124-08:00","closed_at":"2026-02-16T13:33:59.130124-08:00","close_reason":"Updated lead.md Phase 1 to scout-first workflow: scouts are now the default exploration mechanism (1-2 in parallel), leads plan decomposition while scouts work, self-scouting restricted to trivial tasks meeting 3 explicit criteria. Builder implemented, reviewer verified PASS on all 8 acceptance criteria."}
{"id":"overstory-19e","title":"Mail messages may be lost during concurrent agent/orchestrator access","description":"During E2E testing, messages sent to 'status-builder' via 'mail send' returned success (with message IDs), but the messages were not found in mail.db afterward. This occurred while an agent was running in a worktree that shares the same .git directory and potentially the same mail.db. Possible causes: (1) WAL file contention between agent and orchestrator SQLite connections, (2) WAL checkpoint race condition, (3) the merge process somehow affecting SQLite state. Need investigation with concurrent access stress testing.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:54:16.59917-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T11:51:05.992165-08:00","closed_at":"2026-02-12T11:51:05.992165-08:00","close_reason":"Root cause was mail.ts using raw cwd instead of resolved project root, causing agents in worktrees to open separate mail.db files. Fixed by resolving project root in mailCommand. Also added PRAGMA synchronous=NORMAL and WAL checkpoint on close for better concurrent access."}
{"id":"overstory-19p","title":"[Epic] Layer 3: Merge + Orchestration","description":"Merge system and orchestration commands. 6 parallel tasks. Depends on Layer 2 completion.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:49.943203-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:36:35.111621-08:00","closed_at":"2026-02-12T07:36:35.111621-08:00","close_reason":"All 6 L3 subtasks completed","dependencies":[{"issue_id":"overstory-19p","depends_on_id":"overstory-3vt","type":"blocks","created_at":"2026-02-12T07:12:19.266371-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-19p","depends_on_id":"overstory-26j","type":"blocks","created_at":"2026-02-12T07:12:19.402906-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-19p","depends_on_id":"overstory-tgb","type":"blocks","created_at":"2026-02-12T07:12:19.538662-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-19p","depends_on_id":"overstory-mxi","type":"blocks","created_at":"2026-02-12T07:12:19.671997-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-19p","depends_on_id":"overstory-1l3","type":"blocks","created_at":"2026-02-12T07:12:19.812703-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-19p","depends_on_id":"overstory-94i","type":"blocks","created_at":"2026-02-12T07:12:19.967081-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-1d3y","title":"Cherry-pick mulch decomposition commit onto main","description":"The builder branch overstory/builder-mulch-decomp/overstory-dp9p has a spurious commit (e6b4689) alongside the real implementation commit (1a271f0). overstory merge failed due to .beads/issues.jsonl conflict from the spurious commit. Cherry-pick only commit 1a271f0 onto main. Run quality gates after.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:33:10.047116-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:41:03.844815-08:00","closed_at":"2026-02-13T22:41:03.844815-08:00","close_reason":"Cherry-pick completed, merged to main"}
{"id":"overstory-1f9g","title":"Implement overstory doctor command","description":"Add a comprehensive health-check command (overstory doctor) that validates all overstory subsystems and reports actionable diagnostics. Modeled after mulch doctor. Should be non-destructive, comprehensive, and produce clear remediation steps. Categories: external deps, directory structure, config, databases, worktree/tmux alignment, session state, agent manifest, merge queue, log disk usage, version check. Future: --fix flag for auto-remediation, --json for structured output.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:59:00.740809-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:55:22.54026-08:00","closed_at":"2026-02-15T12:55:22.54026-08:00","close_reason":"Doctor command fully implemented: scaffold with CLI registration, check runner, ANSI output formatter, JSON output, --verbose/--category flags. 9 check categories implemented: dependencies, version, config, structure, logs, agents, databases, merge-queue, consistency. Plus 3 bonus tasks: --watchdog flag for coordinator, lead self-termination fix, inspect command."}
{"id":"overstory-1ilu","title":"Track orchestrator session cost in overstory costs","description":"## Problem\n\n`overstory costs` only shows costs for spawned agents (workers, leads, coordinator). The user's own Claude Code session (the orchestrator) is completely invisible to cost tracking. This means you cannot answer 'how much did this entire swarm session cost?' because the orchestrator's token usage is excluded.\n\n## Current Behavior\n\nAll hooks use an ENV guard that skips execution when OVERSTORY_AGENT_NAME is unset:\n```bash\n[ -z \"\\$OVERSTORY_AGENT_NAME\" ] \u0026\u0026 exit 0\n```\n\nThe orchestrator session (the user's Claude Code) does not have this env var set, so:\n- No session-end event fires → no transcript parsing → no metrics recorded\n- No token snapshots recorded → invisible to `overstory costs --live`\n- Not registered in sessions.db → no session lifecycle tracking\n\nThe coordinator agent (spawned via `overstory coordinator start`) IS tracked because it gets OVERSTORY_AGENT_NAME=coordinator. But the user's direct session is not.\n\n## Desired Behavior\n\n`overstory costs` should be able to show the orchestrator's own session cost, either:\n\n**Option A: Self-scan mode** — Add `overstory costs --self` that finds and parses the current session's transcript JSONL directly from `~/.claude/projects/{project-key}/{session-id}.jsonl`. No hooks needed, just filesystem discovery. Lightweight, no architectural changes.\n\n**Option B: Hook integration** — Modify the ENV guard to allow cost-specific logging for the orchestrator. Add a separate hook path that records token snapshots and session metrics for the orchestrator without requiring OVERSTORY_AGENT_NAME. More invasive, but gives real-time --live visibility.\n\n**Option C: Run-level aggregate** — When displaying costs for a run, also parse the coordinator's transcript (discoverable via runs.coordinator_session_id) and include it as a separate line item. Pairs well with the --run fix (separate issue).\n\n## Context\n\nThe transcript parser (`src/metrics/transcript.ts`) already handles any Claude Code JSONL file — it's agent-agnostic. The `src/commands/log.ts` transcript discovery logic (lines 183-226) also works for any project path. The plumbing exists; it just needs to be wired to the orchestrator.\n\n### Transcript location pattern:\n```\n~/.claude/projects/-Users-jayminwest-Projects-overstory/{session-id}.jsonl       # orchestrator\n~/.claude/projects/-Users-jayminwest-Projects-overstory--overstory-worktrees-{agent}/{session-id}.jsonl  # agents\n```\n\n## Files likely involved\n\n- `src/commands/costs.ts` — Add --self flag or orchestrator inclusion logic\n- `src/metrics/transcript.ts` — Already works, may need session discovery helper\n- `src/commands/log.ts` — Transcript path resolution logic to reuse\n- `templates/hooks.json.tmpl` — If going with Option B, modify ENV guard for cost hooks","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:08:31.158763-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T13:06:18.715633-08:00","closed_at":"2026-02-19T13:06:18.715633-08:00","close_reason":"Added --self flag to overstory costs. Discovers and parses the orchestrator session transcript from ~/.claude/projects/. 1916 tests pass."}
{"id":"overstory-1iw5","title":"Fix YAML parser: arrays after key: parsed as empty objects","description":"2 E2E tests in src/e2e/init-sling-lifecycle.test.ts fail because parseYaml in src/config.ts mishandles arrays. When YAML has 'key:\\n  - item1\\n  - item2', the parser creates {} for the key (empty value after colon) then fails to convert it to [] when array items appear. The Array.isArray check at line ~123 fails because existing is {} not []. sandbox.allowedDomains and sandbox.denyReadPaths are parsed as {} instead of arrays, causing ValidationError. Fix: when a '- ' array item is encountered and parent's last key is {}, convert it to [] before pushing.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T13:38:30.428253-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:02:03.087461-08:00","closed_at":"2026-02-16T07:02:03.087461-08:00","close_reason":"Already fixed in prior session (commits f841427, 420d8b7)"}
{"id":"overstory-1l3","title":"L3-5: Implement status command (src/commands/status.ts)","description":"CLI: overstory status [--json] [--watch]. Shows: active agents (name, state, task, duration), worktree status, beads summary, mail queue depth, merge queue state. --watch mode uses polling for live updates.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:09.461311-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:36:21.716923-08:00","closed_at":"2026-02-12T07:36:21.716923-08:00","close_reason":"All L3 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-1l3","depends_on_id":"overstory-rbj","type":"blocks","created_at":"2026-02-12T07:13:43.226662-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-1uaz","title":"Write supervisor.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:05:27.660237-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:32:05.328919-08:00","closed_at":"2026-02-13T09:32:05.328919-08:00","close_reason":"Test files already written and committed"}
{"id":"overstory-1wj","title":"Add PreToolUse guards to block dangerous operations","description":"Add hook entries that intercept: git push to canonical branch, git checkout -b with wrong naming, git reset --hard. Implement 'overstory guard \u003coperation\u003e' CLI command called by the hook. Validates branch naming conventions, prevents pushes to canonical branch. Different guard sets per capability (read-only agents get stricter guards blocking Write/Edit tools).","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:13:02.529044-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:34:19.46856-08:00","closed_at":"2026-02-12T12:34:19.46856-08:00","close_reason":"Added getDangerGuards() to hooks-deployer.ts: Bash PreToolUse guard that blocks git push to main/master, git reset --hard, and git checkout -b with wrong naming convention. Guards applied to all agent capabilities. 10 new tests added.","dependencies":[{"issue_id":"overstory-1wj","depends_on_id":"overstory-ll5","type":"blocks","created_at":"2026-02-12T12:13:23.987927-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-26j","title":"L3-2: Implement tiered conflict resolver (src/merge/resolver.ts)","description":"4-tier conflict resolution: 1) Clean merge (git merge --no-edit), 2) Auto-resolve (parse conflict markers), 3) AI-resolve (spawn claude --print with both versions), 4) Re-imagine (spawn claude --print on fresh checkout to reimplement). Tiers escalate automatically. Each tier configurable (enable/disable).","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:58.395385-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:36:21.651943-08:00","closed_at":"2026-02-12T07:36:21.651943-08:00","close_reason":"All L3 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-26j","depends_on_id":"overstory-rbj","type":"blocks","created_at":"2026-02-12T07:13:42.786609-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-27jf","title":"Add reviewer-ratio doctor check in consistency.ts","description":"Add doctor consistency check for reviewer-to-builder ratio per lead","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T08:01:23.5072-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T08:07:02.46679-08:00","closed_at":"2026-02-17T08:07:02.46679-08:00","close_reason":"Added reviewer-coverage consistency check in src/doctor/consistency.ts with 5 comprehensive tests. Check validates reviewer-to-builder ratio per lead agent to enforce review-before-merge workflow."}
{"id":"overstory-2bix","title":"Wire up tier2Enabled config flag or remove dead code","description":"The tier2Enabled key exists in watchdog config defaults (set to false) but no code path reads it. Either wire it into monitor.ts to gate Tier 2 startup, or remove it to avoid confusion.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:34.505552-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T17:07:00.89658-08:00","closed_at":"2026-02-18T17:07:00.89658-08:00","close_reason":"Wired tier2Enabled config flag into monitor.ts (throws AgentError when disabled) and coordinator.ts (skips --monitor auto-start when disabled). Updated stale 'not yet implemented' comments in types.ts and config.ts. Two builder branches with non-overlapping file scopes ready to merge."}
{"id":"overstory-2ed","title":"L2-3: Implement agent identity (src/agents/identity.ts)","description":"Persistent agent identity management. Create/load/update AgentIdentity YAML files at .overstory/agents/{name}/identity.yaml. Track sessions completed, expertise domains, recent tasks. Functions: createIdentity, loadIdentity, updateIdentity.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:50.235583-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:33:09.560065-08:00","closed_at":"2026-02-12T07:33:09.560065-08:00","close_reason":"All L2 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-2ed","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:40.937136-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-2gu1","title":"Orchestrator sessions skip mulch learn hooks","description":"All hooks in settings.local.json gate on OVERSTORY_AGENT_NAME being set. Regular Claude Code sessions (no swarm) never trigger the Stop hook, so mulch learn never runs and learning suggestions are never generated. Need a parallel hook path or remove the env guard for the Stop hook so direct orchestrator sessions also get post-session mulch analysis.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:28:59.084061-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:18:54.839187-08:00","closed_at":"2026-02-16T13:18:54.839187-08:00","close_reason":"All 3 assigned issues completed: (1) overstory-2gu1: Added mulch learn to Stop hooks for orchestrator and agent sessions, (2) overstory-l13t: Added --monitor flag to coordinator start/stop/status, (3) overstory-f0kl: Scoped as external mulch-cli work - overstory client already wraps all available features."}
{"id":"overstory-2hk3","title":"Implement ResolvedModel return type for resolveModel()","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T07:37:15.650909-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T07:43:07.179725-08:00","closed_at":"2026-02-20T07:43:07.179725-08:00","close_reason":"Added ResolvedModel interface, relaxed AgentDefinition.model to ModelRef, implemented resolveProviderEnv() helper, updated resolveModel() to return ResolvedModel with gateway env vars, updated 4 callers to destructure .model, added comprehensive tests"}
{"id":"overstory-2ki1","title":"overstory init should add .overstory/README.md","description":"When running 'overstory init', generate a .overstory/README.md explaining the directory's purpose, similar to what .beads/ and .mulch/ do. This helps contributors understand what .overstory/ is without needing to read the main project docs.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:33:26.367216-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T16:35:42.65089-08:00","closed_at":"2026-02-18T16:35:42.65089-08:00","close_reason":"Implemented .overstory/README.md generation in overstory init via builder init-readme-builder. Branch overstory/init-readme-builder/overstory-4dtk ready for merge."}
{"id":"overstory-2kn","title":"L4-5: Implement log command (src/commands/log.ts)","description":"CLI: overstory log \u003cevent\u003e --agent \u003cname\u003e. Called by Pre/PostToolUse and Stop hooks. Events: tool-start, tool-end, session-end. Writes to .overstory/logs/{agent-name}/{session-timestamp}/ in multi-format (session.log human-readable + events.ndjson machine-parseable).","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:28.215057-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:39:41.975202-08:00","closed_at":"2026-02-12T07:39:41.975202-08:00","close_reason":"All L4 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-2kn","depends_on_id":"overstory-19p","type":"blocks","created_at":"2026-02-12T07:13:45.471433-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-2mi","title":"Test task for sling","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:36:06.136009-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:57:10.074886-08:00","closed_at":"2026-02-12T10:57:10.074886-08:00","close_reason":"Stale test issue from earlier sling testing. Superseded by E2E exercise (overstory-aqf)."}
{"id":"overstory-2ml","title":"L0-7: Write agents/builder.md base definition","description":"Builder agent: implementation agent. Can read/write/edit files, run bash (git, tests, lint), send mail. Must only modify files in FILE_SCOPE. Commits to worktree branch only.","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:28.100512-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:20:05.122603-08:00","closed_at":"2026-02-12T07:20:05.122603-08:00","close_reason":"Created all 5 base agent definitions: scout (read-only explorer), builder (implementation), reviewer (validation), lead (delegation), merger (branch integration)"}
{"id":"overstory-2ni","title":"capabilityIndex was empty in original agent-manifest.json","description":"The agent-manifest.json generated by the initial 'overstory init' had capabilityIndex: {} (empty). Running 'init --force' correctly regenerated it with all capabilities. This suggests the manifest was created before the capabilityIndex generation code was added and never re-generated. Not a code bug per se (init.ts code is correct), but existing deployments may have stale manifests. Consider adding a migration or validation check that warns when capabilityIndex is empty.","status":"closed","priority":4,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:09:48.845497-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:14:41.526858-08:00","closed_at":"2026-02-12T10:14:41.526858-08:00","close_reason":"capabilityIndex already correctly populated in .overstory/agent-manifest.json -- matches buildAgentManifest() output"}
{"id":"overstory-2zg1","title":"Migrate session lifecycle writers to SessionStore","description":"Replace sessions.json read/write in agent spawning and state-transition files with the SQLite-backed SessionStore (via openSessionStore from sessions/compat.ts).\n\nFiles to migrate: src/commands/sling.ts, src/commands/coordinator.ts, src/commands/supervisor.ts, src/commands/monitor.ts, src/commands/log.ts.\n\nEach file has duplicated loadSessions/saveSessions helpers that read/write sessions.json. Replace with:\n- store.upsert() for session registration after spawning\n- store.updateState() for state transitions (booting-\u003eworking, working-\u003ecompleted)\n- store.getByName() for single-session lookups\n- store.updateLastActivity() for heartbeat updates\n- store.getActive() where needed\n\nThe SessionStore API is in src/sessions/store.ts, and openSessionStore() in src/sessions/compat.ts handles JSON-to-SQLite migration automatically.\n\nUpdate all associated test files (.test.ts) to create sessions via SessionStore instead of writing sessions.json fixtures.\n\nAcceptance criteria:\n- All 5 source files use SessionStore exclusively (no sessions.json read/write)\n- All tests pass (bun test)\n- Type checking passes (tsc --noEmit)\n- Lint passes (biome check .)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T14:53:46.841285-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T19:16:13.148674-08:00","closed_at":"2026-02-13T19:16:13.148674-08:00","close_reason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed."}
{"id":"overstory-33p8","title":"Create STEELMAN.md and add README disclaimer","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T12:55:15.850378-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T13:04:37.911616-08:00","closed_at":"2026-02-13T13:04:37.911616-08:00","close_reason":"First builder attempt - wrote files to wrong directory (main repo instead of worktree). Content was good but location was wrong. Superseded by overstory-ngz7."}
{"id":"overstory-34rb","title":"Migrate sling.ts and monitor.ts to SessionStore","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T14:56:44.005121-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T19:16:13.15506-08:00","closed_at":"2026-02-13T19:16:13.15506-08:00","close_reason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed."}
{"id":"overstory-378","title":"status --watch: no validation for --interval value","description":"overstory status --watch --interval accepts invalid values: negative numbers cause infinite busy-wait, zero causes 100% CPU spin, NaN (from non-numeric input like 'abc') causes undefined Bun.sleep behavior. Unlike sling.ts which validates --depth with Number.isNaN(), status.ts line 230 skips NaN check entirely. Fix: add NaN check and minimum interval validation (e.g. \u003e= 500ms).","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:09:33.105487-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:14:02.596158-08:00","closed_at":"2026-02-12T10:14:02.596158-08:00","close_reason":"Fixed: --interval now validates for NaN and minimum 500ms, following sling.ts --depth validation pattern"}
{"id":"overstory-37e","title":"Switch agents from headless (claude -p) to interactive mode with beacon injection","description":"Change sling.ts to launch 'claude \u003cbeacon\u003e' instead of 'claude -p \u003cprompt\u003e'. Beacon message tells agent its identity and task. Wait for Claude to be ready before considering agent 'working'. This unblocks hooks (SessionStart, UserPromptSubmit) which are currently dead in -p mode. Unblocks mail injection, multi-turn reasoning, and mid-flight communication. Currently at sling.ts:312 the command is 'claude -p' which runs headless one-shot mode where no hooks fire.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:12:59.036867-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:23:49.315286-08:00","closed_at":"2026-02-12T12:23:49.315286-08:00","close_reason":"Switched sling.ts from claude -p (headless) to claude (interactive). Agents now launch in interactive mode via tmux with beacon prompt sent via sendKeys. Initial state is booting; hooks handle transition to working."}
{"id":"overstory-38d","title":"L5-7: Write mail-client.test.ts","description":"Tests for src/mail/client.ts. Cover: send() returns ID, check() returns unread for agent, checkInject() formats for hook injection, list() with filters (from/to/unread), markRead(), reply() creates threaded message.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:32.422933-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:54:20.436677-08:00","closed_at":"2026-02-12T07:54:20.436677-08:00","close_reason":"Closed","dependencies":[{"issue_id":"overstory-38d","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:47.730538-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-39u","title":"AI-resolve tier corrupts files: claude --print outputs prose instead of code","description":"When tier 3 (AI-resolve) triggers, the resolver calls 'claude --print -p \u003cprompt\u003e' to resolve conflicts. But claude --print can return conversational prose (e.g., 'I need permission to edit the file...') instead of the actual resolved code. This output gets written directly to the file, corrupting it. The commit succeeds silently, leaving corrupted files on the canonical branch. Fix must include: (1) validate that resolved output is valid code (e.g., check it parses/compiles), (2) fall back to tier 4 if output looks like prose, (3) possibly use a more structured prompt that constrains output format.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:34:32.651697-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:41:39.077233-08:00","closed_at":"2026-02-12T10:41:39.077233-08:00","close_reason":"Closed"}
{"id":"overstory-3dq","title":"init doesn't deploy agent definition .md files to target project","description":"overstory init creates .overstory/ and agent-manifest.json, but does NOT copy agent definition files (scout.md, builder.md, etc.) from overstory's agents/ dir to the target project. sling then fails because manifest.load() resolves agent files relative to config.project.root + config.agents.baseDir, and those files don't exist in the target project. Either init needs to copy them, or sling needs to resolve paths from the overstory installation directory.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:47:12.104934-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:58:36.429522-08:00","closed_at":"2026-02-12T12:58:36.429522-08:00","close_reason":"Superseded by overstory-06l7 which has a more complete description and is part of the phased plan"}
{"id":"overstory-3ds8","title":"Write molecules integration tests (molecules.test.ts)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:21:14.465989-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:41:52.924331-08:00","closed_at":"2026-02-13T08:41:52.924331-08:00","close_reason":"Molecules unit tests written: 16 tests with mocked Bun.spawn (bd mol API not yet implemented)"}
{"id":"overstory-3e3s","title":"sling should use resolveModel() for config-level model overrides","description":"sling.ts:426 reads agentDef.model directly from the manifest instead of going through resolveModel(). This means config.models overrides in config.yaml have no effect on sling-spawned agents (scout, builder, reviewer, merger, lead). Only persistent agents (coordinator, supervisor, monitor) respect config overrides because they call resolveModel(). Fix: replace agentDef.model with resolveModel(config, manifest, capability, agentDef.model) in sling.ts.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:53:54.63905-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T07:29:30.79223-08:00","closed_at":"2026-02-18T07:29:30.79223-08:00","close_reason":"sling now uses resolveModel() for config-level model overrides. Merged from overstory/sling-model-builder/overstory-07jl."}
{"id":"overstory-3n0","title":"L4-4: Implement watch command (src/commands/watch.ts)","description":"CLI: overstory watch [--interval \u003cms\u003e] [--background]. Starts watchdog daemon. Foreground mode shows real-time status. Background mode daemonizes. Interval configurable, default 30000ms.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:22.651404-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:39:41.953007-08:00","closed_at":"2026-02-12T07:39:41.953007-08:00","close_reason":"All L4 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-3n0","depends_on_id":"overstory-19p","type":"blocks","created_at":"2026-02-12T07:13:45.331166-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-3up","title":"mail send accepts invalid --type and --priority values","description":"'overstory mail send' accepts arbitrary values for --type and --priority without validation. The CLI docs specify type should be one of: status|question|result|error, and priority should be one of: low|normal|high|urgent. Currently any string is accepted (e.g., --type invalid_type, --priority invalid_prio both succeed). Should validate against allowed values.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:11:19.801105-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:43:49.101828-08:00","closed_at":"2026-02-12T08:43:49.101828-08:00","close_reason":"Added validation for --type and --priority in handleSend — rejects invalid values with ValidationError listing allowed options"}
{"id":"overstory-3vk","title":"mail reply sends to self instead of original sender","description":"'overstory mail reply \u003cid\u003e --body ...' routes the reply back to the replier (orchestrator → orchestrator) instead of to the original sender. Expected: reply should go to the 'from' field of the original message. In this case, orchestrator sent to status-builder, then replied to that message, and the reply went to orchestrator instead of status-builder.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:49:43.965408-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T11:51:47.316783-08:00","closed_at":"2026-02-12T11:51:47.316783-08:00","close_reason":"Fixed reply routing: when replier is the original sender (from === original.from), reply now goes to original.to instead of original.from. Added tests for reply-to-own-message and third-party reply scenarios."}
{"id":"overstory-3vt","title":"L3-1: Implement merge queue (src/merge/queue.ts)","description":"FIFO merge queue for agent branches. Tracks: branchName, beadId, agentName, filesModified, enqueuedAt, status (pending/merging/merged/conflict/failed), resolvedTier. Functions: enqueue, dequeue, peek, list, updateStatus.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:54.295042-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:36:21.628694-08:00","closed_at":"2026-02-12T07:36:21.628694-08:00","close_reason":"All L3 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-3vt","depends_on_id":"overstory-rbj","type":"blocks","created_at":"2026-02-12T07:13:42.648756-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-3wa","title":"L5-3: Write worktree.test.ts","description":"Tests for src/worktree/manager.ts. Cover: create worktree (uses temp dirs), list worktrees, remove worktree, branch naming convention (overstory/{agentName}/{beadId}), error handling for missing repo.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:28.851869-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:54:20.463578-08:00","closed_at":"2026-02-12T07:54:20.463578-08:00","close_reason":"Closed","dependencies":[{"issue_id":"overstory-3wa","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:47.140959-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-3yvt","title":"Phase 2: Real-time Observability","description":"Enable real-time visibility into what agents are doing. Currently metrics are only recorded at session end and logs require manual file parsing.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:24.529132-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T17:47:53.12094-08:00","closed_at":"2026-02-16T17:47:53.12094-08:00","close_reason":"Phase 2 substantially complete. Real-time observability delivered: dashboard TUI, feed --follow, inspect --follow, costs --live, logs --follow, trace, replay, errors commands. Real-time event recording via PostToolUse hooks. Real-time token snapshots via recordSnapshot(). Remaining gap (health state in dashboard) tracked as overstory-gqlo.","dependencies":[{"issue_id":"overstory-3yvt","depends_on_id":"overstory-0wfq","type":"blocks","created_at":"2026-02-15T17:05:28.598886-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-4029","title":"Write logging subsystem tests (sanitizer, reporter, logger)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:21:12.720001-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:41:50.474976-08:00","closed_at":"2026-02-13T08:41:50.474976-08:00","close_reason":"Logging subsystem tests written: sanitizer.test.ts (18 tests), reporter.test.ts (17 tests), logger.test.ts (23 tests - flaky version, replaced by overstory-6034)"}
{"id":"overstory-41f","title":"L1-7: Implement metrics storage (src/metrics/*)","description":"SQLite metrics store via bun:sqlite. Schema for SessionMetrics (agent name, bead ID, capability, duration, exit code, merge result). Summary reporting with aggregations. Files: src/metrics/store.ts, src/metrics/summary.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:50.245509-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:26:01.472187-08:00","closed_at":"2026-02-12T07:26:01.472187-08:00","close_reason":"Implemented metrics storage (SQLite store + summary reporter) and mail SQLite store (schema, CRUD, WAL mode, prepared statements)","dependencies":[{"issue_id":"overstory-41f","depends_on_id":"overstory-68p","type":"blocks","created_at":"2026-02-12T07:13:39.670025-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-4200","title":"Add PreToolUse path-boundary guard for builder/merger Write/Edit operations","description":"## Problem\n\nIn the latest coordinator run, builder agents (builder-steelman, builder-steelman-2) and the lead agent wrote STEELMAN.md and modified README.md directly in the canonical repo root instead of their assigned worktrees. All three agent worktrees have zero commits — the work landed entirely in root.\n\n## Root Cause\n\nhooks-deployer.ts blocks Write/Edit tools for non-implementation agents (scout, reviewer, lead) but has NO path validation for implementation agents (builder, merger). A builder agent can call Write or Edit with any absolute path — including paths outside its worktree — and nothing stops it.\n\n## Evidence\n\n- STEELMAN.md exists at /Users/jayminwest/Projects/overstory/STEELMAN.md (root, untracked)\n- README.md modified at root (git diff shows steelman warning added)\n- .overstory/worktrees/builder-steelman/ has no commits beyond main\n- .overstory/worktrees/builder-steelman-2/ has no commits beyond main\n- .overstory/worktrees/lead-steelman/ has no commits beyond main\n\n## Solution\n\nAdd a PreToolUse hook for Write, Edit, and NotebookEdit that:\n\n1. Reads the tool_input from stdin JSON\n2. Extracts the file_path / file parameter\n3. Resolves it to an absolute path\n4. Checks that it starts with the agent's worktree path (passed via OVERSTORY_WORKTREE_PATH env var)\n5. Blocks with decision=block if the path is outside the worktree boundary\n\nImplementation in hooks-deployer.ts:\n- New function buildPathBoundaryGuardScript(worktreePath) that generates the validation script\n- Apply to ALL agent capabilities (not just builders — even scouts shouldn't read outside scope)\n- Pass OVERSTORY_WORKTREE_PATH as an env var alongside OVERSTORY_AGENT_NAME in sling.ts tmux creation\n- Guard must handle both absolute paths and relative paths (resolve relative to cwd)\n\n## Files to modify\n\n- src/agents/hooks-deployer.ts — add path boundary guard generation\n- src/commands/sling.ts — pass OVERSTORY_WORKTREE_PATH env var to tmux session\n- src/agents/hooks-deployer.test.ts — test the new guard\n- templates/hooks.json.tmpl — may need worktree path placeholder","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:03:01.94768-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T14:23:42.623711-08:00","closed_at":"2026-02-13T14:23:42.623711-08:00","close_reason":"Added PreToolUse path boundary guard for Write/Edit/NotebookEdit using OVERSTORY_WORKTREE_PATH env var. Guards apply to all agent capabilities as defense-in-depth. Updated sling.ts to pass env var to tmux session."}
{"id":"overstory-442z","title":"Post-swarm summary via mulch diff","description":"After a swarm run completes, the coordinator runs mulch diff --since \u003cswarm-start-ref\u003e to see what expertise the swarm produced. Surface this in the run summary so the coordinator has visibility into organizational learning from the swarm. Could also be part of overstory status --verbose output. Depends on expanded MulchClient (overstory-j53z) for the diff wrapper.","status":"open","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:42:23.997138-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T21:42:23.997138-08:00","dependencies":[{"issue_id":"overstory-442z","depends_on_id":"overstory-j53z","type":"blocks","created_at":"2026-02-13T21:42:32.487213-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-44m6","title":"Fix doctor tests: stale assertions assume check modules are stubs","description":"9 doctor tests in src/commands/doctor.test.ts fail because they were written when all check modules returned empty arrays (stubs). The modules (dependencies, config, structure, databases, consistency, agents, merge-queue, logs, version) are now fully implemented and return real results. Failing tests: empty stubs produce zero counts, shows summary line with zero counts, summary uses singular form, default mode does not show empty categories, shows No checks for empty categories, runs only specified category, exit code is undefined when all pass, exit code 0 on success, handles multiple flags together. Fix: update test setup to create a valid .overstory/ directory so checks pass, or update assertions to expect real check results.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T13:38:25.937901-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:02:03.113493-08:00","closed_at":"2026-02-16T07:02:03.113493-08:00","close_reason":"Already fixed in prior session (commits f841427, 420d8b7)"}
{"id":"overstory-4ab0","title":"File-scoped priming in sling.ts via mulch prime --files","description":"In sling.ts, when --files is provided and mulch is enabled, call mulch prime --files \u003cfile1,file2,...\u003e instead of generic mulch prime \u003cdomains\u003e. This gives agents only the expertise relevant to their file scope, dramatically reducing noise. Falls back to domain-scoped priming if files not specified. Extend MulchClient.prime() signature to accept files parameter. Depends on expanded MulchClient (overstory-j53z).","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:42:17.992316-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:28:26.772807-08:00","closed_at":"2026-02-13T22:28:26.772807-08:00","close_reason":"Implemented as part of overstory-95za: sling.ts auto-fetches mulch prime --files when files scoped (4ab0), overlay embeds mulchExpertise with Pre-loaded Expertise section (wzaq).","dependencies":[{"issue_id":"overstory-4ab0","depends_on_id":"overstory-j53z","type":"blocks","created_at":"2026-02-13T21:42:32.186376-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-4cm","title":"Sling does not pass --model flag from agent manifest to claude CLI","description":"The agent manifest specifies model per capability (haiku for scout, sonnet for builder, opus for lead) but sling.ts line 312 constructs the claude command as 'claude -p ... --dangerously-skip-permissions' without --model. All agents use the default model regardless of capability. This defeats the cost optimization (scouts should use haiku) and capability matching (leads should use opus). Fix: read model from manifest entry and add '--model \u003cmodel\u003e' to claudeCmd.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:10:30.410602-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:15:39.514059-08:00","closed_at":"2026-02-12T12:15:39.514059-08:00","close_reason":"Added --model flag from manifest to claude CLI command in sling"}
{"id":"overstory-4cto","title":"Allow git add/commit in coordinator hooks (keep git push blocked)","description":"Coordinator hooks in hooks-deployer.ts block git add and git commit via DANGEROUS_BASH_PATTERNS. This prevents the coordinator from committing beads/mulch sync files and test fixes. The coordinator needs git add/commit to finalize work (commit beads sync, mulch records, test updates). git push should remain blocked — merges and pushes are handled by merger agents or the human. Fix: either (1) add git add/git commit to SAFE_BASH_PREFIXES for coordinator capability, or (2) remove git add/git commit from DANGEROUS_BASH_PATTERNS for non-implementation agents and rely on Write/Edit blocks to prevent source file modification.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:56:43.515738-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:45:08.583691-08:00","closed_at":"2026-02-13T06:45:08.583691-08:00","close_reason":"Added COORDINATION_CAPABILITIES set and COORDINATION_SAFE_PREFIXES. buildBashFileGuardScript now accepts extraSafePrefixes param. Coordinator/supervisor get git add/commit whitelisted while git push remains blocked."}
{"id":"overstory-4dtk","title":"Implement .overstory/README.md generation in init command","description":"Add README.md to overstory init. Whitelist !README.md in OVERSTORY_GITIGNORE, create OVERSTORY_README constant, write it during init, add tests.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T16:32:19.481561-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T16:35:41.328723-08:00","closed_at":"2026-02-18T16:35:41.328723-08:00","close_reason":"Added OVERSTORY_README constant, writeOverstoryReadme(), whitelisted !README.md in gitignore, 4 new tests. All quality gates pass."}
{"id":"overstory-4h93","title":"Add real-time token tracking during active sessions","description":"Currently metrics are only recorded at session end. Add periodic token snapshots during active sessions via EventStore tool-end events. Enable 'overstory costs --live' to show current burn rate across all active agents.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:33.461126-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:41:49.393672-08:00","closed_at":"2026-02-16T13:41:49.393672-08:00","close_reason":"Real-time token tracking implemented. Builder token-tracking-builder created: TokenSnapshot type, token_snapshots table with 4 methods (recordSnapshot, getLatestSnapshots, getLatestSnapshotTime, purgeSnapshots), throttled snapshot recording in log.ts tool-end handler (30s interval), costs --live flag for live burn rate display. All 1717 tests pass, lint clean, typecheck clean."}
{"id":"overstory-4jca","title":"Add --file filter to MulchClient.search()","description":"Add file option to MulchClient.search() in src/mulch/client.ts to pass mulch 0.4.3's --file flag for file-scoped expertise lookup. Update lead/supervisor agent definitions to suggest file-scoped search before decomposing work (e.g. mulch search 'error handling' --file src/commands/init.ts). Supplements existing --files support in prime().","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-20T12:49:43.648478-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:23:12.41754-08:00","closed_at":"2026-02-20T13:23:12.41754-08:00","close_reason":"File filter added to search() in client.ts (mulch-client-builder). File-scoped search added to lead.md and supervisor.md (overlay-defs-builder)."}
{"id":"overstory-4ku","title":"merge fails: cannot checkout main when orchestrator worktree has it checked out","description":"Running 'overstory merge --branch \u003cagent-branch\u003e' sometimes fails with 'fatal: main is already checked out'. Observed during e2e testing: first merge attempt failed, second attempt succeeded immediately after. Possibly related to: (1) git state corruption from previous dry-run, (2) uncommitted .beads/issues.jsonl confusing checkout, or (3) race condition in config.project.root resolution. Needs investigation to determine if this is reliably reproducible.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:24:48.379419-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:41:39.053575-08:00","closed_at":"2026-02-12T10:41:39.053575-08:00","close_reason":"Closed"}
{"id":"overstory-4l1e","title":"Validate mail round-trip between orchestrator and agent","description":"While a slung agent is running, send it mail via overstory mail send. Verify the agent receives it via UserPromptSubmit hook injection. Check if the agent sends mail back to orchestrator. Validates the communication layer works in practice.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:57:41.546072-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:19:58.226975-08:00","closed_at":"2026-02-12T13:19:58.226975-08:00","close_reason":"Validated full mail round-trip: send, check, reply, inject format all working. Agent-to-orchestrator and orchestrator-to-agent flows confirmed.","dependencies":[{"issue_id":"overstory-4l1e","depends_on_id":"overstory-rnqn","type":"blocks","created_at":"2026-02-12T12:58:31.07181-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-4lqu","title":"Review: lead.md coordinator-not-doer rewrite","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T16:36:35.219022-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T16:41:28.715799-08:00","closed_at":"2026-02-18T16:41:28.715799-08:00","close_reason":"Review PASS: all 6 edits verified against spec, quality gates clean (1872 tests, lint, typecheck)"}
{"id":"overstory-4nw","title":"watch --background: exit code 0 when watchdog already running","description":"Running 'overstory watch --background' when a watchdog is already running outputs a warning message but exits with code 0 (success). Should exit with code 1 to indicate the operation didn't succeed, or provide a way to check if the watchdog is running (e.g. 'overstory watch --status').","status":"closed","priority":4,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:09:51.035346-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:14:43.202686-08:00","closed_at":"2026-02-12T10:14:43.202686-08:00","close_reason":"watch --background now exits with code 1 and writes to stderr when watchdog is already running"}
{"id":"overstory-4p77","title":"Tests for multi-provider model support","description":"Write tests for all multi-provider components. Tests colocated with source files per project convention.\n\nFILES: src/config.test.ts, src/agents/manifest.test.ts, src/commands/sling.test.ts (or new test files as needed)\n\nTest cases:\n1. Config parsing: providers section parsed correctly, merged across config layers\n2. Config validation: rejects invalid provider types, missing baseUrl on gateways, references to nonexistent providers\n3. Backward compat: simple model strings still work, empty providers section = current behavior\n4. resolveModel(): simple alias returns { model: 'sonnet' } with no env; provider-prefixed returns correct env dict with ANTHROPIC_BASE_URL, ANTHROPIC_AUTH_TOKEN, ANTHROPIC_API_KEY=''\n5. Provider env resolution: correctly reads authTokenEnv from process.env\n6. Edge cases: unknown provider reference, missing env var for auth token, deeply nested model IDs (openrouter/openai/gpt-5.3 where model ID itself contains slashes)\n\nUse real temp dirs and SQLite per project test conventions. Only mock tmux (real tmux interferes with dev sessions).","status":"open","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:14:05.803356-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:14:05.803356-08:00","dependencies":[{"issue_id":"overstory-4p77","depends_on_id":"overstory-otwd","type":"blocks","created_at":"2026-02-19T12:14:12.120261-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-4ra","title":"merge --branch shows raw git error for nonexistent branches","description":"'overstory merge --branch nonexistent-branch' leaks a raw git error message: 'fatal: ambiguous argument main...nonexistent-branch'. Should first validate that the branch exists and provide a user-friendly error like 'Branch nonexistent-branch not found'.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:11:49.921127-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:43:20.020735-08:00","closed_at":"2026-02-12T08:43:20.020735-08:00","close_reason":"Added branch existence validation in merge --branch. Uses git rev-parse --verify refs/heads/\u003cbranch\u003e before attempting git diff, throwing a user-friendly ValidationError instead of leaking raw git errors."}
{"id":"overstory-4szs","title":"Watchdog nudge is phase-unaware: reports 'Ready for merge/cleanup' after scout phase","description":"When a scout phase completes (all scouts finish), the watchdog sends a nudge to the coordinator saying: '[WATCHDOG] All 6 worker(s) in run run-... have completed. Ready for merge/cleanup.' This is incorrect — a scout phase completing doesn't mean work is ready for merge/cleanup. Scouts are just doing exploration; the real build work hasn't started yet. The watchdog needs to be phase-aware so it can send contextually appropriate messages. For example, after a scout phase it should say something like 'All scouts have completed. Ready for next phase.' instead of implying the entire run is done.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-19T06:31:07.559564-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:27:32.515101-08:00","closed_at":"2026-02-19T12:27:32.515101-08:00","close_reason":"Fixed watchdog nudge to be phase-aware. Added buildCompletionMessage() helper to daemon.ts that generates contextually appropriate nudge messages based on worker capabilities (scouts→'Ready for next phase', builders→'Ready for merge/cleanup', reviewers→'Reviews done', mixed→breakdown). Updated event data to include capabilities array and phase field. 50/50 tests pass, typecheck clean."}
{"id":"overstory-4uu","title":"staggerDelayMs is never enforced between agent spawns","description":"The config has agents.staggerDelayMs=2000 intended as a delay between spawning agents to avoid resource contention, but sling never reads or enforces this delay. Multiple agents can be spawned instantly back-to-back.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:22:59.362789-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:53:44.789454-08:00","closed_at":"2026-02-12T08:53:44.789454-08:00","close_reason":"Extracted calculateStaggerDelay pure function and wired it into slingCommand step 4b. 12 unit tests added."}
{"id":"overstory-4xb","title":"Agent state stays 'booting' forever in -p headless mode","description":"When running claude -p (headless mode), the SessionStart/UserPromptSubmit hooks that normally transition agent state from 'booting' to 'working' via 'overstory log tool-start' may not fire. Agents appear stuck in 'booting' state in overstory status even though they are actively working (modifying files in their worktree). Need to either: (1) fire hooks in -p mode, (2) set initial state to 'working' in sling, or (3) have status reconcile by checking for worktree activity.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:51:34.589129-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T11:47:26.643495-08:00","closed_at":"2026-02-12T11:47:26.643495-08:00","close_reason":"Fixed agent state stuck in booting forever when using headless mode (claude -p). Since hooks do not fire in headless mode, the booting-\u003eworking transition in log.ts never occurs. Changed sling.ts to set initial state to working instead of booting at spawn time."}
{"id":"overstory-4yad","title":"Lead 3: Agent and logging subsystems test coverage (identity, molecules, logging)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T07:58:40.880134-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:55:07.562407-08:00","closed_at":"2026-02-13T08:55:07.562407-08:00","close_reason":"Test coverage blitz complete: 830 tests, 0 failures, 42 files. All 17 modules now have test coverage."}
{"id":"overstory-4zcj","title":"Dashboard zombie reconciliation uses O(n*m) linear scan","description":"status.ts:108-124 iterates all sessions and calls tmuxSessions.some() (linear scan) for each. At 40 agents x 40 tmux sessions = 1600 comparisons per tick. Fix: pre-build a Set\u003cstring\u003e of tmux session names before the loop, replace .some() with .has().","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-19T13:28:15.264081-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T08:03:32.640732-08:00","closed_at":"2026-02-20T08:03:32.640732-08:00","close_reason":"Replaced O(n*m) tmuxSessions.some() with Set.has() lookup in gatherStatus() and printStatus(). Pre-builds Set\u003cstring\u003e before loop."}
{"id":"overstory-50l","title":"L1-2: Implement agent manifest loader (src/agents/manifest.ts)","description":"Load agent-manifest.json, capability routing (find agents by capability), validation of agent definitions. Returns typed AgentManifest. Queries: getByCapability(cap) -\u003e AgentDefinition[]","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:29.294856-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:25:14.359612-08:00","closed_at":"2026-02-12T07:25:14.359612-08:00","close_reason":"Implemented manifest loader (load, capability routing, validation) and worktree manager (create/list/remove via git CLI)","dependencies":[{"issue_id":"overstory-50l","depends_on_id":"overstory-68p","type":"blocks","created_at":"2026-02-12T07:13:38.960165-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-51t","title":"Agent state stuck at 'booting' — evaluateHealth() never transitions to 'working'","description":"In src/watchdog/health.ts, evaluateHealth() has a code path where session.state === 'booting' unconditionally returns state: 'booting' without checking lastActivity freshness. This means an agent NEVER transitions from booting to working, even when the watchdog is running. The fix: when booting and lastActivity is recent (within staleThresholdMs), transition to 'working'. Additionally, without the watchdog running, log events (tool-start, tool-end) only update lastActivity but never touch the state field in sessions.json, so agents are permanently stuck at booting.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:40:56.790025-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:47:49.402863-08:00","closed_at":"2026-02-12T09:47:49.402863-08:00","close_reason":"Fixed evaluateHealth() to transition booting→working when activity is recent. Also fixed updateLastActivity() in log.ts to transition state from booting to working on first tool event."}
{"id":"overstory-52z","title":"Headless agents cannot receive mail during execution","description":"Agents spawn via 'claude -p' (headless mode), so UserPromptSubmit hooks never fire. This means overstory mail check --inject never runs, and agents cannot see messages sent to them during execution. The overlay CLAUDE.md instructs agents to 'Check your inbox (do this regularly)' which is impossible in headless mode. Either: (a) the overlay should not include mail-check instructions for headless agents, (b) agents should be given a way to poll mail, or (c) consider alternative spawn modes.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:04:42.917314-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:23:51.456728-08:00","closed_at":"2026-02-12T12:23:51.456728-08:00","close_reason":"Resolved by overstory-37e: switching to interactive mode means all hooks (SessionStart, UserPromptSubmit, PreToolUse, PostToolUse, Stop) now fire. Mail injection, metrics recording, lastActivity updates, and log directories all work."}
{"id":"overstory-5bic","title":"Progressive nudging before kill (warn → nudge → escalate → terminate)","description":"Replace the current binary stalled→terminate behavior with a progressive sequence: (1) warn: log warning, no action (2) nudge: send tmux nudge via existing nudge command (3) escalate: invoke Tier 1 triage (4) terminate: kill tmux session. Requires adding nudgeCount/escalationLevel to AgentSession in types.ts, modifying daemon.ts tick logic to progress through stages on each tick where agent remains stalled, configurable thresholds for each stage transition in WatchdogConfig. Must integrate with existing nudgeAgent() from nudge.ts.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T06:51:21.419174-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T07:01:12.846125-08:00","closed_at":"2026-02-13T07:01:12.846125-08:00","close_reason":"Implemented progressive nudging (warn-\u003enudge-\u003eescalate-\u003eterminate) with escalationLevel/stalledSince on AgentSession, nudgeIntervalMs config, and full daemon.ts rewrite"}
{"id":"overstory-5imc","title":"Design Tier 3 watchdog: supervisor monitors per-project","description":"Tier 3 of the watchdog hierarchy (supervisor that monitors across projects) has no design or implementation. Create a design doc/spec if this tier is still desired, or formally descope it.","status":"closed","priority":4,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:36.233805-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T19:10:41.739842-08:00","closed_at":"2026-02-16T19:10:41.739842-08:00","close_reason":"Premature. No current need for cross-project supervisor tier. Can revisit if multi-project orchestration becomes a real use case."}
{"id":"overstory-5rq","title":".overstory/.gitignore missing merge-queue.json","description":"The .overstory/.gitignore generated by init does not include merge-queue.json. When overstory merge is run, it creates merge-queue.json which shows up as an untracked file in git status. This is a runtime state file that should be gitignored alongside sessions.json and the SQLite databases.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:44:25.410111-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:55:56.446377-08:00","closed_at":"2026-02-12T09:55:56.446377-08:00","close_reason":"Added merge-queue.json to .overstory/.gitignore generated by init"}
{"id":"overstory-5s0","title":"mail list --unread shows no results despite unread messages existing","description":"'overstory mail list --unread' returns 'No messages found' even when there is an unread message (sent from orchestrator to status-builder, confirmed visible via 'mail check --agent status-builder'). The --unread filter may not be checking from the right perspective or may be broken.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:49:23.64334-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T11:51:53.379696-08:00","closed_at":"2026-02-12T11:51:53.379696-08:00","close_reason":"Added --agent flag to mail list as alias for --to, enabling agent-scoped perspective (mail list --agent X --unread) without marking messages as read (unlike mail check). The root cause was that mail check marks messages read as a side effect, so running check before list showed no unread."}
{"id":"overstory-5u8","title":"worktree.test.ts: Replace Bun.spawn mocks with real git operations","description":"worktree.test.ts currently mocks all Bun.spawn calls for git worktree add/list/remove. Replace with real git operations in temp directories. Use the shared test harness to create a real git repo, then test createWorktree/listWorktrees/removeWorktree against actual git. This catches real parsing issues with git porcelain output and validates command construction end-to-end. Ref mulch failure mx-56558b: mock.module() leaks across test files.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:56:12.984224-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:05:22.457262-08:00","closed_at":"2026-02-12T09:05:22.457262-08:00","close_reason":"Replaced all Bun.spawn mocks with real git operations using test-helpers.ts","dependencies":[{"issue_id":"overstory-5u8","depends_on_id":"overstory-y72","type":"blocks","created_at":"2026-02-12T08:56:33.265159-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-5y26","title":"Write store.test.ts for src/metrics/store.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:20:19.808279-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:26:50.86271-08:00","closed_at":"2026-02-13T08:26:50.86271-08:00","close_reason":"Created store.test.ts with 20 tests using real SQLite"}
{"id":"overstory-5y5","title":"L1-5: Implement beads CLI client (src/beads/client.ts)","description":"Wrapper around bd CLI with --json output parsing. Interface: ready(), show(id), create(title, opts), claim(id), close(id, reason), status(), molPour(protoId, vars). All via Bun.spawn.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:41.494802-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:25:38.321618-08:00","closed_at":"2026-02-12T07:25:38.321618-08:00","close_reason":"Implemented beads CLI client — ready, show, create, claim, close, list via Bun.spawn with --json parsing","dependencies":[{"issue_id":"overstory-5y5","depends_on_id":"overstory-68p","type":"blocks","created_at":"2026-02-12T07:13:39.374196-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-5zhq","title":"Add sandbox tests","description":"Test the sandbox integration: (1) Config parsing — verify sandbox defaults applied when section omitted from YAML, verify explicit sandbox.enabled=false disables it, verify allowedDomains and denyReadPaths parsed correctly. (2) Hooks deployment — verify settings.local.json includes sandbox block when enabled, verify sandbox block absent when disabled, verify allowedDomains propagated correctly, verify allowUnsandboxedCommands=false when sandbox enabled. (3) Integration — verify sling still uses --dangerously-skip-permissions regardless of sandbox setting.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:22:34.678269-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:32:07.47736-08:00","closed_at":"2026-02-15T12:32:07.47736-08:00","close_reason":"Sandbox integration complete - all code + tests implemented and passing","dependencies":[{"issue_id":"overstory-5zhq","depends_on_id":"overstory-lu8k","type":"blocks","created_at":"2026-02-13T22:22:41.187816-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-5zhq","depends_on_id":"overstory-i9be","type":"blocks","created_at":"2026-02-13T22:22:41.507522-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-5zhq","depends_on_id":"overstory-q9v1","type":"blocks","created_at":"2026-02-13T22:22:41.654656-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-6034","title":"Fix flaky logger test: tool event ordering race condition","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:30:10.28397-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:41:54.151253-08:00","closed_at":"2026-02-13T08:41:54.151253-08:00","close_reason":"Fixed logger.test.ts race condition: replaced flaky version with robust polling-based approach (15 tests, all passing)"}
{"id":"overstory-63wq","title":"Research better message polling mechanism for coordinator","description":"Currently the coordinator polls for new messages by running repeated 'sleep 60 \u0026\u0026 overstory mail check' commands, which is clunky and wastes context window turns. Research alternatives: (1) filesystem watches (inotify/FSEvents) on mail.db WAL changes, (2) SQLite NOTIFY/trigger-based approach, (3) a lightweight daemon that watches mail.db and injects messages via hook stdin, (4) using Claude Code hooks more effectively (e.g. a PreToolUse hook that checks mail before each tool call), (5) Unix signals or named pipes. Goal: coordinator should receive messages without burning turns on sleep loops.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T11:50:00.740171-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T12:36:11.253381-08:00","closed_at":"2026-02-13T12:36:11.253381-08:00","close_reason":"Research concluded: existing UserPromptSubmit hook already runs overstory mail check --inject on every prompt, making manual sleep-based polling unnecessary. The hook is the optimal mechanism -- zero latency overhead, no false positives, atomic delivery. No code changes needed."}
{"id":"overstory-640","title":"L1-3: Implement worktree manager (src/worktree/manager.ts)","description":"Git worktree create/list/cleanup via Bun.spawn(['git', 'worktree', ...]). Branch naming: overstory/{agentName}/{beadId}. Functions: createWorktree, listWorktrees, removeWorktree.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:33.763095-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:25:14.382011-08:00","closed_at":"2026-02-12T07:25:14.382011-08:00","close_reason":"Implemented manifest loader (load, capability routing, validation) and worktree manager (create/list/remove via git CLI)","dependencies":[{"issue_id":"overstory-640","depends_on_id":"overstory-68p","type":"blocks","created_at":"2026-02-12T07:13:39.10387-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-67rb","title":"Write tests for trace command (src/commands/trace.test.ts)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T19:21:24.427051-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:38:31.763799-08:00","closed_at":"2026-02-13T20:38:31.763799-08:00","close_reason":"Registered trace in CLI router, wrote comprehensive tests","dependencies":[{"issue_id":"overstory-67rb","depends_on_id":"overstory-rj1k","type":"blocks","created_at":"2026-02-13T19:21:30.229931-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-68p","title":"[Epic] Layer 0: Project Scaffolding","status":"closed","priority":0,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:10:30.37382-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:21:28.211742-08:00","closed_at":"2026-02-12T07:21:28.211742-08:00","close_reason":"All 13 L0 tasks completed: scaffolding (package.json, tsconfig, biome), core types (types.ts, errors.ts, config.ts), CLAUDE.md conventions, 5 agent definitions, 3 templates","dependencies":[{"issue_id":"overstory-68p","depends_on_id":"overstory-c2q","type":"blocks","created_at":"2026-02-12T07:11:58.176126-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-68p","depends_on_id":"overstory-gst","type":"blocks","created_at":"2026-02-12T07:11:58.321581-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-68p","depends_on_id":"overstory-kqs","type":"blocks","created_at":"2026-02-12T07:11:58.459194-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-68p","depends_on_id":"overstory-7r9","type":"blocks","created_at":"2026-02-12T07:11:58.594514-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-68p","depends_on_id":"overstory-uox","type":"blocks","created_at":"2026-02-12T07:11:58.729208-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-68p","depends_on_id":"overstory-aun","type":"blocks","created_at":"2026-02-12T07:11:58.86613-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-68p","depends_on_id":"overstory-2ml","type":"blocks","created_at":"2026-02-12T07:11:58.999916-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-68p","depends_on_id":"overstory-j1c","type":"blocks","created_at":"2026-02-12T07:11:59.138735-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-68p","depends_on_id":"overstory-a7f","type":"blocks","created_at":"2026-02-12T07:11:59.278263-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-68p","depends_on_id":"overstory-lww","type":"blocks","created_at":"2026-02-12T07:11:59.419665-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-68p","depends_on_id":"overstory-6we","type":"blocks","created_at":"2026-02-12T07:11:59.530966-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-68p","depends_on_id":"overstory-tko","type":"blocks","created_at":"2026-02-12T07:11:59.664071-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-68p","depends_on_id":"overstory-6md","type":"blocks","created_at":"2026-02-12T07:11:59.80685-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-6asp","title":"Update hooks to capture tool args, tokens, and exit codes","description":"Update hook templates and the log command to capture the full data available from Claude Code hooks.\n\n## Current State\n- PreToolUse/PostToolUse hooks only extract tool_name via sed, discard tool_input and tool_response\n- Stop hook doesn't pass --transcript, so token/cost data is never captured\n- Tool duration is always logged as 0ms (no correlation between start/end)\n- Exit codes are never captured\n\n## What Claude Code Hooks Provide (via stdin JSON)\n- PreToolUse: { session_id, tool_name, tool_input }\n- PostToolUse: { session_id, tool_name, tool_input, tool_response }\n- Stop: { session_id, transcript_path, stop_hook_active }\n\n## Changes to templates/hooks.json.tmpl\nReplace the current sed-based tool_name extraction with piping full stdin to overstory log:\n\nPreToolUse:\n```\nread -r INPUT; echo \"$INPUT\" | overstory log tool-start --agent {{AGENT_NAME}} --stdin\n```\n\nPostToolUse:\n```\nread -r INPUT; echo \"$INPUT\" | overstory log tool-end --agent {{AGENT_NAME}} --stdin\n```\n\nStop:\n```\nread -r INPUT; echo \"$INPUT\" | overstory log session-end --agent {{AGENT_NAME}} --stdin\n```\n\n## Changes to src/commands/log.ts\nAdd --stdin flag. When present:\n1. Read one line from stdin, parse as JSON\n2. For tool-start: extract tool_name + tool_input, run through filterToolArgs(), insert into EventStore\n3. For tool-end: extract tool_name, insert into EventStore, call correlateToolEnd() to compute duration\n4. For session-end: extract transcript_path, auto-call parseTranscriptUsage() to get tokens, record metrics with real token data\n5. Continue writing to existing per-agent log files for backward compatibility\n\n## Changes to src/agents/hooks-deployer.ts\nUpdate template rendering to match new hook command format. Ensure the --stdin flag is included. Update any tests that validate hook output.\n\n## Backward Compatibility\n- If --stdin is not passed, existing behavior is preserved (old agents still work)\n- Existing per-agent log files continue to be written\n- The EventStore write is additional, not replacing\n\n## Tests\n- log.test.ts: tool-start with stdin parsing, tool-end with duration correlation, session-end with transcript auto-parse\n- hooks-deployer.test.ts: validate new hook command format in generated settings.local.json","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:08:48.304708-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T14:37:18.841969-08:00","closed_at":"2026-02-13T14:37:18.841969-08:00","close_reason":"Implemented in session: bash path guard, hook capture updates, CLAUDE.md overwrite guard, and orchestrator nudge fix","dependencies":[{"issue_id":"overstory-6asp","depends_on_id":"overstory-c6ca","type":"blocks","created_at":"2026-02-13T13:10:37.472185-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-6asp","depends_on_id":"overstory-hfus","type":"blocks","created_at":"2026-02-13T13:10:37.60924-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-6dyr","title":"Structural tool enforcement for non-implementation agents","description":"Implement structural enforcement of tool restrictions for coordinator and supervisor agents. Currently, agent constraints are prompt-based (.md files say 'you cannot edit files') which agents can violate under pressure. Need: (1) Deploy hooks config per capability that blocks file-modifying tools (Write, Edit, NotebookEdit) via PreToolUse hook returning exit code 2, (2) Allow Bash but guard against file-modifying commands (sed -i, echo \u003e, cat \u003e, vim, nano) via command pattern matching in PreToolUse, (3) Whitelist read-only commands and coordination CLIs (overstory, bd, git status/log/diff, mulch). This makes the 'cannot implement' constraint mechanical rather than instructional - the agent literally cannot edit files regardless of prompt pressure.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:51:16.681998-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T14:01:09.469324-08:00","closed_at":"2026-02-12T14:01:09.469324-08:00","close_reason":"Implemented typed mail protocol with 8 new message types + payload column, structural tool enforcement hooks, and beacon sendKeys fix"}
{"id":"overstory-6fjn","title":"Bug: merge-queue SQLite migration incomplete — 5 consumers still read/write JSON","description":"The queue.ts was migrated to SQLite (commit 7c6b208) but 5 other consumers still treat merge-queue.json as JSON, causing silent failures:\n\n1. dashboard.ts:157-166 — reads file with Bun.file().text() + JSON.parse, breaks on SQLite binary\n2. status.ts:127-132 — same JSON.parse pattern, breaks on SQLite binary  \n3. clean.ts:518 — calls resetJsonFile() which overwrites SQLite DB with '[]', corrupts it\n4. doctor/merge-queue.ts — entire file (199 lines) validates JSON format, all checks produce wrong results against SQLite\n5. init.ts:417 — may create empty file that SQLite then fails to open\n\nAdditionally, the .json extension is misleading since the file is now SQLite.\n\nFix approach (option 3 from report): Rename to merge-queue.db AND update all consumers to use SQLite via createMergeQueue() from queue.ts.\n\nFiles to modify:\n- src/commands/merge.ts:173 — change path to merge-queue.db\n- src/commands/dashboard.ts:157-166 — use createMergeQueue() instead of JSON.parse\n- src/commands/status.ts:127-132 — use createMergeQueue() instead of JSON.parse\n- src/commands/clean.ts:518 — use wipeSqliteDb() instead of resetJsonFile()\n- src/doctor/merge-queue.ts — rewrite to validate SQLite format\n- src/commands/init.ts:417 — update filename in .gitignore template\n- src/doctor/structure.ts:110 — update expected filename\n- .gitignore and .overstory/.gitignore — update entry\n- CLAUDE.md — update docs reference\n- All corresponding test files\n\nReported by agent in another project. Reproduction: run overstory merge after an agent branch (created before SQLite migration) merges its old JSON merge-queue.json back to main.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-16T07:26:02.334603-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:27:59.460423-08:00","closed_at":"2026-02-16T07:27:59.460423-08:00","close_reason":"Duplicate — already being handled by the current coordinator run. sqlite-migration lead (overstory-bkvc) spawned queue-consumers-builder (overstory-ez8j) which completed updating all 11 consumer files. Branch overstory/queue-consumers-builder/overstory-ez8j is pending merge to main."}
{"id":"overstory-6ib5","title":"Resolve agents-cmd merge conflict","description":"Branch overstory/builder-agents-cmd/overstory-n9s2 failed to merge due to .mulch/expertise/cli.jsonl conflict. The code files (src/commands/agents.ts, src/commands/agents.test.ts, src/commands/completions.ts, src/commands/completions.test.ts, src/index.ts) are correct. Resolution: create a fresh branch from main, read the 5 code files from the failed branch, apply them to the new branch, run quality gates, and signal merge_ready.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T18:04:00.439495-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:15:21.922375-08:00","closed_at":"2026-02-16T18:15:21.922375-08:00","close_reason":"Merge conflict resolved. Fresh branch applied cleanly."}
{"id":"overstory-6il","title":"Update CLAUDE.md testing section to codify 'never mock what you can use for real'","description":"Update the Testing section in CLAUDE.md to codify the new philosophy: (1) Use real filesystem via temp dirs (already done), (2) Use real SQLite via temp files (already done), (3) Use real git repos for worktree/merge tests, (4) Use real bd CLI for beads-client tests, (5) Only mock external services that have side effects (tmux, AI APIs) or aren't available in CI. Reference mulch failure mx-56558b about mock.module() leaking. Remove the line 'Tests should mock subprocess calls (Bun.spawn)' and replace with the new guidance.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:56:26.984204-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:59:53.905017-08:00","closed_at":"2026-02-12T08:59:53.905017-08:00","close_reason":"Updated CLAUDE.md testing section: replaced mock-first guidance with 'never mock what you can use for real' philosophy, updated test locations to reflect colocated tests, added test helpers reference, updated directory structure and file organization sections"}
{"id":"overstory-6j2o","title":"Coordinator: warn before worktree clean that branches will be deleted","description":"overstory worktree clean deletes branches, not just directories. A coordinator cleaned worktrees before merging and lost builder branches (archive-builder, gmail-builder, stripe-impl). The coordinator needs to: (1) understand that worktree clean is destructive to branches, (2) always follow the sequence: wait for merge_ready → merge → THEN clean, (3) ideally overstory worktree clean should warn or refuse if unmerged branches exist. Possible fixes: add a --force flag requirement if unmerged work exists, print a warning listing branches that will be deleted, or add a pre-clean check in the coordinator agent definition.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-18T10:50:50.168158-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T16:41:38.148194-08:00","closed_at":"2026-02-18T16:41:38.148194-08:00","close_reason":"Added unmerged branch safety to worktree clean: isBranchMerged() helper in manager.ts, --force flag in worktree clean command, skip/warn for unmerged branches, JSON skipped array. 4 new tests for safety behavior + 3 tests for isBranchMerged. All quality gates pass."}
{"id":"overstory-6jos","title":"Review: lead.md scout-first enforcement changes","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:46:08.953597-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:51:34.619264-08:00","closed_at":"2026-02-17T07:51:34.619264-08:00","close_reason":"All subtasks complete. lead.md updated with scout-first enforcement. sling.ts has scout-before-builder warning."}
{"id":"overstory-6jpc","title":"Add run auto-completion to coordinator stop","description":"When coordinator stop is called, auto-complete the current run: read current-run.txt, call runStore.completeRun(), delete current-run.txt. Add tests.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:38:50.321381-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:43:49.703384-08:00","closed_at":"2026-02-17T07:43:49.703384-08:00","close_reason":"Added run auto-completion to coordinator stop command. When stopCoordinator() is called, it now auto-completes the active run (if current-run.txt exists) and deletes the file. Added runCompleted field to JSON/text output. All tests pass."}
{"id":"overstory-6ka","title":"L5-2: Write manifest.test.ts","description":"Tests for src/agents/manifest.ts. Cover: loading valid manifest, capability routing (find agents by capability), validation of agent definitions, missing manifest handling, invalid entries.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:28.152081-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:54:20.487305-08:00","closed_at":"2026-02-12T07:54:20.487305-08:00","close_reason":"Closed","dependencies":[{"issue_id":"overstory-6ka","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:46.993526-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-6md","title":"L0-13: Write templates/hooks.json.tmpl","description":"Template for .claude/settings.local.json deployed to each worktree. Includes SessionStart (prime), UserPromptSubmit (mail check), Pre/PostToolUse (logging), Stop (session end), PreCompact hooks.","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:51.895329-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:18:45.129572-08:00","closed_at":"2026-02-12T07:18:45.129572-08:00","close_reason":"Created all 3 templates: CLAUDE.md.tmpl (orchestrator awareness), overlay.md.tmpl (per-worker overlay), hooks.json.tmpl (agent hooks config)"}
{"id":"overstory-6nq","title":"mail reply: positional ID extraction picks up flag values","description":"In handleReply() at src/commands/mail.ts:203, the message ID is extracted via args.find((a) =\u003e \\!a.startsWith('--')). This matches the first non-flag argument, which could be a flag VALUE. Example: 'overstory mail reply --agent scout msg-123 --body hi' treats 'scout' as the message ID instead of 'msg-123'. Confirmed: 'mail reply --agent my-agent msg-dd33zwsq06e7 --body test' produces 'Message not found: my-agent'. handleRead at line 183 has the same pattern but currently no flags with values - still fragile. Fix: skip known flag values when extracting positional args, or use a proper arg parser.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:09:02.738629-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:16:33.918249-08:00","closed_at":"2026-02-12T12:16:33.918249-08:00","close_reason":"Fixed positional ID extraction to skip flag values in handleReply and handleRead"}
{"id":"overstory-6oae","title":"overstory clean --all kills agents without logging session-end events","description":"When overstory clean --all runs killAllTmuxSessions(), it SIGTERM/SIGKILL's all agent processes. The Stop hook never fires because the process is killed externally, so no session_end event is logged. This leaves agents in zombie state in sessions.json (before it gets reset). Fix: before killing tmux sessions, iterate through known agents and log synthetic session-end events with reason='clean' so the event history is complete.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T15:33:23.128765-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T19:07:43.505083-08:00","closed_at":"2026-02-13T19:07:43.505083-08:00","close_reason":"clean.ts already had synthetic session-end logging (loadActiveSessions + EventStore). Migrated to use SessionStore instead of sessions.json for active session lookup."}
{"id":"overstory-6p2c","title":"Real-time agent inspection from dashboard (status, output, state)","description":"Stretch goal: Add the ability to inspect individual agent status, outputs, and state in real-time from the overstory dashboard. Currently there's no way to see what an agent is actively doing without manually attaching to its tmux session. Desired capabilities: (1) live view of agent's current activity/tool calls, (2) recent output/logs streaming, (3) current file being edited, (4) token usage so far, (5) time since last activity. Could leverage the existing logging/metrics infrastructure (log.ts events, metrics.db) and tmux capture-pane for live output.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T11:50:05.661407-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:02:09.356313-08:00","closed_at":"2026-02-16T07:02:09.356313-08:00","close_reason":"Inspect command implemented (commit db84991 v0.4.0)"}
{"id":"overstory-6qqt","title":"Write prime.test.ts for overstory prime command","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:22:12.652788-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:34:59.555689-08:00","closed_at":"2026-02-13T08:34:59.555689-08:00","close_reason":"Test files created and merged to main"}
{"id":"overstory-6qya","title":"Write reporter.test.ts for src/logging/reporter.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:04:57.977155-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:17:40.908882-08:00","closed_at":"2026-02-13T09:17:40.908882-08:00","close_reason":"wrote reporter.test.ts with coverage for formatLogLine and printToConsole"}
{"id":"overstory-6r7j","title":"Fix dashboard mail query full table scan","description":"Add limit option to MailStore.getAll() and use it in dashboard.ts to avoid full table scans","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T07:46:31.590784-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T07:50:41.977784-08:00","closed_at":"2026-02-20T07:50:41.977784-08:00","close_reason":"Added limit option to MailStore.getAll() filters (SQL LIMIT clause). Dashboard now uses limit:5/50 instead of full table scan + .slice(). All quality gates pass."}
{"id":"overstory-6s79","title":"Build: update all merge-queue consumers from JSON to SQLite","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T07:19:06.398784-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:20:07.207978-08:00","closed_at":"2026-02-16T07:20:07.207978-08:00","close_reason":"Duplicate work - queue-consumers-builder already handling this"}
{"id":"overstory-6sc8","title":"Watchdog: nudge coordinator when all agents complete","description":"The watchdog daemon (overstory watch) monitors for agent failures (stalls, zombies, dead tmux sessions) but has no logic to detect when all agents in a run have completed and notify the coordinator. This means the coordinator sits idle after all workers finish unless manually prompted or continuously polling.\n\nAll infrastructure exists:\n- nudgeAgent('coordinator') resolves via SessionStore or orchestrator-tmux.json\n- writePendingNudge() can queue a banner for coordinator's next prompt\n- store.getByRun(runId) can fetch all sessions for a run\n\nMissing piece: run-level completion detection in the daemon tick. After iterating sessions, the watchdog should check if all non-coordinator/non-monitor sessions for the active run are in state 'completed', and if so, send a tmux nudge or write a pending nudge marker for the coordinator. Must track that notification was already sent to avoid repeated nudges per tick.\n\nFiles likely affected: src/watchdog/daemon.ts (primary), possibly src/watchdog/health.ts","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:41:44.488689-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T07:26:09.205664-08:00","closed_at":"2026-02-18T07:26:09.205664-08:00","close_reason":"Watchdog run-completion detection implemented and merged. After iterating sessions, watchdog detects when all non-coordinator/non-monitor workers have completed and nudges the coordinator. Uses dedup marker file to avoid repeated nudges."}
{"id":"overstory-6smk","title":"Implement broadcast fan-out in mail client and CLI","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T07:05:06.741851-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:14:30.558452-08:00","closed_at":"2026-02-16T07:14:30.558452-08:00","close_reason":"Implemented broadcast messaging with group addresses (@all, @builders, @scouts, etc.). New file src/mail/broadcast.ts with pure resolution logic, src/mail/broadcast.test.ts with 26 tests, and updated src/commands/mail.ts handleSend with fan-out logic. All 1640 tests pass, biome + tsc clean."}
{"id":"overstory-6ueu","title":"Verify template resolution works from agent worktrees","description":"overlay.ts and hooks-deployer.ts read from templates/. Need to confirm they resolve paths relative to the overstory installation (via import.meta.dir or similar), not relative to cwd. If they use cwd, they'll break when running inside an agent's worktree. Quick code read - fix if broken.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:57:39.042126-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:01:20.595239-08:00","closed_at":"2026-02-12T13:01:20.595239-08:00","close_reason":"Verified: overlay.ts and hooks-deployer.ts both use import.meta.dir to resolve template paths, which resolves from overstory installation directory, not cwd. Works correctly from agent worktrees."}
{"id":"overstory-6we","title":"L0-11: Write templates/CLAUDE.md.tmpl","description":"Template for orchestrator's CLAUDE.md. Documents overstory CLI commands, conventions, hook behavior. Template variables for project name, config paths.","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:44.200052-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:18:45.087061-08:00","closed_at":"2026-02-12T07:18:45.087061-08:00","close_reason":"Created all 3 templates: CLAUDE.md.tmpl (orchestrator awareness), overlay.md.tmpl (per-worker overlay), hooks.json.tmpl (agent hooks config)"}
{"id":"overstory-6zv","title":"CLI commands outside git repo show raw git error instead of user-friendly message","description":"Running 'overstory status' from a non-overstory directory (e.g. /tmp) produces: Error [WORKTREE_ERROR]: git worktree list --porcelain failed (exit 128): fatal: not a git repository. Should instead show a user-friendly message like 'Not in an overstory project. Run overstory init first.' The error leaks the internal git command failure rather than wrapping it.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:09:39.300831-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:15:24.929202-08:00","closed_at":"2026-02-12T10:15:24.929202-08:00","close_reason":"Catch WorktreeError with 'not a git repository' in CLI entry point, show friendly message"}
{"id":"overstory-6zw","title":"resolver.test.ts: Replace file and git mocks with real implementations","description":"resolver.test.ts mocks Bun.spawn (git + claude CLI), Bun.file, and Bun.write. Replace file mocks with real temp files and git mocks with real git repos that have actual merge conflicts. Only keep mocks for the claude CLI (external AI service). This is the most mock-heavy test file and benefits most from real implementations. Use shared test harness for git repo setup with divergent branches that create real conflicts.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:56:16.015347-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:12:32.205535-08:00","closed_at":"2026-02-12T09:12:32.205535-08:00","close_reason":"Replaced file and git mocks with real implementations in resolver.test.ts. Only claude CLI remains mocked (for Tier 3/4).","dependencies":[{"issue_id":"overstory-6zw","depends_on_id":"overstory-y72","type":"blocks","created_at":"2026-02-12T08:56:33.412011-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-71o","title":"sling --json outputs both human-readable AND JSON (should be JSON only)","description":"When running 'overstory sling \u003cid\u003e --name \u003cname\u003e --json', the output includes both the human-readable launch message (rocket emoji, bullet points) AND the JSON object. With --json flag, only JSON should be output. The human-readable output should be suppressed when --json is specified. This affects downstream tooling that expects to parse pure JSON from stdout.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:44:00.763541-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:56:08.541979-08:00","closed_at":"2026-02-12T09:56:08.541979-08:00","close_reason":"Suppressed human-readable output when --json flag is specified in sling command"}
{"id":"overstory-72ak","title":"Implement overstory errors CLI command","description":"Aggregated error view across all agents. Query events.db for level='error' events. Support --agent, --run, --since, --until, --limit, --json flags. Group errors by agent with counts. Follow trace.ts patterns (same arg parsing, ANSI colors, test structure).","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T20:44:43.602329-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:58:11.20001-08:00","closed_at":"2026-02-13T20:58:11.20001-08:00","close_reason":"Implemented and tested in commit 35531bc"}
{"id":"overstory-749","title":"status.ts: race condition in session state mutation during gatherStatus","description":"gatherStatus() in status.ts reads sessions.json, filters dead tmux sessions, updates state, and writes back. Between reading and writing, another agent process could modify sessions.json, causing a lost-write conflict. This is especially relevant when multiple agents are active and the watchdog is running. Consider using file locking or atomic compare-and-swap for session state updates.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:09:41.767926-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:14:40.523333-08:00","closed_at":"2026-02-12T10:14:40.523333-08:00","close_reason":"Fixed race condition in gatherStatus: sessions.json now uses write-to-tmp + atomic rename instead of direct Bun.write"}
{"id":"overstory-79fh","title":"Tests fail in Claude Code sandbox mode due to write restrictions","description":"Running bun test inside Claude Code sandbox shows 271 failures because sandbox restricts file writes to specific directories. Most tests need temp dirs for SQLite, git repos, etc. Need to either: (a) document that tests must run outside sandbox, or (b) make tests respect TMPDIR=/tmp/claude/ so they work in sandbox.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T13:43:04.546369-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T13:57:35.343385-08:00","closed_at":"2026-02-15T13:57:35.343385-08:00","close_reason":"Sandbox config removed from overstory; test sandbox failures no longer relevant since agents don't deploy Seatbelt settings. Pre-existing GPG test failures remain (unrelated)."}
{"id":"overstory-7a2","title":"session-end log event does not transition agent state to completed","description":"In log.ts, the session-end event updates identity and clears the session marker, but never transitions the agent state in sessions.json from 'working' to 'completed'. The updateLastActivity() function only handles booting-\u003eworking. This means agents stay in 'working' state forever after their session ends, which breaks worktree clean --completed (it never finds completed agents to clean).","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:29:34.989686-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:41:33.130445-08:00","closed_at":"2026-02-12T10:41:33.130445-08:00","close_reason":"Added 'completed' to AgentState type, added transitionToCompleted() in log.ts session-end handler, updated worktree clean to recognize completed state, excluded completed agents from concurrency limits and watchdog checks"}
{"id":"overstory-7ah4","title":"Lead 1: CLI complex commands test coverage (dashboard, supervisor, monitor, merge)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T07:58:38.596003-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:55:07.558048-08:00","closed_at":"2026-02-13T08:55:07.558048-08:00","close_reason":"Test coverage blitz complete: 830 tests, 0 failures, 42 files. All 17 modules now have test coverage."}
{"id":"overstory-7ana","title":"Add run auto-completion to session-end hook for coordinator","description":"In log.ts session-end handler, when the agent is a coordinator, auto-complete the current run. This handles the tmux exit case. Add tests.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:38:52.213767-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:49:23.094594-08:00","closed_at":"2026-02-17T07:49:23.094594-08:00","close_reason":"Added coordinator run auto-completion to session-end hook. When coordinator exits, current run is auto-completed and current-run.txt is deleted. Includes 4 comprehensive tests. All quality gates passed."}
{"id":"overstory-7cx","title":"Optimize test harness: 30s+ runtime after no-mock migration","description":"After switching to real git repos/bd CLI instead of mocks, the test suite takes 30-40s. Three files account for ~97% of runtime:\n\n## Profiling Results (per-file, bun test)\n\n| File | Tests | Time | % of total |\n|---|---|---|---|\n| beads/client.test.ts | 16 | 22.76s | 58% |\n| merge/resolver.test.ts | 14 | 10.34s | 26% |\n| worktree/manager.test.ts | 16 | 4.18s | 11% |\n| test-helpers.test.ts | 8 | 2.12s | 5% |\n| All other 9 files (205 tests) | 205 | \u003c0.3s | \u003c1% |\n\n## Root Causes\n\n### beads/client.test.ts (22.76s) — Worst offender\n- Each of 16 tests runs `beforeEach` that creates a fresh temp git repo (5 subprocess spawns: init, config x2, add, commit) + `bd init` (another subprocess)\n- Then each test spawns 2-5 more `bd` CLI calls (create, show, claim, close, list, ready)\n- Total: ~100+ subprocess spawns for 16 tests\n- The bd CLI itself has startup overhead (Python? Node?) on each invocation\n\n### merge/resolver.test.ts (10.34s)\n- Each of 14 tests creates a fresh git repo via `beforeEach`\n- Tests then do 4-8 git operations each (commit, branch, checkout, merge, rm, status)\n- Some tests set up identical conflict scenarios (setupContentConflict, setupDeleteModifyConflict, setupReimagineScenario called multiple times)\n\n### worktree/manager.test.ts (4.18s)\n- Three separate `describe` blocks each with their own `beforeEach` creating fresh repos\n- 16 tests × (git init + config + add + commit + mkdir) = ~80 subprocess spawns\n\n## Optimization Ideas (investigate, pick best ROI)\n\n1. **Share repos within describe blocks** — Use `beforeAll` instead of `beforeEach` where tests don't mutate shared state, or create a base repo once and clone/branch per test\n2. **Batch git config** — Combine the 2 git config calls into 1 subprocess (or use GIT_AUTHOR_NAME/GIT_COMMITTER_NAME env vars instead)\n3. **beads/client: reduce bd CLI spawns** — The bd CLI startup cost dominates. Options:\n   - Share one initialized repo across tests that don't conflict (list/ready tests need isolation, but create/show don't)\n   - Create multiple issues in beforeAll, then test against them\n4. **resolver: share conflict setups** — setupContentConflict and setupDeleteModifyConflict are called by multiple tests. Create the conflict once, then run assertions against it\n5. **Parallelize independent subprocess calls** — git config user.email and git config user.name are independent and can run concurrently via Promise.all\n6. **Consider git template dir** — Pre-configure a template with user.email/user.name so git init picks them up automatically, eliminating 2 spawns per repo\n\n## Target\nGet the suite under 10s while keeping the no-mock philosophy (real git repos, real bd CLI).","notes":"## Additional Finding: Temp Dir Leakage\n\n120 orphaned `overstory-test-*` directories found in $TMPDIR:\n- 119/120 contain only `.beads/issues.jsonl` with test data (e.g. 'Limit issue 1')\n- 1/120 still has a full `.git/` repo\n- ~716K total disk usage (small but accumulates)\n- `.git/` dirs are cleaned but `.beads/` persists, suggesting cleanup is partial or interrupted test runs skip `afterEach`\n\n**No contamination of project state:**\n- Project `.beads/issues.jsonl` has zero test issues (tests properly use isolated temp dirs)\n- No leaked git branches in the main repo\n- Git history is clean\n\n**Root cause:** `afterEach` calls `cleanupTempDir()` which does `rm(dir, { recursive: true })`. When tests are interrupted (Ctrl+C, timeout, crash), `afterEach` never fires and dirs accumulate. With ~40 temp dirs created per full test run, a few interrupted runs = 100+ orphans.\n\n**Potential fix:** Add a cleanup-on-start pattern: at the beginning of the test suite, scan $TMPDIR for stale `overstory-test-*` dirs and remove them. Or use `process.on('exit')` as a fallback cleanup.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:11:15.885004-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:30:22.806622-08:00","closed_at":"2026-02-12T09:30:22.806622-08:00","close_reason":"Reduced test suite from 38.1s to 11.7s (-69%). Template clone pattern in test-helpers, beforeAll shared repos in beads and resolver tests. All quality gates pass."}
{"id":"overstory-7d33","title":"Implement post-session mulch learn extraction in log.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T12:18:28.781396-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:41:56.420581-08:00","closed_at":"2026-02-15T12:41:56.420581-08:00","close_reason":"Superseded by overstory-hcia (log-fix-builder). Original implementation had 4 issues corrected in the fix."}
{"id":"overstory-7di0","title":"Coordinator status set to 'completed' when awaiting user input","description":"When the coordinator is waiting for user input (either via nudge or direct user prompt), its status is being incorrectly set to 'completed'. The suspected cause is the 'session.end' hook firing when the coordinator pauses for input — this is correct behavior (the Claude Code turn ends), but something downstream is interpreting that event as the session having fully ended and updating the coordinator's state to 'completed'. Investigation needed: 1) Confirm which hook emits 'session-end' when awaiting input, 2) Trace how that event propagates to status updates, 3) Determine the correct fix — likely distinguishing between 'turn ended, awaiting input' vs 'session truly finished'.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T19:43:32.183147-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:22:49.757988-08:00","closed_at":"2026-02-13T20:22:49.757988-08:00","close_reason":"Fixed in this session"}
{"id":"overstory-7go2","title":"Update overlay quality gates and agent defs for outcome flags + file-scoped search","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T13:19:17.420762-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:22:27.990109-08:00","closed_at":"2026-02-20T13:22:27.990109-08:00","close_reason":"Added --outcome-status and --outcome-agent flags to overlay.ts formatQualityGates() step 5; added file-scoped search bullets to lead.md and supervisor.md Expertise sections; updated builder.md Completion Protocol step 5 with outcome flags and 'with outcome data' text."}
{"id":"overstory-7jlf","title":"coordinator.test.ts: startCoordinator test spawns real tmux session","description":"The startCoordinator test opens a real tmux session despite mock.module for tmux.ts being registered. Test times out at 5000ms, sessions.json never written (length 0). Likely a mock.module leak (mx-56558b) — another test file importing tmux.ts first could prevent the mock from taking effect. The Bun.sleep override (line 209) works because it's a direct property assignment, but mock.module is fragile across test files in bun:test's single-process model. May need to restructure to avoid mock.module entirely, or ensure import ordering.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T09:02:08.612151-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:21:21.576793-08:00","closed_at":"2026-02-13T09:21:21.576793-08:00","close_reason":"Fixed coordinator.test.ts mock.module leak: replaced mock.module() with DI pattern (CoordinatorDeps interface) matching daemon.ts _tmux/_triage/_nudge pattern. Tests now pass fake tmux/deployHooks via coordinatorCommand's deps parameter instead of process-global mock.module()."}
{"id":"overstory-7jr8","title":"Update parent agents to record insights from read-only workers","description":"Scout and reviewer agents are read-only — they cannot write files or commit. When they discover insights worth preserving in mulch, those insights must flow through mail to their parent (lead or supervisor) who records them.\n\nChanges needed:\n- agents/supervisor.md: Add to Expertise section (~line 82): 'Record worker insights: When worker result mails contain INSIGHT: items, record them via mulch record \u003cdomain\u003e --type \u003ctype\u003e --description \u003cinsight\u003e'\n- agents/lead.md: Add to Expertise section: 'Record worker insights: When scout or reviewer result mails contain INSIGHT: items, record them via mulch record \u003cdomain\u003e --type \u003ctype\u003e --description \u003cinsight\u003e'\n\nThis depends on overstory-b1ac (leaf agents tagging insights with INSIGHT: prefix in their result mails).","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T08:07:59.989385-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T17:39:38.369374-08:00","closed_at":"2026-02-16T17:39:38.369374-08:00","close_reason":"Added INSIGHT recording guidance to supervisor.md and lead.md Expertise sections.","dependencies":[{"issue_id":"overstory-7jr8","depends_on_id":"overstory-b1ac","type":"blocks","created_at":"2026-02-16T08:08:18.63567-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-7kc","title":"E2E scout test: explore status.ts implementation","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:55:48.793334-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:57:00.621289-08:00","closed_at":"2026-02-12T10:57:00.621289-08:00","close_reason":"E2E scout test completed. Used to validate sling with --capability scout. Identified overlay template bug (overstory-m4w)."}
{"id":"overstory-7kn2","title":"Replace mulch_learn mail with actual mulch record in session-end handler","description":"The session-end handler in src/commands/log.ts (lines 404-437) currently runs mulch learn --since HEAD~1 to detect domains with changes worth recording, but only sends a suggestion mail to the parent agent. Nobody consumes these mulch_learn messages — they accumulate as unread low-priority noise.\n\nFix: Replace the mail-only approach with actual mulch record calls at the canonical root, plus a slimmer notification mail.\n\nChanges to src/commands/log.ts lines 404-437:\n1. Keep the mulch learn call to detect suggested domains\n2. For each suggested domain, call mulchClient.record(domain, { type: 'reference', description: '\u003ccapability\u003e agent \u003cname\u003e completed work in this domain. Files: \u003clist\u003e', tags: ['auto-session-end', capability], evidenceBead: beadId })\n3. Record at config.project.root (canonical root) so records are immediately available to all agents, not isolated in worktrees\n4. Send a slimmer notification mail with subject 'mulch: auto-recorded insights in \u003cdomains\u003e' instead of 'mulch_learn: learning suggestions from \u003cagent\u003e'\n5. Wrap each individual record call in try/catch (non-fatal per domain)\n6. This covers read-only agents (scout/reviewer) whose worktree records would be lost\n\nAlso update src/commands/log.test.ts:\n- Verify mulchClient.record() is called for each suggested domain\n- Verify mail notification subject reflects 'auto-recorded' not 'learning suggestions'\n- Verify non-fatal behavior preserved (record failures don't break session-end)\n\nKey files: src/commands/log.ts, src/commands/log.test.ts, src/mulch/client.ts (record method already implemented but never called programmatically)","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T08:08:13.172871-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T17:38:11.477379-08:00","closed_at":"2026-02-16T17:38:11.477379-08:00","close_reason":"Session-end handler now calls mulch record directly instead of sending suggestion mail. Extracted testable autoRecordExpertise function. 36 tests passing."}
{"id":"overstory-7lsr","title":"Doctor: directory structure validation","description":"Verify .overstory/ directory is complete and matches what init.ts creates.\n\nChecks:\n- .overstory/ directory exists\n- Required files exist: config.yaml, agent-manifest.json, hooks.json, .gitignore\n- Required subdirectories exist: agent-defs/, agents/, worktrees/, specs/, logs/\n- .gitignore contains expected entries (worktrees/, *.db, *.db-shm, *.db-wal, logs/, etc.)\n- agent-defs/ contains .md files referenced by agent-manifest.json\n- No leftover files from failed init attempts\n\nSource references:\n- src/commands/init.ts (creates all of this)\n- .overstory/.gitignore (expected contents)\n\nOutput: pass/warn/fail per check. Missing required files = critical.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:59:12.604341-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:54:28.367995-08:00","closed_at":"2026-02-15T12:54:28.367995-08:00","close_reason":"Implemented structure, logs, and agent health checks. All tests passing (33 tests), quality gates clean.","dependencies":[{"issue_id":"overstory-7lsr","depends_on_id":"overstory-m55s","type":"blocks","created_at":"2026-02-13T22:00:18.319159-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-7r9","title":"L0-4: Implement config loader in src/config.ts","description":"YAML config loader for .overstory/config.yaml. Includes sensible defaults for all fields, validation of required fields, path resolution relative to project root. Returns typed OverstoryConfig.","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:16.788784-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:18:57.544923-08:00","closed_at":"2026-02-12T07:18:57.544923-08:00","close_reason":"Implemented types.ts (all shared types), errors.ts (error hierarchy), config.ts (config loader with defaults and validation)"}
{"id":"overstory-7sma","title":"Status display shows completed sessions as active","description":"overstory status filters only zombie sessions (status.ts:228) but still shows completed sessions in the active agent count. A completed coordinator shows as 'active' alongside the real running one, making it look like two coordinators are running. Fix: filter completed sessions from the active list, or display them in a separate 'recent/history' section.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:42:32.130568-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:45:19.665964-08:00","closed_at":"2026-02-13T06:45:19.665964-08:00","close_reason":"Fixed status display: added completed state filter alongside zombie in printStatus active agent count (status.ts line 228)"}
{"id":"overstory-7u8","title":"merge/resolver.test.ts: 10 tests fail on CI due to hardcoded 'main' branch","description":"In src/merge/resolver.test.ts, 10 tests fail on CI because helper functions (setupCleanMerge, setupContentConflict, setupDeleteModifyConflict, setupReimagineScenario) call git checkout main, but the temp git repos have 'master' as default branch on the CI runner. Error: 'error: pathspec main did not match any file(s) known to git'. Blocked by fix to createTempGitRepo() in test-helpers.ts.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:08:31.848579-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:26:34.626825-08:00","closed_at":"2026-02-12T12:26:34.626825-08:00","close_reason":"Replaced all hardcoded 'main' in resolver.test.ts with dynamic defaultBranch from getDefaultBranch() helper, updated helper function signatures to accept baseBranch parameter","dependencies":[{"issue_id":"overstory-7u8","depends_on_id":"overstory-9zw","type":"blocks","created_at":"2026-02-12T12:08:36.920795-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-7xf9","title":"Audit mulch domains and coverage — investigate gaps","description":"Investigate whether mulch expertise coverage is comprehensive. Check if new domains are needed beyond the current set (architecture, agents, typescript, cli, messaging). Look at what areas of the codebase lack expertise records — e.g., merge system, watchdog/monitoring, metrics/costs, doctor checks, testing patterns. Also verify existing records are still accurate and not stale. Report findings — may result in no action needed or a list of records to add.","notes":"## Audit Findings (2026-02-17)\n\n### Current State\n- 5 domains, 287 total records\n- cli: 100 (hitting governance threshold), agents: 74, typescript: 72, architecture: 28, messaging: 13\n- mulch doctor clean: no stale records, no duplicates, no schema issues\n\n### Coverage Assessment\n**No new domains needed.** Subsystems (merge, watchdog, events, sessions, etc.) are cross-cutting and fit naturally in existing domains.\n\n**Well-covered:** merge system, worktree management, sessions/SessionStore, watchdog/monitoring, config, agent lifecycle, testing patterns\n\n**Thin but adequate:** events/EventStore (~5 records), logging (~3), insights/analyzer (2), doctor checks (1), metrics/costs (~3), beads client (~4)\n\n### Action Items\n1. **Compact cli domain** — at 100 records, hitting governance limit. Several near-duplicate E2E lifecycle patterns. Blocked on mulch compact --auto bug (see below).\n2. **Delete stale record mx-454bf3** — 'Sessions JSON for agent tracking' is obsolete since SessionStore migrated to SQLite.\n3. **Optional:** Add records for doctor check system structure, metrics transcript parser, sanitizer/redaction patterns.\n\n### Blocked: mulch compact bugs\n- mulch compact \u003cdomain\u003e --auto ignores the domain argument and operates globally\n- mulch compact \u003cdomain\u003e --analyze also ignores domain, shows all candidates\n- --dry-run output too terse (no preview of replacement records)\n- mulch doctor governance warning doesn't name the domain or threshold\nOwner is fixing these in the mulch project.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T08:17:37.694655-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T07:21:10.140079-08:00","closed_at":"2026-02-20T07:21:10.140079-08:00","close_reason":"Audit completed: 5 domains, 287 records, coverage adequate. Remaining items (compact cli domain, delete stale mx-454bf3) blocked on mulch compact bugs in external project."}
{"id":"overstory-7y1l","title":"Task group tracking (batch work coordination)","description":"Implement task group tracking - the ability to batch related beads issues into a group, monitor collective progress, and auto-close when all members complete. Maps to gastown's convoy concept but uses beads relations. Key features: (1) overstory group create '\u003cname\u003e' \u003cissue-ids\u003e - creates a tracking bead with 'tracks' relations to member issues, (2) overstory group status [group-id] - shows progress (N/M complete), active workers, blocked issues, (3) Auto-close: when all tracked issues are closed, group auto-closes and notifies subscribers (coordinator, human), (4) Add/remove issues from active groups (reopen if closed), (5) Cross-project groups: track issues across multiple projects via beads prefix routing. This is critical for the coordinator to manage batched work without manually polling each issue.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:51:22.02572-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T14:11:41.641978-08:00","closed_at":"2026-02-12T14:11:41.641978-08:00","close_reason":"Implemented task group tracking (overstory group create/status/add/remove/list with auto-close) and session lifecycle (checkpoint save/restore, handoff orchestration, compaction-aware priming)"}
{"id":"overstory-7yie","title":"Fix dashboard merge queue field name mismatch","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T07:22:03.437196-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T07:26:30.158936-08:00","closed_at":"2026-02-13T07:26:30.158936-08:00","close_reason":"Fixed merge queue field name mismatch (branchName/agentName vs branch/agent)"}
{"id":"overstory-802o","title":"Coordinator runs at project root without hooks - blind spot for monitoring","description":"The coordinator agent (depth 0) runs at the project root via overstory coordinator start, but hooks are NOT deployed to the project root (.claude/settings.local.json). This means: (1) no event logging (tool-start, tool-end, session-end), (2) no mail check --inject on UserPromptSubmit, (3) no activity tracking in sessions.json. The coordinator's lastActivity field never updates from startedAt. Comment in coordinator.ts line 146 acknowledges this: 'Hooks are NOT deployed to the project root.' Fix: deploy hooks to the project root when running coordinator, or inject hooks via --append-system-prompt.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T15:33:28.096494-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T19:07:43.641404-08:00","closed_at":"2026-02-13T19:07:43.641404-08:00","close_reason":"coordinator start now calls deployHooks to project root. ENV guard ensures hooks only activate for coordinator tmux session, not user sessions."}
{"id":"overstory-80r","title":"Test hierarchy spawning","description":"temp","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:09:25.070495-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:10:07.112732-08:00","closed_at":"2026-02-12T12:10:07.112732-08:00","close_reason":"temp test issues, closed after E2E validation"}
{"id":"overstory-851c","title":"Export triage pure functions + write triage tests","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:04:04.128481-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:07:49.124207-08:00","closed_at":"2026-02-13T08:07:49.124207-08:00","close_reason":"Exported triage pure functions (buildTriagePrompt, classifyResponse, readRecentLog) and added comprehensive test suite with 22 tests. All quality gates pass."}
{"id":"overstory-85y","title":"sling depth check is off-by-one: depth \u003e= maxDepth should be depth \u003e maxDepth","description":"With default maxDepth=2, the depth check rejects 'depth 2 \u003e= maxDepth 2'. But the CLAUDE.md hierarchy shows 3 levels (orchestrator at 0, lead at 1, specialist at 2), meaning depth=2 should be the deepest allowed leaf node. The check in sling should be 'depth \u003e maxDepth' not 'depth \u003e= maxDepth', or maxDepth semantics should be documented as 'exclusive upper bound'.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:31:08.048368-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:41:32.560494-08:00","closed_at":"2026-02-12T10:41:32.560494-08:00","close_reason":"Fixed off-by-one: changed depth \u003e= maxDepth to depth \u003e maxDepth in sling.ts"}
{"id":"overstory-89kt","title":"Multi-provider model support","description":"Allow users to configure non-Anthropic models (via gateways like OpenRouter/LiteLLM) for specific agent roles. Core mechanism: per-tmux-session env var injection (ANTHROPIC_BASE_URL, ANTHROPIC_AUTH_TOKEN, ANTHROPIC_DEFAULT_*_MODEL). See design spec in linked sub-issues.","status":"open","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:13:22.788837-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:13:22.788837-08:00"}
{"id":"overstory-8cm","title":"No --help flag support for subcommands","description":"Passing --help to any subcommand (init, sling, prime, status, mail, merge, worktree, log, watch, metrics) either errors or runs the command instead of showing usage help. Examples: 'overstory mail --help' errors with 'Unknown mail subcommand: --help'. 'overstory watch --help' starts the watchdog daemon. 'overstory init --help' warns about already initialized. 'overstory sling --help' errors with validation. Each subcommand should check for --help/-h and display usage info.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:09:18.88392-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:32:22.170644-08:00","closed_at":"2026-02-12T08:32:22.170644-08:00","close_reason":"Added --help/-h support to all 10 subcommands and the main CLI entry point"}
{"id":"overstory-8fj0","title":"Implement mail debounce: CLI flag + PostToolUse hook + tests","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T12:37:14.414156-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T13:01:16.46902-08:00","closed_at":"2026-02-15T13:01:16.46902-08:00","close_reason":"Completed: mail check debounce CLI flag + tests"}
{"id":"overstory-8fr","title":"status unread mail count includes ALL agents, not just orchestrator","description":"overstory status shows '6 unread' mail but overstory mail check (for orchestrator) shows 0 unread. The status command counts all unread messages across all agents (including test-agent, test-scout-3, x, etc). This is misleading because the orchestrator can't read messages addressed to other agents. The status should either show per-agent counts or only count messages for the current agent.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:41:26.447251-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:48:02.503614-08:00","closed_at":"2026-02-12T09:48:02.503614-08:00","close_reason":"Filter unread mail count by agent (default orchestrator) instead of counting all agents. Added --agent flag to status command."}
{"id":"overstory-8jo7","title":"Flip .overstory/.gitignore to wildcard+whitelist and auto-heal in prime","description":"State files keep leaking into git status because the .gitignore template in init.ts uses an explicit deny-list that must be manually updated for every new runtime file. Two problems: (1) missing entries (current-run.txt, mail-check-state.json), and (2) deployed gitignores go stale since init skips if the file exists and prime doesn't touch it.\n\nFix: flip to wildcard+whitelist model in OVERSTORY_GITIGNORE (init.ts:431-455):\n  *\n  !.gitignore\n  !config.yaml\n  !agent-manifest.json\n  !hooks.json\n  !groups.json\n\nThen add an auto-heal step in prime that overwrites .overstory/.gitignore if its content differs from the template. This ensures existing projects get updated on next session start.\n\nAlso remove the exists() guard in writeOverstoryGitignore() so --force reinit regenerates it too.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:11:29.118913-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:29:24.992048-08:00","closed_at":"2026-02-17T07:29:24.992048-08:00","close_reason":"Merged 3 builder branches: wildcard+whitelist gitignore template, removed exists() guard, auto-heal in prime, doctor check updated. All tests pass (1819/1819)."}
{"id":"overstory-8m8","title":"Add CLI help text for unknown subcommands","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T11:57:23.398574-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T11:59:09.647218-08:00","closed_at":"2026-02-12T11:59:09.647218-08:00","close_reason":"Added editDistance function and suggestCommand to src/index.ts. Unknown commands now show 'Did you mean X?' when edit distance \u003c= 2. All quality gates pass (303 tests, biome clean, tsc clean)."}
{"id":"overstory-8p1p","title":"Update lead.md Phase 1 to scout-first workflow with parallel scouts","description":"Modify agents/lead.md Phase 1 (Scout) section to make spawning scouts the default approach, support 1-2 parallel scouts, and reframe the skip-scout option as the exception.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:23:25.755577-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:33:32.579776-08:00","closed_at":"2026-02-16T13:33:32.579776-08:00","close_reason":"Updated lead.md Phase 1 to scout-first workflow with parallel scout support. All acceptance criteria passed review."}
{"id":"overstory-8pcf","title":"Fix tool=unknown in feed: stdin handling broken for large PostToolUse payloads","description":"## Problem\n\n`overstory feed` shows `tool=unknown summary=unknown` for ~77% of tool_end events and ~19% of tool_start events. This makes the feed largely useless for observability.\n\n## Evidence\n\nFrom events.db analysis:\n- tool_start: 5814 known (81%), 1338 unknown (19%)\n- tool_end: 1546 known (23%), 5098 unknown (77%)\n- All agents affected (100+ agents across history)\n- Known tool_end events are mostly small-output commands (e.g. `overstory mail check`)\n\n## Root Cause\n\nThe hook commands in `templates/hooks.json.tmpl` use a fragile stdin relay pattern:\n```bash\nread -r INPUT; echo \"$INPUT\" | overstory log tool-end --agent NAME --stdin\n```\n\nThree problems:\n\n### 1. Shell `read -r` truncates large payloads\nPostToolUse payloads from Claude Code include `tool_result` (the full tool output — file contents, command output, etc.). These payloads can easily be 10-100KB+. Shell `read -r` may truncate at buffer boundaries, producing malformed JSON that `readStdinJson()` fails to parse.\n\nPreToolUse payloads are much smaller (just tool_name + tool_input), explaining the higher success rate for tool_start.\n\n### 2. `echo \"$INPUT\"` can mangle content\nBSD echo on macOS may interpret escape sequences in the JSON. Special characters in tool results (`\\n`, `\\t`, backticks) can cause corruption.\n\n### 3. `readStdinJson()` silently swallows errors\nIn `src/commands/log.ts`, the function reads only the first chunk from stdin and catches ALL errors returning null:\n```typescript\nasync function readStdinJson() {\n    try {\n        const reader = Bun.stdin.stream().getReader();\n        const { value } = await reader.read(); // only first chunk!\n        reader.releaseLock();\n        if (!value) return null;\n        return JSON.parse(new TextDecoder().decode(value).trim());\n    } catch { return null; } // swallows all errors\n}\n```\n\nWhen it returns null, `toolName` falls back to `toolNameFlag` which defaults to `\"unknown\"`.\n\n## Additional Issue: Orchestrator hooks don't use EventStore\n\nThe orchestrator hooks in `.overstory/hooks.json` use a legacy `--tool-name` flag path with fragile sed extraction. They do NOT use `--stdin`, so the EventStore insert block is never reached (guarded by `if (useStdin)`). Orchestrator tool events get logged to per-agent log files but NOT to EventStore, reducing feed visibility.\n\n## Proposed Fix\n\n### Fix 1: Eliminate the read/echo middleman in hooks template\nReplace:\n```bash\nread -r INPUT; echo \"$INPUT\" | overstory log tool-end --agent NAME --stdin\n```\nWith direct stdin piping:\n```bash\noverstory log tool-end --agent NAME --stdin \u003c/dev/stdin\n```\nOr use `cat` as a reliable relay:\n```bash\ncat | overstory log tool-end --agent NAME --stdin\n```\nThe env guard `[ -z \"$OVERSTORY_AGENT_NAME\" ] \u0026\u0026 exit 0` doesn't consume stdin, so overstory can inherit it directly.\n\n### Fix 2: Read ALL stdin in readStdinJson()\nReplace single-chunk read with full stdin consumption:\n```typescript\nconst chunks: Uint8Array[] = [];\nconst reader = Bun.stdin.stream().getReader();\nwhile (true) {\n    const { value, done } = await reader.read();\n    if (done) break;\n    if (value) chunks.push(value);\n}\n// Concatenate and parse\n```\n\n### Fix 3: For tool_end, only parse tool_name (not full payload)\nSince we only need `tool_name` and `session_id` from PostToolUse, we could extract just those fields without parsing the entire (potentially huge) JSON. A targeted regex or streaming parser would be more robust.\n\n### Fix 4: Update orchestrator hooks to use --stdin path\nAlign orchestrator hooks with the template pattern so orchestrator events also flow to EventStore.\n\n### Fix 5: Add error diagnostics to readStdinJson()\nLog the actual error (or at least a truncated version) so failures are debuggable instead of silently falling back to 'unknown'.\n\n## Files Involved\n- `templates/hooks.json.tmpl` — hook command patterns (primary fix)\n- `src/commands/log.ts` — `readStdinJson()` function, EventStore writes\n- `src/events/tool-filter.ts` — summary generation\n- `src/commands/feed.ts` — display code (shows whatever is stored)\n- `.overstory/hooks.json` — orchestrator hooks (secondary fix)\n- `src/agents/hooks-deployer.ts` — deploys hooks to worktrees","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:25:32.734467-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:50:36.624508-08:00","closed_at":"2026-02-17T07:50:36.624508-08:00","close_reason":"Fixed tool=unknown in feed. Root causes: (1) hooks template used read/echo stdin relay that truncated large payloads — removed relay, stdin flows directly to overstory log. (2) readStdinJson() read only first chunk — now reads all chunks in a loop. (3) Updated test assertions for relay removal. Three branches ready for merge."}
{"id":"overstory-8pg","title":"Test sling json","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:43:44.284799-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:44:02.030934-08:00","closed_at":"2026-02-12T09:44:02.030934-08:00","close_reason":"Test issue for sling --json testing, no longer needed"}
{"id":"overstory-8v4h","title":"Write merge.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:05:28.582239-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:32:05.327816-08:00","closed_at":"2026-02-13T09:32:05.327816-08:00","close_reason":"Test files already written and committed"}
{"id":"overstory-8vf9","title":"Implement inspect command and register in CLI","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T19:58:30.781332-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:42:02.435091-08:00","closed_at":"2026-02-15T12:42:02.435091-08:00","close_reason":"Implemented overstory inspect command: deep per-agent inspection with EventStore, SessionStore, MetricsStore, tmux capture-pane, --json/--follow/--limit flags, 18 tests"}
{"id":"overstory-8xb","title":"Metrics not recorded for headless agents (session-end hook never fires)","description":"The metrics system relies on the Stop hook calling 'overstory log session-end'. In headless mode (claude -p), hooks don't fire, so no session-end event is emitted. Agents complete work but are never recorded in metrics.db. After spawning 4 agents (helptext-builder, mail-scout, merge-scout, json-test-agent), metrics still shows only 1 session from a previous test. This makes the metrics system useless for monitoring agent work. Related to overstory-52z (mail can't be received) and overstory-ebd (no log directories).","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:08:18.828719-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:23:51.477806-08:00","closed_at":"2026-02-12T12:23:51.477806-08:00","close_reason":"Resolved by overstory-37e: switching to interactive mode means all hooks (SessionStart, UserPromptSubmit, PreToolUse, PostToolUse, Stop) now fire. Mail injection, metrics recording, lastActivity updates, and log directories all work."}
{"id":"overstory-8ynj","title":"Update doctor/structure.ts gitignore check for wildcard model","description":"Update .gitignore entries check to validate wildcard+whitelist pattern","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:18:01.041654-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:25:45.897191-08:00","closed_at":"2026-02-17T07:25:45.897191-08:00","close_reason":"Closed"}
{"id":"overstory-94i","title":"L3-6: Implement worktree command (src/commands/worktree.ts)","description":"CLI: overstory worktree list | clean [--completed] [--all]. List shows worktrees with agent status. Clean removes: worktree dir, branch ref (if merged), tmux session (kill if running). Logs preserved (never auto-deleted).","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:13.847906-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:36:21.737507-08:00","closed_at":"2026-02-12T07:36:21.737507-08:00","close_reason":"All L3 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-94i","depends_on_id":"overstory-rbj","type":"blocks","created_at":"2026-02-12T07:13:43.365292-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-95za","title":"Mulch-informed task decomposition for lead agents","description":"Update lead agent overlay and sling.ts to leverage mulch before decomposing work. Before decomposition, leads should:\n1. mulch search \u003ctask keywords\u003e to find relevant patterns/failures\n2. mulch prime --files \u003caffected-files\u003e to load file-specific expertise (now available via M1)\n3. Factor known failure patterns and conventions into sub-task specs\n\nThe --files flag makes this much more targeted than generic domain priming.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:08:44.380765-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:41:02.534455-08:00","closed_at":"2026-02-13T22:41:02.534455-08:00","close_reason":"Lead agents now consult mulch before decomposition: mulch search for patterns, mulch prime --files for file-scoped expertise. Overlay embeds pre-fetched expertise.","dependencies":[{"issue_id":"overstory-95za","depends_on_id":"overstory-j53z","type":"blocks","created_at":"2026-02-13T21:50:46.593679-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-96la","title":"Migrate worktree.ts and daemon.ts to SessionStore","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T14:58:37.248234-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T19:16:13.151109-08:00","closed_at":"2026-02-13T19:16:13.151109-08:00","close_reason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed."}
{"id":"overstory-98qr","title":"Failure post-mortem recording","description":"When watchdog escalates to Tier 1 (AI triage), record the triage result and resolution to mulch. Over time build a knowledge base: 'agent X stalled because Y, resolved by Z'. Use this to improve triage accuracy and reduce escalation times.","status":"open","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:55.635506-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T17:04:55.635506-08:00"}
{"id":"overstory-99ec","title":"Dashboard opens/closes 6 SQLite DBs per tick","description":"Each dashboard refresh opens sessions.db, mail.db (x2), merge-queue.db (x2), and metrics.db (x2) — running PRAGMAs, schema checks, and WAL checkpoints on every open/close. At 2s interval this is constant churn. Fix: hold DB connections open for the poll loop lifetime, pass handles into loadDashboardData, close on SIGINT.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-19T13:28:11.623463-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T08:27:15.428605-08:00","closed_at":"2026-02-20T08:27:15.428605-08:00","close_reason":"Dashboard DB connection pooling complete. openDashboardStores/closeDashboardStores hold 4 SQLite DBs open for poll loop lifetime instead of opening/closing 7 per tick. loadDashboardData accepts pre-opened DashboardStores. getCachedWorktrees/getCachedTmuxSessions exported from status.ts. 25 tests pass, merged to main."}
{"id":"overstory-99tm","title":"Apply conflict history intelligence to merge resolver","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T18:07:53.514586-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:17:43.663324-08:00","closed_at":"2026-02-16T18:17:43.663324-08:00","close_reason":"Applied conflict history intelligence to merge resolver. Added ParsedConflictPattern and ConflictHistory types, parseConflictPatterns/buildConflictHistory/queryConflictHistory functions, tier-skipping logic, AI prompt enrichment with historical context, and comprehensive tests. Quality gates passed."}
{"id":"overstory-9ju","title":"Closed task for testing","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:06:51.772977-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:06:56.02381-08:00","closed_at":"2026-02-12T10:06:56.02381-08:00","close_reason":"Test issue for sling"}
{"id":"overstory-9kuz","title":"Add agent discovery command","description":"New command: 'overstory agents discover --capability builder' returns all active builders with their status, current task, and file scope. Currently agents can't find each other without knowing exact names.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:36.435421-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:15:21.790268-08:00","closed_at":"2026-02-16T18:15:21.790268-08:00","close_reason":"Agent discovery command implemented. overstory agents discover with --capability and --all filtering, --json output, file scope extraction, shell completions, 10 tests."}
{"id":"overstory-9ot9","title":"Phase 5: Session lifecycle independence (handoff, compaction, continuity)","description":"Implement session lifecycle management so agents survive context compaction, crashes, and restarts without losing work state. Key components: (1) Handoff mechanism - agent saves state to beads, spawns fresh session, new session resumes from checkpoint. State lives in beads issues (not .md files), (2) Compaction hooks - PreCompact saves current progress to beads, SessionStart after compaction restores from beads, (3) Session query - ability to query previous session transcripts for context recovery (like gastown's seance), (4) Three-layer model: Session (ephemeral Claude runtime) / Sandbox (git worktree, persists across sessions) / Identity (permanent agent record with work history, expertise domains, accumulated CV), (5) Identity persistence - agents accumulate capability profiles across assignments, enabling smarter dispatch by coordinator.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:51:02.991283-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T14:11:41.661546-08:00","closed_at":"2026-02-12T14:11:41.661546-08:00","close_reason":"Implemented task group tracking (overstory group create/status/add/remove/list with auto-close) and session lifecycle (checkpoint save/restore, handoff orchestration, compaction-aware priming)"}
{"id":"overstory-9sct","title":"Enforce scout-first workflow in lead agents","description":"Leads consistently skip Phase 1 (Scout) — 0 scouts spawned across 58-agent run. Fix: (1) Add SCOUT_SKIP named failure mode to lead.md, (2) Strengthen should spawn scouts to MUST spawn scouts with narrower exception, (3) Rebalance cost guidance to not discourage scout/reviewer spawning, (4) Consider structural enforcement in sling.ts or overlay.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:34:00.506406-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:51:53.767959-08:00","closed_at":"2026-02-17T07:51:53.767959-08:00","close_reason":"Scout-first workflow enforced in lead agents. (1) agents/lead.md: added SCOUT_SKIP failure mode, strengthened Phase 1 to MUST spawn scouts, tightened skip exception, rebalanced cost guidance. (2) src/commands/sling.ts: added parentHasScouts() + non-blocking warning when builder spawned without prior scout, 10 tests."}
{"id":"overstory-9vnb","title":"Token/cost instrumentation for agent sessions","description":"Add tracking of input/output tokens and estimated cost per agent session so dashboard can display spend.\n\nChallenge: Claude Code doesn't expose token counts through hook events (tool-start/tool-end). Need to investigate extraction options:\n- Parse ~/.claude/ session data files for token usage\n- Add PostToolUse hook that captures response metadata\n- Scrape Claude Code's own status line output from tmux panes\n- Add a session-end summary parser\n\nStorage: Extend metrics.db sessions table with token_in, token_out, estimated_cost_usd columns. Update SessionMetrics type and MetricsStore accordingly.\n\nThis is exploratory — the extraction method needs scouting before implementation.","status":"closed","priority":4,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:37:43.55218-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:46:09.803514-08:00","closed_at":"2026-02-13T09:46:09.803514-08:00","close_reason":"Added transcript JSONL parser (src/metrics/transcript.ts) with cost estimation, extended SessionMetrics with token/cost fields, updated metrics store schema with migration, wired session-end handler to parse transcripts via --transcript flag, updated summary display with token/cost totals, 27 new tests"}
{"id":"overstory-9vr","title":"worktree/manager.test.ts: 14 tests fail on CI due to hardcoded 'main' branch","description":"In src/worktree/manager.test.ts, 14 tests fail on CI because createWorktree() calls use baseBranch: 'main', but the temp git repos have 'master' as default branch on the CI runner. Failing tests: all 5 createWorktree tests, 4 listWorktrees tests (those calling createWorktree internally), and all 5 removeWorktree tests. Error: 'fatal: invalid reference: main'. Blocked by fix to createTempGitRepo() in test-helpers.ts.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:08:30.655436-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:26:33.09042-08:00","closed_at":"2026-02-12T12:26:33.09042-08:00","close_reason":"Replaced all hardcoded 'main' in manager.test.ts with dynamic defaultBranch from getDefaultBranch() helper","dependencies":[{"issue_id":"overstory-9vr","depends_on_id":"overstory-9zw","type":"blocks","created_at":"2026-02-12T12:08:36.767804-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-9zg","title":"metrics never populated: no code path calls metricsStore.recordSession()","description":"The metrics command always shows 'No sessions recorded' because nothing in the agent lifecycle calls metricsStore.recordSession(). The session-end log event updates identity but skips metrics recording. The log command or worktree clean should record session metrics (agent name, bead id, duration, capability) when an agent session ends.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:32:03.509983-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:41:37.250599-08:00","closed_at":"2026-02-12T10:41:37.250599-08:00","close_reason":"Added metricsStore.recordSession() call in session-end handler in log.ts"}
{"id":"overstory-9zw","title":"CI failing: tests hardcode 'main' branch but CI runner defaults to 'master'","description":"All 24 CI test failures stem from a single root cause: createTempGitRepo() in src/test-helpers.ts creates repos via git init + git clone without explicitly setting the default branch name. On macOS (local dev), git defaults to 'main', so tests pass. On CI (ubuntu-latest), git defaults to 'master', so any test referencing 'main' fails with 'fatal: invalid reference: main'. This has caused 26 consecutive CI failures since commit de94853. Fix: pass -b main to git init in getTemplateRepo() in src/test-helpers.ts so the template repo always uses 'main' regardless of system config.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:08:23.589124-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:15:07.52571-08:00","closed_at":"2026-02-12T12:15:07.52571-08:00","close_reason":"Added -b main to git init in getTemplateRepo()"}
{"id":"overstory-a28","title":"L5-11: Write hooks-deployer.test.ts","description":"Tests for src/agents/hooks-deployer.ts. Cover: deploying hooks config to worktree as .claude/settings.local.json, agent name substitution in commands, all hook types present (SessionStart, UserPromptSubmit, Pre/PostToolUse, Stop, PreCompact).","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:36.411068-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:56:26.843714-08:00","closed_at":"2026-02-12T07:56:26.843714-08:00","close_reason":"Closed","dependencies":[{"issue_id":"overstory-a28","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:48.358119-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-a559","title":"Review: overlay-defs-builder agent defs","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T13:23:35.662106-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:28:05.826715-08:00","closed_at":"2026-02-20T13:28:05.826715-08:00","close_reason":"PASS: all three builder branches reviewed and verified"}
{"id":"overstory-a7by","title":"Write watch.test.ts for overstory watch command","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:22:14.77068-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:34:59.557497-08:00","closed_at":"2026-02-13T08:34:59.557497-08:00","close_reason":"Test files created and merged to main"}
{"id":"overstory-a7f","title":"L0-9: Write agents/lead.md base definition","description":"Team lead agent: can spawn sub-workers via overstory sling. Reads specs, decomposes work, delegates to specialists. Has canSpawn=true. Tracks sub-worker progress via beads and mail.","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:35.755539-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:20:05.12537-08:00","closed_at":"2026-02-12T07:20:05.12537-08:00","close_reason":"Created all 5 base agent definitions: scout (read-only explorer), builder (implementation), reviewer (validation), lead (delegation), merger (branch integration)"}
{"id":"overstory-abv","title":"Config resolves to worktree root instead of real project root","description":"When running 'overstory status' (or any command) from inside a worktree (.overstory/worktrees/\u003cname\u003e/), loadConfig resolves project.root to the worktree path instead of the actual repository root. This means sessions.json, mail.db, etc. are looked up in the wrong location. Worktrees have their own .overstory/ directory which is a subset of the main one. The config loader needs to detect git worktrees and resolve up to the real root.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:51:21.956374-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T11:51:05.849253-08:00","closed_at":"2026-02-12T11:51:05.849253-08:00","close_reason":"Fixed mail.ts to use resolveProjectRoot instead of raw cwd. Exported resolveProjectRoot from config.ts for reuse. Added worktree resolution tests."}
{"id":"overstory-aeh4","title":"Post-session learning extraction in log.ts","description":"In log.ts handleSessionEnd(), after recording metrics, run mulch learn --since HEAD~1 --json. Parse suggestedDomains and changedFiles. If suggestions exist, include them in the session-end mail to the orchestrator so they can decide what to record. Uses expanded MulchClient.learn().","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:08:35.890248-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:42:13.240931-08:00","closed_at":"2026-02-15T12:42:13.240931-08:00","close_reason":"All 3 mulch integration subtasks completed: (1) Post-session learning extraction in log.ts via mulch learn + mail (overstory-hcia, commit 7130595), (2) Automated failure recording in watchdog daemon via mulch record (overstory-kix0, commit 07b769c), (3) Mulch health checks in overstory clean (overstory-r93n, commit f4d9210). Total: 8 new tests across 3 branches.","dependencies":[{"issue_id":"overstory-aeh4","depends_on_id":"overstory-j53z","type":"blocks","created_at":"2026-02-13T21:08:49.983786-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-afrk","title":"Write triage.test.ts for src/watchdog/triage.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:20:21.482457-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:26:54.37341-08:00","closed_at":"2026-02-13T08:26:54.37341-08:00","close_reason":"Created triage.test.ts with 17 tests covering pure functions and filesystem integration","dependencies":[{"issue_id":"overstory-afrk","depends_on_id":"overstory-zyz7","type":"blocks","created_at":"2026-02-13T08:20:27.304531-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-aiik","title":"Doctor: agent manifest and identity validation","description":"Validate agent-manifest.json and agent identity files for consistency.\n\nManifest checks:\n- JSON parses without error\n- Required top-level fields: version (non-empty), agents (object), capabilityIndex (object)\n- Each agent definition has required fields: file, model, tools, capabilities, canSpawn, constraints\n- Model values in {haiku, sonnet, opus}\n- Referenced .md files in agent-defs/ actually exist and are readable\n- Capability index bidirectional consistency: if agent X has capability Y, capabilityIndex[Y] includes X, and vice versa\n- No agents with zero capabilities\n- No capabilities with zero providers\n\nIdentity checks:\n- List all identity.yaml files in .overstory/agents/*/\n- Each YAML parses without error\n- Required fields present: name, capability, created (valid ISO timestamp)\n- sessionsCompleted is non-negative integer\n- No stale identity files for agents deleted from manifest\n- Agent names are valid identifiers (alphanumeric, dash, underscore only)\n\nSource references:\n- src/agents/manifest.ts — loadManifest(), agent definition schema, capability index\n- src/agents/identity.ts — identity YAML parsing, field extraction\n- .overstory/agent-manifest.json — real example\n- .overstory/agents/*/identity.yaml — real examples\n\nOutput: pass/warn/fail. Malformed JSON = critical. Missing .md files = fail. Index out of sync = warn with auto-fix suggestion.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:59:42.5891-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:54:28.36983-08:00","closed_at":"2026-02-15T12:54:28.36983-08:00","close_reason":"Implemented structure, logs, and agent health checks. All tests passing (33 tests), quality gates clean.","dependencies":[{"issue_id":"overstory-aiik","depends_on_id":"overstory-m55s","type":"blocks","created_at":"2026-02-13T22:00:18.930587-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-am6","title":"Agent identity (sessionsCompleted, recentTasks) never updated","description":"The updateIdentity() function in src/agents/identity.ts is fully implemented but never called. sessionsCompleted is always 0 and recentTasks is always empty. The session-end log event (src/commands/log.ts) should call updateIdentity() to increment sessionsCompleted and record the completed task. The merge command could also update identity after successful merges. Currently these fields are dead code.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:21:18.398521-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:29:56.995341-08:00","closed_at":"2026-02-12T08:29:56.995341-08:00","close_reason":"Closed"}
{"id":"overstory-aqf","title":"E2E exercise: Add --verbose flag to status command","description":"E2E validation exercise. Add a --verbose flag to 'overstory status' that shows additional detail about each agent (logs path, worktree path, last mail timestamp). This is a real but small feature used to validate the full overstory lifecycle: issue creation, spec writing, agent sling, mail monitoring, merge, and close.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:44:57.452935-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:56:59.739703-08:00","closed_at":"2026-02-12T10:56:59.739703-08:00","close_reason":"E2E exercise complete. Agent successfully implemented --verbose flag for status command, merged clean to main. Full lifecycle validated: issue -\u003e spec -\u003e sling -\u003e agent work -\u003e merge -\u003e clean."}
{"id":"overstory-aun","title":"L0-6: Write agents/scout.md base definition","description":"Scout agent: read-only exploration agent. Can read files, run non-destructive bash commands, search code. Cannot write files. Used for codebase exploration and research tasks.","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:23.919487-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:20:05.120278-08:00","closed_at":"2026-02-12T07:20:05.120278-08:00","close_reason":"Created all 5 base agent definitions: scout (read-only explorer), builder (implementation), reviewer (validation), lead (delegation), merger (branch integration)"}
{"id":"overstory-ax6","title":"init should create .overstory/.gitignore for runtime state","description":"Move overstory-specific gitignore rules from root .gitignore into .overstory/.gitignore, following the same pattern as .beads/.gitignore. The init command should auto-create this file. Rules to include: SQLite DBs (mail.db, metrics.db + WAL/SHM), worktrees/, logs/, sessions.json, agents/ runtime state, specs/. Config files (config.yaml, agent-manifest.json, hooks.json) should remain tracked.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:39:42.631463-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:45:12.499255-08:00","closed_at":"2026-02-12T08:45:12.499255-08:00","close_reason":"Closed"}
{"id":"overstory-ax7","title":"init generates .overstory/ JSON files with spaces, Biome expects tabs","description":"'overstory init' generates hooks.json and agent-manifest.json with space indentation but Biome is configured for tab indentation. This causes 'biome check' to fail on the generated files. Also, sessions.json (created by sling) has a trailing newline issue. The init command should either: 1) Use tab indentation in generated JSON, or 2) Add .overstory/ to Biome's ignore list (since these are generated files).","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:16:27.534419-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:45:12.523887-08:00","closed_at":"2026-02-12T08:45:12.523887-08:00","close_reason":"Closed"}
{"id":"overstory-b02","title":"L4-8: Implement CLI router (src/index.ts)","description":"Main CLI entry point. Command router mapping: init, sling, prime, status, mail (send/check/list/read/reply), merge, worktree (list/clean), log, watch, metrics. Parses args, validates, dispatches to command handlers. Includes --help and --version. Shebang: #!/usr/bin/env bun","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:43.700846-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:39:42.046983-08:00","closed_at":"2026-02-12T07:39:42.046983-08:00","close_reason":"All L4 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-b02","depends_on_id":"overstory-19p","type":"blocks","created_at":"2026-02-12T07:13:45.937888-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-b0l1","title":"Fix doctor.test.ts assertions for implemented check modules","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T14:14:09.236215-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T14:24:00.854737-08:00","closed_at":"2026-02-15T14:24:00.854737-08:00","close_reason":"Consistency test DI refactor complete (8d52688), doctor tests already fixed (420d8b7)"}
{"id":"overstory-b1ac","title":"Add mulch record to leaf agent completion protocols","description":"Currently only coordinator and supervisor have mulch record in their completion protocols. All leaf agents (builder, scout, reviewer, merger, lead) mention mulch record in capabilities but don't include it as a required step. This means the self-improvement loop is broken at the leaf level — agents that do the actual work never record what they learn.\n\nChanges needed:\n- builder.md: Add 'mulch record \u003cdomain\u003e --type \u003cpattern|convention|decision\u003e --description ...' step before worker_done mail (new step 4, renumber rest)\n- lead.md: Add 'mulch record \u003cdomain\u003e --type \u003cpattern|decision\u003e --description ...' step before merge_ready mail (new step 3, renumber rest)  \n- merger.md: Add 'mulch record \u003cdomain\u003e --type \u003cpattern|failure\u003e --description ...' step before result mail (new step 4, renumber rest). Skip for clean merges.\n- scout.md: Read-only agent, cannot write files. Update result mail step (step 3) to instruct scouts to prefix reusable findings with 'INSIGHT:' in their result mail body so parents can record them.\n- reviewer.md: Read-only agent, cannot write files. Update result mail step (step 2) to instruct reviewers to prefix findings with 'INSIGHT:' so parents can record them.\n\nNote: Writable agents (builder, merger, lead) run mulch record in their worktree. Records commit with their branch and merge in with code. Read-only agents (scout, reviewer) flow insights through mail to parents.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T08:07:51.241763-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T17:39:36.992659-08:00","closed_at":"2026-02-16T17:39:36.992659-08:00","close_reason":"Added mulch record to builder/lead/merger completion protocols. Scout and reviewer use INSIGHT: prefix in result mail for parent recording."}
{"id":"overstory-b3sa","title":"Migrate sessions.json to SQLite SessionStore","description":"Create src/sessions/store.ts and src/sessions/compat.ts — replace the race-condition-prone sessions.json with a proper SQLite store.\n\n## Problem\nsessions.json is read/written by multiple concurrent processes (sling, log, status, watch, nudge, monitor) with no locking. Only status.ts uses atomic write (tmp+rename). Under high concurrency (25 agents), this can cause lost writes and data corruption.\n\n## Schema (in sessions.db)\n```sql\nCREATE TABLE sessions (\n  id TEXT PRIMARY KEY,\n  agent_name TEXT NOT NULL UNIQUE,\n  capability TEXT NOT NULL,\n  worktree_path TEXT NOT NULL,\n  branch_name TEXT NOT NULL,\n  bead_id TEXT NOT NULL,\n  tmux_session TEXT NOT NULL,\n  state TEXT NOT NULL DEFAULT 'booting'\n    CHECK(state IN ('booting','working','completed','stalled','zombie')),\n  pid INTEGER,\n  parent_agent TEXT,\n  depth INTEGER NOT NULL DEFAULT 0,\n  run_id TEXT,\n  started_at TEXT NOT NULL,\n  last_activity TEXT NOT NULL,\n  escalation_level INTEGER NOT NULL DEFAULT 0,\n  stalled_since TEXT\n);\nCREATE INDEX idx_sessions_state ON sessions(state);\nCREATE INDEX idx_sessions_run ON sessions(run_id);\n```\n\n## SessionStore Interface\n- upsert(session): void\n- getByName(agentName): AgentSession | null\n- getActive(): AgentSession[] — state IN ('booting','working','stalled')\n- getAll(): AgentSession[]\n- getByRun(runId): AgentSession[]\n- updateState(agentName, state): void\n- updateLastActivity(agentName): void\n- updateEscalation(agentName, level, stalledSince): void\n- remove(agentName): void\n- purge(opts): number\n- close(): void\n\n## Migration (src/sessions/compat.ts)\n```typescript\n// Backward-compatible shim for transition period\nfunction loadSessionsCompat(root: string): AgentSession[]\nfunction saveSessionCompat(root: string, session: AgentSession): void\n```\nOn first call, if sessions.json exists and sessions.db doesn't, import all entries. After that, SQLite is authoritative. sessions.json continues to be written during transition (one release) for safety.\n\n## Consumers to Migrate\nAll these currently read/write sessions.json directly:\n- src/commands/sling.ts — writes new session on spawn\n- src/commands/log.ts — updates lastActivity, transitions to completed\n- src/commands/status.ts — reads all, reconciles with tmux, writes zombie transitions\n- src/watchdog/daemon.ts — reads all, writes state changes + escalation levels\n- src/commands/nudge.ts — reads to find tmux session name\n- src/commands/monitor.ts — reads session state\n- src/commands/coordinator.ts — reads session state\n- src/commands/supervisor.ts — reads session state\n- src/commands/clean.ts — wipes sessions\n\n## Tests\n- src/sessions/store.test.ts: CRUD, state transitions, active filtering, run queries, escalation updates, purge. Use temp file SQLite.\n- src/sessions/compat.test.ts: JSON→SQLite migration, fallback behavior, idempotent migration. Use temp dirs with real files.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:08:30.673852-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T19:16:13.14516-08:00","closed_at":"2026-02-13T19:16:13.14516-08:00","close_reason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed."}
{"id":"overstory-b3u0","title":"Phase 0: Typed mail protocol for agent coordination","description":"Extend the existing SQLite mail system with typed message protocols for structured agent coordination. This is a prerequisite for Phases 1-3 since all inter-agent communication should flow through mail, not .md files. New message types: WORKER_DONE (worker → supervisor: signals completion with exit status, branch, issue ID), MERGE_READY (supervisor → merger: branch verified and ready for merge queue), MERGED (merger → supervisor: branch merged successfully, safe to clean up worker), MERGE_FAILED (merger → supervisor: merge failed, needs rework or fresh worker), ESCALATION (any → coordinator: severity-tagged issue requiring higher-level decision), HEALTH_CHECK (watchdog → agent: liveness probe, agent responds via heartbeat update not mail). Also: mail-based dispatch (coordinator sends DISPATCH message to supervisor, supervisor sends ASSIGN to worker) replacing the current model where the orchestrator must manually run overstory sling.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:51:09.166344-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T14:01:09.444294-08:00","closed_at":"2026-02-12T14:01:09.444294-08:00","close_reason":"Implemented typed mail protocol with 8 new message types + payload column, structural tool enforcement hooks, and beacon sendKeys fix"}
{"id":"overstory-b4jj","title":"Deprecate status --watch, point users to dashboard","description":"Once 'overstory dashboard' exists, deprecate the --watch flag on 'overstory status':\n\n- Print a deprecation notice when --watch is used: 'Note: --watch is deprecated. Use overstory dashboard for live monitoring.'\n- Keep --watch working for one release cycle, then remove\n- Update CLI help text and CLAUDE.md command reference\n- status stays as the lean, one-shot or --json machine-readable command","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:37:46.602486-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:46:09.652926-08:00","closed_at":"2026-02-13T09:46:09.652926-08:00","close_reason":"Added --watch deprecation warning to stderr, updated help text to mark --watch as deprecated pointing users to overstory dashboard, updated CLAUDE.md reference, added 2 new tests","dependencies":[{"issue_id":"overstory-b4jj","depends_on_id":"overstory-ofgf","type":"blocks","created_at":"2026-02-12T14:37:50.986034-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-b7of","title":"Implement run-completion detection in watchdog daemon tick","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T07:16:25.104416-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T07:21:41.531621-08:00","closed_at":"2026-02-18T07:21:41.531621-08:00","close_reason":"Implemented run-completion detection in watchdog daemon: PERSISTENT_CAPABILITIES set, checkRunCompletion() function with dedup marker file, integrated in runDaemonTick() after session loop. 8 new tests added covering all acceptance criteria."}
{"id":"overstory-b8ay","title":"Add post-workflow cleanup for stale state (mail, sessions, metrics)","description":"## Problem\n\nAfter a swarm workflow completes (agents terminated, worktrees cleaned), stale runtime state persists in .overstory/:\n\n- **mail.db**: 176K+ with 150+ unread messages between dead agents (builder→lead, coordinator→builder, etc). `overstory status` says '0 unread' because it filters to orchestrator, but `mail list --unread` dumps everything.\n- **sessions.json**: 34 session records from past workflows that are no longer relevant.\n- **metrics.db**: Accumulated metrics from past runs.\n\nNone of this is harmful, but it's confusing — the data from completed workflows clutters the current state view and makes it hard to tell what's active vs historical.\n\n## Design Considerations\n\nSeveral possible approaches (not mutually exclusive):\n\n1. **`overstory clean --state`** — Nuclear option: wipe mail, sessions, metrics for a fresh start. Simple but loses history.\n2. **Mail archiving/purging** — `overstory mail purge --agents-gone` to delete mail to/from agents that no longer have active sessions. Or mark all as read when their agent terminates.\n3. **Auto-cleanup on agent teardown** — When `worktree clean` removes an agent's worktree, also archive/purge their mail and session records.\n4. **Time-based retention** — Only show mail/sessions from the last N hours or current workflow. Archive older data.\n5. **Workflow boundaries** — Tag mail/sessions with a workflow ID. `overstory status` only shows current workflow's data.\n\nOption 3 feels most natural — cleanup should happen at the same time agents are being cleaned. Option 5 is most correct long-term but higher effort.\n\n## Current Behavior\n\n```\noverstory status          → 0 unread (filters to orchestrator)\noverstory mail list       → 2149 lines of output (all historical messages)\noverstory mail list --unread → 759 lines (messages to dead agents)\n.overstory/mail.db        → 176K\n```\n\n## Expected Behavior\n\nAfter a workflow completes and is cleaned up, starting fresh should feel fresh — no stale mail, no dead session records cluttering output.","notes":"Decision: Implement BOTH approach 1 (auto-cleanup on teardown) AND approach 2 (nuclear `overstory clean` command). The clean command should kill all processes, clean all worktrees, wipe mail, reset sessions/metrics — full slate wipe.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T10:47:12.241384-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T10:58:55.721893-08:00","closed_at":"2026-02-13T10:58:55.721893-08:00","close_reason":"Implemented overstory clean command (--all for nuclear wipe, individual flags for selective cleanup) and auto mail purge on worktree clean. Added MetricsStore.purge(). All 933 tests pass."}
{"id":"overstory-b8oj","title":"Expertise-routed task assignment","description":"When 'overstory sling' spawns an agent, query mulch for which agent identities have expertise in relevant file domains. Route to best-fit agent rather than random assignment. Agent identity already tracks expertiseDomains and recentTasks -- connect this to mulch for richer routing.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:54.424617-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T19:10:41.410415-08:00","closed_at":"2026-02-16T19:10:41.410415-08:00","close_reason":"Contradicts disposable agent architecture. No persistent agent identity to route to — sling picks a capability type, not a specific agent with accumulated expertise."}
{"id":"overstory-bc8v","title":"Dashboard: stop duration counter when agents reach completed status","description":"The overstory dashboard duration column continues counting up for agents that have reached 'completed' status. Duration should freeze at the time the agent completed, not keep incrementing as a live timer.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T12:59:40.850472-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:14:42.268029-08:00","closed_at":"2026-02-16T07:14:42.268029-08:00","close_reason":"Merged: duration counter freezes for completed/zombie agents"}
{"id":"overstory-bhz","title":"worktree clean --completed fails on .claude/ untracked files, then says 'No worktrees to clean'","description":"When sling deploys hooks to a worktree, it creates .claude/settings.local.json and .claude/CLAUDE.md. These are untracked files. When worktree clean --completed runs, git worktree remove fails because of these untracked files (exit 128). The command then misleadingly prints 'No worktrees to clean' after showing failure warnings. Two fixes needed: (1) worktree clean --completed should use force:true (same as --all) since the .claude/ dir will always be present, and (2) the 'No worktrees to clean' message should not appear when there were failures — it should say something like 'Failed to clean N worktrees (use --all to force)'.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:40:58.28652-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:50:53.388425-08:00","closed_at":"2026-02-12T09:50:53.388425-08:00","close_reason":"worktree clean --completed now uses force:true for worktree removal (handles untracked .claude/ files). Added failed[] tracking so 'No worktrees to clean' only shows when there are truly zero worktrees — failures now show 'Failed to clean N worktrees' instead."}
{"id":"overstory-bkvc","title":"Migrate merge queue from JSON to SQLite","description":"Current JSON queue (.overstory/merge-queue.json) uses readFileSync/writeFileSync with no concurrency safety. Two agents writing simultaneously causes data loss. Migrate to SQLite with WAL mode to align with mail.db, sessions.db, events.db, metrics.db pattern.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:25.809778-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:37:22.474561-08:00","closed_at":"2026-02-16T07:37:22.474561-08:00","close_reason":"Migrated merge queue from JSON (merge-queue.json) to SQLite (merge-queue.db). Eliminates data loss from concurrent writes. 13 files changed across core store, commands, tests, and doctor checks. 1665 tests pass."}
{"id":"overstory-bld","title":"E2E test task: add integration test for mail round-trip","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:22:26.928937-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:32:19.184205-08:00","closed_at":"2026-02-12T10:32:19.184205-08:00","close_reason":"e2e test completed"}
{"id":"overstory-bsqj","title":"Fix: clamp all .repeat() args in dashboard.ts to prevent negative values","description":"Wrap all unguarded String.prototype.repeat() calls with Math.max(0, ...) in src/commands/dashboard.ts. Add tests for edge cases.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-20T07:53:09.10787-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T07:55:41.196004-08:00","closed_at":"2026-02-20T07:55:41.196004-08:00","close_reason":"Guarded all String.prototype.repeat() calls in dashboard.ts with Math.max(0,...). Added early-return guards in truncate() and pad(). Exported pure functions and added 12 edge-case tests. All quality gates pass."}
{"id":"overstory-bsr8","title":"Supervisor agent: behavioral definition (agents/supervisor.md)","description":"Write the supervisor agent definition file defining HOW the supervisor operates. Based on coordinator.md pattern but scoped to per-project worker management. Covers: spawning workers, monitoring via mail, handling worker-done lifecycle, escalation to coordinator, nudge protocol.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:34:37.94917-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T14:55:19.697716-08:00","closed_at":"2026-02-12T14:55:19.697716-08:00","close_reason":"Phase 2 supervisor agent implemented and merged","dependencies":[{"issue_id":"overstory-bsr8","depends_on_id":"overstory-p6pn","type":"blocks","created_at":"2026-02-12T14:34:43.628951-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-bvwi","title":"Write log.test.ts for overstory log command","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:22:13.696762-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:34:59.55676-08:00","closed_at":"2026-02-13T08:34:59.55676-08:00","close_reason":"Test files created and merged to main"}
{"id":"overstory-byro","title":"Add run_id to token_snapshots for live cost filtering by run","description":"## Problem\n\n`overstory costs --live` shows real-time token snapshots for all active agents, but cannot be filtered by run. The `token_snapshots` table in metrics.db has no `run_id` column, matching the same gap as the sessions table (see related bug for --run returning empty).\n\nWhen multiple runs overlap or snapshots from old runs persist, there's no way to isolate live cost data to a specific run.\n\n## Current Schema\n\n```sql\nCREATE TABLE token_snapshots (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  agent_name TEXT NOT NULL,\n  input_tokens INTEGER NOT NULL DEFAULT 0,\n  output_tokens INTEGER NOT NULL DEFAULT 0,\n  cache_read_tokens INTEGER NOT NULL DEFAULT 0,\n  cache_creation_tokens INTEGER NOT NULL DEFAULT 0,\n  estimated_cost_usd REAL,\n  model_used TEXT,\n  created_at TEXT NOT NULL\n);\n```\n\n## Proposed Fix\n\nAdd `run_id TEXT` column to `token_snapshots`. When recording snapshots in `src/commands/log.ts` (throttled at 30s intervals during tool-end events), include the agent's run_id from the session. The --live path in costs.ts can then filter snapshots by run.\n\nLower priority than the main --run fix since --live is only useful during active runs, not retroactively.\n\n## Files to change\n\n- `src/metrics/store.ts` — Add run_id column migration, update recordSnapshot and getLatestSnapshots\n- `src/commands/log.ts` — Pass run_id when recording snapshots\n- `src/commands/costs.ts` — Filter --live snapshots by --run if both flags provided\n- `src/types.ts` — Add runId to TokenSnapshot if not already present","status":"open","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:08:32.19428-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:08:32.19428-08:00","dependencies":[{"issue_id":"overstory-byro","depends_on_id":"overstory-yg84","type":"blocks","created_at":"2026-02-19T12:08:39.673221-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-c2q","title":"L0-1: Initialize package.json, tsconfig.json, biome.json","description":"Bun init with strict TS config (noUncheckedIndexedAccess, no any), Biome config with tab indentation. Zero runtime deps. Bun runs TS directly — no build step. bin entry: overstory -\u003e ./src/index.ts","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:05.693767-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:16:21.984219-08:00","closed_at":"2026-02-12T07:16:21.984219-08:00","close_reason":"Created package.json (zero runtime deps, bin entry), tsconfig.json (strict, noUncheckedIndexedAccess), biome.json (tab indent, no any). Installed deps. Created full directory structure."}
{"id":"overstory-c2x","title":"L4-1: Implement watchdog daemon (src/watchdog/daemon.ts)","description":"Tier 1 mechanical process monitoring. Runs on interval (default 30s). For each active session: check tmux alive, check Claude PID alive, check last activity timestamp. State transitions: working -\u003e stalled -\u003e zombie -\u003e terminate. Function: startDaemon(options) -\u003e { stop: () =\u003e void }.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:11.200545-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:39:41.885421-08:00","closed_at":"2026-02-12T07:39:41.885421-08:00","close_reason":"All L4 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-c2x","depends_on_id":"overstory-19p","type":"blocks","created_at":"2026-02-12T07:13:44.918128-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-c6ca","title":"Create EventStore SQLite implementation","description":"Create src/events/store.ts — the central event store backed by SQLite.\n\n## Schema\n```sql\nCREATE TABLE events (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  run_id TEXT,\n  agent_name TEXT NOT NULL,\n  session_id TEXT,\n  event_type TEXT NOT NULL,\n  tool_name TEXT,\n  tool_args TEXT,           -- JSON, smart-filtered\n  tool_duration_ms INTEGER,\n  level TEXT NOT NULL DEFAULT 'info' CHECK(level IN ('debug','info','warn','error')),\n  data TEXT,                -- JSON payload\n  created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%f','now'))\n);\n-- Indexes: (agent_name, created_at), (run_id, created_at), (event_type, created_at), (tool_name, agent_name), level WHERE error\n```\n\n## Interface\n- insert(event): number — returns row id\n- correlateToolEnd(agentName, toolName): {startId, durationMs} | null — finds most recent unmatched tool_start, computes duration delta, updates row\n- getByAgent(agentName, opts?): StoredEvent[]\n- getByRun(runId, opts?): StoredEvent[]\n- getErrors(opts?): StoredEvent[] — filters level='error' or event_type IN ('error','escalation')\n- getTimeline(opts): StoredEvent[] — flexible query with agent/run/time filters\n- getToolStats(opts?): Array\u003c{toolName, count, avgDurationMs, maxDurationMs}\u003e\n- purge(opts): number\n- close(): void\n\n## Types to add to src/types.ts\nEventType, EventLevel, StoredEvent, EventStore interface\n\n## Patterns to follow\n- src/metrics/store.ts for SQLite setup (WAL mode, busy timeout, prepared statements)\n- src/mail/store.ts for schema migrations and interface shape\n\n## Tests (src/events/store.test.ts)\n- Insert and retrieve events\n- Tool duration correlation (start/end matching, handles missing starts)\n- Query by agent, run, event type, time range\n- Error filtering\n- Tool stats aggregation\n- Purge operations\n- Use :memory: SQLite for tests","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:07:54.50043-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T14:24:00.472321-08:00","closed_at":"2026-02-13T14:24:00.472321-08:00","close_reason":"Created src/events/store.ts with SQLite EventStore: insert, correlateToolEnd, getByAgent/Run/Errors/Timeline, getToolStats, purge. 48 tests pass."}
{"id":"overstory-c8j2","title":"Merge agent branch back to canonical and verify result","description":"After a slung agent completes work, run overstory merge --branch to merge its work back to main. Verify clean merge succeeds. This validates the final step of the e2e lifecycle.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:57:43.152107-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:19:03.170916-08:00","closed_at":"2026-02-12T13:19:03.170916-08:00","close_reason":"Validated merge E2E: dry-run correctly detects agent/task/files, clean merge succeeds at tier 1. Tested with synthetic agent branch.","dependencies":[{"issue_id":"overstory-c8j2","depends_on_id":"overstory-rnqn","type":"blocks","created_at":"2026-02-12T12:58:32.930602-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-cahb","title":"Register trace command in CLI router (src/index.ts)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T19:21:25.97898-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:38:31.76157-08:00","closed_at":"2026-02-13T20:38:31.76157-08:00","close_reason":"Registered trace in CLI router, wrote comprehensive tests","dependencies":[{"issue_id":"overstory-cahb","depends_on_id":"overstory-rj1k","type":"blocks","created_at":"2026-02-13T19:21:30.381134-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-cczf","title":"Beacon prompt does not trigger agent work without nudge","description":"During E2E lifecycle validation, the structured beacon sent via tmux sendKeys was received by Claude Code but did not trigger the agent to start working. The agent sat idle showing the beacon text in the prompt area but not generating a response. Only after sending an explicit nudge via 'overstory nudge' did the agent begin processing. Root cause likely: tmux sendKeys multiline text handling or timing issue where Claude Code TUI hasn't fully initialized its input processing when the beacon arrives (2s sleep may be insufficient).","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:10:11.423194-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:17:14.472215-08:00","closed_at":"2026-02-12T13:17:14.472215-08:00","close_reason":"Same root cause as y2ob: multiline beacon prevented TUI submission. Fixed by flattening beacon and guarding sendKeys()"}
{"id":"overstory-cec9","title":"Fix logger.test.ts tool event ordering assertion","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:46:16.683787-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:55:07.566123-08:00","closed_at":"2026-02-13T08:55:07.566123-08:00","close_reason":"Test coverage blitz complete: 830 tests, 0 failures, 42 files. All 17 modules now have test coverage."}
{"id":"overstory-co8","title":"L2-6: Implement prime command (src/commands/prime.ts)","description":"The overstory prime command for context loading. Called by SessionStart hook. Loads config, recent agent activity, mulch expertise. Supports --agent flag for per-agent priming and --compact flag for reduced context (PreCompact hook).","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:03.955578-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:33:09.627131-08:00","closed_at":"2026-02-12T07:33:09.627131-08:00","close_reason":"All L2 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-co8","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:41.36507-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-cz8","title":"sling accepts closed bead issues — should reject non-open issues","description":"overstory sling overstory-2mi spawned an agent for a closed issue without warning. The sling command should validate that the bead issue status is 'open' or 'in_progress' before creating the worktree and tmux session. Currently it only checks that the issue exists (bd show succeeds) but not that it's in a workable state. The fix: after fetching the issue via bd show --json, check that the status is 'open' or 'in_progress', and reject closed/resolved issues.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:43:39.103379-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:51:02.726516-08:00","closed_at":"2026-02-12T09:51:02.726516-08:00","close_reason":"sling now validates bead issue status after fetching. Only 'open' and 'in_progress' issues are accepted. Closed/resolved issues throw ValidationError with a clear message."}
{"id":"overstory-d1g8","title":"Enhance resolveModel() to return provider env vars","description":"Update resolveModel() in src/agents/manifest.ts to resolve provider configuration and return env vars for tmux session injection.\n\nFILES: src/agents/manifest.ts, src/types.ts\n\nChanges:\n- Add ResolvedModel interface: { model: string; env?: Record\u003cstring, string\u003e }\n- Update resolveModel() return type from ModelName to ResolvedModel\n- Resolution logic:\n  1. Resolve model string from config.models[role] \u003e manifest.agents[role].model \u003e fallback\n  2. If model is a simple alias (sonnet/opus/haiku): return { model: alias } (no extra env)\n  3. If model is provider-prefixed (e.g. 'openrouter/openai/gpt-5.3'):\n     a. Split on first '/' to get provider name ('openrouter') and model ID ('openai/gpt-5.3')\n     b. Look up provider in config.providers\n     c. Build env: ANTHROPIC_BASE_URL=provider.baseUrl, ANTHROPIC_AUTH_TOKEN from process.env[provider.authTokenEnv], ANTHROPIC_API_KEY='', ANTHROPIC_DEFAULT_{ALIAS}_MODEL=modelId\n     d. Return { model: alias-to-use, env: {...} }\n- Update VALID_MODELS set at line 29 and validation at lines 49-51 to allow arbitrary model strings in manifest\n- resolveModel() now takes config (with providers) as context for env resolution\n- Add resolveProviderEnv() helper function for building the env dict","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:13:48.882824-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T07:46:21.609116-08:00","closed_at":"2026-02-20T07:46:21.609116-08:00","close_reason":"Completed: Enhanced resolveModel() to return ResolvedModel { model, env? } with provider gateway support. Builder implemented ResolvedModel interface, resolveProviderEnv() helper, updated validation to accept ModelRef, updated 4 callers, added comprehensive tests. All changes merged to main.","dependencies":[{"issue_id":"overstory-d1g8","depends_on_id":"overstory-rgst","type":"blocks","created_at":"2026-02-19T12:14:11.614944-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-d3x","title":"tmux.test.ts: Document as legitimate mock exception","description":"tmux.test.ts is the one test file where mocking is the correct approach — real tmux operations would interfere with the developer's session and are fragile in CI. Add a comment to the top of the test file documenting why mocks are used here (system-level side effects, CI incompatibility). Consider extracting the mockSpawnResult helper to the shared test harness since it may still be needed for tmux and claude CLI mocking.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:56:22.90369-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:59:49.498353-08:00","closed_at":"2026-02-12T08:59:49.498353-08:00","close_reason":"Added block comment documenting tmux tests as legitimate mock exception; fixed stale import paths from file relocation"}
{"id":"overstory-d4bx","title":"clean.test.ts kills live tmux sessions during bun test (dogfood crash root cause)","description":"## Root Cause\n\nclean.test.ts runs cleanCommand(['--all']) with NO tmux mocks ('never mock what you can use for real'). This calls killAllTmuxSessions() which kills ALL tmux sessions prefixed 'overstory-' globally — not scoped to any project.\n\nDuring dogfooding (bun test run by a builder agent inside a live swarm), this kills:\n- overstory-coordinator\n- overstory-{lead-name}\n- overstory-{builder-name} (kills itself mid-loop)\n\n## Evidence\n- Observed live: coordinator and builder tmux sessions disappeared while builder was running 'bun test'\n- Lead survived because kill loop self-terminated when it killed the builder's own tmux\n- Sequential 34-second death window in previous crash matches killSession() SIGTERM→wait→SIGKILL per-session pattern\n- Only reproduces when dogfooding (running swarm on overstory's own repo) — external projects have no live tmux sessions during bun test\n\n## Fix Options\n1. Mock killAllTmuxSessions in clean.test.ts (simplest, matches tmux.test.ts pattern)\n2. Use fake session name prefix in tests (e.g. 'overstory-agent-fake' per mx-f1dccb convention)\n3. Scope killAllTmuxSessions to project by checking SessionStore before killing\n\n## Secondary Issue: Hook contamination\ndeployHooks() writes coordinator hooks to .claude/settings.local.json at project root. The ENV_GUARD only protects PreToolUse blocking hooks, NOT the logging/lifecycle hooks (SessionStart, UserPromptSubmit, PreToolUse logger, PostToolUse, Stop, PreCompact). This means ALL Claude Code sessions at the project root:\n- Log tool events as coordinator\n- Fire session-end marking coordinator 'completed' on every Stop\n- Run overstory prime/mail check as coordinator\n\nCode comment at coordinator.ts:117-119 incorrectly claims ENV_GUARD protects all hooks.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T20:13:30.43115-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:23:10.98226-08:00","closed_at":"2026-02-13T20:23:10.98226-08:00","close_reason":"Fixed: killAllTmuxSessions now project-scoped via SessionStore lookup","dependencies":[{"issue_id":"overstory-d4bx","depends_on_id":"overstory-pcef","type":"blocks","created_at":"2026-02-13T20:19:18.127177-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-d4bx","depends_on_id":"overstory-hy7a","type":"blocks","created_at":"2026-02-13T20:19:18.283851-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-d4bx","depends_on_id":"overstory-lvsy","type":"blocks","created_at":"2026-02-13T20:19:18.440924-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-d5n","title":"Agent does not send completion mail to orchestrator","description":"When a headless agent completes its task, it closes the bead but does not send a completion mail (--type result) back to the orchestrator. The overlay CLAUDE.md instructs the agent to do this, but the agent did not comply. This means the orchestrator has no mail-based signal that work is done - it must poll status or check worktree state.","notes":"UPDATE: This is likely a symptom of overstory-d9g (mail DB silo). The mail-scout agent DID send a completion mail, but it went to the worktree-local mail.db. The helptext-builder may have done the same. Once overstory-d9g is fixed (mail resolves to canonical DB), agent completion mails should be visible to the orchestrator.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:01:08.534464-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:23:52.87793-08:00","closed_at":"2026-02-12T12:23:52.87793-08:00","close_reason":"Root cause (overstory-d9g mail DB silo) was already fixed. With interactive mode (overstory-37e), agents can now send/receive mail properly. Overlay instructions to send completion mail will be followed.","dependencies":[{"issue_id":"overstory-d5n","depends_on_id":"overstory-d9g","type":"blocks","created_at":"2026-02-12T12:11:14.972976-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-d6ph","title":"Update hooks-deployer tests for removed stdin relay","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:41:37.853592-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:45:54.275275-08:00","closed_at":"2026-02-17T07:45:54.275275-08:00","close_reason":"Updated three test assertions to verify stdin relay pattern removal. Tests correctly assert pattern is NOT present (lines 247, 262, 298). Lint and typecheck pass. Tests depend on overstory-nlnl template fix."}
{"id":"overstory-d9d8","title":"Scope dashboard/status views to current run","description":"The dashboard shows data from ALL sessions/runs ever created, not just the current one. Specifically: (1) Agent panel calls getAll() on sessions.db — shows every session ever. (2) Metrics panel calls getRecentSessions(100) and getAverageDuration() across ALL runs with no run scoping. (3) Mail panel shows last 5 messages from all time. (4) Merge queue shows all entries. Fix: Default dashboard/status views to current-run data (read run ID from current-run.txt, use sessionStore.getByRun() and filter metrics accordingly). Add --all flag for historical view.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:31:46.313082-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T07:39:45.422507-08:00","closed_at":"2026-02-18T07:39:45.422507-08:00","close_reason":"Dashboard and status commands now scoped to current run by default. Added --all flag for historical view. Both builder branches merged.","dependencies":[{"issue_id":"overstory-d9d8","depends_on_id":"overstory-tgcl","type":"blocks","created_at":"2026-02-17T07:31:51.805736-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-d9g","title":"CRITICAL: Mail DB is siloed per worktree - agents write to wrong mail.db","description":"Each git worktree contains its own .overstory/ directory with a separate mail.db. When agents run 'overstory mail send' from their worktree, the mail is written to the worktree-local .overstory/mail.db instead of the canonical one. The orchestrator reads from the main .overstory/mail.db and never sees agent messages. Verified: mail-scout sent a detailed audit report (msg-tteblz285v8j) that is only in .overstory/worktrees/mail-scout/.overstory/mail.db. Similarly, mail FROM orchestrator TO agents (e.g., msg-45maqn4qfk29) is in the main mail.db but not in the worktree-local DBs. Fix: mail store should resolve to the canonical .overstory/mail.db path, not the worktree-relative one. Or use a shared absolute path.","notes":"Root cause: resolveProjectRoot() in config.ts checks for .overstory/config.yaml existence as its first condition. Since config.yaml is a git-tracked file, worktrees have their own copy. The function short-circuits and returns the worktree path instead of following through to git rev-parse --git-common-dir. Fix: the function should always use git worktree detection when running from a subdirectory of .overstory/worktrees/, OR the mail.db path should be resolved differently (e.g., always use an absolute path from the canonical root stored in config). Note: beads (bd) does NOT have this issue because it follows .git -\u003e gitdir to find the main repo.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:05:57.204117-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:18:32.607829-08:00","closed_at":"2026-02-12T12:18:32.607829-08:00","close_reason":"Fixed resolveProjectRoot() to check git worktree FIRST before local .overstory/config.yaml check. Worktrees have tracked copies of config.yaml that caused the function to short-circuit and return the worktree path instead of the canonical root. Added regression test with committed config.yaml."}
{"id":"overstory-da2","title":"sling --spec: spec file not accessible from agent worktree","description":"The overlay CLAUDE.md references the spec file with a relative path (e.g., .overstory/specs/test-spec.md), but .overstory/ is gitignored so it does not exist in the agent's worktree. The agent cannot read its task spec. Fix options: (1) copy spec file to worktree during sling, (2) use absolute path in overlay, (3) symlink, or (4) embed spec content directly in the overlay.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:30:32.763758-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:41:38.926898-08:00","closed_at":"2026-02-12T10:41:38.926898-08:00","close_reason":"Resolve spec path to absolute in sling.ts before passing to overlay config, so agents in worktrees can read the spec file from the main repo"}
{"id":"overstory-ddep","title":"Implement src/commands/logs.ts command","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:04:46.563364-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:09:33.814026-08:00","closed_at":"2026-02-16T13:09:33.814026-08:00","close_reason":"logs.ts command implemented with all filters, follow mode, JSON output"}
{"id":"overstory-dfc","title":"L5-6: Write mail-store.test.ts","description":"Tests for src/mail/store.ts. Cover: schema creation, message CRUD (insert/select/update), WAL mode enabled, concurrent read/write safety, index usage, thread_id grouping.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:31.678813-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:47:43.361616-08:00","closed_at":"2026-02-12T07:47:43.361616-08:00","close_reason":"Wrote mail-store.test.ts with 17 tests covering CRUD, filtering, threading, and concurrent access","dependencies":[{"issue_id":"overstory-dfc","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:47.5755-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-dg4","title":"mail read on already-read message silently succeeds","description":"Running 'overstory mail read \u003cid\u003e' on a message that is already marked as read outputs 'Marked \u003cid\u003e as read.' without indicating it was already read. While not harmful, it's misleading. Could either say 'Already read' or 'Marked as read (was already read)' for clarity.","status":"closed","priority":4,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:09:54.425626-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:14:44.881371-08:00","closed_at":"2026-02-12T10:14:44.881371-08:00","close_reason":"mail read now returns { alreadyRead: boolean } and prints informational message when message was already read"}
{"id":"overstory-dh2","title":"Test depth limit","description":"temp","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:09:53.187085-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:10:07.133422-08:00","closed_at":"2026-02-12T12:10:07.133422-08:00","close_reason":"temp test issues, closed after E2E validation"}
{"id":"overstory-divy","title":"Review: sling-domain-builder domain inference","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T13:23:35.495847-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:28:05.825968-08:00","closed_at":"2026-02-20T13:28:05.825968-08:00","close_reason":"PASS: all three builder branches reviewed and verified"}
{"id":"overstory-dp7","title":"L4-2: Implement watchdog triage (src/watchdog/triage.ts)","description":"Tier 2 AI-assisted failure classification. When daemon detects stalled agent, triage analyzes logs to determine: recoverable stall (retry), genuine failure (terminate + report), or expected long operation (extend timeout). Uses claude --print for classification.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:14.924625-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:39:41.908478-08:00","closed_at":"2026-02-12T07:39:41.908478-08:00","close_reason":"All L4 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-dp7","depends_on_id":"overstory-19p","type":"blocks","created_at":"2026-02-12T07:13:45.057659-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-dp9p","title":"Implement mulch-informed lead decomposition: types, overlay, sling, lead.md","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:23:01.453443-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:28:20.580206-08:00","closed_at":"2026-02-13T22:28:20.580206-08:00","close_reason":"Implemented mulch-informed lead decomposition: mulchExpertise field in OverlayConfig, formatMulchExpertise() in overlay.ts, {{MULCH_EXPERTISE}} template placeholder, auto-fetch in sling.ts, lead.md Phase 1 workflow updated with mulch search + file-scoped priming. 50 overlay tests + 32 sling tests pass."}
{"id":"overstory-dpk","title":" env var referenced in agent definitions but never set","description":"All base agent definitions (scout.md, builder.md, lead.md, reviewer.md, merger.md) reference $OVERSTORY_AGENT_NAME for the agent to know its own name. However, the sling command never sets this environment variable in the tmux session. The hooks work because they use hardcoded agent names (via {{AGENT_NAME}} template substitution), but if an agent tries to use $OVERSTORY_AGENT_NAME in ad-hoc commands, it will be empty. Either set the env var in the tmux session or update the agent definitions to reference the overlay.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:22:12.116692-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:45:12.475531-08:00","closed_at":"2026-02-12T08:45:12.475531-08:00","close_reason":"Closed"}
{"id":"overstory-dt9o","title":"Strengthen review-mandatory language in lead.md","description":"Edit agents/lead.md to strengthen Phase 3 review requirement language and add cost awareness","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T08:01:19.932443-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T08:06:54.098567-08:00","closed_at":"2026-02-17T08:06:54.098567-08:00","close_reason":"Strengthened review-mandatory language in agents/lead.md with production data (2/98 reviews) and imperative phrasing. Phase 3 title now MANDATORY, step 12 uses MUST language, reviewer cost comparison added, REVIEW_SKIP failure mode enhanced, explicit reviewer coverage verification added to Completion Protocol, new constraint added. All acceptance criteria met."}
{"id":"overstory-dvy","title":"temp test for spec validation","description":"temp","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:04:52.577478-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:10:07.091749-08:00","closed_at":"2026-02-12T12:10:07.091749-08:00","close_reason":"temp test issues, closed after E2E validation"}
{"id":"overstory-dy0j","title":"Migrate supervisor.ts + test to SessionStore","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T14:56:45.562983-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T15:03:23.306603-08:00","closed_at":"2026-02-13T15:03:23.306603-08:00","close_reason":"Migrated supervisor.ts to SessionStore: replaced sessions.json operations with SQLite store, removed loadSessions/saveSessions functions and tests, added store.close() in finally blocks. All quality gates passed."}
{"id":"overstory-e1fp","title":"Add event subscription system","description":"Agents subscribe to events (file changed, test suite passed, merge conflict detected). When an event fires, subscribed agents get auto-notified via mail. Currently agents only learn about the world when polled on UserPromptSubmit hook.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:33.451509-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T17:16:51.778925-08:00","closed_at":"2026-02-15T17:16:51.778925-08:00","close_reason":"Closing along with blackboard system — not needed at this stage","dependencies":[{"issue_id":"overstory-e1fp","depends_on_id":"overstory-sbto","type":"blocks","created_at":"2026-02-15T17:05:34.04932-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-e1q2","title":"Fix unused merging status in MergeEntry","description":"MergeEntry type has 'merging' status but the resolver never sets it (goes directly from 'pending' to 'merged'/'conflict'/'failed'). Either wire it up in the resolver or remove it from the type.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:37.696942-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:28:15.339091-08:00","closed_at":"2026-02-16T18:28:15.339091-08:00","close_reason":"Merging status fix included in the merge resolver refactor."}
{"id":"overstory-e3kd","title":"Fix typecheck: add providers to config fixtures and update resolveModel","description":"Add providers field to 10 test fixtures and update resolveModel types in manifest.ts. Also replicate types.ts provider changes for branch coherence.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:37:40.343012-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:42:12.02714-08:00","closed_at":"2026-02-19T12:42:12.02714-08:00","close_reason":"Added providers field to 10 test fixture files (manifest.test.ts + 9 doctor test files), updated resolveModel to use string type instead of local ModelName alias, replicated types.ts/config.ts provider types. All quality gates passed: 1911 tests, typecheck clean, lint clean on scoped files."}
{"id":"overstory-e4jk","title":"Implement: replace mulch_learn mail with actual mulch record","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T17:30:29.129949-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T17:37:17.448762-08:00","closed_at":"2026-02-16T17:37:17.448762-08:00","close_reason":"Replaced mulch_learn mail with actual mulch record in session-end handler. Extracted autoRecordExpertise function for testability. 4 new tests, 2 test renames. Quality gates pass."}
{"id":"overstory-e4t","title":"Agent lastActivity timestamp never updates in headless mode","description":"In status output, agent lastActivity shows the spawn time and never changes because tool-start/tool-end hooks do not fire in headless mode (claude -p). This makes it appear agents are idle when they are actually working. The status --verbose output shows stale timestamps.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:04:44.541702-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:23:51.498511-08:00","closed_at":"2026-02-12T12:23:51.498511-08:00","close_reason":"Resolved by overstory-37e: switching to interactive mode means all hooks (SessionStart, UserPromptSubmit, PreToolUse, PostToolUse, Stop) now fire. Mail injection, metrics recording, lastActivity updates, and log directories all work."}
{"id":"overstory-e5jb","title":"git push hook bypassed in interactive sessions","description":"All PreToolUse hooks in .claude/settings.local.json start with ENV_GUARD ([ -z \"$OVERSTORY_AGENT_NAME\" ] \u0026\u0026 exit 0), so git push blocking only activates for spawned agents. Interactive Claude Code sessions have no agent name set, so the hook is a no-op and git push goes through unchecked. Need a separate hook entry without the env guard for universal git push blocking.","notes":"More involved than a simple hook addition. The template (templates/hooks.json.tmpl) is read by deployHooks() in src/agents/hooks-deployer.ts, which is covered by 135 tests — 8 of which count Bash guard entries and will break if a new Bash guard is added to the template. The env guard test also asserts all non-empty-matcher guards contain OVERSTORY_AGENT_NAME, which a universal guard intentionally would not. Fix requires: (1) add guardless git push block to template, (2) update 8 tests to expect +1 Bash guard count, (3) update env guard test to exclude the universal git push guard from its assertion. Also need to update settings.local.json at project root (not tracked by git, deployed by overstory hooks install).","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-17T09:21:24.190522-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T07:57:12.253785-08:00","closed_at":"2026-02-18T07:57:12.253785-08:00","close_reason":"Universal hook guard added to templates/hooks.json.tmpl without ENV_GUARD prefix. Blocks the dangerous remote operation in both agent and interactive sessions. 7 test count assertions updated, env guard test patched, new verification test added. 1868 tests pass."}
{"id":"overstory-e72","title":"agent-manifest.json capabilityIndex is always empty","description":"After 'overstory init', the agent-manifest.json has 'capabilityIndex: {}'. The manifest defines agents with capabilities (e.g., builder has 'implement, refactor, fix') but the capabilityIndex is never populated. This index should map capabilities to agent names for lookup (e.g., {'implement': ['builder', 'lead'], 'explore': ['scout']}). Without it, capability-based agent selection requires iterating all agents.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:15:59.653102-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:45:12.547374-08:00","closed_at":"2026-02-12T08:45:12.547374-08:00","close_reason":"Closed"}
{"id":"overstory-e7hf","title":"Conflict pattern learning for merge","description":"Close the loop on recordConflictPattern(). Before attempting merge, query mulch for similar past conflicts. Use historical patterns to: skip tiers that historically fail for this file/pattern combo, inform AI-resolve prompts with past successful resolutions, predict which files are likely to conflict.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:51.101367-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:28:15.214329-08:00","closed_at":"2026-02-16T18:28:15.214329-08:00","close_reason":"Conflict pattern learning for merge implemented. queryConflictHistory function, tier-skip logic based on failure rates, AI prompt enrichment with past resolutions. 38 tests pass.","dependencies":[{"issue_id":"overstory-e7hf","depends_on_id":"overstory-f0kl","type":"blocks","created_at":"2026-02-15T17:05:33.230921-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-e86r","title":"Phase 4: Deep watchdog chain (multi-tier health monitoring)","description":"Evolve the current single-tier watchdog into a multi-tier health monitoring chain with autonomous recovery. Architecture: Tier 0 (Mechanical daemon) - Go/Bun process, heartbeat every 30-60s, checks tmux/pid liveness, spawns Tier 1 on anomaly. Tier 1 (Triage agent) - Ephemeral AI agent, fresh spawn each tick (no context debt), makes single decision: is intervention needed? Exits immediately. Tier 2 (Monitor agent) - Continuous patrol, long-running session, monitors all supervisors and workers, handles lifecycle requests (respawn, restart, cycle). Tier 3 (Supervisor monitors) - Per-project supervisors already monitor their own workers. Additional features: (1) Stale escalation auto-bump (severity increases over time if unacknowledged), (2) Progressive nudging before kill (warn → nudge → escalate → terminate), (3) Zombie detection and reconciliation every tick.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:50:56.70583-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T07:03:46.728909-08:00","closed_at":"2026-02-13T07:03:46.728909-08:00","close_reason":"Phase 4 complete: Tier 0 (mechanical daemon with progressive nudging), Tier 1 (AI triage gated behind config), Tier 2 (monitor agent definition + command), Tier 3 (supervisor monitors existing). Added: progressive nudge stages (warn→nudge→escalate→terminate), stale escalation auto-bump, triage retry action, tier renaming with backward compat, 18 daemon integration tests, monitor.md agent definition, overstory monitor start/stop/status command.","dependencies":[{"issue_id":"overstory-e86r","depends_on_id":"overstory-yhbn","type":"blocks","created_at":"2026-02-12T13:51:33.782841-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-e86r","depends_on_id":"overstory-5bic","type":"blocks","created_at":"2026-02-13T06:51:43.16472-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-e86r","depends_on_id":"overstory-w4zv","type":"blocks","created_at":"2026-02-13T06:51:43.308086-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-e86r","depends_on_id":"overstory-k3t4","type":"blocks","created_at":"2026-02-13T06:51:43.460268-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-e86r","depends_on_id":"overstory-pvn7","type":"blocks","created_at":"2026-02-13T06:51:43.60724-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-e9d3","title":"Add Run type and RunStore to sessions.db","description":"Add Run type/RunStore interface to types.ts, implement runs table and RunStore in sessions/store.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T19:20:50.337554-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:32:57.294862-08:00","closed_at":"2026-02-13T20:32:57.294862-08:00","close_reason":"Added Run type/RunStore interface to types.ts, implemented runs table and RunStore methods in sessions/store.ts with tests"}
{"id":"overstory-ebd","title":"No agent log directory created in headless mode","description":"Agent log directories under .overstory/logs/{agent-name}/ are never created for headless agents because the 'overstory log' command (called by hooks) creates the directory, but hooks don't fire in 'claude -p' mode. Verified: after sling of mail-scout, merge-scout, and helptext-builder, no log directories exist for any of them.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:04:47.109507-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:23:51.519688-08:00","closed_at":"2026-02-12T12:23:51.519688-08:00","close_reason":"Resolved by overstory-37e: switching to interactive mode means all hooks (SessionStart, UserPromptSubmit, PreToolUse, PostToolUse, Stop) now fire. Mail injection, metrics recording, lastActivity updates, and log directories all work."}
{"id":"overstory-edbz","title":"Cherry-pick resolver conflict recording commits onto main","description":"Cherry-pick commits c884e83 (mulch conflict pattern recording in resolver.ts/resolver.test.ts) and 971b58b (mulch record .mulch/expertise/typescript.jsonl) onto main. These are from overstory/conflict-recorder/overstory-typs.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:37:12.430871-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:41:03.870773-08:00","closed_at":"2026-02-13T22:41:03.870773-08:00","close_reason":"Cherry-pick completed, merged to main"}
{"id":"overstory-eef1","title":"Write logger.test.ts for src/logging/logger.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:05:00.046146-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:18:50.221719-08:00","closed_at":"2026-02-13T09:18:50.221719-08:00","close_reason":"wrote comprehensive logger.test.ts with 46 tests covering all Logger methods, output file formats, session.log key=value formatting, events.ndjson field completeness, errors.log structure with cause chains, secret redaction in all outputs, close() preventing writes across all event types, lazy directory creation, verbose mode, and error isolation"}
{"id":"overstory-eft1","title":"Dashboard mail query does full table scan with no SQL LIMIT","description":"dashboard.ts:163 calls mailStore.getAll() which fetches the entire messages table, then slices to 5 in JS. With 40+ agents exchanging frequent mail, this table grows to thousands of rows. Fix: add a getRecent(n) method to MailStore using ORDER BY created_at DESC LIMIT n, or pass limit options to getAll().","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-19T13:28:08.956578-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T07:52:23.206403-08:00","closed_at":"2026-02-20T07:52:23.206403-08:00","close_reason":"Fixed dashboard mail query full table scan. Added limit option to MailStore.getAll() (SQL LIMIT clause). Dashboard now uses limit:5/50 instead of fetching all rows. Branch: overstory/dashboard-mail-builder/overstory-6r7j (commit 6ab923d). All quality gates pass."}
{"id":"overstory-ekv","title":"init succeeds in non-git directory without warning","description":"'overstory init' succeeds in a directory that is not a git repository. Since overstory depends entirely on git (worktrees, branches, merge), init should detect whether the directory is inside a git repo and either fail with a clear error or warn the user that git is required.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:19:03.976557-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:29:23.535152-08:00","closed_at":"2026-02-12T08:29:23.535152-08:00","close_reason":"Added git repo check at start of init command. Throws ValidationError if not inside a git repository."}
{"id":"overstory-el16","title":"Record merge conflict patterns in mulch","description":"In src/merge/resolver.ts, after conflict resolution, record a pattern to the architecture domain with conflicting file paths, branch names, and resolution tier used. Tag with merge-conflict. Use --evidence-bead to link conflict patterns back to the bead that caused the merge. Over time this builds knowledge to help agents avoid conflicts.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:08:42.651498-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:41:00.667966-08:00","closed_at":"2026-02-13T22:41:00.667966-08:00","close_reason":"Merge conflict patterns now recorded in mulch after tier 2-4 resolution. Fire-and-forget pattern, evidenceBead linking, 7 new tests.","dependencies":[{"issue_id":"overstory-el16","depends_on_id":"overstory-j53z","type":"blocks","created_at":"2026-02-13T21:50:45.215959-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-en4","title":"E2E test: builder agent concurrent test","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:24:05.31921-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:35:41.188861-08:00","closed_at":"2026-02-12T10:35:41.188861-08:00","close_reason":"e2e test completed, builder agent concurrent test validated"}
{"id":"overstory-ep5m","title":"Implement session insight analyzer module","description":"Create src/insights/analyzer.ts with pattern extraction from EventStore data, add types to types.ts, integrate into autoRecordExpertise in log.ts, and add tests","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T17:51:18.608903-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:00:41.522769-08:00","closed_at":"2026-02-16T18:00:41.522769-08:00","close_reason":"Implemented session insight analyzer: src/insights/analyzer.ts with pattern extraction from EventStore data, integrated into autoRecordExpertise in log.ts, types added to types.ts, all tests passing"}
{"id":"overstory-eqj0","title":"Hybrid enforcement: coordinator delegation must use overstory sling (structural + behavioral)","description":"Parent epic for the coordinator delegation enforcement problem. The coordinator agent uses Claude Code built-in Task tool instead of overstory sling, completely bypassing the overstory system (no worktrees, no mail, no groups, no specs). The fix requires a hybrid approach: (1) STRUCTURAL: Block Task/TeamCreate/SendMessage tools via PreToolUse hooks in hooks-deployer.ts for coordinator and supervisor capabilities (overstory-x6xm). (2) BEHAVIORAL: Update coordinator.md and supervisor.md with explicit prohibitions, a NATIVE_DELEGATION failure mode, and a workaround heuristic — if you are reaching for workarounds you should be delegating (overstory-q4nb). (3) OBSERVABILITY: Fix tool logging so we can detect this behavior from logs instead of requiring tmux capture (overstory-nq0y). Neither structural nor behavioral enforcement alone is sufficient (Gastown learned this too). The hybrid ensures the model cannot use Task even if it wants to, AND understands why it should use overstory sling instead.","notes":"Additional design flaw: overstory coordinator start deploys hooks to project root .claude/settings.local.json, which affects ALL Claude Code sessions in the project, not just the coordinator. Slinged agents get hooks in their worktree (isolated), but the coordinator has no worktree. Either (a) the coordinator needs its own worktree, (b) hooks need to be scoped by OVERSTORY_AGENT_NAME env var so they only activate for the coordinator session, or (c) the coordinator should not deploy hooks to the project root at all. Also: bun -e bypasses all bash guards since unlinkSync/writeFileSync dont match dangerous patterns — the structural enforcement has holes.","status":"closed","priority":1,"issue_type":"epic","owner":"jayminwest@gmail.com","created_at":"2026-02-13T06:21:01.394114-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:49:17.729163-08:00","closed_at":"2026-02-13T06:49:17.729163-08:00","close_reason":"All 3 subtasks complete: structural hook blocking (x6xm), behavioral agent def updates (q4nb), tool logging fix (nq0y). Remaining design concerns filed as separate issues.","dependencies":[{"issue_id":"overstory-eqj0","depends_on_id":"overstory-x6xm","type":"blocks","created_at":"2026-02-13T06:22:09.427728-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-eqj0","depends_on_id":"overstory-q4nb","type":"blocks","created_at":"2026-02-13T06:22:09.569109-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-eqj0","depends_on_id":"overstory-nq0y","type":"blocks","created_at":"2026-02-13T06:22:09.721461-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-eu6y","title":"Write molecules.test.ts for src/beads/molecules.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:05:01.062301-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:32:05.321585-08:00","closed_at":"2026-02-13T09:32:05.321585-08:00","close_reason":"Test files already written and committed"}
{"id":"overstory-ewe","title":"L5-8: Write merge-queue.test.ts","description":"Tests for src/merge/queue.ts. Cover: FIFO ordering, enqueue/dequeue, status transitions (pending/merging/merged/conflict/failed), conflict detection between overlapping file sets.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:33.339278-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:54:20.509727-08:00","closed_at":"2026-02-12T07:54:20.509727-08:00","close_reason":"Closed","dependencies":[{"issue_id":"overstory-ewe","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:47.898715-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-ez8j","title":"Update all merge queue consumers for SQLite migration","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T07:06:28.975074-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:36:53.363366-08:00","closed_at":"2026-02-16T07:36:53.363366-08:00","close_reason":"All 11 consumer files updated from merge-queue.json to merge-queue.db. Tests pass. Two minor lint fixes needed on main.","dependencies":[{"issue_id":"overstory-ez8j","depends_on_id":"overstory-maiz","type":"blocks","created_at":"2026-02-16T07:08:05.808151-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-f0kl","title":"Mulch enhancements for structured pattern storage","description":"Project-agnostic mulch improvements to support the learning flywheel: (1) structured pattern records with success/failure metadata, (2) better search/query for 'find patterns matching this file type and task type', (3) pattern scoring/weighting so frequently-confirmed patterns rank higher. These should be general mulch capabilities, not Overstory-specific.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:05:01.395564-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:12:21.119968-08:00","closed_at":"2026-02-16T13:12:21.119968-08:00","close_reason":"Scoped: mulch is an external CLI tool. The requested enhancements (structured pattern records with success/failure metadata, pattern scoring/weighting, advanced search) require changes in the mulch-cli repo, not in overstory. The overstory mulch client (src/mulch/client.ts) already wraps all available mulch CLI features including record (with types, classification, tags, evidence), search (with domain/type/tag filters), learn, compact, and diff. No changes needed on overstory's side until mulch-cli adds these features. Filed as external work."}
{"id":"overstory-fe19","title":"Review: mulch-client-builder search+record changes","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T13:23:35.335152-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:28:05.824975-08:00","closed_at":"2026-02-20T13:28:05.824975-08:00","close_reason":"PASS: all three builder branches reviewed and verified"}
{"id":"overstory-ff2s","title":"Agent worktree missing biome/tsc on PATH","description":"When a builder agent runs 'biome check .' or 'tsc --noEmit' directly in a worktree, the commands are not found (exit code 127). The agent must use 'bun run lint' and 'bun run typecheck' instead. Either: (1) update the builder agent definition to use bun run scripts, (2) add node_modules/.bin to PATH in the tmux session, or (3) update the overlay quality gates section to use the correct commands.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:10:08.254508-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:20:03.174148-08:00","closed_at":"2026-02-12T13:20:03.174148-08:00","close_reason":"Updated all agent definitions (builder, merger, lead, reviewer) and overlay.ts to use bun run lint and bun run typecheck instead of direct biome/tsc calls"}
{"id":"overstory-fjme","title":"Update CLAUDE.md to document all 24 commands","description":"CLAUDE.md CLI reference only documents ~15 commands but 24 exist. Missing: dashboard, inspect, coordinator, supervisor, hooks, spec, group, trace, errors, replay, run, costs, clean, doctor, nudge. Also missing sessions/, events/, doctor/ from directory structure section.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:21.926337-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T17:12:59.643569-08:00","closed_at":"2026-02-15T17:12:59.643569-08:00","close_reason":"Updated CLAUDE.md: documented all 24 commands (was ~15), added sessions/events/doctor subsystems to directory tree, added 4 SQLite databases to target project structure, added 8 agent definitions (was 6)"}
{"id":"overstory-fles","title":"Add discoverOrchestratorTranscript to transcript.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:52:41.401532-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:55:57.888032-08:00","closed_at":"2026-02-19T12:55:57.888032-08:00","close_reason":"Added discoverOrchestratorTranscript to src/metrics/transcript.ts. Scans ~/.claude/projects/{project-key}/ for most recent JSONL. 5 tests added, all passing. Quality gates clean."}
{"id":"overstory-fnar","title":"Add mulch diff PostToolUse hook to agent template","description":"Add a PostToolUse Bash hook to templates/hooks.json.tmpl that detects git commit and runs mulch diff HEAD~1","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T13:17:21.60208-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:24:05.871593-08:00","closed_at":"2026-02-20T13:24:05.871593-08:00","close_reason":"Added PostToolUse Bash hook to templates/hooks.json.tmpl: uses ENV_GUARD, reads stdin, greps for git commit, runs mulch diff HEAD~1 silently. Always exits 0."}
{"id":"overstory-fp1z","title":"Hooks must live in .overstory/, not project root .claude/","description":"## Problem\n\nCoordinator and hooks-deployer write Claude Code hooks to `.claude/settings.local.json` at the **project root**. This has two critical consequences:\n\n1. **Breaks project-agnosticism**: Overstory is supposed to work in ANY repo. Writing to `.claude/` at root makes it only work inside its own repo — the target project's `.claude/` gets polluted with overstory-specific hook config.\n\n2. **ENV_GUARD was a band-aid, not a fix**: The ig8t fix added `[ -z \"$OVERSTORY_AGENT_NAME\" ]` guards so hooks don't fire for non-overstory sessions, but the hooks are still physically present in the project's `.claude/settings.local.json`, which is wrong.\n\n## Root Cause\n\n- `src/agents/hooks-deployer.ts` writes hooks to `\u003cprojectRoot\u003e/.claude/settings.local.json`\n- The coordinator has no worktree (it runs at project root), so it deploys hooks directly to root `.claude/`\n- Slinged agents correctly get hooks in their worktree, but the coordinator does not\n\n## Required Fix\n\nAll overstory hooks config must live inside `.overstory/`, NOT in `.claude/`. Possible approaches:\n- (a) Coordinator gets its own worktree (isolates its `.claude/` entirely)\n- (b) Hooks go in `.overstory/hooks.json` and a thin shim in `.claude/` just delegates\n- (c) Claude Code supports reading hooks from a custom path (unlikely upstream change)\n- (d) Coordinator skips hook deployment entirely; only slinged agents (which have worktrees) get hooks\n\nThe chosen solution MUST ensure that running `overstory init` + `overstory coordinator start` in someone else's repo does NOT modify their `.claude/` directory.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T07:26:50.037672-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:26:17.868504-08:00","closed_at":"2026-02-13T09:26:17.868504-08:00","close_reason":"Removed deployHooks() from coordinator start. Added 'overstory hooks install/uninstall/status' command for explicit orchestrator hook management. Hooks source of truth is .overstory/hooks.json. Cleaned up .claude/settings.local.json to contain only orchestrator hooks (no capability guards, no ENV_GUARD)."}
{"id":"overstory-fsgf","title":"Add run scoping to gatherStatus() and --all flag to status command","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T07:15:24.139573-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T07:19:13.372019-08:00","closed_at":"2026-02-18T07:19:13.372019-08:00","close_reason":"Added run scoping to gatherStatus() via optional runId param, --all flag to statusCommand(), currentRunId field to StatusData, run display in printStatus(), updated help text. 13 tests passing."}
{"id":"overstory-fsh","title":"L5-10: Write overlay.test.ts","description":"Tests for src/agents/overlay.ts. Cover: template rendering with all variables (BEAD_ID, AGENT_NAME, SPEC_PATH, BRANCH_NAME, FILE_SCOPE, etc.), writeOverlay creates .claude/CLAUDE.md in worktree, missing template handling.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:35.132065-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:54:20.530193-08:00","closed_at":"2026-02-12T07:54:20.530193-08:00","close_reason":"Closed","dependencies":[{"issue_id":"overstory-fsh","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:48.209271-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-ftq2","title":"Fix dashboard/status run-scoping to include null-runId sessions (coordinator)","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-20T07:26:23.760979-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T07:33:09.154071-08:00","closed_at":"2026-02-20T07:33:09.154071-08:00","close_reason":"Fixed: coordinator (null runId) now visible in run-scoped status and dashboard. status.ts includes null-runId sessions via supplemental filter; dashboard.ts uses exported filterAgentsByRun() helper. Tests added."}
{"id":"overstory-fvur","title":"Wire logs command into index.ts and completions.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:04:47.63928-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:16:04.778042-08:00","closed_at":"2026-02-16T13:16:04.778042-08:00","close_reason":"index.ts and completions.ts wired for logs command","dependencies":[{"issue_id":"overstory-fvur","depends_on_id":"overstory-ddep","type":"blocks","created_at":"2026-02-16T13:04:54.233827-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-fxrx","title":"Wire feed command into index.ts and completions.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:46:21.042015-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:58:25.446963-08:00","closed_at":"2026-02-16T13:58:25.446963-08:00","close_reason":"Wired feed command into src/index.ts (import, COMMANDS, HELP, switch case) and src/commands/completions.ts (COMMANDS array with all flags, bash completion string)","dependencies":[{"issue_id":"overstory-fxrx","depends_on_id":"overstory-hc35","type":"blocks","created_at":"2026-02-16T13:47:08.738906-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-fynf","title":"Build: Add --monitor flag to coordinator start/stop/status","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:11:21.416119-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:18:46.889965-08:00","closed_at":"2026-02-16T13:18:46.889965-08:00","close_reason":"Added --monitor flag to coordinator start/stop/status following the --watchdog pattern. 78 tests passing."}
{"id":"overstory-fz0","title":"merge-queue.json: missing trailing newline in JSON write","description":"src/merge/queue.ts line 64 writes JSON with writeFileSync without appending a trailing newline. This causes biome check to fail on merge-queue.json. Convention per mx-24764f requires all JSON written via Bun.write to include trailing newline. Fix: change writeFileSync call to append \\n to the JSON.stringify output.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:09:29.940528-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:14:00.644204-08:00","closed_at":"2026-02-12T10:14:00.644204-08:00","close_reason":"Fixed: writeQueue now appends trailing newline to JSON.stringify output per convention mx-24764f"}
{"id":"overstory-g0al","title":"Implement provider and model validation in validateConfig()","description":"Update validateConfig() in config.ts and add tests in config.test.ts for provider validation and extended model refs","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T07:26:45.134202-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T07:31:33.016681-08:00","closed_at":"2026-02-20T07:31:33.016681-08:00","close_reason":"Added provider validation (type, gateway baseUrl+authTokenEnv) and replaced hardcoded model list with provider-prefixed ref support + stderr warning for tool-heavy roles. 9 new tests, all quality gates pass."}
{"id":"overstory-g2za","title":"Add debounced mail polling to PostToolUse hook for mid-task message delivery","description":"## Problem\n\nAgents only poll for mail via the UserPromptSubmit hook. Short-running agents (builders, cherry-pick specialists) often complete their entire task in a single work cycle — one prompt to Claude that triggers a chain of tool calls. They never submit a second prompt, so UserPromptSubmit never fires after boot. Any message sent by the orchestrator mid-task (corrections, additional instructions) is silently dropped.\n\n### Evidence from run-2026-02-14T05-51-12-265Z\n\nThree orchestrator→agent messages were sent but never read:\n- cherry-pick-lead: 'Cherry-pick commit 1a271f0' (dispatch, 06:33:32) — NEVER READ\n- cherry-pick-lead: 'ALSO cherry-pick c884e83 and 971b58b' (status, 06:34:33) — NEVER READ  \n- resolver-pick-lead: 'Cherry-pick 2 commits' (dispatch, 06:37:32) — NEVER READ\n\nThe cherry-pick-lead completed its original task and exited in ~110s. The orchestrator sent the 'ALSO cherry-pick' message 66 seconds in, but the agent never polled again. Result: conflict-recorder branch changes were never merged to main.\n\nThe pending-nudge marker system doesn't help either — it writes a file, but that file is only read on the next mail check --inject, which only runs on UserPromptSubmit.\n\n## Design\n\nAdd debounced mail polling to the PostToolUse hook. PostToolUse fires after every tool call, so even single-cycle agents will check mail between tool executions.\n\n### Changes required:\n\n**1. Add --debounce flag to 'overstory mail check' (src/commands/mail.ts)**\n- New flag: --debounce \u003cms\u003e (default: 0 = no debounce)\n- Track last-check timestamp per agent in .overstory/agents/{name}/last-mail-check\n- If --debounce is set and less than \u003cms\u003e has elapsed since last check, exit immediately with no output (no DB query, no file I/O beyond a single stat())\n- If debounce has expired (or no timestamp file exists), proceed with normal mail check and update timestamp\n\n**2. Add mail check to PostToolUse hook template (templates/hooks.json.tmpl)**\n- Add a second hook entry to the PostToolUse array (after the existing tool-end logger):\n  overstory mail check --inject --agent {{AGENT_NAME}} --debounce 30000\n- This means agents check for mail at most every 30 seconds between tool calls\n- The --inject flag outputs to stdout which Claude Code hooks surface to the agent's context\n\n**3. Update hooks-deployer.ts (src/agents/hooks-deployer.ts)**\n- No code changes needed if the template change above is sufficient\n- The deployer already reads and deploys the template as-is\n\n**4. Rebuild and test**\n- Add tests to mail.test.ts for debounce behavior: skip when within window, check when expired, check when no timestamp file\n- Update hooks-deployer.test.ts if needed for the new PostToolUse entry\n- Verify the timestamp file path is gitignored\n\n### Why PostToolUse + debounce (not other approaches):\n- PreToolUse would add latency before every tool execution\n- A background daemon adds complexity and a new process to manage\n- tmux sendkeys was already tried and abandoned (corrupts tool I/O — see pending-nudge marker system)\n- PostToolUse + 30s debounce adds ~1ms overhead (a stat() call) per tool and full mail check at most every 30s\n- Uses existing hook and mail infrastructure, no new subsystems","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:45:04.621179-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T13:01:42.340825-08:00","closed_at":"2026-02-15T13:01:42.340825-08:00","close_reason":"Implemented debounced mail polling in PostToolUse hook. Two builder branches ready for merge: hooks-template-builder (correct template + deployer tests) and debounce-fix-builder (mail.ts debounce logic + tests). All quality gates passed."}
{"id":"overstory-g3ym","title":"Cost-per-bead breakdown in overstory costs","description":"## Problem\n\nThere's no way to answer 'how much did task X cost?' across all agents that worked on it. Since multiple agents can work on the same bead (scout, builder, reviewer), and the metrics.db sessions table is keyed by `(agent_name, bead_id)`, the data is there but no query surface exists.\n\n## Desired Behavior\n\n```bash\noverstory costs --bead overstory-ye8f\n```\n\nShould show all agent sessions that worked on that bead with their individual costs, plus a total. This would let users understand which tasks are expensive and optimize their decomposition strategy.\n\n## Implementation\n\n- `src/metrics/store.ts` — Add `getSessionsByBead(beadId)` method (simple WHERE bead_id = ? query)\n- `src/commands/costs.ts` — Add --bead flag, call new method, render with existing table formatting\n- Help text update\n\nLow effort since the data already exists in the right shape — just needs a query path and CLI flag.","status":"open","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:08:34.363539-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:08:34.363539-08:00"}
{"id":"overstory-g8iw","title":"Investigate smolvm-sdk for agent auto-containerization","description":"Stretch goal: Research using the smolvm-node SDK (https://github.com/smol-machines/smolvm-sdk/tree/main/smolvm-node) to automatically containerize agents in lightweight VMs instead of running them in git worktrees on the host. Benefits: (1) true isolation between agents, (2) agents can't accidentally modify host state, (3) resource limits per agent, (4) clean teardown. Investigate: SDK maturity, macOS support, startup latency, filesystem sharing for git repos, network access for API calls, compatibility with tmux-based session management. This would be a significant architecture change - evaluate feasibility before committing.","status":"closed","priority":4,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T11:50:14.467625-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:16:14.595352-08:00","closed_at":"2026-02-13T22:16:14.595352-08:00","close_reason":"Research complete: smolvm is 2 weeks old, alpha, no npm package, critical filesystem bugs, no TTY support. Not viable. Instead, integrating Claude Code's built-in Seatbelt sandbox (sandbox-runtime) as opt-out default in overstory config."}
{"id":"overstory-ga4z","title":"Fix watchdog nudge to be phase-aware in checkRunCompletion","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:22:28.100624-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:26:40.739763-08:00","closed_at":"2026-02-19T12:26:40.739763-08:00","close_reason":"Added exported buildCompletionMessage() helper with phase-aware completion messages based on worker capabilities. Updated checkRunCompletion to use it. Added capabilities/phase to run_complete event data. 50 tests pass."}
{"id":"overstory-gago","title":"Write mulch client tests","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:04:05.352147-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:32:05.326634-08:00","closed_at":"2026-02-13T09:32:05.326634-08:00","close_reason":"Test files already written and committed"}
{"id":"overstory-gaio","title":"Coordinator needs prompting to delegate scouting tasks","description":"During e2e testing, the coordinator agent does not proactively delegate scouting work to scout agents without being reminded. Investigate using Claude Code's --system-prompt-file flag to inject stronger orchestration instructions into the coordinator's system prompt at spawn time. The coordinator overlay CLAUDE.md may not be sufficient to drive delegation behavior - a system prompt override could ensure the coordinator always checks for available scouts and delegates exploration tasks before attempting them itself.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T11:49:56.661642-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T12:35:10.616846-08:00","closed_at":"2026-02-13T12:35:10.616846-08:00","close_reason":"Coordinator now gets agents/coordinator.md injected via --append-system-prompt at spawn time. Beacon also strengthened with explicit DELEGATION instruction to spawn leads for exploration."}
{"id":"overstory-ggbi","title":"Implement overstory costs command","description":"Create src/commands/costs.ts — token usage and cost analysis.\n\n## Usage\n```\noverstory costs [--agent \u003cname\u003e] [--run \u003cid\u003e] [--by-capability] [--json]\n```\n\n## Behavior\nQuery metrics.db for token data and display cost breakdowns by agent, capability, and model.\n\n## Output Format (human)\n```\nCost Summary\n\nTotal:  $4.23 (5 agents, 12m 34s)\n\nBy agent:\n  builder-auth-1    $1.23  (15K in, 3K out, 100K cache-read)\n  builder-db-2      $1.56  (18K in, 4K out, 120K cache-read)\n  lead-tests-1      $0.89  (10K in, 2K out, 80K cache-read)\n\nBy capability:\n  builder    $2.79  (avg $1.40/agent)\n  lead       $0.89\n  reviewer   $0.34\n\nModel breakdown:\n  claude-opus-4-6          3 agents  $3.68\n  claude-sonnet-4-5  2 agents  $0.55\n```\n\n## Flags\n- --agent: filter to specific agent\n- --run: filter to specific run (requires SessionStore to map run→agents)\n- --by-capability: group by capability type\n- --json: structured output with all breakdowns\n\n## Implementation\n- Query existing MetricsStore for token data\n- Use SessionStore for run→agent mapping when --run is passed\n- Token formatting: \u003e1M shown as '1.2M', otherwise comma-separated (follow existing pattern in metrics/summary.ts)\n- Cost estimation uses existing pricing in metrics/transcript.ts\n- This is an enhanced version of the existing 'overstory metrics' — more filters, more groupings\n\n## Tests (src/commands/costs.test.ts)\n- Total cost calculation\n- Per-agent breakdown\n- Per-capability grouping\n- Model breakdown\n- --run filter via session mapping\n- --json output\n- No data shows clean message","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:09:49.131544-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:58:16.30155-08:00","closed_at":"2026-02-13T20:58:16.30155-08:00","close_reason":"Implemented in commit 35531bc (duplicate of overstory-n4r8/gz4u/72ak)","dependencies":[{"issue_id":"overstory-ggbi","depends_on_id":"overstory-b3sa","type":"blocks","created_at":"2026-02-13T13:10:38.433666-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-gh1d","title":"Doctor: merge queue validation","description":"Validate merge-queue.json for correctness and staleness.\n\nChecks:\n- JSON parses without error (or file doesn't exist yet, which is fine)\n- Each entry has required fields: branchName, beadId, agentName, filesModified, enqueuedAt, status, resolvedTier\n- Status values in {pending, merging, merged, conflict, failed}\n- Tier values in {clean-merge, auto-resolve, ai-resolve, reimagine} or null\n- enqueuedAt is valid ISO timestamp, not in future\n- No duplicate branch names in queue\n- For each entry: branch exists in git ('git branch --list \u003cname\u003e')\n- For 'merging' entries: check if actually stalled (no recent activity, no active merge process)\n- For 'merged' entries: verify branch is actually merged into canonical branch\n- For 'conflict' entries: verify files still have conflict markers\n- Detect branches that were manually merged outside the queue\n\nSource references:\n- src/merge/queue.ts — queue shape, status/tier enums, FIFO semantics\n- src/merge/resolver.ts — tier ordering, conflict detection patterns\n\nOutput: pass/warn/fail. Malformed JSON = fail. Stale entries = warn. Stuck 'merging' = warn with remediation.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:59:48.954477-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:48:10.818428-08:00","closed_at":"2026-02-15T12:48:10.818428-08:00","close_reason":"Implemented database health and merge queue validation checks with comprehensive test coverage","dependencies":[{"issue_id":"overstory-gh1d","depends_on_id":"overstory-m55s","type":"blocks","created_at":"2026-02-13T22:00:19.08439-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-giqq","title":"Fix doctor.test.ts: 9 tests fail even in isolation","description":"doctorCommand tests fail in isolation (not just in full suite). Tests expect empty check arrays when empty stubs are passed, but real checks execute. 9 of 19 tests fail. Root cause: check runner stubs are not being respected — doctor command runs real dependency/config checks instead of using injected stubs. Fix: ensure doctorCommand properly uses injected checkRunners and skips real checks when stubs are provided.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T14:06:14.848651-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T14:15:31.073801-08:00","closed_at":"2026-02-15T14:15:31.073801-08:00","close_reason":"DI fix merged. All 19 doctor tests pass."}
{"id":"overstory-givh","title":"Mandatory review loop: builder → reviewer → merge-ready","description":"Update lead.md workflow to spawn a reviewer agent after each builder completes, creating a quality feedback loop. Builder completes → lead spawns reviewer on same branch → PASS triggers merge_ready → FAIL sends feedback for revision cycle. This is the biggest missing feedback loop in the swarm.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-16T08:05:52.42613-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:12:59.717182-08:00","closed_at":"2026-02-16T13:12:59.717182-08:00","close_reason":"Mandatory review loop implemented in agents/lead.md. Phase 3 now requires reviewer spawning after each builder completes, with PASS/FAIL feedback loop (3 revision cap), REVIEW_SKIP failure mode, and review-verified completion constraints."}
{"id":"overstory-goqp","title":"Add --self flag to overstory costs command","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:52:42.437092-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T13:05:04.234319-08:00","closed_at":"2026-02-19T13:05:04.234319-08:00","close_reason":"Added --self flag to overstory costs: discovers and parses orchestrator transcript JSONL, displays token usage and cost estimate. Text and JSON output modes. Graceful error when no transcript found. 5 new tests, all quality gates pass.","dependencies":[{"issue_id":"overstory-goqp","depends_on_id":"overstory-fles","type":"blocks","created_at":"2026-02-19T12:52:46.945174-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-gp2b","title":"Fix overstory merge to support --into flag instead of always targeting main","description":"overstory merge unconditionally checks out config.project.canonicalBranch (default: main) and merges there, ignoring the user's active branch. No --into flag exists. This silently contaminated main with 36 unrelated commits in a real session. Fix: add --into \u003cbranch\u003e flag to merge command, pass it through to resolver.resolve() which already accepts target as a parameter. Files: src/commands/merge.ts (parse flag, update help), src/merge/resolver.ts (already parameterized). Update tests in merge.test.ts and resolver.test.ts. See GitHub issue #4.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-17T06:11:28.862317-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T06:16:57.29262-08:00","closed_at":"2026-02-17T06:16:57.29262-08:00","close_reason":"Added --into flag to overstory merge command. Flag overrides config.project.canonicalBranch as merge target. Resolver was already parameterized. Added 3 tests for --into with --branch, --into with --all, and default fallback."}
{"id":"overstory-gqlo","title":"Integrate health state machine with dashboard TUI","description":"Connect watchdog health states (booting→working→stalled→zombie) to the dashboard TUI. Currently dashboard shows status but not the health state machine transitions in real-time.","status":"open","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:40.944148-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T17:04:40.944148-08:00"}
{"id":"overstory-gr3","title":"L1-4: Implement tmux session manager (src/worktree/tmux.ts)","description":"Tmux session management via Bun.spawn(['tmux', ...]). Session naming: overstory-{agentName}. Functions: createSession, listSessions, killSession, isSessionAlive, sendKeys.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:37.64304-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:25:37.447979-08:00","closed_at":"2026-02-12T07:25:37.447979-08:00","close_reason":"Implemented tmux session manager — createSession, listSessions, killSession, isSessionAlive, sendKeys via Bun.spawn","dependencies":[{"issue_id":"overstory-gr3","depends_on_id":"overstory-68p","type":"blocks","created_at":"2026-02-12T07:13:39.242223-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-gst","title":"L0-2: Define shared types in src/types.ts","description":"All shared interfaces: OverstoryConfig, AgentManifest, AgentDefinition, AgentSession, AgentIdentity, MailMessage, OverlayConfig, MergeEntry, MergeResult, HealthCheck, LogEvent, SessionMetrics. Strict TypeScript, no any.","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:09.615167-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:18:57.541223-08:00","closed_at":"2026-02-12T07:18:57.541223-08:00","close_reason":"Implemented types.ts (all shared types), errors.ts (error hierarchy), config.ts (config loader with defaults and validation)"}
{"id":"overstory-gtj","title":"L1-8: Implement mail SQLite store (src/mail/store.ts)","description":"SQLite mail storage via bun:sqlite. Schema: messages table with id, from_agent, to_agent, subject, body, type, priority, thread_id, read, created_at. WAL mode + busy_timeout=5000. Indexes on inbox (to_agent, read) and thread_id. CRUD operations.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:55.353422-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:26:01.474216-08:00","closed_at":"2026-02-12T07:26:01.474216-08:00","close_reason":"Implemented metrics storage (SQLite store + summary reporter) and mail SQLite store (schema, CRUD, WAL mode, prepared statements)","dependencies":[{"issue_id":"overstory-gtj","depends_on_id":"overstory-68p","type":"blocks","created_at":"2026-02-12T07:13:39.814739-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-gv2i","title":"Fix test isolation: tmux/nudge tests fail in full suite but pass individually","description":"24 tests across tmux.test.ts and nudge.test.ts pass when run individually (bun test src/worktree/tmux.test.ts) but fail in the full suite (bun test). This is a test isolation issue, likely mock.module() leakage across test files (see mulch record mx-56558b). Failing tests: createSession (8), listSessions (4), isProcessAlive (1), killProcessTree (1), killSession (4), isSessionAlive (2), nudgeAgent (4). Fix: investigate which test file runs before these and leaks mocks; refactor to avoid mock.module() or ensure proper cleanup.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T13:38:33.817339-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T14:39:31.951702-08:00","closed_at":"2026-02-15T14:39:31.951702-08:00","close_reason":"All 33 test failures resolved. 1603/1603 pass."}
{"id":"overstory-gvw","title":"L2-4: Implement mail client (src/mail/client.ts)","description":"Mail client over SQLite store. Interface: send(msg) -\u003e id, check(agentName) -\u003e MailMessage[], checkInject(agentName) -\u003e string (hook format), list(filters) -\u003e MailMessage[], markRead(id), reply(id, body) -\u003e id. Synchronous by design (bun:sqlite is sync, ~1-5ms).","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:54.498358-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:33:09.58236-08:00","closed_at":"2026-02-12T07:33:09.58236-08:00","close_reason":"All L2 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-gvw","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:41.075267-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-gz4u","title":"Implement overstory replay CLI command","description":"Interleaved chronological replay across multiple agents. Query events.db, show all agents' events in chronological order with agent labels. Support --run, --agent (repeatable), --since, --until, --limit, --json flags. Without --run, default to most recent run or last 24h. Follow trace.ts patterns.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T20:44:45.216383-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:58:11.202289-08:00","closed_at":"2026-02-13T20:58:11.202289-08:00","close_reason":"Implemented and tested in commit 35531bc"}
{"id":"overstory-h4kt","title":"Bug: overstory group create fails — bd show --json returns array, not object","description":"In src/commands/group.ts line 87, getIssueStatus() does JSON.parse(stdout) as { status?: string } but bd show --json returns an array [{ status: ... }]. Should be parsed as array and index [0]. This causes all validateIssueExists calls to fail with 'not found in beads'.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:38:08.150643-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:41:33.788323-08:00","closed_at":"2026-02-13T06:41:33.788323-08:00","close_reason":"Already fixed in current code — group.ts line 88 already parses bd show --json output as array and indexes [0]"}
{"id":"overstory-h8wt","title":"Write tests for worktree command (src/commands/worktree.test.ts)","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:04:37.931111-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:32:05.332019-08:00","closed_at":"2026-02-13T09:32:05.332019-08:00","close_reason":"Test files already written and committed"}
{"id":"overstory-h8yi","title":"Cherry-pick fixed logger.test.ts onto lead-tests-3 branch","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:36:08.279136-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:41:55.105934-08:00","closed_at":"2026-02-13T08:41:55.105934-08:00","close_reason":"Fixed logger.test.ts copied to builder-final-merge branch for merge"}
{"id":"overstory-hah","title":"merge command resolves merge-queue.json path inside worktree instead of project root","description":"'overstory merge --branch \u003cname\u003e' fails with 'Failed to write merge queue at ...worktree/.overstory/merge-queue.json'. The merge command is resolving the .overstory/ path relative to the worktree directory instead of the actual project root. Worktrees don't have their own .overstory/ directory. The merge queue file should be written to the main project's .overstory/merge-queue.json.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:18:07.628623-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:29:56.95078-08:00","closed_at":"2026-02-12T08:29:56.95078-08:00","close_reason":"Closed"}
{"id":"overstory-hc35","title":"Implement src/commands/feed.ts and tests","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:46:19.894934-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:53:40.45214-08:00","closed_at":"2026-02-16T13:53:40.45214-08:00","close_reason":"Feed command implementation and tests complete — 362 lines of command code, 578 lines of tests covering help, arg parsing, JSON output, agent filtering, run filtering, limit, since, event types, edge cases"}
{"id":"overstory-hc6w","title":"Graceful degradation for optional dependencies (beads, mulch)","description":"When bd CLI isn't installed or beads isn't initialized, sling should still work (skip bead validation/claiming). When mulch isn't installed, agents shouldn't fail on mulch prime. The hooks reference overstory by name - needs to be globally available or hooks need a fallback path. Currently the system hard-fails if any optional dependency is missing.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:57:51.8062-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:02:57.232271-08:00","closed_at":"2026-02-12T13:02:57.232271-08:00","close_reason":"Removed from plan - too large a scope change, getting ahead of ourselves. Focus on e2e validation first."}
{"id":"overstory-hcia","title":"Fix mulch learn in log.ts: add mail sending, PERSISTENT guard, HEAD~1","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T12:35:54.724872-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:41:55.372556-08:00","closed_at":"2026-02-15T12:41:55.372556-08:00","close_reason":"Fixed mulch learn extraction in log.ts: uses HEAD~1, PERSISTENT_CAPABILITIES guard, mail sending via createMailClient, proper imports. 2 tests. Committed 7130595."}
{"id":"overstory-hcud","title":"Write summary.test.ts for src/metrics/summary.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:20:20.673184-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:26:53.505681-08:00","closed_at":"2026-02-13T08:26:53.505681-08:00","close_reason":"Created summary.test.ts with 11 tests"}
{"id":"overstory-hfus","title":"Create smart tool argument filter","description":"Create src/events/tool-filter.ts — filters tool arguments for storage, keeping useful data while discarding noise.\n\n## Interface\n```typescript\ninterface FilteredToolArgs {\n  args: Record\u003cstring, unknown\u003e;  // JSON-serializable filtered args\n  summary: string;                // Human-readable one-line summary\n}\n\nfunction filterToolArgs(toolName: string, toolInput: Record\u003cstring, unknown\u003e): FilteredToolArgs;\n```\n\n## Per-Tool Filtering Rules (Smart Defaults)\n- **Bash**: Keep command, description. Drop timeout, run_in_background, dangerouslyDisableSandbox.\n  Summary: `bash: \u003cfirst 80 chars of command\u003e`\n- **Read**: Keep file_path, offset, limit. Drop content from response.\n  Summary: `read: \u003cfile_path\u003e (lines X-Y)` or `read: \u003cfile_path\u003e`\n- **Write**: Keep file_path. Drop content (too large).\n  Summary: `write: \u003cfile_path\u003e`\n- **Edit**: Keep file_path. Drop old_string, new_string (too large).\n  Summary: `edit: \u003cfile_path\u003e`\n- **Glob**: Keep pattern, path (small payload, keep all).\n  Summary: `glob: \u003cpattern\u003e in \u003cpath\u003e`\n- **Grep**: Keep pattern, path, glob, output_mode. Drop result content.\n  Summary: `grep: \"\u003cpattern\u003e\" in \u003cpath\u003e`\n- **WebFetch**: Keep url. Drop prompt, response.\n  Summary: `fetch: \u003curl\u003e`\n- **WebSearch**: Keep query. Drop response.\n  Summary: `search: \u003cquery\u003e`\n- **Task**: Keep description, subagent_type. Drop prompt (too large).\n  Summary: `task: \u003cdescription\u003e (\u003csubagent_type\u003e)`\n- **Unknown tools**: Keep tool_name only, empty args.\n  Summary: `\u003ctool_name\u003e`\n\n## Design Principle\nLog what you'd want to know during post-mortem. Skip content bodies that bloat the DB. A filtered event row should be ~200 bytes, not ~20KB.\n\n## Tests (src/events/tool-filter.test.ts)\n- Each tool type: correct fields kept/dropped\n- Summary string generation and truncation\n- Unknown tool fallback\n- Empty/null/missing input handling\n- Pure functions, no mocks needed","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:08:10.256971-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T14:24:00.316655-08:00","closed_at":"2026-02-13T14:24:00.316655-08:00","close_reason":"Created src/events/tool-filter.ts with per-tool filtering for 9 tool types. 36 tests pass."}
{"id":"overstory-hgc4","title":"Update lead.md: add SCOUT_SKIP failure mode, strengthen scout-first language, rebalance cost guidance","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:38:46.198028-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:51:34.611515-08:00","closed_at":"2026-02-17T07:51:34.611515-08:00","close_reason":"All subtasks complete. lead.md updated with scout-first enforcement. sling.ts has scout-before-builder warning."}
{"id":"overstory-hjmp","title":"Doctor: SQLite database health checks","description":"Verify integrity of all 4 SQLite databases: mail.db, sessions.db, metrics.db, events.db.\n\nFor each database:\n- File exists and is accessible (open without error)\n- WAL mode enabled: PRAGMA journal_mode returns 'wal'\n- Busy timeout configured: PRAGMA busy_timeout returns \u003e= 5000\n- Schema correct: expected tables and columns exist\n- PRAGMA integrity_check returns 'ok'\n- No stale WAL files (suggest checkpoint if WAL is large)\n\nDatabase-specific checks:\n- mail.db: messages table with CHECK constraints, valid message types (15 types from MAIL_MESSAGE_TYPES), payload JSON parseable, thread_id integrity\n- sessions.db: sessions table with valid states {booting, working, completed, stalled, zombie}, runs table exists, no duplicate agent_name entries\n- metrics.db: sessions table with token columns (migration applied), no negative durations, completedAt \u003e= startedAt\n- events.db: verify table structure, check for excessive size\n\nSource references:\n- src/mail/store.ts — schema, migration, CHECK constraints\n- src/sessions/store.ts — schema, state enum, runs table\n- src/metrics/store.ts — schema, token column migration\n- src/events/ — event store schema\n\nOutput: pass/warn/fail per database. Inaccessible or corrupt = critical. Missing columns/migration needed = warn with auto-fix suggestion.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:59:25.998295-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:48:10.817261-08:00","closed_at":"2026-02-15T12:48:10.817261-08:00","close_reason":"Implemented database health and merge queue validation checks with comprehensive test coverage","dependencies":[{"issue_id":"overstory-hjmp","depends_on_id":"overstory-m55s","type":"blocks","created_at":"2026-02-13T22:00:18.625786-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-hr2b","title":"Add INSIGHT recording guidance to supervisor.md and lead.md Expertise sections","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T17:34:28.770039-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T17:37:37.446604-08:00","closed_at":"2026-02-16T17:37:37.446604-08:00","close_reason":"Added INSIGHT recording bullet to supervisor.md and lead.md expertise sections. Parent agents now instructed to record INSIGHT: items from read-only worker result mails."}
{"id":"overstory-hrzi","title":"Fix biome formatting in mail.test.ts and merge-queue.test.ts","description":"Run 'bunx biome check --write src/commands/mail.test.ts src/doctor/merge-queue.test.ts' to auto-fix formatting (multi-line arrays to single-line) and import organization (sort bun:sqlite before bun:test). Then commit the changes.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-16T07:41:51.685295-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:43:27.651648-08:00","closed_at":"2026-02-16T07:43:27.651648-08:00","close_reason":"Fixed biome lint and formatting issues across all three files"}
{"id":"overstory-htnk","title":"Remove dead INSIGHT: mail protocol from agent definitions","description":"The INSIGHT: prefix protocol in agent definitions is dead — zero agents across 123 sessions have ever used it. Scouts have never been spawned. Reviewers who discover reusable patterns just mulch record directly. Remove INSIGHT: protocol from agents/scout.md, agents/reviewer.md, agents/lead.md, agents/supervisor.md. Simplify the definitions. If we want insight flow from read-only agents, it should be via mulch record (which reviewers already do) not a mail convention nobody follows.","status":"open","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T13:09:42.442162-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:09:42.442162-08:00"}
{"id":"overstory-hy7a","title":"Scope killAllTmuxSessions to current project via SessionStore","description":"killAllTmuxSessions() in clean.ts currently kills ALL tmux sessions with 'overstory-' prefix globally. Even after adding project name to session names, add a defense-in-depth check: only kill sessions that are registered in this project's SessionStore.\n\nCurrent code (clean.ts:128-129):\n  const sessions = await listSessions();\n  const overStorySessions = sessions.filter(s =\u003e s.name.startsWith('overstory-'));\n\nFix: filter by project-specific prefix AND cross-reference with SessionStore entries.\n\nThis is the immediate fix for overstory-d4bx (the dogfood crash root cause). The session naming change (sibling issue) is the structural fix.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T20:19:06.674008-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:23:10.830038-08:00","closed_at":"2026-02-13T20:23:10.830038-08:00","close_reason":"Implemented via loadRegisteredTmuxNames() — pcef is a separate future enhancement","dependencies":[{"issue_id":"overstory-hy7a","depends_on_id":"overstory-pcef","type":"blocks","created_at":"2026-02-13T20:19:17.97339-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-i1kt","title":"Add debounced mail check to PostToolUse hook template","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T12:17:35.259174-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T13:01:16.313779-08:00","closed_at":"2026-02-15T13:01:16.313779-08:00","close_reason":"Completed: PostToolUse hook with separate entry and --debounce 30000"}
{"id":"overstory-i1v4","title":"Auto-insight capture on task completion","description":"When agents complete tasks, auto-analyze what worked and record structured patterns to mulch. The 'log session-end' command already records to mulch; deepen this to capture patterns (what approach worked, what files were tricky, what tools were most useful) not just events.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:48.314452-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:01:19.968196-08:00","closed_at":"2026-02-16T18:01:19.968196-08:00","close_reason":"Auto-insight capture implemented. New src/insights/analyzer.ts module with analyzeSessionInsights(). 21 tests in analyzer.test.ts, 38 tests in log.test.ts. Captures tool usage patterns, file complexity, and approach strategies.","dependencies":[{"issue_id":"overstory-i1v4","depends_on_id":"overstory-f0kl","type":"blocks","created_at":"2026-02-15T17:05:31.471828-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-i375","title":"Write metrics store + summary tests","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:04:03.197784-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:08:39.403282-08:00","closed_at":"2026-02-13T08:08:39.403282-08:00","close_reason":"Created comprehensive test suites for metrics store and summary modules. 33 tests total covering all CRUD operations, aggregations, formatting, and edge cases. All quality gates passed."}
{"id":"overstory-i3wv","title":"Phase 4: Self-Improvement Flywheel (Mulch Learning)","description":"Build a learning system where agents do work, insights get auto-captured to mulch, and future agents are primed with relevant insights. The flywheel: work → insights → smarter agents → better work → more insights. Mulch changes should stay project-agnostic (mulch is a separate tool), adding general-purpose capabilities that happen to benefit Overstory.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:44.803783-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T17:48:37.057295-08:00","closed_at":"2026-02-16T17:48:37.057295-08:00","close_reason":"Phase 4 flywheel complete. Just shipped the mulch insight loop: builder/lead/merger record insights via mulch record, scout/reviewer flow INSIGHT: prefix through mail to parents, session-end handler auto-records via autoRecordExpertise(), and mulch prime injects all insights at session start. The cycle: work -\u003e mulch record -\u003e mulch prime -\u003e smarter agents -\u003e better work.","dependencies":[{"issue_id":"overstory-i3wv","depends_on_id":"overstory-nzor","type":"blocks","created_at":"2026-02-15T17:05:30.402009-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-i4xb","title":"Write monitor.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:05:26.751556-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:32:05.329985-08:00","closed_at":"2026-02-13T09:32:05.329985-08:00","close_reason":"Test files already written and committed"}
{"id":"overstory-i8v9","title":"Implement shell completion generation for overstory CLI","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T07:07:23.638917-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:17:02.663453-08:00","closed_at":"2026-02-16T07:17:02.663453-08:00","close_reason":"Shell completion generation implemented: completions.ts with COMMANDS array (26 commands), generateBash/generateZsh/generateFish generators, completionsCommand entry point. Full test coverage (26 tests). Integrated into index.ts via --completions flag."}
{"id":"overstory-i9be","title":"Add sandbox config section to types.ts and config.ts","description":"Add SandboxConfig interface to types.ts: { enabled: boolean (default true), allowedDomains: string[] (default ['api.anthropic.com', 'github.com']), denyReadPaths: string[] (default ['~/.ssh', '~/.aws']) }. Add sandbox field to OverstoryConfig. Add defaults in DEFAULT_CONFIG in config.ts. Add validation in validateConfig(). This is the foundation — other tasks depend on this.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:22:27.651045-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:32:07.47584-08:00","closed_at":"2026-02-15T12:32:07.47584-08:00","close_reason":"Sandbox integration complete - all code + tests implemented and passing","dependencies":[{"issue_id":"overstory-i9be","depends_on_id":"overstory-lu8k","type":"blocks","created_at":"2026-02-13T22:22:40.89133-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-iaae","title":"Auto-nudge coordinator when lead transitions to completed state","description":"When a lead agent's session ends and transitionToCompleted() fires (log.ts:90-103), the coordinator should be automatically nudged so it can process merge_ready / worker_done messages without waiting for user input.\n\nCurrently leads send merge_ready mail (in AUTO_NUDGE_TYPES, mail.ts:19-27) which writes a pending-nudge marker to .overstory/pending-nudges/coordinator.json — but this marker only gets read when the coordinator's UserPromptSubmit hook fires, requiring the user to manually type something.\n\nProposed: In the session-end handler (log.ts case 'session-end'), after transitionToCompleted() succeeds, if the agent's capability is 'lead', write a pending-nudge marker for the coordinator (or call overstory nudge coordinator). This closes the loop so the coordinator wakes up when leads finish.\n\nKey references:\n- transitionToCompleted(): src/commands/log.ts:90-103\n- AUTO_NUDGE_TYPES: src/commands/mail.ts:19-27\n- PendingNudge markers: src/commands/mail.ts:110-144\n- AgentState type: src/types.ts:79\n- SessionStore.updateState(): src/sessions/store.ts:254\n- Lead def: .overstory/agent-defs/lead.md (merge_ready protocol)","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T20:02:39.711412-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:22:49.80413-08:00","closed_at":"2026-02-13T20:22:49.80413-08:00","close_reason":"Fixed in this session"}
{"id":"overstory-ib5q","title":"Improve sendKeys error to distinguish server-not-running from session-not-found","description":"In tmux.ts sendKeys(), parse stderr to distinguish tmux server not running from session not found and emit distinct error messages","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T16:46:45.380495-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T16:50:04.379124-08:00","closed_at":"2026-02-18T16:50:04.379124-08:00","close_reason":"sendKeys() now distinguishes no-server-running from session-not-found errors with targeted messages mentioning root/UID 0 causes and agent crash. 3 new tests added, all 43 pass."}
{"id":"overstory-ig4m","title":"Refactor dashboard to hold DB connections open across poll ticks","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T08:17:46.994483-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T08:24:08.943324-08:00","closed_at":"2026-02-20T08:24:08.943324-08:00","close_reason":"Dashboard DB connection pooling: openDashboardStores/closeDashboardStores, loadDashboardData takes pre-opened stores, getCachedWorktrees/getCachedTmuxSessions exported. All quality gates pass."}
{"id":"overstory-ig8t","title":"Coordinator hooks pollute project root settings.local.json","description":"overstory coordinator start deploys hooks to project root .claude/settings.local.json, which affects ALL Claude Code sessions in the project, not just the coordinator. Slinged agents get hooks in their worktree (isolated), but the coordinator has no worktree. Options: (a) coordinator gets its own worktree, (b) hooks scope by OVERSTORY_AGENT_NAME env var, (c) coordinator skips hook deployment.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T06:50:30.817645-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T07:10:36.975222-08:00","closed_at":"2026-02-13T07:10:36.975222-08:00","close_reason":"Fixed: ENV_GUARD prefix on all hook commands (ig8t), runtime eval patterns in DANGEROUS_BASH_PATTERNS (lhva)"}
{"id":"overstory-ii1o","title":"Auto-nudge sends tmux keys during tool execution causing tool interruption","description":"When auto-nudge fires (via mail send for urgent/high priority or protocol types like worker_done), it calls sendKeys() which blindly sends tmux keystrokes to the agent's pane. If Claude Code is currently executing a bash tool, the injected text corrupts the tool's I/O, causing Claude Code to SIGKILL the subprocess (exit code 137) and report 'Request interrupted by user for tool use'. There is no synchronization between the nudge system and Claude Code's tool execution lifecycle. Fix: either (1) check tool execution state before nudging, (2) queue nudges for delivery between tool executions, or (3) use a different injection mechanism that doesn't interfere with running tools.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T15:33:19.387487-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T19:07:43.361266-08:00","closed_at":"2026-02-13T19:07:43.361266-08:00","close_reason":"Replaced auto-nudge tmux sendKeys with pending-nudge marker files. Messages now surface via mail check --inject on next prompt cycle. Manual nudge preserved."}
{"id":"overstory-in3q","title":"End-to-end test on throwaway external project","description":"Create a temp git repo, run overstory init, sling an agent, verify the full init-\u003esling-\u003ework-\u003emerge lifecycle works in a project that is NOT the overstory repo itself. This proves the project-agnostic promise. Depends on init deploying agent defs being fixed first.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:57:50.261869-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:31:02.605315-08:00","closed_at":"2026-02-12T13:31:02.605315-08:00","close_reason":"E2E init-sling lifecycle test validates full init-\u003econfig-\u003emanifest-\u003eoverlay pipeline on a throwaway external project. 6 tests, zero mocks.","dependencies":[{"issue_id":"overstory-in3q","depends_on_id":"overstory-06l7","type":"blocks","created_at":"2026-02-12T12:58:34.149293-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-in3q","depends_on_id":"overstory-qqnv","type":"blocks","created_at":"2026-02-12T12:58:35.422875-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-inxu","title":"Merger agent trigger for non-trivial conflicts","description":"Use overstory merge --dry-run to detect conflicts before merging. If conflicts are detected (would need Tier 3+), spawn a merger agent with full LLM context instead of relying on the programmatic resolver's one-shot claude --print approach. The merger agent can reason about intent across both branches.","status":"open","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-16T08:06:00.918285-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T08:06:00.918285-08:00"}
{"id":"overstory-ip89","title":"Add provider types and config defaults","description":"Add ProviderConfig, ModelAlias, ModelRef to types.ts; add providers to OverstoryConfig; add providers default to config.ts; add tests","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:22:52.122011-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:33:11.780897-08:00","closed_at":"2026-02-19T12:33:11.780897-08:00","close_reason":"Added ModelAlias, ModelRef, ProviderConfig types to types.ts. Added providers field to OverstoryConfig and DEFAULT_CONFIG. Updated models field to use ModelRef. Added config.test.ts tests for providers. Tests pass (1896/1896), lint clean. Typecheck fails on 11 out-of-scope files (10 test fixtures missing providers field, manifest.ts:290 needs as-cast). Parent notified via mail for scope expansion."}
{"id":"overstory-iwlg","title":"Fix merge queue SQLite migration: update all consumers to use merge-queue.db","description":"The SQLite migration (commit 7c6b208) changed queue.ts to use SQLite but left all consumers referencing merge-queue.json as a JSON file path. Now createMergeQueue() tries to open the JSON file as SQLite, causing 'file is not a database' error. All merges are blocked. Consumers to update: src/commands/merge.ts, src/commands/dashboard.ts, src/commands/status.ts, src/commands/clean.ts, src/commands/init.ts, src/doctor/merge-queue.ts (and all their test files). Change path from merge-queue.json to merge-queue.db. Delete old merge-queue.json. Update doctor checks from JSON validation to SQLite validation.","status":"closed","priority":0,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-16T07:16:27.850704-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:33:58.46221-08:00","closed_at":"2026-02-16T07:33:58.46221-08:00","close_reason":"Merged: all branches clean-merged to main"}
{"id":"overstory-ixpu","title":"Orchestrator not nudged when lead sends merge_ready/worker_done — mail is pull-only","description":"## Problem\n\nWhen lead-steelman completed its task and sent merge_ready + worker_done mail to the orchestrator, nothing happened. The orchestrator was never triggered to:\n1. Read the merge_ready message\n2. Commit the work in the builder's worktree (builder couldn't commit, lead couldn't commit, so work sat uncommitted)\n3. Run overstory merge\n4. Tear down the lead and builder agents\n\nThe messages were only surfaced when the USER manually typed a prompt, which triggered the UserPromptSubmit hook (overstory mail check --inject). This means the entire orchestration pipeline stalls at the merge step until a human intervenes.\n\n## Root Cause\n\nMail delivery to the orchestrator is entirely pull-based:\n- UserPromptSubmit hook fires overstory mail check --inject\n- This only triggers when the USER submits a prompt\n- There is no push mechanism for agents to wake the orchestrator\n\nThe orchestrator (user's Claude Code session) sits idle between user messages. When an agent completes work and sends mail, that mail sits in the SQLite DB until the next UserPromptSubmit hook fires.\n\n## Evidence from latest run\n\nTimeline:\n- 21:00:27 — lead dispatches builder-steelman-2\n- 21:04:24 — lead sends merge_ready to orchestrator\n- 21:04:48 — lead sends worker_done to orchestrator\n- ??? — orchestrator does nothing until user types a message minutes later\n- lead-steelman tmux session still alive even after worker_done\n\n## Possible Solutions\n\n1. **Polling loop in orchestrator**: After dispatching work, the orchestrator should enter a polling loop (overstory mail check + overstory status) at regular intervals, not just on user prompt.\n\n2. **tmux nudge from agent to orchestrator**: When an agent sends a high-priority message (merge_ready, worker_done, error), also send a tmux send-keys nudge to the orchestrator session to trigger it to check mail.\n\n3. **Watchdog escalation**: The Tier 0 watchdog could detect completed agents and nudge the orchestrator.\n\n4. **PostToolUse hook on agent side**: After an agent sends worker_done mail, a hook could trigger a nudge to the orchestrator's tmux session.\n\nOption 2 (tmux nudge) is probably the most direct — it mirrors how the orchestrator nudges stalled agents but in reverse.\n\n## Impact\n\nWithout this fix, every agent run requires human babysitting at the merge step, which defeats the purpose of autonomous orchestration.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:06:09.534874-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T14:37:18.884457-08:00","closed_at":"2026-02-13T14:37:18.884457-08:00","close_reason":"Implemented in session: bash path guard, hook capture updates, CLAUDE.md overwrite guard, and orchestrator nudge fix"}
{"id":"overstory-iy8","title":"Improve process cleanup with descendant tree walking","description":"Current killSession() just runs tmux kill-session. New: walk process descendant tree via pane_pid, send SIGTERM to all descendants (deepest first), wait 2s grace period, send SIGKILL to survivors, then kill tmux session. Ensures all child processes (git, bun test, biome, etc.) are properly cleaned up. Follow gastown's KillSessionWithProcesses pattern which handles reparented processes (PPID=1) and process groups.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:13:09.593077-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:11:16.107872-08:00","closed_at":"2026-02-12T13:11:16.107872-08:00","close_reason":"Implemented descendant tree walking for process cleanup: getPanePid(), getDescendantPids(), isProcessAlive(), killProcessTree(), and updated killSession() to walk process trees before killing tmux. Tests pass."}
{"id":"overstory-iycz","title":"Implement overstory inspect command for real-time agent inspection","description":"New CLI command: overstory inspect \u003cagent-name\u003e [--follow]. Aggregates EventStore (recent tool calls with args/durations), SessionStore (state, lastActivity, beadId), MetricsStore (token usage if available), and tmux capture-pane (live terminal output) into a single per-agent detail view. Must: (1) show agent current state + time since last activity, (2) list recent tool calls with summaries from EventStore, (3) show current file being edited (extract from most recent Edit/Write/Read tool event), (4) show token usage from metrics.db or live transcript parsing, (5) optionally capture live tmux pane output. Register command in index.ts. Add --json flag for programmatic consumption. Acceptance: running overstory inspect \u003cname\u003e on an active agent shows its live activity.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T19:55:59.564543-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:02:09.382524-08:00","closed_at":"2026-02-16T07:02:09.382524-08:00","close_reason":"Inspect command implemented (commit db84991 v0.4.0)","dependencies":[{"issue_id":"overstory-iycz","depends_on_id":"overstory-6p2c","type":"blocks","created_at":"2026-02-13T19:56:05.300867-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-j1c","title":"L0-8: Write agents/reviewer.md base definition","description":"Reviewer agent: read-only validation agent. Can read files, run tests and lint. Cannot write files. Reviews code for correctness, style, security issues.","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:31.656197-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:20:05.123949-08:00","closed_at":"2026-02-12T07:20:05.123949-08:00","close_reason":"Created all 5 base agent definitions: scout (read-only explorer), builder (implementation), reviewer (validation), lead (delegation), merger (branch integration)"}
{"id":"overstory-j3x","title":"worktree clean --all fails on worktrees with untracked files","description":"'overstory worktree clean --all' fails to remove worktrees that have modified/untracked files because it doesn't pass --force to git worktree remove. The error is 'contains modified or untracked files, use --force to delete it'. Since --all is an explicit user request to force-remove everything, it should pass --force to git. Note that the settings.local.json and .claude/CLAUDE.md written by hooks-deployer are 'untracked' files in the worktree, so this will always fail for agent worktrees.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:14:02.576868-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:29:25.004703-08:00","closed_at":"2026-02-12T08:29:25.004703-08:00","close_reason":"Added force option to removeWorktree and passed it from clean --all to handle untracked files."}
{"id":"overstory-j46a","title":"overstory coordinator start: auto-attach to spawned tmux session","description":"When running 'overstory coordinator start' from an interactive terminal, auto-attach to the tmux session after spawning it. Currently the command spawns the coordinator in a detached tmux session and returns, requiring the user to manually 'tmux attach -t overstory-coordinator'. Add a --attach flag (default on when interactive TTY detected, off when piped/scripted) that attaches to the session after startup completes.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:31:17.964209-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:37:08.687526-08:00","closed_at":"2026-02-13T06:37:08.687526-08:00","close_reason":"Added --attach/--no-attach flags to overstory coordinator start. Auto-attaches to tmux when run from interactive TTY. resolveAttach() exported for testing with comprehensive test coverage."}
{"id":"overstory-j4j9","title":"Fix molecules.test.ts Bun.spawn mock leak","status":"closed","priority":0,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:38:41.867635-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:42:32.912503-08:00","closed_at":"2026-02-13T08:42:32.912503-08:00","close_reason":"Fixed Bun.spawn mock leak: added afterEach to restore original Bun.spawn"}
{"id":"overstory-j53z","title":"Expand MulchClient: new commands (diff, learn, prune, doctor, ready, compact) and new flags (prime --files/--exclude-domain, record --stdin/--evidence-bead)","description":"src/mulch/client.ts only wraps prime, status, record, query, search. Expand it in two ways:\n\n1. New command wrappers: diff, learn, prune, doctor, ready, compact. All should use --json for structured output parsing. Add corresponding result types to src/types.ts.\n\n2. New flags on existing methods:\n   - prime(): add files?: string[] (--files) and excludeDomains?: string[] (--exclude-domain) parameters\n   - record(): add stdin?: boolean (--stdin) and evidenceBead?: string (--evidence-bead) parameters\n\nThis is the foundation for O1, O2, O3, O5, and all beads-mulch cross-linking.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:08:34.78013-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:20:12.445309-08:00","closed_at":"2026-02-13T22:20:12.445309-08:00","close_reason":"MulchClient expanded: 6 new commands (diff, learn, prune, doctor, ready, compact) with typed JSON results, new flags on prime (--files, --exclude-domain) and record (--stdin, --evidence-bead). 39 tests pass."}
{"id":"overstory-je5w","title":"Dashboard spawns 2 subprocesses per tick unconditionally","description":"gatherStatus spawns git worktree list --porcelain and tmux list-sessions every tick (default 2s, min 500ms). Worktrees rarely change mid-tick. Fix: cache listWorktrees result with a short TTL (e.g. 10s) and only re-spawn when stale. Consider similar caching for tmux list-sessions.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-19T13:28:19.458584-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T08:03:33.964317-08:00","closed_at":"2026-02-20T08:03:33.964317-08:00","close_reason":"Added module-level TTL cache (10s) for listWorktrees and listSessions results. Exported invalidateStatusCache() for test cleanup."}
{"id":"overstory-jtxw","title":"overstory status shows active agent after tmux session killed","description":"When a tmux session is manually killed (e.g. tmux kill-session), overstory status still shows 1 active agent. The agent lifecycle state in sessions.json is not updated when the tmux session dies externally. Status should detect that the tmux session no longer exists and reflect that the agent is no longer active. Likely fix: overstory status (or the watchdog) should cross-reference tmux session existence before reporting an agent as active.","notes":"Repro: (1) overstory status shows '1 active' with coordinator [completed] and 2m56s duration. (2) tmux list-sessions returns empty (no sessions). (3) overstory coordinator stop errors with 'No active coordinator session found'. State in sessions.json is stale — the coordinator entry was never cleaned up when tmux died.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T19:28:13.603865-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:45:20.840639-08:00","closed_at":"2026-02-13T06:45:20.840639-08:00","close_reason":"Fixed zombie reconciliation: added stalled state to zombie detection check so externally-killed tmux sessions with any active-like state are caught (status.ts lines 105-113)"}
{"id":"overstory-jzw9","title":"Supervisor decision logic: coordinator chooses lead vs supervisor","description":"Add heuristics to coordinator.md (and potentially code) for when to spawn a supervisor vs a lead. Supervisors are persistent and handle multi-phase work (explore → design → build → review → merge). Leads are ephemeral for single-phase tasks. Decision factors: estimated scope, number of phases, expected duration, number of sub-tasks.","status":"open","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-16T08:06:04.801117-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T08:06:04.801117-08:00","dependencies":[{"issue_id":"overstory-jzw9","depends_on_id":"overstory-18zt","type":"blocks","created_at":"2026-02-16T08:06:15.046625-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-k1s3","title":"Fix costs --run: add run_id to metrics.db sessions table","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:21:58.828121-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:30:45.095861-08:00","closed_at":"2026-02-19T12:30:45.095861-08:00","close_reason":"Added run_id column to metrics.db, getSessionsByRun() query method, wired runId through log.ts session-end recording, replaced broken cross-reference in costs --run with direct metrics.db query. All quality gates pass."}
{"id":"overstory-k3t4","title":"Gate triage behind tier2Enabled config + implement retry action","description":"Two small fixes: (1) In daemon.ts, check config.watchdog.tier2Enabled before calling triageAgent(). When disabled, fall through to the progressive nudging logic instead. (2) Implement the retry triage verdict — currently retry is a no-op like extend. When triage returns retry, send a nudge to the agent with a recovery prompt derived from the triage analysis.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T06:51:26.939004-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T07:01:14.156992-08:00","closed_at":"2026-02-13T07:01:14.156992-08:00","close_reason":"Gated triage behind tier1Enabled config and implemented retry action sending nudge with recovery message"}
{"id":"overstory-k64n","title":"Add STEELMAN.md and README disclaimer about agent swarm risks","description":"Create STEELMAN.md collecting arguments AGAINST using agent swarms and large-scale agentic projects like Overstory. Add a disclaimer section near the top of README.md that warns users not to use this project without understanding the risks, and links to STEELMAN.md as well as https://github.com/jayminwest/agentic-engineering-book and https://jayminwest.com/agentic-engineering-book for prerequisite reading.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T12:53:41.848141-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T13:07:46.363711-08:00","closed_at":"2026-02-13T13:07:46.363711-08:00","close_reason":"STEELMAN.md and README disclaimer created by builder agents. Files in main repo working tree ready for commit."}
{"id":"overstory-kcf","title":"merge-queue.json formatting triggers biome errors","description":"merge-queue.json (a gitignored runtime state file in .overstory/) is written with expanded array formatting that biome rejects. While gitignored, running 'biome check .' picks it up. Either the file should be written with biome-compatible formatting, or biome should be configured to ignore .overstory/ runtime files.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:01:10.887235-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:15:44.577368-08:00","closed_at":"2026-02-12T12:15:44.577368-08:00","close_reason":"Added .overstory/ to biome ignore list"}
{"id":"overstory-keoe","title":"Hook template missing ENV_GUARD on logging/lifecycle hooks","description":"templates/hooks.json.tmpl has no ENV_GUARD on SessionStart, UserPromptSubmit, PreToolUse (logger), PostToolUse, Stop, or PreCompact hooks. Only the PreToolUse blocking guards (path boundary, capability, bash danger, native team tools) have the ENV_GUARD. This causes all Claude Code sessions at the project root to fire coordinator hooks — logging tool events as coordinator, marking coordinator 'completed' on every Stop, and running mail check/prime as coordinator. Code comment at coordinator.ts:117-119 incorrectly claims ENV_GUARD protects all hooks. Fix: add ENV_GUARD to all hooks in the template, or use a different mechanism to scope hooks to the coordinator's tmux session.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T20:13:51.858332-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:22:49.781626-08:00","closed_at":"2026-02-13T20:22:49.781626-08:00","close_reason":"Fixed in this session"}
{"id":"overstory-kix0","title":"Automated failure recording in watchdog via mulch","description":"When watchdog detects agent failures (Tier 0 process death, Tier 1 AI triage), auto-record failure patterns via mulch record to the agents domain. Include agent name, capability, failure reason, and triage suggestion. Tag with watchdog and auto-recorded. Use --evidence-bead to link the failure to the bead the agent was working on (task ID is already known at watchdog time). Uses expanded MulchClient.record().","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:08:37.729902-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:41:52.221604-08:00","closed_at":"2026-02-15T12:41:52.221604-08:00","close_reason":"Automated failure recording in watchdog via mulch: recordFailure() at Tier 0 process death, Tier 1 AI triage terminate, and level 3+ progressive escalation. Fire-and-forget with DI for testing. Committed 07b769c.","dependencies":[{"issue_id":"overstory-kix0","depends_on_id":"overstory-j53z","type":"blocks","created_at":"2026-02-13T21:08:50.13672-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-kk4","title":"Overlay CLAUDE.md says 'Read your task spec at the path above' but spec path says 'No spec file provided'","description":"When sling is run without --spec, the overlay CLAUDE.md says 'Spec: No spec file provided' then immediately says 'Read your task spec at the path above.' This is confusing — the instruction to read the spec should be conditional on whether a spec was actually provided. The template at templates/overlay.md.tmpl should conditionally include this instruction.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:41:35.13135-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:50:58.142438-08:00","closed_at":"2026-02-12T09:50:58.142438-08:00","close_reason":"Overlay template now uses {{SPEC_INSTRUCTION}} placeholder. When spec provided: shows 'Read your task spec at the path above'. When null: shows 'No task spec was provided. Check your mail or ask your parent agent for details.' Added 2 new tests."}
{"id":"overstory-km7i","title":"Write tests for overstory logs command","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:04:49.062908-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:16:04.932264-08:00","closed_at":"2026-02-16T13:16:04.932264-08:00","close_reason":"11 test cases written for logs command, all passing","dependencies":[{"issue_id":"overstory-km7i","depends_on_id":"overstory-ddep","type":"blocks","created_at":"2026-02-16T13:04:54.389142-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-km7i","depends_on_id":"overstory-fvur","type":"blocks","created_at":"2026-02-16T13:04:54.540425-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-korf","title":"Persist watchdog and mail events to EventStore","description":"Record watchdog actions and mail send/receive as events for full post-mortem audit trail.\n\n## Problem\nWatchdog nudges, escalations, and triage verdicts are currently fire-and-forget. Mail messages are in mail.db but not correlated with the event timeline. Post-mortem replay is missing these critical coordination signals.\n\n## Watchdog Events (src/watchdog/daemon.ts)\nOn each daemon tick, for each action taken, insert an event:\n\n- Level 0 (warn): event_type='escalation', level='warn', data={escalationLevel:0, action:'warn'}\n- Level 1 (nudge): event_type='nudge', level='warn', data={escalationLevel:1, delivered:bool}\n- Level 2 (triage): event_type='triage', level='warn', data={escalationLevel:2, verdict:'retry'|'terminate'|'extend'}\n- Level 3 (terminate): event_type='escalation', level='error', data={escalationLevel:3, action:'terminate'}\n\n## Nudge Events (src/commands/nudge.ts)\nRecord each nudge delivery:\n- event_type='nudge', level='info', data={from, message, delivered:bool}\n\n## Mail Events (src/commands/mail.ts)\nRecord mail send as events (denormalized — mail.db remains authoritative):\n- event_type='mail_sent', level='info', data={to, subject, type, priority, messageId}\n\nMail receive is already tracked via the existing mail check hook — could optionally record:\n- event_type='mail_received', level='debug', data={from, subject, messageId}\n\n## Implementation\n- Open EventStore at start of each relevant command\n- Insert events alongside existing behavior (additive, not replacing)\n- Use current run_id from .overstory/current-run.txt if available\n- Fire-and-forget pattern: swallow EventStore errors to avoid breaking core flows\n\n## Tests\n- daemon.test.ts: verify events inserted for each escalation level\n- nudge.test.ts: verify nudge event recorded\n- mail.test.ts: verify mail_sent event recorded","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:10:21.606139-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:58:11.205447-08:00","closed_at":"2026-02-13T20:58:11.205447-08:00","close_reason":"Implemented and tested in commit 35531bc","dependencies":[{"issue_id":"overstory-korf","depends_on_id":"overstory-c6ca","type":"blocks","created_at":"2026-02-13T13:10:39.288525-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-korf","depends_on_id":"overstory-vajl","type":"blocks","created_at":"2026-02-13T13:10:39.433609-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-kqs","title":"L0-3: Define custom error types in src/errors.ts","description":"Custom error classes for overstory: ConfigError, ManifestError, WorktreeError, TmuxError, MailError, MergeError, WatchdogError. Each with meaningful context fields.","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:13.418195-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:18:57.543446-08:00","closed_at":"2026-02-12T07:18:57.543446-08:00","close_reason":"Implemented types.ts (all shared types), errors.ts (error hierarchy), config.ts (config loader with defaults and validation)"}
{"id":"overstory-ku8e","title":"Implement real-time token tracking infrastructure and live costs display","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:22:38.976765-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:34:55.155089-08:00","closed_at":"2026-02-16T13:34:55.155089-08:00","close_reason":"Implemented real-time token tracking: TokenSnapshot type, token_snapshots table (recordSnapshot, getLatestSnapshots, getLatestSnapshotTime, purgeSnapshots), throttled snapshot recording in log.ts tool-end handler (30s interval), costs --live flag with burn rate display (human and JSON output). All quality gates passed."}
{"id":"overstory-l13t","title":"Auto-start monitor agent with coordinator","description":"When overstory coordinator start runs, automatically spawn the monitor agent as a companion. Currently monitor requires a separate manual overstory monitor start. The --watchdog flag exists for Tier 0 but the LLM-based Tier 2 monitor should be the default companion for autonomous health awareness.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-16T08:05:55.609022-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:18:48.13157-08:00","closed_at":"2026-02-16T13:18:48.13157-08:00","close_reason":"Added --monitor flag to coordinator start/stop/status. Monitor auto-starts alongside coordinator when flag is set. Stop/status also show monitor state. Tests added mirroring watchdog pattern."}
{"id":"overstory-l1ku","title":"Implement overstory errors command","description":"Create src/commands/errors.ts — aggregated error view across all agents.\n\n## Usage\n```\noverstory errors [--agent \u003cname\u003e] [--run \u003cid\u003e] [--last \u003cn\u003e] [--json]\n```\n\n## Behavior\nQuery EventStore for events where level='error' or event_type IN ('error','escalation'). Display sorted by time with agent attribution.\n\n## Output Format (human)\n```\nErrors (last 24h)\n\nbuilder-auth-1  10:23:09  Bash exit code 1: test \"handles expired tokens\" failed\nbuilder-db-2    10:25:44  TypeScript error: Property 'foo' does not exist on type 'Bar'\nlead-tests-1    10:30:12  ESCALATION: builder-db-2 stalled after 5 nudges\n\n4 errors across 3 agents\n```\n\n## Flags\n- --agent: filter to specific agent\n- --run: filter to specific run ID\n- --last \u003cn\u003e: show last N errors (default: all from last 24h)\n- --json: structured output\n\n## Implementation\n- Query EventStore.getErrors() with filters\n- Extract error message from data JSON payload or tool_args\n- Count unique agents for summary line\n- Color: agent name in bold, timestamp in gray, error message in red\n- Escalation events shown with ESCALATION prefix\n\n## Tests (src/commands/errors.test.ts)\n- Shows errors from multiple agents sorted by time\n- --agent filter works\n- --json output\n- No errors shows clean message\n- Escalation events included","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:09:17.260375-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:58:16.348754-08:00","closed_at":"2026-02-13T20:58:16.348754-08:00","close_reason":"Implemented in commit 35531bc (duplicate of overstory-n4r8/gz4u/72ak)","dependencies":[{"issue_id":"overstory-l1ku","depends_on_id":"overstory-c6ca","type":"blocks","created_at":"2026-02-13T13:10:38.021209-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-l1ku","depends_on_id":"overstory-6asp","type":"blocks","created_at":"2026-02-13T13:10:38.735126-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-l2e","title":"L1-6: Implement mulch CLI client (src/mulch/client.ts)","description":"Wrapper around mulch CLI. Functions: prime(domains, format), status(), record(domain, data), query(domain). Parse --json output where available.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:45.257594-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:25:39.302566-08:00","closed_at":"2026-02-12T07:25:39.302566-08:00","close_reason":"Implemented mulch CLI client — prime, status, record, query, search via Bun.spawn","dependencies":[{"issue_id":"overstory-l2e","depends_on_id":"overstory-68p","type":"blocks","created_at":"2026-02-12T07:13:39.523265-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-l7y","title":"worktree clean does not delete agent branches","description":"When worktrees are cleaned (or manually removed), the associated git branches (e.g. overstory/test-builder-1/overstory-n4o) remain. Over time this leads to branch proliferation. 'overstory worktree clean' should also delete the associated branches after successful worktree removal, or there should be a separate 'overstory branch clean' command.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:19:59.712175-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:44:43.08805-08:00","closed_at":"2026-02-12T08:44:43.08805-08:00","close_reason":"worktree clean now force-deletes associated git branches via git branch -D through new forceBranch option on removeWorktree"}
{"id":"overstory-l87h","title":"Add shell completion generation","description":"Add --completions bash/zsh/fish flag to generate shell completions for all 24 commands and their flags. Essential for DX with this many commands.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:29.267249-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:33:58.474843-08:00","closed_at":"2026-02-16T07:33:58.474843-08:00","close_reason":"Merged: all branches clean-merged to main"}
{"id":"overstory-l9uy","title":"Merge sv-def branch into main","description":"Merge branch overstory/sv-def/overstory-bsr8 into main. The branch adds agents/supervisor.md (new file) and appends 2 records to .mulch/expertise/agents.jsonl. The JSONL conflict is trivial — keep all appended lines from both branches.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:48:20.354334-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T14:55:12.188578-08:00","closed_at":"2026-02-12T14:55:12.188578-08:00","close_reason":"Phase 2 supervisor agent implemented and merged"}
{"id":"overstory-lezb","title":"Implement overstory trace command","description":"Create src/commands/trace.ts — timeline of events for a specific agent or bead.\n\n## Usage\n```\noverstory trace \u003cagent|bead\u003e [--limit \u003cn\u003e] [--tools-only] [--json]\n```\n\n## Behavior\n1. If argument matches an agent name (found in SessionStore), query events by agent_name\n2. If argument matches a bead ID, look up agent(s) assigned to that bead via SessionStore, query events for all of them\n3. Display chronological timeline with color-coded event types\n\n## Output Format (human)\n```\nTimeline for builder-auth-1 (bead: overstory-abc1)\n\n10:23:01.234  SPAWN      spawned by lead-tests-1 (depth 2)\n10:23:04.567  TOOL       bash: bun test src/auth.test.ts         [2.3s]\n10:23:06.890  TOOL       read: src/auth/login.ts                 [0.1s]\n10:23:07.012  TOOL       edit: src/auth/login.ts                 [0.2s]\n10:23:09.056  ERROR      Bash exit code 1: test failed\n10:23:11.000  MAIL_SENT  to:lead-tests-1 \"Worker done\"\n10:23:11.200  SESSION_END tokens: 15K in / 3K out  cost: $0.42  duration: 7m 58s\n```\n\n## Implementation\n- Query EventStore.getTimeline() with agent/limit filters\n- Use tool_args summary field for the one-line tool description\n- Show tool_duration_ms in brackets when available\n- --tools-only filters to event_type='tool_start' with correlated durations\n- --json outputs array of StoredEvent objects\n- Color scheme: SPAWN=cyan, TOOL=blue, ERROR=red, MAIL=yellow, SESSION=gray\n- Follow reporter.ts patterns for ANSI output\n\n## Tests (src/commands/trace.test.ts)\n- Timeline for agent with tool durations\n- Bead ID resolution to agent name\n- --tools-only filtering\n- --json structured output\n- Agent not found error","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:09:05.376186-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:41:19.16664-08:00","closed_at":"2026-02-13T20:41:19.16664-08:00","close_reason":"Trace command implemented as overstory-rj1k, registered in router as overstory-cahb, tests as overstory-67rb","dependencies":[{"issue_id":"overstory-lezb","depends_on_id":"overstory-c6ca","type":"blocks","created_at":"2026-02-13T13:10:37.745324-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-lezb","depends_on_id":"overstory-b3sa","type":"blocks","created_at":"2026-02-13T13:10:37.881139-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-lezb","depends_on_id":"overstory-6asp","type":"blocks","created_at":"2026-02-13T13:10:38.586007-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-lgb7","title":"SessionStore migration check runs getAll() on every open","description":"sessions/compat.ts:89 runs store.getAll() unconditionally every time openSessionStore is called to check if migration is needed. After migration has happened once this is wasted. Fix: persist migration state (e.g. a sentinel file or a metadata table row) so subsequent opens skip the check.","status":"open","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-19T13:28:16.829584-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T13:28:16.829584-08:00"}
{"id":"overstory-lh0","title":"Agents stuck in 'booting' state after tmux session killed","description":"When a tmux session is killed externally (tmux kill-session), the agent state remains 'booting' and the agent still shows as 'active' in 'overstory status'. The ○ indicator suggests the system detects the tmux session is gone (vs ● for running), but: 1) The agent state never transitions from 'booting' to 'running' or to 'failed/dead'. 2) The summary still says '2 active'. 3) There's no mechanism to detect and clean up zombie agent entries. The watchdog should detect this, or status should reflect the actual tmux state.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:13:50.937781-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:32:26.646925-08:00","closed_at":"2026-02-12T08:32:26.646925-08:00","close_reason":"Status command now reconciles agent state with tmux session existence, marking agents as zombie when tmux is dead"}
{"id":"overstory-lhva","title":"bun -e bypasses bash file guards in structural enforcement","description":"bun -e can execute arbitrary code (unlinkSync, writeFileSync) that bypasses all bash pattern guards in the structural enforcement hooks. The dangerous patterns only match shell commands, not Bun/Node API calls via -e flag. Need to either block bun -e entirely for non-implementation agents or add patterns for common evasion vectors.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T06:50:34.277657-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T07:10:36.997999-08:00","closed_at":"2026-02-13T07:10:36.997999-08:00","close_reason":"Fixed: ENV_GUARD prefix on all hook commands (ig8t), runtime eval patterns in DANGEROUS_BASH_PATTERNS (lhva)"}
{"id":"overstory-lit3","title":"Review: lead.md review-mandatory language","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T08:08:10.633339-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T08:12:17.012807-08:00","closed_at":"2026-02-17T08:12:17.012807-08:00","close_reason":"Review complete: PASS"}
{"id":"overstory-lkp","title":"L2-7: Implement mail CLI command (src/commands/mail.ts)","description":"CLI command family: overstory mail send/check/list/read/reply. Parses CLI args, delegates to mail client. Supports --inject flag for hook context injection, --json for machine output, --from/--to/--unread filters.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:08.420424-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:33:09.648872-08:00","closed_at":"2026-02-12T07:33:09.648872-08:00","close_reason":"All L2 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-lkp","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:41.508064-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-ll5","title":"Role-specific hook variation per agent capability","description":"Replace single hooks.json.tmpl with per-capability hook generation. Scout/reviewer: add guards blocking Write/Edit tools. Builder: add guards blocking git push. Lead: less restricted, can spawn. Implement merge logic: base hooks + capability overlay (like gastown's three-tier system: base -\u003e role -\u003e rig+role). Currently all agents get identical hooks regardless of capability.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:13:04.344261-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:30:37.160139-08:00","closed_at":"2026-02-12T12:30:37.160139-08:00","close_reason":"hooks-deployer now accepts capability parameter. Scout/reviewer agents get PreToolUse guards that block Write, Edit, NotebookEdit. Guards prepended before base logging hook. Builder/lead/merger get no extra guards (builder git-push guard tracked in overstory-1wj). Sling passes capability to deployHooks. 16 new tests."}
{"id":"overstory-llk","title":"Add nudge mechanism for mid-conversation message delivery","description":"Implement 'overstory nudge \u003cagent-name\u003e \u003cmessage\u003e' CLI command. Uses existing sendKeys() in tmux.ts (already built, never called). When sending urgent/high priority mail, auto-nudge recipient with notification. Add debounce (500ms) and retry logic (3 attempts) per gastown's pattern. Serialize nudges per-session to prevent interleaving. Depends on interactive mode switch (agents must be running interactively for send-keys to work).","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:13:00.958833-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:27:59.075176-08:00","closed_at":"2026-02-12T12:27:59.075176-08:00","close_reason":"Added overstory nudge command (src/commands/nudge.ts) with retry (3 attempts), debounce (500ms), and session validation. Auto-nudge integrated into mail send for urgent/high priority messages. Tests added. Wired into CLI router.","dependencies":[{"issue_id":"overstory-llk","depends_on_id":"overstory-37e","type":"blocks","created_at":"2026-02-12T12:13:20.291926-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-llw","title":"All agent sessions have the same PID (55777)","description":"In sessions.json, every agent has pid: 55777 regardless of when they were spawned. The PID is supposed to be the Claude Code process ID inside the tmux session but it appears to be hardcoded or not captured correctly. This makes PID-based liveness detection unreliable in the watchdog.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:19:22.962149-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:29:26.787574-08:00","closed_at":"2026-02-12T08:29:26.787574-08:00","close_reason":"Changed PID retrieval from tmux list-sessions (server PID) to tmux list-panes with pane_pid (actual process PID)."}
{"id":"overstory-lmo","title":"init generates .overstory/ JSON files with space indentation instead of tabs (Biome failure)","description":"overstory init generates hooks.json and agent-manifest.json using space indentation, but the project uses tab indentation enforced by Biome. Running 'biome check .' fails on these generated files with formatting errors. The init command should use tab-indented JSON.stringify (using \\t) consistent with the rest of the codebase. Additionally, Biome wants short arrays on a single line, so the generation code should match Biome's formatting preferences.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:42:07.528349-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:51:01.126978-08:00","closed_at":"2026-02-12T09:51:01.126978-08:00","close_reason":"init buildHooksJson() no longer reads the agent template (which had space indentation + agent placeholders). Now generates hooks.json directly with tab indentation matching Biome config. Also fixed templates/hooks.json.tmpl to use tab indentation."}
{"id":"overstory-loa7","title":"Add Bash path-boundary guard for file-modifying commands in builder agents","description":"## Problem\n\nEven with Write/Edit path guards (sibling issue), builder agents can bypass worktree isolation via Bash tool. Commands like 'echo content \u003e /path/to/root/file.txt', 'cp file /root/path/', 'mv', 'sed -i' with absolute paths outside the worktree are not caught.\n\n## Current State\n\nhooks-deployer.ts has buildBashFileGuardScript() for non-implementation agents that blocks ALL file-modifying bash commands. But builders are intentionally exempt from this — they need sed, cp, etc. The problem is they can use these commands with paths outside their worktree.\n\n## Solution\n\nFor builder/merger agents, add a Bash PreToolUse hook that:\n\n1. Reads the command from stdin JSON\n2. For file-modifying patterns (sed -i, echo \u003e, cp, mv, tee, cat \u003e, etc.), extracts target file paths\n3. Validates that all target paths resolve within the worktree boundary\n4. Blocks if any target path is outside the worktree\n\nThis is harder than the Write/Edit guard because bash commands have varied syntax. A pragmatic approach:\n- Extract all absolute paths from the command (anything starting with /)\n- Check that none start with the canonical repo root UNLESS they start with the worktree path\n- For relative paths, they resolve from the tmux cwd (which is the worktree) so they're OK\n\n## Complexity Note\n\nThis is inherently harder to make airtight than the Write/Edit guard. An agent could theoretically construct paths via variable expansion, cd to a different directory, etc. The guard should catch the common case (direct absolute paths) and document known limitations.\n\n## Files to modify\n\n- src/agents/hooks-deployer.ts — new buildBashPathBoundaryScript()\n- src/agents/hooks-deployer.test.ts — test cases","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:03:14.28314-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T14:37:18.817527-08:00","closed_at":"2026-02-13T14:37:18.817527-08:00","close_reason":"Implemented in session: bash path guard, hook capture updates, CLAUDE.md overwrite guard, and orchestrator nudge fix","dependencies":[{"issue_id":"overstory-loa7","depends_on_id":"overstory-4200","type":"blocks","created_at":"2026-02-13T13:03:28.08919-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-lqis","title":"Fix hooks-deployer.test.ts PostToolUse count after mulch diff hook","description":"Update PostToolUse count assertion from 2 to 3 in hooks-deployer.test.ts line 146","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T13:23:04.69268-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:27:53.5216-08:00","closed_at":"2026-02-20T13:27:53.5216-08:00","close_reason":"Fixed PostToolUse count assertion (2-\u003e3) and added test for new mulch diff Bash hook. Cherry-picked template change from sibling builder to pass quality gates (137 tests pass)."}
{"id":"overstory-lu8k","title":"Integrate Claude Code native sandbox as opt-out default","description":"Add Claude Code's built-in Seatbelt sandbox to agent spawning. Sandbox should be ON by default (opt-out via config). Key changes: (1) Add sandbox section to OverstoryConfig in types.ts with enabled (default true), allowedDomains, denyReadPaths. (2) Add defaults and validation in config.ts. (3) In hooks-deployer.ts, write sandbox config block into settings.local.json deployed to each worktree: enabled=true, autoAllowBashIfSandboxed=true, allowUnsandboxedCommands=false, network.allowedDomains from config. (4) Keep --dangerously-skip-permissions in sling.ts (required for headless operation) — sandbox provides OS-level defense-in-depth. (5) Existing hook guards (path boundary, bash guards, tool blocks) remain as additional layer. Config shape in .overstory/config.yaml: sandbox.enabled (bool, default true), sandbox.allowedDomains (string[], default [api.anthropic.com, github.com]), sandbox.denyReadPaths (string[], default [~/.ssh, ~/.aws]). macOS uses Seatbelt (built-in, zero install). Research source: beads issue overstory-g8iw (closed — smolvm rejected, Claude Code sandbox chosen instead).","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:22:21.026065-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:34:17.332721-08:00","closed_at":"2026-02-15T12:34:17.332721-08:00","close_reason":"Sandbox integration complete. Added SandboxConfig to types.ts, defaults/validation in config.ts, sandbox block deployment in hooks-deployer.ts, all 4 callers updated. 8 new tests, all passing. Branch: overstory/sandbox-builder/overstory-lu8k (commit 631cea6)."}
{"id":"overstory-lua3","title":"Add broadcast and group messaging","description":"Support 'overstory mail send --to @all' and '--to @builders' (capability-based groups). Currently a lead monitoring 5 builders must send 5 separate messages. Implement as fan-out at the mail client level.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:34.832616-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:33:58.468947-08:00","closed_at":"2026-02-16T07:33:58.468947-08:00","close_reason":"Merged: all branches clean-merged to main"}
{"id":"overstory-lue","title":"Add structured startup beacon with identity context","description":"Instead of flat prompt string in sling.ts:311, build a structured beacon: [OVERSTORY] \u003cagent-name\u003e (\u003ccapability\u003e) timestamp task:\u003cbead-id\u003e followed by numbered steps: 1. Read assignment (.claude/CLAUDE.md), 2. Load expertise (mulch prime), 3. Check mail (overstory mail check), 4. Begin working on task. Include parent agent info and hierarchy depth. Make beacon format configurable per capability. This replaces the current simple prompt string and gives agents a clear startup protocol.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:13:14.482244-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:32:20.262633-08:00","closed_at":"2026-02-12T12:32:20.262633-08:00","close_reason":"Replaced simple beacon string in sling.ts with structured buildBeacon() function. Beacon now includes [OVERSTORY] header with agent identity/timestamp/task, depth/parent context, and 4-step startup protocol. Exported as pure function with full test coverage (10 tests).","dependencies":[{"issue_id":"overstory-lue","depends_on_id":"overstory-37e","type":"blocks","created_at":"2026-02-12T12:13:22.041531-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-lvsy","title":"Mock tmux in clean.test.ts to prevent live session kills","description":"clean.test.ts runs cleanCommand(['--all']) with no tmux mocks. During dogfooding (bun test inside a live swarm), this calls the real killAllTmuxSessions() which destroys all live agent tmux sessions.\n\nFix: spyOn the tmux functions (listSessions, killSession) in clean.test.ts, matching the pattern used in tmux.test.ts. This is the test-level fix — the session naming and SessionStore scoping changes fix the production code.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T20:19:12.070795-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:23:06.886803-08:00","closed_at":"2026-02-13T20:23:06.886803-08:00","close_reason":"No longer needed — production code now scopes tmux kills to project SessionStore"}
{"id":"overstory-lww","title":"L0-10: Write agents/merger.md base definition","description":"Merger agent: branch merge specialist. Handles conflict resolution using tiered approach (clean merge, auto-resolve, AI-resolve, reimagine). Works with overstory merge command.","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:39.761389-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:20:05.126655-08:00","closed_at":"2026-02-12T07:20:05.126655-08:00","close_reason":"Created all 5 base agent definitions: scout (read-only explorer), builder (implementation), reviewer (validation), lead (delegation), merger (branch integration)"}
{"id":"overstory-lx9","title":"Sling spawns agent but sends no initial task prompt to tmux session","description":"overstory sling creates a tmux session running Claude Code in the agent worktree, but the agent just sits at the REPL prompt with no initial task. The SessionStart hook runs 'overstory prime --agent \u003cname\u003e' which provides context, but there is no actual task prompt or instruction sent. The agent needs to receive an initial prompt (e.g., 'Read your assignment in .claude/CLAUDE.md and begin working on task \u003cid\u003e'). Without this, the spawned agent does nothing. Consider using tmux send-keys to inject an initial prompt after the Claude Code session starts.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:40:59.153636-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:47:49.537517-08:00","closed_at":"2026-02-12T09:47:49.537517-08:00","close_reason":"Added sendKeys() call after tmux session creation in sling.ts to inject initial task prompt to the agent."}
{"id":"overstory-lzm1","title":"Worktree missing node_modules for quality gate commands","description":"Agent worktrees created by sling do not have node_modules/ available. Direct commands like 'biome check .' and 'tsc --noEmit' fail with 'command not found'. The agent self-corrected by using 'bun run lint' and 'bun run typecheck' (which resolve via package.json scripts). Fix: either symlink node_modules from the main repo into the worktree during sling, or update agent definitions to use 'bun run' variants of quality gate commands.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:10:14.787355-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:20:04.773906-08:00","closed_at":"2026-02-12T13:20:04.773906-08:00","close_reason":"Updated all agent definitions (builder, merger, lead, reviewer) and overlay.ts to use bun run lint and bun run typecheck instead of direct biome/tsc calls"}
{"id":"overstory-m0f","title":"mail: no purge/clean command for clearing old messages","description":"The mail DB accumulates messages from all sessions with no way to clean them up. 'mail list' shows dozens of old messages from test sessions and dead agents. Need a 'mail purge' or 'mail clean' subcommand to remove messages older than N days, messages to/from non-existent agents, or all messages. This is important for long-running projects where the mail DB would grow unbounded.","status":"closed","priority":4,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:34:49.005811-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:41:42.052566-08:00","closed_at":"2026-02-12T10:41:42.052566-08:00","close_reason":"Added mail purge subcommand with --all, --days N, --agent \u003cname\u003e, and --json support"}
{"id":"overstory-m3mk","title":"Apply conflict history intelligence to merge resolver","description":"Re-apply conflict history pattern learning code from overstory/merge-intel-builder/overstory-99tm. Modify src/types.ts, src/merge/resolver.ts, src/merge/resolver.test.ts, src/commands/merge.ts only. No mulch or .claude file modifications.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T18:19:43.049871-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:27:07.015609-08:00","closed_at":"2026-02-16T18:27:07.015609-08:00","close_reason":"Conflict history intelligence applied to merge resolver. 38 tests pass, lint/types clean. Code commit: 8a64dba. Note: builder also ran mulch record (commit 3efc640) despite constraint — coordinator should cherry-pick only 8a64dba or exclude .mulch/ from merge."}
{"id":"overstory-m4w","title":"Overlay template includes quality gates for read-only agents (scout, reviewer)","description":"The overlay template (templates/overlay.md.tmpl) includes quality gates that tell agents to commit, run biome check, and run tests. These are wrong for read-only agents like scouts and reviewers who should never modify files. The overlay should conditionally include quality gates based on the agent capability, or at least exclude them for scout/reviewer roles.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:56:16.671504-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T11:47:24.138052-08:00","closed_at":"2026-02-12T11:47:24.138052-08:00","close_reason":"Overlay template now conditionally renders quality gates and constraints based on agent capability. Read-only agents (scout, reviewer) get a lightweight completion section instead of the full quality gates (bun test, biome check, commit). Added formatQualityGates and formatConstraints functions with READ_ONLY_CAPABILITIES set. Added capability field to OverlayConfig type."}
{"id":"overstory-m55s","title":"Doctor: CLI scaffold and output formatting","description":"Create the doctor command scaffold: CLI registration, check runner, output formatting.\n\nImplementation:\n- New file: src/commands/doctor.ts\n- Register 'doctor' command in src/index.ts COMMANDS list and switch statement\n- Define DoctorCheck type: { name, category, status: 'pass'|'warn'|'fail', message, details?: string[], fixable?: boolean }\n- Define check categories: 'dependencies', 'structure', 'config', 'databases', 'consistency', 'agents', 'merge', 'logs', 'version'\n- Run all checks sequentially (some depend on earlier results, e.g. config must load before validating DB paths)\n- Output formatting: ANSI colors (green pass, yellow warn, red fail), summary counts at end\n- Flags: --json (structured output), --verbose (show passing checks too, not just problems), --category \u003cname\u003e (run only one category)\n- Future: --fix flag (not in initial implementation, but design the check result type to support it)\n- Exit code: 0 if all pass/warn, 1 if any fail\n\nFollow mulch doctor's UX pattern:\n- Show category headers\n- Show check name + status + message on one line\n- Show details indented below on warn/fail\n- Summary line at end: 'X passed, Y warnings, Z failures'\n\nSource references (mulch pattern):\n- /Users/jayminwest/Projects/mulch/src/commands/doctor.ts — overall structure and UX\n\nThis issue should be implemented first as it provides the framework for all other check issues.","notes":"IMPLEMENTATION COMPLETE:\n- Added DoctorCheck, DoctorCategory, DoctorCheckFn types to src/types.ts\n- Created src/commands/doctor.ts with full CLI implementation\n- Created 9 stub check modules in src/doctor/ (all return empty arrays)\n- Registered command in src/index.ts\n- Created comprehensive tests in src/commands/doctor.test.ts (19 passing)\n- Quality gates passed: biome check clean, tsc --noEmit clean\n\nAll files staged for commit. Cannot complete commit due to hanging pre-commit hook (bd hook pre-commit).\nSent worker_done mail to cli-lead. Ready for review and merge.\n\nCannot close due to dependency on overstory-1f9g (should be inverse - scaffold should not depend on parent feature).","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:00:11.740768-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:40:31.06146-08:00","closed_at":"2026-02-15T12:40:31.06146-08:00","close_reason":"Doctor command scaffold complete: CLI registration, check runner, output formatter, 9 stub check modules, DoctorCheck types","dependencies":[{"issue_id":"overstory-m55s","depends_on_id":"overstory-1f9g","type":"blocks","created_at":"2026-02-13T22:00:23.910631-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-m9p4","title":"Migrate status.ts, clean.ts, and init.ts to SessionStore","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T14:58:36.438885-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T19:16:13.152456-08:00","closed_at":"2026-02-13T19:16:13.152456-08:00","close_reason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed."}
{"id":"overstory-maiz","title":"Rewrite merge queue store from JSON to SQLite","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T07:06:23.907755-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:14:18.552192-08:00","closed_at":"2026-02-16T07:14:18.552192-08:00","close_reason":"Core merge queue SQLite store implemented and tests passing"}
{"id":"overstory-makx","title":"Test: merge command (help, validation, integration with real git)","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:21:49.180327-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:26:57.097836-08:00","closed_at":"2026-02-13T08:26:57.097836-08:00","close_reason":"Created src/commands/merge.test.ts with 15 comprehensive tests. All quality gates passed (tests, lint, typecheck). Tests cover help, validation, --branch, --all, --dry-run, --json, and conflict handling."}
{"id":"overstory-mbs6","title":"Fix MulchClient: correct types, add --json parsing, fix flag spread","description":"Start from branch overstory/mulch-client-builder/overstory-u76r and apply targeted fixes.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:09:28.31142-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:18:47.46055-08:00","closed_at":"2026-02-13T22:18:47.46055-08:00","close_reason":"Fixed types, added --json parsing, fixed flag spread. Final implementation on branch overstory/mulch-fix-builder/overstory-mbs6"}
{"id":"overstory-mifc","title":"Apply merge resolver conflict history (no mulch)","description":"Re-apply the conflict history pattern learning code from branch overstory/merge-intel-builder/overstory-99tm to a fresh branch. CRITICAL: Builder must NOT run mulch record or modify any .mulch/ or .claude/ files. Only modify src/types.ts, src/merge/resolver.ts, src/merge/resolver.test.ts, src/commands/merge.ts.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T18:18:21.35509-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:28:15.588285-08:00","closed_at":"2026-02-16T18:28:15.588285-08:00","close_reason":"Clean merge achieved. Conflict history code applied to main."}
{"id":"overstory-milb","title":"Add --debounce flag to overstory mail check command","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T12:17:34.197462-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T13:01:16.122553-08:00","closed_at":"2026-02-15T13:01:16.122553-08:00","close_reason":"Superseded by debounce-fix-builder (overstory-8fj0)"}
{"id":"overstory-mt9l","title":"Doctor: log disk usage and staleness","description":"Check logging directory for disk usage, staleness, and corruption.\n\nChecks:\n- .overstory/logs/ directory exists and is readable\n- Calculate total disk usage across all log directories\n- Warn if total exceeds threshold (e.g. \u003e500MB, configurable)\n- List log directories for agents no longer in sessions.db (stale)\n- Sample NDJSON files (events.ndjson, tools.ndjson) for malformed JSON lines\n- Check tools.ndjson for orphaned toolStart events without matching toolEnd (incomplete sessions)\n- Report per-agent log sizes for visibility\n\nNote: No log rotation exists today. Doctor should warn about this and suggest 'overstory worktree clean --completed' as partial cleanup.\n\nSource references:\n- src/logging/logger.ts — log directory structure, file naming, NDJSON format\n- .overstory/logs/ — real example with coordinator and agent subdirectories\n\nOutput: pass/warn. Large disk usage = warn. Stale logs = warn with cleanup suggestion. This is Tier 3 (degraded but functional).","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:59:54.981856-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:54:28.369084-08:00","closed_at":"2026-02-15T12:54:28.369084-08:00","close_reason":"Implemented structure, logs, and agent health checks. All tests passing (33 tests), quality gates clean.","dependencies":[{"issue_id":"overstory-mt9l","depends_on_id":"overstory-m55s","type":"blocks","created_at":"2026-02-13T22:00:19.234751-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-mw6l","title":"Add mulch recording as required completion gate to all agent definitions","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:37:47.920659-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:45:11.193336-08:00","closed_at":"2026-02-16T13:45:11.193336-08:00","close_reason":"Added mulch record as required completion gate for all agents. Updated 5 agent definitions (builder, lead, scout, reviewer, merger) with new completion protocol step and MISSING_MULCH_RECORD failure mode. Updated overlay.ts formatQualityGates for both read-only and writable agents. Fixed completions test. All quality gates pass."}
{"id":"overstory-mxi","title":"L3-4: Implement merge command (src/commands/merge.ts)","description":"CLI: overstory merge --branch \u003cname\u003e | --all | --dry-run. Merges agent branches back to canonical branch. Uses merge queue + tiered resolver. Reports merge results with tier used and any conflict files.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:05.510494-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:36:21.695111-08:00","closed_at":"2026-02-12T07:36:21.695111-08:00","close_reason":"All L3 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-mxi","depends_on_id":"overstory-rbj","type":"blocks","created_at":"2026-02-12T07:13:43.075886-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-my8","title":"L2-5: Implement sling command (src/commands/sling.ts)","description":"CRITICAL PATH. The overstory sling command orchestrates full agent spawn: 1) Load config + manifest, 2) Validate (name unique, depth limit, bead exists), 3) Create worktree, 4) Generate + write overlay CLAUDE.md, 5) Generate + write hooks config, 6) Claim beads issue, 7) Create tmux session running claude, 8) Record session in sessions.json, 9) Return AgentSession.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:59.30775-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:33:09.604276-08:00","closed_at":"2026-02-12T07:33:09.604276-08:00","close_reason":"All L2 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-my8","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:41.219321-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-n4go","title":"Migrate log.ts + test to SessionStore","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T14:56:46.505897-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T15:03:00.760959-08:00","closed_at":"2026-02-13T15:03:00.760959-08:00","close_reason":"Migrated log.ts and log.test.ts from sessions.json to SessionStore API"}
{"id":"overstory-n4o","title":"Test task for sling","description":"Dummy task to test overstory sling command","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:12:24.141653-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:23:25.824061-08:00","closed_at":"2026-02-12T08:23:25.824061-08:00","close_reason":"Test tasks created during integration testing, not real work"}
{"id":"overstory-n4r8","title":"Implement overstory costs CLI command","description":"Token/cost analysis and breakdown. Query metrics.db for token data (inputTokens, outputTokens, cacheReadTokens, cacheCreationTokens, estimatedCostUsd). Support --agent, --run, --by-capability, --json flags. Show per-agent breakdown and totals. Follow trace.ts patterns.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T20:44:47.787496-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:58:11.20357-08:00","closed_at":"2026-02-13T20:58:11.20357-08:00","close_reason":"Implemented and tested in commit 35531bc"}
{"id":"overstory-n6nc","title":"Add gitignore auto-heal step in prime.ts","description":"Import OVERSTORY_GITIGNORE from init.ts, add auto-heal in primeCommand","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:17:59.672018-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:25:45.896501-08:00","closed_at":"2026-02-17T07:25:45.896501-08:00","close_reason":"Closed"}
{"id":"overstory-n6ny","title":"Write dashboard.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:05:25.836084-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:32:05.33104-08:00","closed_at":"2026-02-13T09:32:05.33104-08:00","close_reason":"Test files already written and committed"}
{"id":"overstory-n6qk","title":"Implement overstory replay command","description":"Create src/commands/replay.ts — chronological interleaved replay across all agents.\n\n## Usage\n```\noverstory replay [--run \u003cid\u003e] [--agent \u003ca1,a2\u003e] [--json]\n```\n\n## Behavior\nShow all events across multiple agents in chronological order, interleaved. This is the key post-mortem tool — it shows the full story of a swarm run as it happened.\n\n## Output Format (human)\n```\nReplay: run-2026-02-13T10-00-00Z (5 agents, 12m 34s)\n\n10:00:00  [orchestrator]     SPAWN lead-tests-1 (lead)\n10:00:03  [lead-tests-1]     SPAWN builder-auth-1 (builder)\n10:00:03  [lead-tests-1]     SPAWN builder-db-2 (builder)\n10:00:06  [builder-auth-1]   bash: bun test src/auth.test.ts         [2.3s]\n10:00:06  [builder-db-2]     bash: bun test src/db.test.ts           [3.1s]\n10:00:09  [builder-db-2]     ERROR: test \"handles connection pool\" failed\n10:12:30  [builder-auth-1]   MAIL_SENT to:lead-tests-1 \"Worker done\"\n10:12:34  [orchestrator]     MERGE builder-auth-1 -\u003e main (clean-merge)\n```\n\n## Flags\n- --run: filter to specific run. Default: most recent run, or last 24h if no runs exist\n- --agent: comma-separated list of agents to include (filter)\n- --json: structured output\n\n## Implementation\n- Query EventStore.getTimeline() with run/agent filters, sorted by created_at\n- Each line prefixed with [agent_name] in a consistent-width column\n- Agent names get stable colors (hash agent name to color index)\n- Tool events show the summary from tool-filter + duration\n- Without --run, detect most recent run from SessionStore or fall back to last 24h\n- Header shows run ID, agent count, total duration\n\n## Tests (src/commands/replay.test.ts)\n- Interleaved events from multiple agents in correct time order\n- --run filter\n- --agent filter (comma-separated)\n- --json output\n- Default to most recent run\n- Header stats (agent count, duration)","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:09:33.331838-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:58:16.32614-08:00","closed_at":"2026-02-13T20:58:16.32614-08:00","close_reason":"Implemented in commit 35531bc (duplicate of overstory-n4r8/gz4u/72ak)","dependencies":[{"issue_id":"overstory-n6qk","depends_on_id":"overstory-c6ca","type":"blocks","created_at":"2026-02-13T13:10:38.155369-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-n6qk","depends_on_id":"overstory-b3sa","type":"blocks","created_at":"2026-02-13T13:10:38.290702-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-n6qk","depends_on_id":"overstory-6asp","type":"blocks","created_at":"2026-02-13T13:10:38.87861-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-n82","title":"L4-6: Implement metrics command (src/commands/metrics.ts)","description":"CLI: overstory metrics [--last \u003cn\u003e] [--json]. Shows metrics summary from SQLite store: session durations, success rates, merge tier distribution, agent utilization. Human-readable table or JSON output.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:33.162384-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:39:41.996046-08:00","closed_at":"2026-02-12T07:39:41.996046-08:00","close_reason":"All L4 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-n82","depends_on_id":"overstory-19p","type":"blocks","created_at":"2026-02-12T07:13:45.606801-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-n9b0","title":"Epic: Evolve overstory into autonomous orchestration system","description":"Transform overstory from a manual CLI toolkit into a true autonomous orchestration system with hierarchical delegation, self-propelling agents, and structured escalation. Key pillars: (1) Persistent coordinator agent, (2) Per-project supervisor agents, (3) Auto-propulsion for workers, (4) Deep watchdog chain, (5) Session lifecycle independence. Design principle: minimize .md-based prompt injection - use beads for task context and the mail system for inter-agent communication.","status":"closed","priority":1,"issue_type":"epic","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:50:27.526086-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T07:05:46.939007-08:00","closed_at":"2026-02-13T07:05:46.939007-08:00","close_reason":"All 8 dependency phases complete: typed mail protocol, coordinator, supervisor, auto-propulsion, deep watchdog chain, session lifecycle, structural enforcement, task groups","dependencies":[{"issue_id":"overstory-n9b0","depends_on_id":"overstory-rxvu","type":"blocks","created_at":"2026-02-12T13:51:34.053822-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-n9b0","depends_on_id":"overstory-p6pn","type":"blocks","created_at":"2026-02-12T13:51:34.191105-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-n9b0","depends_on_id":"overstory-yhbn","type":"blocks","created_at":"2026-02-12T13:51:34.326258-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-n9b0","depends_on_id":"overstory-e86r","type":"blocks","created_at":"2026-02-12T13:51:34.459077-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-n9b0","depends_on_id":"overstory-9ot9","type":"blocks","created_at":"2026-02-12T13:51:34.596238-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-n9b0","depends_on_id":"overstory-b3u0","type":"blocks","created_at":"2026-02-12T13:51:34.741598-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-n9b0","depends_on_id":"overstory-6dyr","type":"blocks","created_at":"2026-02-12T13:51:34.888443-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-n9b0","depends_on_id":"overstory-7y1l","type":"blocks","created_at":"2026-02-12T13:51:35.041813-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-n9s2","title":"Implement overstory agents discover command","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T17:51:56.172634-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:01:10.616313-08:00","closed_at":"2026-02-16T18:01:10.616313-08:00","close_reason":"Implemented overstory agents discover command with capability filtering, file scope extraction from overlays, human and JSON output, shell completions, and 10 unit tests"}
{"id":"overstory-nau","title":"No DB-level constraints for mail type/priority columns","description":"The mail SQLite schema doesn't enforce valid type/priority values at the DB level. Historical test data includes messages with type='invalid_type' and priority='invalid_prio'. While CLI validation now rejects invalid values, direct SQLite access (from agents or tests) can still insert invalid data. Consider adding CHECK constraints to the mail table schema: type CHECK(type IN ('status','question','result','error')) and priority CHECK(priority IN ('low','normal','high','urgent')).","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:41:38.954059-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:49:19.63794-08:00","closed_at":"2026-02-12T09:49:19.63794-08:00","close_reason":"Added CHECK constraints for type/priority columns to mail schema. Added migration to recreate existing tables with constraints (sanitizes invalid data to defaults). Added 5 new tests."}
{"id":"overstory-ne0","title":"init --force: regenerated hooks.json has broken log commands (missing --agent)","description":"Running 'overstory init --force' regenerates .overstory/hooks.json and strips {{AGENT_NAME}} template placeholders. This results in 'overstory log tool-start' (no --agent) in the hooks, which fails with VALIDATION_ERROR since --agent is required. The prime and mail check commands happen to work without --agent (they default to 'orchestrator'), but all three log commands (tool-start, tool-end, session-end) will fail on every hook invocation. The orchestrator hooks.json should either: (1) use '--agent orchestrator' explicitly, or (2) make --agent optional in log.ts with a default of 'orchestrator'.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:10:28.403348-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:13:54.055955-08:00","closed_at":"2026-02-12T10:13:54.055955-08:00","close_reason":"Added --agent orchestrator to all three log commands (tool-start, tool-end, session-end) in buildHooksJson() in init.ts"}
{"id":"overstory-ngz7","title":"Create STEELMAN.md and README disclaimer (retry)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T12:59:56.138438-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T13:04:39.511854-08:00","closed_at":"2026-02-13T13:04:39.511854-08:00","close_reason":"STEELMAN.md created and README.md disclaimer added in builder-steelman-2 worktree. Files written correctly but uncommitted (builder session died before git commit). Escalated to orchestrator for commit and merge."}
{"id":"overstory-nlnl","title":"Fix hooks template: remove read/echo stdin relay","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:37:37.530247-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:48:04.528091-08:00","closed_at":"2026-02-17T07:48:04.528091-08:00","close_reason":"Removed read/echo stdin relay from templates/hooks.json.tmpl (3 hooks fixed). Template loads correctly."}
{"id":"overstory-nmz","title":"maxConcurrent agent limit is never enforced by sling","description":"The config has agents.maxConcurrent=5 but 'overstory sling' never checks this limit before spawning a new agent. You can spawn unlimited agents. The sling command should count active (non-zombie) sessions and reject new spawns if the limit would be exceeded.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:22:48.225682-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:29:56.97226-08:00","closed_at":"2026-02-12T08:29:56.97226-08:00","close_reason":"Closed"}
{"id":"overstory-nq0y","title":"Fix tool logging — all tools logged as hook-captured with no tool name or args","description":"Coordinator log files (events.ndjson, session.log, tools.ndjson) record every tool call as toolName=hook-captured with empty args. No actual tool identity (Bash, Read, Glob) or arguments are captured. This makes logs useless for debugging agent behavior — we had to use tmux capture-pane to determine what the coordinator was doing. The overstory log hook is not propagating the actual tool_name and tool_input from the PreToolUse/PostToolUse stdin JSON. Check the log command and hooks template.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T06:20:51.639374-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:45:26.281875-08:00","closed_at":"2026-02-13T06:45:26.281875-08:00","close_reason":"Fixed sed patterns in hooks template and hooks-deployer to handle optional whitespace after JSON colons. Claude Code sends spaced JSON (e.g. \"tool_name\": \"Bash\") but sed patterns expected no space (\"tool_name\":\"Bash\"), causing extraction to fail and return the full JSON blob instead of the tool name."}
{"id":"overstory-ntmo","title":"Cross-agent mulch propagation within a run","description":"When a scout discovers important patterns and records them to mulch, that expertise should be available to builders in the same run. Currently mulch expertise is only embedded at spawn time via the overlay. Options: re-fetch mulch at builder spawn time (already happens but scout may not have recorded yet), or add a mechanism to propagate mulch updates to running agents via mail.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-16T08:06:06.45412-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T19:10:41.575302-08:00","closed_at":"2026-02-16T19:10:41.575302-08:00","close_reason":"Scout-first workflow (overstory-18zt) already solves the timing problem. Scouts finish before builders spawn, so builders get latest mulch via overlay at spawn time. Propagating updates to running agents fights the disposable model."}
{"id":"overstory-nup","title":"L5-4: Write tmux.test.ts","description":"Tests for src/worktree/tmux.ts. Cover: create session, list sessions, kill session, isSessionAlive check, session naming convention (overstory-{agentName}). May need to mock tmux commands.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:29.912752-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:54:20.550763-08:00","closed_at":"2026-02-12T07:54:20.550763-08:00","close_reason":"Closed","dependencies":[{"issue_id":"overstory-nup","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:47.290705-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-nuxo","title":"Rename watchdog tier numbering to match Phase 4 spec","description":"Current code calls mechanical monitoring Tier 1 and AI triage Tier 2. Phase 4 spec uses Tier 0 for mechanical, Tier 1 for triage, Tier 2 for monitor agent, Tier 3 for supervisor monitors. Update comments, variable names, config keys, and CLI help text to match Phase 4 naming. Config backward compat: accept both old and new key names.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T06:51:33.364485-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:58:55.893712-08:00","closed_at":"2026-02-13T06:58:55.893712-08:00","close_reason":"Renamed tier numbering to match Phase 4 spec with backward compat"}
{"id":"overstory-nv75","title":"Test: monitor command (help, routing, beacon, status)","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:21:46.316633-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:25:18.949153-08:00","closed_at":"2026-02-13T08:25:18.949153-08:00","close_reason":"Created monitor.test.ts with comprehensive test coverage for buildMonitorBeacon() and monitorCommand(). 18 tests passing, all quality gates cleared."}
{"id":"overstory-nzor","title":"Phase 3: Communication Upgrade","description":"Move beyond point-to-point mail toward richer collaboration patterns. Add shared blackboard (with mulch drill-down), event subscriptions, broadcast messaging, and agent discovery.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:30.945997-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T17:48:30.84575-08:00","closed_at":"2026-02-16T17:48:30.84575-08:00","close_reason":"Phase 3 substantially complete. Broadcast messaging built (src/mail/broadcast.ts: @all, @builders, @scouts, etc.). Agent discovery via overstory status + agent manifest. Mulch serves as shared blackboard (mulch prime/search/record). Event subscriptions effectively handled by mail protocol (worker_done, merge_ready, escalation). Remaining: dedicated agent discovery command tracked as overstory-9kuz.","dependencies":[{"issue_id":"overstory-nzor","depends_on_id":"overstory-3yvt","type":"blocks","created_at":"2026-02-15T17:05:29.555756-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-o0g","title":"lastActivity timestamp never updated after agent spawn","description":"In sling.ts, lastActivity is set to the spawn timestamp and is never updated during the agent's lifetime. The log hooks (overstory log tool-start/tool-end) fire but don't update sessions.json with a new lastActivity timestamp. This means the watchdog's stale/zombie detection based on lastActivity is broken — agents will be marked stale/zombie based on time since spawn rather than time since actual activity. The log command should update lastActivity in sessions.json for the relevant agent.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:15:15.45079-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:29:56.927873-08:00","closed_at":"2026-02-12T08:29:56.927873-08:00","close_reason":"Closed"}
{"id":"overstory-o1p9","title":"Supervisor agent: TypeScript implementation","description":"Add supervisor capability to types.ts and hooks-deployer.ts. Implement src/commands/supervisor.ts (start/stop/status CLI). Register in src/index.ts. Pattern follows coordinator.ts closely but with bead assignment, depth 1, and parent tracking.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:34:37.015522-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T14:55:19.67043-08:00","closed_at":"2026-02-12T14:55:19.67043-08:00","close_reason":"Phase 2 supervisor agent implemented and merged","dependencies":[{"issue_id":"overstory-o1p9","depends_on_id":"overstory-p6pn","type":"blocks","created_at":"2026-02-12T14:34:43.490761-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-o570","title":"Write identity.test.ts for src/agents/identity.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:04:56.015199-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:32:05.325359-08:00","closed_at":"2026-02-13T09:32:05.325359-08:00","close_reason":"Test files already written and committed"}
{"id":"overstory-o992","title":"[Epic] Phase 3: Run Grouping + Watchdog Persistence","description":"Introduce the 'run' concept (one coordinator session = one run) and persist watchdog events for post-mortem analysis.\n\n## Goal\nGroup all agents from a coordinator session into a named run for easy querying. Record all watchdog actions (nudges, escalations, triage verdicts) as events so they appear in trace/replay output.\n\n## Deliverables\n1. Run concept — run ID generation, current-run tracking, runs table in sessions.db\n2. overstory run command — show current run, list recent runs, mark complete, show details\n3. Watchdog event persistence — daemon records nudges/escalations/triage to events.db\n4. Mail event recording — mail send/receive recorded as events for full audit trail\n5. Nudge event recording — nudge deliveries recorded as events\n\n## Architecture Notes\n- Run ID format: run-{ISO timestamp}\n- Stored in .overstory/current-run.txt (active run) and runs table in sessions.db\n- sling generates run ID on first call, subsequent calls inherit it\n- Run auto-completes when all member agents reach completed/zombie state\n- Watchdog events use existing EventStore.insert() with appropriate event_type values\n- Mail events in events.db are denormalized audit trail (mail.db remains authoritative)\n\n## Dependencies\nDepends on Phase 1 (EventStore, SessionStore) and partially on Phase 2 (run filtering in CLI commands)","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:07:39.549788-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:53:42.142137-08:00","closed_at":"2026-02-13T20:53:42.142137-08:00","close_reason":"All 5 deliverables complete: run concept, run CLI, watchdog events, mail events, nudge events. All tests passing.","dependencies":[{"issue_id":"overstory-o992","depends_on_id":"overstory-sp4j","type":"blocks","created_at":"2026-02-13T13:10:27.604611-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-o999","title":"Implement NO_COLOR and --quiet support","description":"Create central color module, update all ANSI-using files, add --quiet flag to CLI entry point, add tests","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T07:40:39.707521-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:55:05.230599-08:00","closed_at":"2026-02-16T07:55:05.230599-08:00","close_reason":"Implemented NO_COLOR env var support and --quiet CLI flag. Created central color.ts module, updated 8 command files to use it, added tests. All quality gates pass."}
{"id":"overstory-oa1x","title":"Fix process.exitCode race between doctor.test.ts and watch.test.ts","description":"1 remaining test failure: 'doctorCommand \u003e exit code \u003e exit code is undefined when all checks pass or warn' passes in isolation but fails in full suite. Root cause: process.exitCode is a shared global between parallel test files. watch.test.ts sets process.exitCode=0 in beforeEach (line 49), which races with doctor.test.ts that expects process.exitCode to be undefined. Fix: either (a) make doctorCommand return the exit code instead of setting process.exitCode directly, and have the CLI entry point handle the global set, or (b) have the test assert process.exitCode is not 1 instead of asserting undefined. Option (a) is cleaner.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T14:31:19.444675-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T14:39:31.954161-08:00","closed_at":"2026-02-15T14:39:31.954161-08:00","close_reason":"All 33 test failures resolved. 1603/1603 pass."}
{"id":"overstory-oac4","title":"Add mulch diff PostToolUse hook to orchestrator buildHooksJson and tests","description":"Add a PostToolUse Bash hook to buildHooksJson() in init.ts and add test in init.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T13:17:24.634966-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:21:14.25555-08:00","closed_at":"2026-02-20T13:21:14.25555-08:00","close_reason":"Added PostToolUse Bash hook to buildHooksJson() in init.ts: matcher='Bash', reads stdin, greps for git commit, runs mulch diff HEAD~1. Test added and all quality gates pass."}
{"id":"overstory-ofgf","title":"overstory dashboard base command — ANSI TUI with live panels","description":"New 'overstory dashboard' command that renders a rich terminal UI using raw ANSI escape codes (zero deps). Polls existing data sources and renders multi-panel layout:\n\nPanels:\n- Agent panel: name, capability, state (color-coded), duration, bead ID, tmux alive indicator\n- Mail panel: recent messages, unread count, activity ticker\n- Merge queue panel: pending/merging/conflict entries with status\n- Metrics summary: session counts, avg duration, by-capability breakdown\n\nImplementation:\n- New src/commands/dashboard.ts\n- Raw ANSI escape codes for layout (box drawing, colors, cursor positioning)\n- Poll loop similar to current --watch but with richer rendering\n- Reuse gatherStatus() data + extend with mail/merge detail\n- Register in src/index.ts command router\n\nAll data sources already exist — this is purely a rendering/UX task.","status":"closed","priority":4,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:37:38.915617-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T07:26:29.04586-08:00","closed_at":"2026-02-13T07:26:29.04586-08:00","close_reason":"Dashboard base command implemented: 609-line ANSI TUI with agent/mail/merge/metrics panels"}
{"id":"overstory-oia","title":"L5-9: Write resolver.test.ts","description":"Tests for src/merge/resolver.ts. Cover: all 4 resolution tiers (clean-merge, auto-resolve, ai-resolve, reimagine). Mock git commands and claude --print calls. Verify tier escalation on failure.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:34.337956-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:54:20.572101-08:00","closed_at":"2026-02-12T07:54:20.572101-08:00","close_reason":"Closed","dependencies":[{"issue_id":"overstory-oia","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:48.05857-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-ojcw","title":"Apply 5 code files from failed agents-cmd branch","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T18:06:57.070004-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:13:54.245229-08:00","closed_at":"2026-02-16T18:13:54.245229-08:00","close_reason":"Applied 5 code files (agents.ts, agents.test.ts, completions.ts, completions.test.ts, index.ts) from failed merge branch. All quality gates passed."}
{"id":"overstory-okcp","title":"Implement conflict history query and tier optimization in resolver","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T17:51:50.090493-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:04:28.612673-08:00","closed_at":"2026-02-16T18:04:28.612673-08:00","close_reason":"Implemented conflict history query, tier skip optimization, AI prompt enrichment, and conflict prediction in resolver.ts. Added parseConflictPatterns(), buildConflictHistory(), queryConflictHistory(). Wired mulchClient in merge.ts. 13 new tests, all 38 pass."}
{"id":"overstory-oo6k","title":"Fix: Add mulch learn to Stop hooks for orchestrator and agent sessions","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:04:21.750276-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:09:55.276195-08:00","closed_at":"2026-02-16T13:09:55.276195-08:00","close_reason":"Added mulch learn to Stop hooks for both orchestrator and agent sessions. Tests added and passing."}
{"id":"overstory-ootr","title":"Review: sling.ts scout-before-builder warning","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:46:09.735011-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:51:34.623213-08:00","closed_at":"2026-02-17T07:51:34.623213-08:00","close_reason":"All subtasks complete. lead.md updated with scout-first enforcement. sling.ts has scout-before-builder warning."}
{"id":"overstory-ot7","title":"Scout: audit merge queue JSON formatting","description":"Read-only audit of how merge-queue.json is written. Report findings about formatting.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:03:11.015929-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:04:05.374475-08:00","closed_at":"2026-02-12T12:04:05.374475-08:00","close_reason":"Audit complete: merge-queue.json formatting is correct. Uses tab-indented JSON.stringify with trailing newline, consistent with all other JSON write sites. Only note: queue.ts uses node:fs writeFileSync (sync) instead of Bun.write (async) — intentional workaround documented in comments."}
{"id":"overstory-otwd","title":"Thread provider env vars through agent spawning","description":"Update all agent spawn commands to use ResolvedModel and pass provider env vars into tmux sessions.\n\nFILES: src/commands/sling.ts, src/commands/coordinator.ts, src/commands/supervisor.ts, src/commands/monitor.ts\n\nPattern (same in all 4 files):\n- Before: const model = resolveModel(config, manifest, role, fallback); const cmd = `claude --model ${model} ...`;\n- After: const resolved = resolveModel(config, manifest, role, fallback); const cmd = `claude --model ${resolved.model} ...`; pass {...resolved.env} into createSession() env dict\n\nSpecific locations:\n- sling.ts:467-468 — worker agents\n- coordinator.ts:335,343 — coordinator\n- supervisor.ts:~199 — supervisor  \n- monitor.ts:~146 — monitor\n\ntmux.ts createSession() already accepts an env dict and handles injection — no changes needed there.\n\nCritical: ANTHROPIC_API_KEY must be set to '' (empty string, not undefined) when using a gateway provider, to prevent Claude Code from falling back to Anthropic auth.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:13:53.618528-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T09:44:06.5203-08:00","closed_at":"2026-02-20T09:44:06.5203-08:00","close_reason":"Threaded provider env vars through all 4 spawn commands (sling, coordinator, supervisor, monitor). Each now destructures { model, env } from resolveModel() and spreads ...env into createSession() env dict.","dependencies":[{"issue_id":"overstory-otwd","depends_on_id":"overstory-d1g8","type":"blocks","created_at":"2026-02-19T12:14:11.781778-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-ov3i","title":"Fix doctor.test.ts: add DI for check runners","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T14:08:34.884181-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T14:13:21.761976-08:00","closed_at":"2026-02-15T14:13:21.761976-08:00","close_reason":"Builder added DI for checkRunners to doctorCommand. All 19 tests pass. Only src/commands/doctor.ts and doctor.test.ts modified."}
{"id":"overstory-ow1m","title":"Test: supervisor command (help, routing, beacon, sessions, status)","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:21:48.096872-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:25:24.458729-08:00","closed_at":"2026-02-13T08:25:24.458729-08:00","close_reason":"Added supervisor.test.ts with 21 passing tests covering loadSessions, saveSessions, buildSupervisorBeacon, and supervisorCommand"}
{"id":"overstory-ow3","title":"sling: getFlag() accepts empty strings for --name and --files","description":"The getFlag() helper in sling.ts returns flag values without checking for empty strings. This means: (1) --name '' passes the truthy check since getFlag returns the next arg which could be another flag. (2) --files '' splits into [''] (array with one empty string element) instead of []. The empty string file scope could cause issues downstream. Fix: validate non-empty values after getFlag() returns, or trim and check length.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:09:36.559543-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:15:19.829597-08:00","closed_at":"2026-02-12T10:15:19.829597-08:00","close_reason":"Validate --name and --files for empty strings after getFlag()"}
{"id":"overstory-oyrn","title":"Wire mulchClient into merge command","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T17:51:54.394634-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:04:29.718851-08:00","closed_at":"2026-02-16T18:04:29.718851-08:00","close_reason":"mulchClient wired into merge command via createMulchClient(config.project.root), passed to createMergeResolver"}
{"id":"overstory-p0i","title":"watch --background flag not implemented","description":"The watch command help documents a --background flag for daemonization, but testing shows the watch command only runs in foreground. The --background flag should launch the watchdog as a background process (e.g., forking or using nohup) and print the PID. Currently watch must be manually backgrounded or run in a tmux session.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:41:45.078946-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:57:10.970147-08:00","closed_at":"2026-02-12T09:57:10.970147-08:00","close_reason":"Implemented --background flag using Bun.spawn detached process with PID file at .overstory/watchdog.pid"}
{"id":"overstory-p4st","title":"isCanonicalRoot guard blocks ALL worktree overlays when dogfooding on overstory repo","description":"## Problem\n\nisCanonicalRoot() in src/agents/overlay.ts:197 uses the presence of .overstory/config.yaml as a heuristic to identify the canonical project root. When dogfooding overstory on its own repo, .overstory/config.yaml is tracked in git. Every worktree is a git checkout, so every worktree also contains .overstory/config.yaml. The guard returns true for ALL worktrees, blocking overlay writes and preventing ALL agent spawning.\n\n## Reproduction\n\noverstory sling overstory-b3sa --capability lead --name lead-sessions --depth 1\nError: Refusing to write overlay to canonical project root\n\nThe worktree was created (step 6 in sling), but the overlay write (step 7) fails, leaving an orphaned worktree.\n\n## Root Cause\n\n1. .overstory/config.yaml is tracked in git\n2. createWorktree() checks out a branch including all tracked files\n3. The checkout includes .overstory/config.yaml\n4. isCanonicalRoot(worktreePath) finds it and returns true\n5. writeOverlay() throws AgentError\n\n## Impact\n\nP0 blocker: Cannot spawn ANY agents when dogfooding. The entire swarm system is inoperable on its own repo. Orphaned worktrees left behind on failure. Existing test (overlay.test.ts:436) does not simulate the dogfooding scenario.\n\n## Fix\n\nReplace the .overstory/config.yaml heuristic with a deterministic path comparison. Pass canonicalRoot (from config.project.root) to writeOverlay() and compare resolved paths:\n\nisCanonicalRoot(dir, canonicalRoot): resolve(dir) === resolve(canonicalRoot)\n\nUpdate writeOverlay signature and call site in sling.ts line 364.\n\n## Files\n\n- src/agents/overlay.ts: fix isCanonicalRoot(), update writeOverlay() signature\n- src/commands/sling.ts: pass config.project.root to writeOverlay()\n- src/agents/overlay.test.ts: add dogfooding test case\n\n## Secondary\n\nsling.ts should clean up the worktree if overlay write fails (currently orphaned on error).","status":"closed","priority":0,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T14:45:19.716806-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T14:48:58.944774-08:00","closed_at":"2026-02-13T14:48:58.944774-08:00","close_reason":"Replaced file-existence heuristic with deterministic path comparison. writeOverlay() now takes canonicalRoot param. Added worktree cleanup on overlay failure in sling.ts. Added dogfooding test case."}
{"id":"overstory-p5mm","title":"Implement status.ts perf fixes: Set lookup + subprocess caching","description":"Fix overstory-4zcj (Set lookup) and overstory-je5w (subprocess caching) in src/commands/status.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T07:58:34.160819-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T08:01:18.26609-08:00","closed_at":"2026-02-20T08:01:18.26609-08:00","close_reason":"Implemented Set-based tmux lookup (replaces .some()) and module-level TTL subprocess cache in status.ts. Exported invalidateStatusCache() for tests. 16 tests passing, all quality gates clean."}
{"id":"overstory-p6pn","title":"Phase 2: Supervisor agent (per-project team lead)","description":"Implement a per-project supervisor agent that monitors and manages workers within a single project. The supervisor bridges the coordinator and leaf workers. Key properties: (1) Structurally cannot write code - tool restrictions enforced at spawn time, not via prompt discipline, (2) Spawns workers via overstory sling, monitors progress, nudges stalled agents, (3) Handles the worker-done → merge-ready → cleanup lifecycle, (4) Escalates to coordinator when stuck (after N nudge attempts), (5) One supervisor per active project, persistent session with self-managed compaction. Communication: uses mail system for all inter-agent coordination (WORKER_DONE, MERGE_READY, MERGED, MERGE_FAILED message types). No .md files for runtime context - beads issues carry task state, mail carries coordination signals.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:50:43.380336-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T14:55:25.842897-08:00","closed_at":"2026-02-12T14:55:25.842897-08:00","close_reason":"Phase 2 complete: supervisor capability added to types, hooks-deployer enforces read-only, supervisor.ts CLI command (start/stop/status), agents/supervisor.md behavioral definition (406 lines). All quality gates pass (499 tests, lint, typecheck).","dependencies":[{"issue_id":"overstory-p6pn","depends_on_id":"overstory-b3u0","type":"blocks","created_at":"2026-02-12T13:51:32.943763-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-p6pn","depends_on_id":"overstory-6dyr","type":"blocks","created_at":"2026-02-12T13:51:33.371829-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-p6pn","depends_on_id":"overstory-rxvu","type":"blocks","created_at":"2026-02-12T13:51:33.512468-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-padg","title":"Write tests for watch command (src/commands/watch.test.ts)","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:04:37.020189-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:08:37.132252-08:00","closed_at":"2026-02-13T08:08:37.132252-08:00","close_reason":"Added comprehensive test suite for watch command with 14 tests covering help display, background mode, PID file operations, and error handling. All quality gates passed."}
{"id":"overstory-pcef","title":"Add project name to tmux session naming convention","description":"Change tmux session names from 'overstory-{agent}' to 'overstory-{projectName}-{agent}' using config.project.name. This prevents cross-project collisions and enables project-scoped cleanup.\n\nTouch points:\n- sling.ts:382 — overstory-${name} → overstory-${projectName}-${name}\n- coordinator.ts:29 — hardcoded TMUX_SESSION constant, needs config.project.name\n- monitor.ts:30 — hardcoded TMUX_SESSION constant, needs config.project.name\n- supervisor.ts:187 — overstory-supervisor-${name} → overstory-${projectName}-supervisor-${name}\n- tmux.ts:5 — update naming convention doc comment\n- clean.ts:129 — filter by 'overstory-{projectName}-' instead of 'overstory-'\n\nNote: coordinator.ts and monitor.ts currently define TMUX_SESSION as a module-level constant. They'll need to compute it after loadConfig() returns the project name, or accept it as a parameter.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T20:19:01.117617-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:34:18.294275-08:00","closed_at":"2026-02-13T20:34:18.294275-08:00","close_reason":"Implemented project-scoped tmux naming across sling, coordinator, monitor, supervisor, clean, and tmux.ts. All tmux sessions now use overstory-{projectName}-{agentName} pattern derived from config.project.name."}
{"id":"overstory-plpq","title":"Update coordinator.md to delegate spec writing to scouts","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:48:24.994953-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:37:06.852134-08:00","closed_at":"2026-02-13T06:37:06.852134-08:00","close_reason":"Updated coordinator.md to delegate spec writing to scouts: added scout-delegated spec pattern (preferred for complex tasks) alongside direct spec writing, updated scout capability description, added cost awareness note","dependencies":[{"issue_id":"overstory-plpq","depends_on_id":"overstory-yiey","type":"blocks","created_at":"2026-02-12T14:48:30.782816-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-pob7","title":"Lead 2: CLI standard commands test coverage (prime, log, watch, worktree)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T07:58:39.515081-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:55:07.56063-08:00","closed_at":"2026-02-13T08:55:07.56063-08:00","close_reason":"Test coverage blitz complete: 830 tests, 0 failures, 42 files. All 17 modules now have test coverage."}
{"id":"overstory-ptia","title":"Cascading waste: lead spawns redundant builders when work lands in root instead of worktree","description":"## Problem\n\nIn the latest coordinator run, the cascading failure went:\n\n1. Orchestrator dispatched steelman task to lead-steelman (20:54)\n2. Lead spawned builder-steelman (20:56) to create STEELMAN.md and edit README.md\n3. builder-steelman wrote both files to the CANONICAL REPO ROOT instead of its worktree\n4. Lead couldn't see any commits on builder-steelman's branch (because there were none in the worktree)\n5. Lead concluded builder-steelman failed and spawned builder-steelman-2 (21:00)\n6. Lead even explicitly warned builder-2: 'The previous builder wrote files to the main repo instead of its worktree'\n7. builder-steelman was marked zombie, builder-steelman-2 continued — likely hitting the same root-write problem\n\n## Impact\n\n- Double the agent sessions (2 builders instead of 1) = doubled token cost\n- builder-steelman went zombie with no useful output on its branch\n- Root repo polluted with untracked files (STEELMAN.md) and unstaged modifications (README.md)\n- No useful work on ANY agent branch — all three worktrees have zero commits\n- Lead wasted tokens diagnosing the problem and re-dispatching\n\n## Root Cause Chain\n\n1. No path boundary enforcement (see overstory-4200, overstory-loa7)\n2. No worktree path in overlay instructions (see overstory-sv0q)\n3. Claude Code resolves file paths from project root, not tmux cwd\n4. Lead has no mechanism to PREVENT builders from writing to root — only advisory text\n\n## This issue is a symptom — blocked by\n\n- overstory-4200 (Write/Edit path boundary guard)\n- overstory-loa7 (Bash path boundary guard)\n- overstory-sv0q (overlay worktree path + constraints)\n\nFixing the three dependency issues eliminates this cascading failure mode entirely.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:03:55.147119-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T14:42:42.523851-08:00","closed_at":"2026-02-13T14:42:42.523851-08:00","close_reason":"All 3 root cause issues (overstory-4200 path boundary guard, overstory-loa7 bash guard, overstory-sv0q overlay constraints) are closed. The cascading waste symptom is eliminated.","dependencies":[{"issue_id":"overstory-ptia","depends_on_id":"overstory-4200","type":"blocks","created_at":"2026-02-13T13:03:59.36304-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-ptia","depends_on_id":"overstory-loa7","type":"blocks","created_at":"2026-02-13T13:03:59.504633-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-ptia","depends_on_id":"overstory-sv0q","type":"blocks","created_at":"2026-02-13T13:03:59.65039-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-pvn7","title":"Daemon integration tests (startDaemon loop, session load/save, escalation)","description":"Add integration tests for the full daemon loop in daemon.test.ts. Test: (1) tick with no sessions file (graceful no-op), (2) tick with healthy sessions (no state changes), (3) tick with dead tmux → zombie transition + termination, (4) tick with stalled agent → escalation flow, (5) session persistence round-trip (load → modify → save → reload). Use real temp directories and real SQLite. Mock only tmux operations (isSessionAlive, killSession) since real tmux interferes with dev sessions.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T06:51:37.377415-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T07:00:42.648051-08:00","closed_at":"2026-02-13T07:00:42.648051-08:00","close_reason":"Added 18 daemon integration tests in src/watchdog/daemon.test.ts covering: no sessions file no-op, healthy sessions, dead tmux zombie transition, progressive nudging escalation (levels 0-3), triage integration with tier1Enabled toggle, agent recovery reset, session persistence round-trip, backward compatibility for pre-escalation sessions. Used DI for tmux/triage/nudge instead of mock.module()."}
{"id":"overstory-pz8y","title":"Add overstory logs command for cross-agent log querying","description":"New CLI command to query NDJSON logs across agents. Support: --agent X, --level error, --since 1h, --follow. Unified timeline view from logs scattered across .overstory/logs/{agent-name}/{session-timestamp}/ directories.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:29.463653-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:16:38.49758-08:00","closed_at":"2026-02-16T13:16:38.49758-08:00","close_reason":"Implemented overstory logs command via 3 builders: logs.ts (impl), index.ts+completions.ts (wiring), logs.test.ts (11 tests). All branches ready for merge. Note: completions.test.ts needs 26-\u003e27 update post-merge."}
{"id":"overstory-pzds","title":"Tier 2 monitor agent — continuous patrol definition and command","description":"Define a new monitor agent capability for long-running patrol. Create agents/monitor.md with: continuous monitoring of all active supervisors and workers, mail-based lifecycle requests (respawn, restart, cycle), periodic health summaries sent to orchestrator via mail. Add overstory monitor start/stop/status subcommands (similar to coordinator). The monitor agent runs at project root (no worktree, like coordinator) and uses overstory mail + nudge for all interactions.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T06:51:30.384385-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T07:03:33.664682-08:00","closed_at":"2026-02-13T07:03:33.664682-08:00","close_reason":"Created agents/monitor.md (Tier 2 patrol agent definition), src/commands/monitor.ts (start/stop/status), added to agent-manifest.json, hooks-deployer.ts (NON_IMPLEMENTATION + COORDINATION sets), and CLI router"}
{"id":"overstory-q1dp","title":"Add unified agent activity feed","description":"New command: 'overstory feed' for a unified real-time event stream across all agents. Like 'tail -f' for the whole fleet. Currently 'overstory inspect --follow' is per-agent only.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:37.343435-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:59:07.999795-08:00","closed_at":"2026-02-16T13:59:07.999795-08:00","close_reason":"Implemented overstory feed command: unified real-time event stream across all agents. Created src/commands/feed.ts (362 lines) with --follow/-f live tailing, --agent/--run/--since/--limit/--interval/--json flags. 32 tests passing in feed.test.ts. Wired into index.ts and completions.ts. Two branches ready for merge: feed-builder and feed-wiring-builder."}
{"id":"overstory-q4nb","title":"Add explicit Task tool prohibition and workaround heuristic to coordinator/supervisor agent definitions","description":"coordinator.md and supervisor.md list available tools and workflows but never explicitly prohibit Claude Code built-in Task/TeamCreate/SendMessage tools. The model gravitates toward Task because it is familiar and always present. Fix: (1) Add to Constraints: NEVER use Claude Code built-in Task, TeamCreate, SendMessage, or any native subagent tools. ALL delegation MUST go through overstory sling. (2) Add Failure Mode: NATIVE_DELEGATION — Using Task tool instead of overstory sling. (3) Add Workaround Heuristic: If you find yourself reaching for workarounds (bun -e to edit, manual file writes, piping through bash) STOP. You are doing implementation work that should be delegated via overstory sling to a builder in a worktree. The coordinator never needs workarounds because it never touches code.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T06:20:50.645213-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:31:53.163487-08:00","closed_at":"2026-02-13T06:31:53.163487-08:00","close_reason":"Added explicit Task tool prohibition, NATIVE_DELEGATION failure mode, and workaround heuristic to coordinator.md and supervisor.md. Both agents now have clear behavioral guidance to use overstory sling instead of Claude Code native tools."}
{"id":"overstory-q9qk","title":"Lead agent stays alive after sending worker_done — no self-termination","description":"## Problem\n\nlead-steelman sent worker_done mail at 21:04:48 but its tmux session is still alive. The lead should either:\n1. Self-terminate after sending worker_done (the builder.md completion protocol says 'Exit. Do NOT idle')\n2. Be torn down by the orchestrator after receiving worker_done\n\nCurrently neither happens. The lead's tmux session stays running, consuming resources.\n\n## Evidence\n\n- overstory status shows lead-steelman still active in 'working' state\n- tmux has-session confirms the session is alive\n- lead sent worker_done 10+ minutes ago\n\n## Root Cause\n\nThe lead.md base definition likely doesn't have the same strict 'Exit after completion' protocol that builder.md has. And the orchestrator isn't processing the worker_done message to trigger teardown (see sibling issue about orchestrator not being nudged).\n\n## Solution\n\n1. lead.md should include explicit self-termination after worker_done (same as builder.md's 'Exit. Do NOT idle')\n2. Orchestrator should tear down agents after receiving worker_done (overstory worktree clean or direct tmux kill)\n3. Both mechanisms should exist as defense-in-depth","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:06:17.241674-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:36:20.884254-08:00","closed_at":"2026-02-15T12:36:20.884254-08:00","close_reason":"Updated agents/lead.md Completion Protocol to send worker_done mail instead of merge_ready, added explicit exit instruction, and added MISSING_WORKER_DONE and POST_CLOSE_IDLE failure modes"}
{"id":"overstory-q9v1","title":"Deploy sandbox settings in hooks-deployer.ts","description":"Modify deployHooks() in hooks-deployer.ts to write sandbox configuration into the settings.local.json deployed to each agent worktree. When sandbox.enabled is true in overstory config, add the sandbox block: { enabled: true, autoAllowBashIfSandboxed: true, allowUnsandboxedCommands: false, network: { allowedDomains: [...from config...] } }. The denyReadPaths from config should map to Claude Code's sandbox filesystem deny rules. When sandbox.enabled is false, omit the sandbox block entirely (current behavior). The hooks-deployer already writes .claude/settings.local.json — this extends the existing mechanism.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:22:31.410325-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:32:07.476617-08:00","closed_at":"2026-02-15T12:32:07.476617-08:00","close_reason":"Sandbox integration complete - all code + tests implemented and passing","dependencies":[{"issue_id":"overstory-q9v1","depends_on_id":"overstory-lu8k","type":"blocks","created_at":"2026-02-13T22:22:41.041115-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-q9v1","depends_on_id":"overstory-i9be","type":"blocks","created_at":"2026-02-13T22:22:41.356838-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-q9xo","title":"Implement overstory run CLI command","description":"New src/commands/run.ts with subcommands, wire into index.ts, add tests","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T19:20:51.362334-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:39:38.684109-08:00","closed_at":"2026-02-13T20:39:38.684109-08:00","close_reason":"Implemented run command with list/show/complete subcommands, registered in CLI router, wrote tests","dependencies":[{"issue_id":"overstory-q9xo","depends_on_id":"overstory-e9d3","type":"blocks","created_at":"2026-02-13T19:21:01.989832-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-qc7t","title":"Review: lead.md mandatory review loop changes","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:07:39.210623-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:12:46.859236-08:00","closed_at":"2026-02-16T13:12:46.859236-08:00","close_reason":"Review completed - false FAIL due to reviewer checking its own worktree instead of builder branch. Manual verification confirms all changes applied correctly."}
{"id":"overstory-qd3n","title":"Make model configurable for coordinator, supervisor, and monitor agents","description":"coordinator.ts, supervisor.ts, and monitor.ts hardcode their Claude model (opus/opus/sonnet) instead of reading from agent-manifest.json or config. sling.ts already reads agentDef.model correctly for regular workers. Fix: have the 3 persistent agent commands read from manifest/config instead of hardcoding. Add missing supervisor and monitor entries to agent-manifest.json. Optionally add a models: section to config.yaml for user overrides. ~20-30 lines for minimal fix, ~100 lines for full config support. See GitHub issue #6.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-17T06:11:31.941305-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:05:30.181583-08:00","closed_at":"2026-02-17T07:05:30.181583-08:00","close_reason":"Implemented configurable model selection for coordinator, supervisor, and monitor agents. Added models: section to config.yaml, supervisor/monitor entries to manifest, resolveModel() helper. Resolution: config \u003e manifest \u003e fallback. GH issue #6."}
{"id":"overstory-qfln","title":"Update config validation for providers and extended model refs","description":"Update validateConfig() in config.ts to handle the new providers section and extended model references.\n\nFILES: src/config.ts\n\nChanges:\n- Validate providers section: each provider must have a valid type ('native' or 'gateway'), gateway providers require baseUrl and authTokenEnv\n- Validate models section: allow both simple aliases ('sonnet','opus','haiku') and provider-prefixed strings ('openrouter/openai/gpt-5.3')\n- For provider-prefixed model refs, validate that the referenced provider exists in the providers section\n- Warn (not error) when a non-Anthropic model is assigned to a tool-heavy role (builder, scout) since tool-use compat can't be verified at config time\n- Remove the hardcoded validModels=['sonnet','opus','haiku'] gate at lines 420-429, replace with richer validation","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:13:40.48878-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T07:32:53.477781-08:00","closed_at":"2026-02-20T07:32:53.477781-08:00","close_reason":"Completed config validation update. Spawned config-validator-builder which added provider validation (type native/gateway, gateway requires baseUrl+authTokenEnv) and replaced hardcoded model aliases with provider-prefixed ref support. Stderr warning for non-Anthropic models in builder/scout roles. 9 new tests, all 44 pass.","dependencies":[{"issue_id":"overstory-qfln","depends_on_id":"overstory-rgst","type":"blocks","created_at":"2026-02-19T12:14:11.44962-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-qn3h","title":"Enable score-aware priming via --sort-by-score","description":"Add sortByScore option to MulchClient.prime() in src/mulch/client.ts and pass --sort-by-score flag to mulch CLI. Default to true in src/commands/sling.ts when pre-loading file-scoped expertise for spawned agents. This ensures agents receive the most battle-tested records first when token budget is tight, leveraging mulch 0.4.3's confirmation-frequency scoring.","notes":"Bumped from P2→P1. Builders never prime themselves — the overlay is their only expertise source. Score-aware sorting ensures the best records survive budget truncation.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-20T12:49:40.172836-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:19:25.813201-08:00","closed_at":"2026-02-20T13:19:25.813201-08:00","close_reason":"Added search() options (file, sortByScore) and record() outcome flags (outcomeStatus, outcomeDuration, outcomeTestResults, outcomeAgent) to MulchClient. 45 tests pass."}
{"id":"overstory-qne","title":"Sling launches interactive claude instead of headless -p mode","description":"sling.ts line 310 runs 'claude --dangerously-skip-permissions' in interactive mode, then tries sendKeys to submit the initial prompt. The Claude Code welcome screen blocks input, causing agents to get stuck. Fix: use 'claude -p \u003cprompt\u003e' for headless execution.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:46:54.440719-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:56:58.596219-08:00","closed_at":"2026-02-12T10:56:58.596219-08:00","close_reason":"Fixed: sling now uses 'claude -p' headless mode instead of interactive mode with sendKeys. Removes sendKeys step entirely, baking the prompt into the command."}
{"id":"overstory-qpdn","title":"Validate overstory status monitoring during agent lifecycle","description":"While agent runs, verify overstory status shows agent as active with correct state. After agent finishes, verify status transitions to completed/zombie. Check that tmux reconciliation logic works.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:57:42.2969-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:19:58.374386-08:00","closed_at":"2026-02-12T13:19:58.374386-08:00","close_reason":"Validated overstory status with --json and human-readable output. Shows agents, worktrees, tmux sessions, mail, merge queue counts correctly.","dependencies":[{"issue_id":"overstory-qpdn","depends_on_id":"overstory-rnqn","type":"blocks","created_at":"2026-02-12T12:58:31.973668-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-qqnv","title":"Verify and fix template resolution for external projects","description":"overlay.ts and hooks-deployer.ts read template files (overlay.md.tmpl, hooks.json.tmpl). These must resolve from overstory's installation directory, not from the target project's cwd. Verify how paths are resolved - fix if broken. Related to template resolution task in phase 1 but specifically for external projects.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:57:49.443545-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:01:21.998251-08:00","closed_at":"2026-02-12T13:01:21.998251-08:00","close_reason":"Verified: overlay.ts:10-12 and hooks-deployer.ts:24-26 use import.meta.dir to resolve template paths relative to overstory source, not process.cwd(). Config resolveProjectRoot() also handles worktree resolution. No fix needed."}
{"id":"overstory-qqr4","title":"Dashboard crashes: String.prototype.repeat argument must be \u003e= 0 and not Infinity","description":"The `overstory dashboard` command crashes with:\n\n```\nError: String.prototype.repeat argument must be greater than or equal to 0 and not be Infinity\n```\n\nThis likely occurs when a calculated column width or padding value is negative or Infinity, possibly due to terminal width calculations or when agent name/status strings exceed expected bounds. The repeat() call in the TUI rendering logic needs to clamp its argument to Math.max(0, n).","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:43:10.073063-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T08:03:35.506832-08:00","closed_at":"2026-02-20T08:03:35.506832-08:00","close_reason":"All .repeat() calls in dashboard.ts now guarded with Math.max(0, ...). Added early-return guards in pad() and truncate(). 12 edge-case tests added."}
{"id":"overstory-qs85","title":"Write sanitizer.test.ts for src/logging/sanitizer.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:04:57.059708-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:32:05.323934-08:00","closed_at":"2026-02-13T09:32:05.323934-08:00","close_reason":"Test files already written and committed"}
{"id":"overstory-quik","title":"Doctor: version and update check","description":"Check if overstory is up to date (once published to npm).\n\nChecks:\n- Read current version from package.json or src/index.ts VERSION constant\n- Query npm registry: 'npm view overstory version' (or whatever the package name will be)\n- Compare versions using semver logic\n- If outdated, warn with: 'Update available: X.Y.Z → A.B.C. Run: npm update -g overstory'\n- Graceful degradation: if npm registry unreachable, report 'unable to check' and pass\n\nThis mirrors mulch's approach in src/commands/doctor.ts (lines 209-223) and src/utils/version.ts.\n\nImplementation:\n- Create src/utils/version.ts with getCurrentVersion(), getLatestVersion(), compareSemver()\n- Reuse these in both doctor and a future 'overstory update' command\n\nSource references (mulch pattern):\n- /Users/jayminwest/Projects/mulch/src/utils/version.ts — version utilities\n- /Users/jayminwest/Projects/mulch/src/commands/doctor.ts lines 209-223 — update check in doctor\n\nOutput: pass/warn. Outdated = warn. Registry unreachable = pass with note. This is Tier 3.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:00:02.828031-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:49:03.90798-08:00","closed_at":"2026-02-15T12:49:03.90798-08:00","close_reason":"Implemented dependency, version, and config health checks with comprehensive test coverage. All quality gates pass.","dependencies":[{"issue_id":"overstory-quik","depends_on_id":"overstory-m55s","type":"blocks","created_at":"2026-02-13T22:00:19.384885-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-qun","title":"sessions.json grows unbounded - no cleanup of zombie entries","description":"sessions.json accumulates all agent sessions (including zombies) indefinitely. There's no mechanism to prune old zombie entries. Over time with many sling cycles, this file will grow. Should add a cleanup mechanism - either 'overstory sessions prune' command, or auto-prune zombies older than a threshold, or move zombies to a separate history file.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:19:29.245975-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:44:44.296082-08:00","closed_at":"2026-02-12T08:44:44.296082-08:00","close_reason":"worktree clean now prunes zombie entries from sessions.json whose worktree paths no longer exist on disk"}
{"id":"overstory-qwyv","title":"Fix dashboard DB connection churn (retry): hold stores open for poll loop","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T08:13:39.132718-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T08:23:28.356198-08:00","closed_at":"2026-02-20T08:23:28.356198-08:00","close_reason":"Fixed dashboard DB connection churn: PreOpenedStores interface + gatherStatus 5th param, openDashboardStores/closeDashboardStores helpers in dashboard.ts, poll loop opens stores once and closes on SIGINT/finally. Backward-compatible. All quality gates pass."}
{"id":"overstory-qxwc","title":"Monitor agent: mulch domain health checks via enriched status --json","description":"The Tier 2 monitor agent already patrols fleet health. Extend it to check mulch domain health using the enriched mulch status --json output (governance utilization, stale counts, type/classification distribution). Warn when domains approach governance limits. Suggest pruning or compaction when stale counts are high. Natural extension of the monitor's existing patrol loop.","status":"open","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:42:26.932182-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T21:42:26.932182-08:00","dependencies":[{"issue_id":"overstory-qxwc","depends_on_id":"overstory-j53z","type":"blocks","created_at":"2026-02-13T21:42:32.628239-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-r2nk","title":"Add unmerged branch safety check to worktree clean","description":"Add isBranchMerged to manager.ts, add --force flag to worktree clean command, warn/skip unmerged branches without --force, tests for both","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T16:33:16.06798-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T16:41:12.486717-08:00","closed_at":"2026-02-18T16:41:12.486717-08:00","close_reason":"Added isBranchMerged() to manager.ts. worktree clean now skips unmerged branches by default with clear warnings, requires --force to delete them. Tests cover merged, unmerged, and JSON output scenarios."}
{"id":"overstory-r39g","title":"Fix mock.module() leakage in consistency.test.ts","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T14:14:07.967675-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T14:24:00.8537-08:00","closed_at":"2026-02-15T14:24:00.8537-08:00","close_reason":"Consistency test DI refactor complete (8d52688), doctor tests already fixed (420d8b7)"}
{"id":"overstory-r4ki","title":"Update scout.md to include spec-writing workflow","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:48:23.900469-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:26:41.411897-08:00","closed_at":"2026-02-13T06:26:41.411897-08:00","close_reason":"Updated agents/scout.md with spec-writing workflow. Added overstory spec write to tools, bd create for issue filing, a Spec-Writing Workflow subsection under Workflow, clarified constraints to allow spec writing as the one exception, added SPEC_WITHOUT_ISSUE failure mode, and updated Completion Protocol to include spec creation step.","dependencies":[{"issue_id":"overstory-r4ki","depends_on_id":"overstory-yiey","type":"blocks","created_at":"2026-02-12T14:48:30.633139-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-r8a","title":"init --force doesn't preserve/migrate existing SQLite data (mail.db, metrics.db)","description":"Running overstory init --force reinitializes config files (config.yaml, agent-manifest.json, hooks.json) and recreates directories, but it doesn't warn that existing mail.db and metrics.db data will be orphaned. The DBs themselves survive (they're not deleted), but re-running init after the DBs exist means the new init doesn't check compatibility. If the schema ever changes, init --force won't migrate. Consider either: (1) adding a warning about existing data, (2) running schema migration on init, or (3) documenting this as expected behavior.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T09:41:31.601869-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:50:55.889866-08:00","closed_at":"2026-02-12T09:50:55.889866-08:00","close_reason":"init --force now runs schema migration on existing mail.db and metrics.db. Opens each DB, enables WAL mode, re-runs CREATE TABLE/INDEX IF NOT EXISTS to apply any schema additions without losing existing data. Prints migration status."}
{"id":"overstory-r93n","title":"Mulch maintenance in overstory clean","description":"Add mulch health checks to overstory clean. Report domains approaching governance limits (warn threshold). Run mulch prune --dry-run and report stale record counts. Run mulch doctor and report issues. All informational by default, not destructive. Uses expanded MulchClient.prune() and .doctor().","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:08:40.066579-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:41:50.83171-08:00","closed_at":"2026-02-15T12:41:50.83171-08:00","close_reason":"Mulch health checks in overstory clean: checkMulchHealth() with status/prune/doctor, informational output on --all flag. Committed f4d9210.","dependencies":[{"issue_id":"overstory-r93n","depends_on_id":"overstory-j53z","type":"blocks","created_at":"2026-02-13T21:08:50.286732-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-r9g","title":"L2-1: Implement overlay generator (src/agents/overlay.ts)","description":"Generate per-worker CLAUDE.md overlay from template. Functions: generateOverlay(config: OverlayConfig) -\u003e string, writeOverlay(worktreePath, config) -\u003e Promise\u003cvoid\u003e. Reads templates/overlay.md.tmpl, fills variables, writes to {worktree}/.claude/CLAUDE.md.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:41.648364-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:33:09.513247-08:00","closed_at":"2026-02-12T07:33:09.513247-08:00","close_reason":"All L2 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-r9g","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:40.659473-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-ra2z","title":"Coordinator cannot spawn agents in Claude Code sandbox mode","description":"overstory sling fails with 'error connecting to /private/tmp/tmux-501/default (Operation not permitted)' when run inside Claude Code sandbox. The sandbox blocks tmux socket access, preventing the coordinator from spawning any agents. This makes the entire swarm system non-functional when the coordinator runs inside Claude Code. Need to either: (a) document that coordinator must run outside sandbox, (b) add tmux socket path to sandbox allowlist in hooks/init, or (c) provide a non-tmux agent spawning backend.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T13:45:38.817592-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T13:57:25.081452-08:00","closed_at":"2026-02-15T13:57:25.081452-08:00","close_reason":"Removed sandbox config feature from overstory. PreToolUse hook guards are the real security layer. Backlog issue overstory-toyn tracks future revisit."}
{"id":"overstory-rbj","title":"[Epic] Layer 2: Agent Lifecycle + Mail","description":"Agent lifecycle management and mail system. 7 parallel tasks. Depends on Layer 1 completion.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:37.127858-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:33:22.806001-08:00","closed_at":"2026-02-12T07:33:22.806001-08:00","close_reason":"All 7 L2 subtasks completed","dependencies":[{"issue_id":"overstory-rbj","depends_on_id":"overstory-r9g","type":"blocks","created_at":"2026-02-12T07:12:13.74256-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rbj","depends_on_id":"overstory-vm0","type":"blocks","created_at":"2026-02-12T07:12:13.868048-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rbj","depends_on_id":"overstory-2ed","type":"blocks","created_at":"2026-02-12T07:12:14.000538-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rbj","depends_on_id":"overstory-gvw","type":"blocks","created_at":"2026-02-12T07:12:14.13539-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rbj","depends_on_id":"overstory-my8","type":"blocks","created_at":"2026-02-12T07:12:14.263641-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rbj","depends_on_id":"overstory-co8","type":"blocks","created_at":"2026-02-12T07:12:14.394936-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rbj","depends_on_id":"overstory-lkp","type":"blocks","created_at":"2026-02-12T07:12:14.52104-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-rbqc","title":"Update agent protocols: INSIGHT prefix for read-only agents, clean merge skip for merger","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T17:28:17.738181-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T17:32:21.247873-08:00","closed_at":"2026-02-16T17:32:21.247873-08:00","close_reason":"Updated agent completion protocols: scout/reviewer use INSIGHT prefix instead of mulch record (read-only), merger skips mulch record for clean Tier 1 merges. All acceptance criteria met."}
{"id":"overstory-rdd","title":"Test depth limit","description":"Temporary test task for depth limit testing","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:16:53.488036-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:23:25.843231-08:00","closed_at":"2026-02-12T08:23:25.843231-08:00","close_reason":"Test tasks created during integration testing, not real work"}
{"id":"overstory-rdo","title":"[Epic] Layer 5: Tests","description":"All test files. 11 parallel tasks. Can run in parallel with Layers 3-4. Depends on Layer 2 completion.","status":"closed","priority":4,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:22.489209-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:56:38.532666-08:00","closed_at":"2026-02-12T07:56:38.532666-08:00","close_reason":"All 11 test files written and passing (238 tests, 505 assertions)","dependencies":[{"issue_id":"overstory-rdo","depends_on_id":"overstory-tdp","type":"blocks","created_at":"2026-02-12T07:12:40.394124-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rdo","depends_on_id":"overstory-6ka","type":"blocks","created_at":"2026-02-12T07:12:41.198087-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rdo","depends_on_id":"overstory-3wa","type":"blocks","created_at":"2026-02-12T07:12:42.407043-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rdo","depends_on_id":"overstory-nup","type":"blocks","created_at":"2026-02-12T07:12:43.27148-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rdo","depends_on_id":"overstory-uh0","type":"blocks","created_at":"2026-02-12T07:12:44.257265-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rdo","depends_on_id":"overstory-dfc","type":"blocks","created_at":"2026-02-12T07:12:45.116103-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rdo","depends_on_id":"overstory-38d","type":"blocks","created_at":"2026-02-12T07:12:45.906899-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rdo","depends_on_id":"overstory-ewe","type":"blocks","created_at":"2026-02-12T07:12:46.656632-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rdo","depends_on_id":"overstory-oia","type":"blocks","created_at":"2026-02-12T07:12:47.435775-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rdo","depends_on_id":"overstory-fsh","type":"blocks","created_at":"2026-02-12T07:12:48.306522-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rdo","depends_on_id":"overstory-a28","type":"blocks","created_at":"2026-02-12T07:12:49.850474-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-rgst","title":"Add provider types and config schema","description":"Extend types.ts and config.ts to support a providers section and extended model references.\n\nFILES: src/types.ts, src/config.ts\n\nTypes changes (src/types.ts):\n- Add ProviderConfig interface: { type: 'native' | 'gateway'; baseUrl?: string; authTokenEnv?: string }\n- Add to OverstoryConfig: providers: Record\u003cstring, ProviderConfig\u003e\n- Change ModelRef: allow string (backward-compat alias like 'sonnet') OR 'provider/model' string format (e.g. 'openrouter/openai/gpt-5.3')\n- Keep ModelAlias type ('sonnet'|'opus'|'haiku') for backward compat\n\nConfig changes (src/config.ts):\n- Add DEFAULT_CONFIG.providers: { anthropic: { type: 'native' } }\n- Parse providers section from config.yaml and config.local.yaml\n- Merge providers across config layers (local overrides base)\n\nBackward compat: empty providers section = current behavior (Anthropic only). Simple model strings ('sonnet') still work.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:13:34.910901-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:50:45.262705-08:00","closed_at":"2026-02-19T12:50:45.262705-08:00","close_reason":"Provider types and config schema implemented. ModelAlias, ModelRef, ProviderConfig types added. Config.ts parses providers section. All fixtures updated. 1911 tests, typecheck clean."}
{"id":"overstory-rhk5","title":"Mulch integration improvements: priming, search, recording, overlay","description":"Umbrella for mulch integration batch. Covers 4 sub-issues: (1) overstory-qn3h P1 sort-by-score in client.ts + sling.ts, (2) overstory-0fuu P1 auto-detect domains in sling.ts, (3) overstory-4jca P3 --file filter in client.ts search(), (4) overstory-vs8z P3 outcome recording flags in client.ts + overlay.ts + agents/*.md. File area: src/mulch/client.ts, src/mulch/client.test.ts, src/commands/sling.ts, src/commands/sling.test.ts, src/agents/overlay.ts, agents/*.md. Acceptance: all 4 sub-issues closed, quality gates pass, branch ready to merge.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-20T13:14:05.568731-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:28:19.046465-08:00","closed_at":"2026-02-20T13:28:19.046465-08:00","close_reason":"Mulch integration batch complete: (1) search() file+sortByScore options in client.ts, (2) auto-detect domains from file scope in sling.ts, (3) --file filter for search in client.ts, (4) outcome flags in record() + overlay quality gates + agent defs. 3 builders, 3 reviewers, all PASS. 3 branches ready to merge."}
{"id":"overstory-rhlb","title":"Update lead.md: mandatory review loop after builder completion","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:03:17.055243-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:12:45.294229-08:00","closed_at":"2026-02-16T13:12:45.294229-08:00","close_reason":"Builder completed all 4 edits to agents/lead.md: mandatory review loop, REVIEW_SKIP failure mode, completion protocol update, constraints update. Tests pass."}
{"id":"overstory-rinz","title":"Write tests for prime command (src/commands/prime.test.ts)","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:04:34.684569-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:09:31.926325-08:00","closed_at":"2026-02-13T08:09:31.926325-08:00","close_reason":"Added comprehensive test coverage for prime command with 18 test cases covering help flags, orchestrator priming, agent priming, error handling, and mulch integration. All quality gates pass."}
{"id":"overstory-rj1k","title":"Implement trace command (src/commands/trace.ts)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T19:21:22.931606-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:31:38.635567-08:00","closed_at":"2026-02-13T20:31:38.635567-08:00","close_reason":"Implemented trace command with agent/bead resolution, timeline formatting, JSON output, and time/limit filtering"}
{"id":"overstory-rn0f","title":"Migrate coordinator.ts + test to SessionStore","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T14:56:44.777927-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T19:16:13.147429-08:00","closed_at":"2026-02-13T19:16:13.147429-08:00","close_reason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed."}
{"id":"overstory-rnqn","title":"Sling a real builder agent and validate full lifecycle","description":"Create a beads issue for a trivial task, write a minimal spec, run overstory sling with --capability builder. Observe: tmux session starts, Claude boots, reads overlay, does work, commits, closes bead. This is the critical e2e validation.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:57:40.496735-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:10:14.577591-08:00","closed_at":"2026-02-12T13:10:14.577591-08:00","close_reason":"Full E2E lifecycle validated: sling -\u003e tmux boot -\u003e overlay read -\u003e mulch prime -\u003e spec read -\u003e implement -\u003e quality gates (test/lint/typecheck) -\u003e commit -\u003e bd close -\u003e mail send. Two bugs filed: overstory-y2ob (beacon sendKeys multiline not auto-submitting, P1) and overstory-ff2s (biome/tsc not on PATH in worktree, P2).","dependencies":[{"issue_id":"overstory-rnqn","depends_on_id":"overstory-6ueu","type":"blocks","created_at":"2026-02-12T12:58:29.809382-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-ru1f","title":"Replace overstory status --watch with overstory dashboard","description":"Replace 'overstory status --watch' with 'overstory dashboard' — a rich ANSI TUI for humans. Agents keep using 'overstory status --json' programmatically, humans get the live experience.\n\nCurrent status --watch is a simple clear+repoll of the same static text. Dashboard should feel like htop for agent swarms: color-coded panels, live activity, real-time metrics.\n\nData sources already available: sessions.json, tmux, mail.db, merge-queue.json, metrics.db, worktrees. Zero runtime deps rule means raw ANSI escape codes (no blessed/ink).\n\nSub-issues track the breakdown.","status":"closed","priority":4,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:35:09.593283-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T07:26:32.059053-08:00","closed_at":"2026-02-13T07:26:32.059053-08:00","close_reason":"Dashboard feature complete: overstory dashboard replaces status --watch with rich ANSI TUI"}
{"id":"overstory-rurd","title":"Fix noImplicitAnyLet in merge-queue.ts:41","description":"Add type annotation to 'let tableCheck;' on line 41 of src/doctor/merge-queue.ts. Change to 'let tableCheck: unknown;' to fix biome noImplicitAnyLet lint error.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-16T07:38:05.797945-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:43:27.650271-08:00","closed_at":"2026-02-16T07:43:27.650271-08:00","close_reason":"Fixed biome lint and formatting issues across all three files"}
{"id":"overstory-rvv4","title":"Test: dashboard command (help, validation, data loading)","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:21:45.252116-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:26:12.235729-08:00","closed_at":"2026-02-13T08:26:12.235729-08:00","close_reason":"Added dashboard.test.ts with help and validation tests"}
{"id":"overstory-rxvu","title":"Phase 1: Coordinator agent (persistent orchestrator)","description":"Implement a persistent coordinator agent that runs as its own Claude Code session (via tmux). This is the 'brain' of the system - it receives work requests, decomposes them into subtasks, creates beads issues, dispatches workers via overstory sling, and tracks completion. Key design decisions: (1) Runs at project-root level with cross-project visibility via beads routing, (2) Cannot implement code - structurally enforced via tool restrictions (not just .md instructions), (3) Creates task groups (batches of related beads) and auto-closes when all tracked issues complete, (4) Receives escalations from supervisors and watchdog, (5) Context passed via beads + mail, NOT .md overlay files. Subsystems: coordinator lifecycle management, task group tracking, strategic dispatch logic, escalation routing with severity levels.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:50:38.641934-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T14:29:11.035718-08:00","closed_at":"2026-02-12T14:29:11.035718-08:00","close_reason":"Implemented Phase 1 coordinator agent: new 'coordinator' capability type, agents/coordinator.md definition, 'overstory coordinator start|stop|status' CLI command, structural tool enforcement (read-only), manifest integration, 33 new tests, all 499 tests passing","dependencies":[{"issue_id":"overstory-rxvu","depends_on_id":"overstory-b3u0","type":"blocks","created_at":"2026-02-12T13:51:32.808243-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rxvu","depends_on_id":"overstory-6dyr","type":"blocks","created_at":"2026-02-12T13:51:33.227027-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-rxvu","depends_on_id":"overstory-7y1l","type":"blocks","created_at":"2026-02-12T13:51:33.919775-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-ryp0","title":"Add root-user guard to 4 spawn commands","description":"Add process.getuid?.() === 0 check early in sling, coordinator start, supervisor start, monitor start that throws a clear error before tmux creation","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T16:46:43.295589-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T16:51:57.907368-08:00","closed_at":"2026-02-18T16:51:57.907368-08:00","close_reason":"Added isRunningAsRoot() pure function to sling.ts (exported, injectable getuid for testability). Applied root-user guard before loadConfig() in sling, coordinator, supervisor, and monitor spawn commands. AgentError thrown with clear message on UID 0. Tests added in all 4 test files. All quality gates pass."}
{"id":"overstory-s1w","title":"Scout: audit error handling in mail commands","description":"Read-only audit of error handling patterns in src/commands/mail.ts. Report findings.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:03:09.915969-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:04:29.256422-08:00","closed_at":"2026-02-12T12:04:29.256422-08:00","close_reason":"Completed read-only audit of error handling in src/commands/mail.ts. Found 2 bugs (P2: empty string flag validation, P3: fragile positional ID extraction in read/reply) and 4 observations (agent name validation, DB path existence, store/client asymmetry in purge, positive note on error type structure). Results sent via mail to orchestrator."}
{"id":"overstory-sbto","title":"Add shared blackboard system","description":"New SQLite-backed shared knowledge base where agents post/read by topic. 'overstory blackboard post --topic api-design --content ...' and 'overstory blackboard read --topic api-design'. Any agent can contribute to any topic. Design: blackboard gives high-level context, agents can drill into mulch for deeper explanation when referenced. The prompting for agents should guide them to check mulch for more detail when blackboard entries reference expertise domains.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:32.410715-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T17:16:32.90319-08:00","closed_at":"2026-02-15T17:16:32.90319-08:00","close_reason":"Decided the blackboard system isn't needed — existing mail + mulch provide sufficient shared context for agents"}
{"id":"overstory-sgy6","title":"Enforce reviewer-after-builder workflow in lead agents","description":"Leads consistently skip Phase 3 (Review) — only 2 reviewers spawned out of ~98 builder completions. REVIEW_SKIP failure mode exists in lead.md but is being ignored. Fix: (1) Strengthen review requirement language from descriptive to imperative, (2) Consider structural enforcement — require reviewer PASS reference before merge_ready can be sent, (3) Add explicit language that cost of skipping review exceeds cost of reviewer agent, (4) Track reviewer spawns per lead in metrics for observability.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:34:04.201712-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T08:13:02.213393-08:00","closed_at":"2026-02-17T08:13:02.213393-08:00","close_reason":"Enforced reviewer-after-builder workflow in lead agents via 3 changes: (1) Strengthened lead.md Phase 3 language from descriptive to imperative with production data (2/98 reviews), cost comparisons, and new constraint. (2) Added structural enforcement in mail.ts — merge_ready sends now check SessionStore for reviewer coverage and warn on stderr. (3) Added reviewer-coverage doctor consistency check for observability. All 3 builders reviewed and passed."}
{"id":"overstory-smkc","title":"Add scout-before-builder warning in sling.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:38:47.034491-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:51:34.615901-08:00","closed_at":"2026-02-17T07:51:34.615901-08:00","close_reason":"All subtasks complete. lead.md updated with scout-first enforcement. sling.ts has scout-before-builder warning."}
{"id":"overstory-so0b","title":"Reframe lead agent identity: coordinator-not-doer, encourage delegation","description":"The lead agent definition (agents/lead.md) currently allows leads to self-justify skipping scouts and reviewers. In practice, leads explore the codebase themselves (using Read/Glob/Grep), write detailed specs from their own findings, and skip reviewers because builders already report quality gate results. The lead identity should be reframed as a team lead who coordinates, not a doer who also delegates. Key adjustments: (1) Reframe the Role section — the lead primary value is decomposition, delegation, and verification, not exploration. (2) Narrow the scout exception clause (Phase 1 step 8) — currently too easy to invoke when dispatch messages include file areas and mulch expertise is pre-loaded. (3) Strengthen the reviewer framing — reviewers catch spec drift, edge cases, and integration issues that unit tests miss, not just redundant quality gates. (4) Reframe propulsion principle as start delegating immediately not start doing immediately. (5) Adjust cost awareness — lead time is most valuable for coordination, not exploration. No structural enforcement changes — prompt and identity adjustment only.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-18T08:05:51.529931-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T16:41:49.144025-08:00","closed_at":"2026-02-18T16:41:49.144025-08:00","close_reason":"Reframed agents/lead.md identity: 6 edits applied (intro, role, scout exception, reviewer framing, propulsion principle, cost awareness) shifting lead from doer to coordinator. Builder + reviewer pipeline completed with PASS verdict. Quality gates: 1872 tests, lint clean, typecheck clean."}
{"id":"overstory-sp4j","title":"[Epic] Phase 1: Event Store Foundation","description":"Central SQLite event store, sessions.json→SQLite migration, and hook data capture fixes. This is the backbone of the post-mortem observability system.\n\n## Goal\nReplace scattered per-agent log files with a queryable central event store. Fix known data gaps (tool args, durations, tokens, exit codes). Eliminate sessions.json race condition.\n\n## Deliverables\n1. Central EventStore (src/events/store.ts) — SQLite events.db with schema for all event types\n2. Smart tool argument filter (src/events/tool-filter.ts) — extract useful args per tool type, skip noise\n3. SessionStore (src/sessions/store.ts) — SQLite replacement for sessions.json with concurrent access safety\n4. Sessions migration shim (src/sessions/compat.ts) — backward-compatible reader during transition\n5. Hook updates — pipe full stdin JSON to overstory log, capture tool_input, transcript_path, session_id\n6. Log command updates — parse hook stdin, write to events.db, correlate tool durations, auto-parse transcripts\n7. Migrate all sessions.json consumers (sling, status, daemon, nudge) to SessionStore\n\n## Architecture Notes\n- events.db schema: id, run_id, agent_name, session_id, event_type, tool_name, tool_args (filtered JSON), tool_duration_ms, level, data (JSON payload), created_at\n- SessionStore schema mirrors current AgentSession type but in SQLite with proper indexes\n- Tool duration correlation: tool_end queries most recent unmatched tool_start for same (agent, tool), computes delta\n- Smart defaults for tool args: Bash→command, Read→file_path, Write→file_path, Edit→file_path, Grep→pattern+path, Task→description+subagent_type. Skip content bodies.\n- Existing per-agent log files continue as backup (no removal)\n\n## Dependencies\nNone — this is the foundation. Phase 2 and 3 depend on this.","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:07:16.330422-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T19:08:32.885908-08:00","closed_at":"2026-02-13T19:08:32.885908-08:00","close_reason":"Phase 1 complete: EventStore (events.db), SessionStore (sessions.db), tool argument filter, compat migration layer, and hook data capture all implemented. All 12 sessions.json consumers migrated to SessionStore. 1170 tests passing."}
{"id":"overstory-sv0q","title":"Add worktree root path and isolation constraints to overlay template","description":"## Problem\n\nThe overlay template (templates/overlay.md.tmpl) tells agents their branch name, file scope, and parent — but never tells them their worktree root path. It also does not explicitly instruct agents to use relative paths or stay within their worktree directory.\n\nIn the latest run, agents resolved paths relative to the canonical repo root (the git project root) rather than their worktree, likely because:\n1. Claude Code's default cwd is the project root, not the tmux session cwd\n2. The overlay doesn't mention the worktree path at all\n3. File scope lists relative paths but doesn't anchor them to the worktree\n\n## Solution\n\n1. Add a {{WORKTREE_PATH}} template variable to overlay.md.tmpl\n2. Add a prominent 'Working Directory' section near the top of the overlay:\n   - State the absolute worktree path\n   - Explicitly instruct: 'All file operations MUST use paths within this directory'\n   - Instruct: 'Use relative paths from your worktree root, NOT absolute paths to the canonical repo'\n   - Warn: 'Writing to the canonical repo root (/path/to/project/) instead of your worktree is a critical error'\n3. In the File Scope section, anchor file paths to the worktree:\n   - 'These paths are relative to your worktree root: {{WORKTREE_PATH}}'\n4. In the Constraints section, add:\n   - 'NEVER write to the canonical repo root — all writes go to your worktree'\n   - 'If you see files at the canonical root, read them but write to your worktree copy'\n\n## Files to modify\n\n- templates/overlay.md.tmpl — add worktree path section and constraints\n- src/agents/overlay.ts — pass worktreePath to template substitution\n- agents/builder.md — reinforce worktree isolation in base definition\n- agents/lead.md — reinforce worktree isolation","status":"closed","priority":1,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:03:22.987232-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T14:23:42.772665-08:00","closed_at":"2026-02-13T14:23:42.772665-08:00","close_reason":"Added worktreePath to OverlayConfig and overlay template. New Working Directory section, file scope anchored to worktree root, constraints include WORKTREE ISOLATION and PATH_BOUNDARY_VIOLATION failure mode. Updated builder.md and lead.md."}
{"id":"overstory-t0f","title":"L4-3: Implement health check definitions (src/watchdog/health.ts)","description":"Health check types and state machine. HealthCheck interface: agentName, timestamp, processAlive, tmuxAlive, lastActivity, state (AgentState), action (none/escalate/terminate). State transition rules and thresholds.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:18.810003-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:39:41.929193-08:00","closed_at":"2026-02-12T07:39:41.929193-08:00","close_reason":"All L4 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-t0f","depends_on_id":"overstory-19p","type":"blocks","created_at":"2026-02-12T07:13:45.194074-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-t62v","title":"Nudges typed but not entered: missing follow-up Enter in sendNudgeWithRetry","description":"Root cause identified: sendNudgeWithRetry() in src/commands/nudge.ts:124-136 does a single sendKeys() call (text + Enter). Claude Code's TUI sometimes consumes the Enter keystroke during re-render/focus events, leaving text visible in the input but unsubmitted. The beacon in both sling.ts:436-441 and coordinator.ts:200-202 already has a workaround: a follow-up sendKeys(session, '') after a 500ms sleep to send a redundant Enter. Nudge code was never given this fix. Affects ALL nudge targets (coordinator, builders, agents), not just the coordinator. Fix: add the same double-Enter pattern (sleep 500ms + empty sendKeys) after each successful sendKeys in sendNudgeWithRetry().","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T11:49:49.377399-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T12:29:48.169892-08:00","closed_at":"2026-02-13T12:29:48.169892-08:00","close_reason":"Added double-Enter pattern (sleep 500ms + empty sendKeys) to sendNudgeWithRetry in nudge.ts, matching existing workaround in sling.ts and coordinator.ts"}
{"id":"overstory-tdp","title":"L5-1: Write config.test.ts","description":"Tests for src/config.ts. Cover: loading valid config, defaults for missing fields, validation errors for bad config, path resolution, missing config file handling.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:27.056998-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:47:43.22018-08:00","closed_at":"2026-02-12T07:47:43.22018-08:00","close_reason":"Wrote config.test.ts with 20 tests covering defaults, merging, parsing, and validation","dependencies":[{"issue_id":"overstory-tdp","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:46.840932-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-tdw","title":"Trust observable state in watchdog (ZFC principle)","description":"Watchdog should check tmux session liveness as primary signal, not sessions.json state. Add isProcessRunning(pid) check as secondary signal. When tmux says dead but sessions.json says working, mark zombie immediately. When tmux says alive but sessions.json says zombie, investigate (don't auto-kill). Document ZFC (Zero Failure Crash) principle: observable state (tmux alive, git status) is source of truth, not recorded state (sessions.json fields). The current watchdog partially does this but should lean into it more consistently.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:13:12.054161-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:11:17.910517-08:00","closed_at":"2026-02-12T13:11:17.910517-08:00","close_reason":"Implemented ZFC principle in watchdog: tmux liveness as primary signal, pid check as secondary, sessions.json as tertiary. Added isProcessRunning(), ZFC rules 1-3, investigate action for conflicting state, comprehensive tests."}
{"id":"overstory-tgb","title":"L3-3: Implement molecule helpers (src/beads/molecules.ts)","description":"Beads molecule management for multi-step workflows. Helpers for creating molecule prototypes, pouring instances, tracking convoy progress. Wraps bd mol commands.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:01.871321-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:36:21.672447-08:00","closed_at":"2026-02-12T07:36:21.672447-08:00","close_reason":"All L3 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-tgb","depends_on_id":"overstory-rbj","type":"blocks","created_at":"2026-02-12T07:13:42.92718-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-tgcl","title":"Auto-complete run on coordinator stop/exit","description":"When the coordinator stops (either via 'overstory coordinator stop' or by just exiting the tmux window), the current run should be automatically completed. Currently: (1) 'coordinator stop' marks the coordinator session completed but does NOT call 'run complete', so current-run.txt persists and new agents may attach to the stale run. (2) Just exiting tmux bypasses even that — the coordinator stays 'working' until zombie detection. Fix: Make 'coordinator stop' call run complete automatically. Add a tmux exit trap or session-end hook that triggers cleanup when the user just closes the tmux window.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:31:43.747446-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:50:53.892625-08:00","closed_at":"2026-02-17T07:50:53.892625-08:00","close_reason":"Auto-complete run on coordinator stop/exit implemented. Two builder branches ready for merge: (1) coordinator stop now auto-completes the current run with runCompleted output, (2) session-end hook completes the run when coordinator exits via tmux close. Both paths are non-fatal and include comprehensive tests."}
{"id":"overstory-tia","title":"Colocate tests with source files (move from __tests__/ to src/)","description":"Move test files from the centralized __tests__/ directory to live alongside their source files. E.g. __tests__/config.test.ts -\u003e src/config.test.ts, __tests__/mail-store.test.ts -\u003e src/mail/store.test.ts. This improves discoverability, makes it obvious which modules have tests, and aligns with modern TS project conventions. Update biome/tsconfig if needed to include new test locations.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:56:06.312445-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:00:57.441947-08:00","closed_at":"2026-02-12T09:00:57.441947-08:00","close_reason":"Colocated all 12 test files from __tests__/ to src/. Updated all import paths, fixed Biome import ordering, updated tsconfig.json include. All 261 tests pass, biome check clean, tsc clean."}
{"id":"overstory-tjy0","title":"Export SUPPORTED_CAPABILITIES constant from types.ts","description":"Add an exported const SUPPORTED_CAPABILITIES array to src/types.ts listing all valid agent capability strings: 'scout', 'builder', 'reviewer', 'lead', 'merger'. This enables type-safe capability validation at compile time.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:04:37.648738-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:09:24.291346-08:00","closed_at":"2026-02-12T13:09:24.291346-08:00","close_reason":"Added SUPPORTED_CAPABILITIES constant and Capability type to src/types.ts. All quality gates pass (tests, lint, typecheck)."}
{"id":"overstory-tk46","title":"Fix readStdinJson to read all stdin chunks","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:37:39.466868-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:40:37.021729-08:00","closed_at":"2026-02-17T07:40:37.021729-08:00","close_reason":"Fixed readStdinJson() to read all stdin chunks. Large payloads (\u003e64KB) now parsed correctly. Added test for 100KB payload verification."}
{"id":"overstory-tko","title":"L0-12: Write templates/overlay.md.tmpl","description":"Template for per-worker dynamic overlay CLAUDE.md. Variables: {{BEAD_ID}}, {{AGENT_NAME}}, {{SPEC_PATH}}, {{BRANCH_NAME}}, {{FILE_SCOPE}}, {{MULCH_DOMAINS}}, {{PARENT_AGENT}}, {{CAN_SPAWN}}.","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:48.034743-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:18:45.108437-08:00","closed_at":"2026-02-12T07:18:45.108437-08:00","close_reason":"Created all 3 templates: CLAUDE.md.tmpl (orchestrator awareness), overlay.md.tmpl (per-worker overlay), hooks.json.tmpl (agent hooks config)"}
{"id":"overstory-toyn","title":"Revisit: Claude Code Seatbelt sandbox support for agents","description":"Stripped sandbox config from overstory (ra2z, 79fh) because: (1) tmux socket blocked by sandbox, (2) agent sandbox config was half-baked, (3) PreToolUse hook guards are the real security layer. Future work: investigate TMUX_TMPDIR approach, evaluate whether Seatbelt sandbox adds value on top of hook guards, handle temp dir access for tests.","status":"open","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-15T13:56:53.508544-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T13:56:53.508544-08:00"}
{"id":"overstory-ttfo","title":"Make mulch recording a required completion gate for builder agents","description":"Builder agent definition (agents/builder.md) lists mulch record as a soft suggestion. Agents inconsistently record learnings — some skip it entirely. Update the builder (and other agent) definitions to make mulch recording a required step in the completion checklist, alongside quality gates (bun test, biome check, tsc). This is a simple agent definition change that doesn't depend on the structured pattern storage work in overstory-f0kl.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:29:02.86351-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:47:07.188467-08:00","closed_at":"2026-02-16T13:47:07.188467-08:00","close_reason":"Made mulch recording a required completion gate for all agent definitions. Updated 5 agent .md files (builder, lead, scout, reviewer, merger) with a numbered mulch record step in each Completion Protocol and a MISSING_MULCH_RECORD failure mode. Updated overlay.ts to include mulch recording in the generated quality gates for both read-only and writable agents. Builder quality gates passed."}
{"id":"overstory-typs","title":"Implement mulch conflict pattern recording in resolver.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:21:51.463105-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:32:41.221794-08:00","closed_at":"2026-02-13T22:32:41.221794-08:00","close_reason":"Implemented mulch conflict pattern recording in resolver.ts with 7 new tests. All quality gates passed."}
{"id":"overstory-u19","title":"[Epic] Layer 4: Watchdog + CLI Router","description":"Watchdog daemon, remaining CLI commands, and main CLI router. 8 parallel tasks. Depends on Layer 3 completion.","status":"closed","priority":4,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:07.077987-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:39:53.50198-08:00","closed_at":"2026-02-12T07:39:53.50198-08:00","close_reason":"All 8 L4 subtasks completed","dependencies":[{"issue_id":"overstory-u19","depends_on_id":"overstory-c2x","type":"blocks","created_at":"2026-02-12T07:12:48.035004-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-u19","depends_on_id":"overstory-dp7","type":"blocks","created_at":"2026-02-12T07:12:48.848609-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-u19","depends_on_id":"overstory-t0f","type":"blocks","created_at":"2026-02-12T07:12:49.800684-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-u19","depends_on_id":"overstory-3n0","type":"blocks","created_at":"2026-02-12T07:12:50.626577-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-u19","depends_on_id":"overstory-2kn","type":"blocks","created_at":"2026-02-12T07:12:51.431128-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-u19","depends_on_id":"overstory-n82","type":"blocks","created_at":"2026-02-12T07:12:52.590077-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-u19","depends_on_id":"overstory-z5y","type":"blocks","created_at":"2026-02-12T07:12:53.715455-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-u19","depends_on_id":"overstory-b02","type":"blocks","created_at":"2026-02-12T07:12:54.528846-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-u4qm","title":"Fix OverstoryConfig fixtures for providers field","description":"Add providers field to all OverstoryConfig test fixtures and fix resolveModel return type in manifest.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:34:41.002355-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:35:52.267083-08:00","closed_at":"2026-02-19T12:35:52.267083-08:00","close_reason":"Merged into overstory-ip89 scope expansion"}
{"id":"overstory-u76r","title":"Implement MulchClient expansion: new commands + new flags","description":"Add diff, learn, prune, doctor, ready, compact wrappers to src/mulch/client.ts. Add prime --files/--exclude-domain and record --stdin/--evidence-bead flags. Add result types to src/types.ts. Add tests.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:53:14.685041-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:18:47.123714-08:00","closed_at":"2026-02-13T22:18:47.123714-08:00","close_reason":"Implemented by mulch-client-builder: 6 new methods added, initial implementation"}
{"id":"overstory-u8d0","title":"Add universal git push guard to hooks template + update tests","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T07:43:57.950698-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T07:55:06.243895-08:00","closed_at":"2026-02-18T07:55:06.243895-08:00","close_reason":"Added universal Bash PreToolUse guard to hooks template without ENV_GUARD. Updated 7 test count assertions, patched env guard test, added verification test. All 1868 tests pass."}
{"id":"overstory-udid","title":"Doctor: external dependency checks","description":"Check that all external tools overstory depends on are available and functional.\n\nChecks:\n- git installed and on PATH: run 'git --version', verify exit 0\n- tmux installed and accessible: run 'tmux -V', verify exit 0\n- bd (beads) available: run 'bd --version', verify exit 0, also check .beads/ dir exists with issues.jsonl\n- mulch available: run 'mulch --version', verify exit 0 (warn-only since mulch is optional)\n- overstory itself resolvable from worktree context: run 'which overstory' or equivalent\n\nSource references:\n- Various Bun.spawn calls throughout src/worktree/manager.ts, src/beads/client.ts, src/mulch/client.ts\n\nOutput: pass/fail per dependency with version info. Fail = critical (blocks operation).","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:59:09.49888-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:49:03.90708-08:00","closed_at":"2026-02-15T12:49:03.90708-08:00","close_reason":"Implemented dependency, version, and config health checks with comprehensive test coverage. All quality gates pass.","dependencies":[{"issue_id":"overstory-udid","depends_on_id":"overstory-m55s","type":"blocks","created_at":"2026-02-13T22:00:18.171833-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-uecg","title":"Scope dashboard panels to current run and add --all flag","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T07:15:24.49891-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T07:28:16.512046-08:00","closed_at":"2026-02-18T07:28:16.512046-08:00","close_reason":"Dashboard panels now scope to current run by default via AgentSession.runId filtering. Added --all flag for historical view, run scope indicator in header, and updated help text. All quality gates pass.","dependencies":[{"issue_id":"overstory-uecg","depends_on_id":"overstory-fsgf","type":"blocks","created_at":"2026-02-18T07:15:28.117278-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-uh0","title":"L5-5: Write beads-client.test.ts","description":"Tests for src/beads/client.ts. Cover: ready(), show(id), create(), claim(), close(), status(). Mock bd CLI subprocess calls. Verify --json flag usage and output parsing.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:30.698722-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:54:20.592935-08:00","closed_at":"2026-02-12T07:54:20.592935-08:00","close_reason":"Closed","dependencies":[{"issue_id":"overstory-uh0","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:47.430304-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-uh2h","title":"Resolve merge-intel-builder merge conflict","description":"Branch overstory/merge-intel-builder/overstory-okcp failed to merge due to conflicts on .mulch/expertise/typescript.jsonl and possibly src/types.ts. Code files: src/merge/resolver.ts, src/merge/resolver.test.ts, src/commands/merge.ts, src/types.ts. Resolution: create fresh branch from main, read files from failed branch, apply code changes to current main versions, run quality gates, signal merge_ready.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T18:06:01.826042-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T18:28:15.462856-08:00","closed_at":"2026-02-16T18:28:15.462856-08:00","close_reason":"Resolved via overstory-mifc (fresh branch approach)."}
{"id":"overstory-uid","title":"beads-client.test.ts: Replace Bun.spawn mocks with real bd CLI","description":"beads-client.test.ts mocks all Bun.spawn calls for bd CLI invocations. Replace with real bd operations using a temp directory with an initialized beads project. This tests actual bd JSON output parsing, flag handling, and error behavior. Guard with a check for bd availability so tests skip gracefully in environments without bd installed. Keep the existing mock-based tests as a fallback or remove if real tests provide equivalent coverage.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:56:19.499166-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:08:48.083455-08:00","closed_at":"2026-02-12T09:08:48.083455-08:00","close_reason":"Replaced Bun.spawn mocks with real bd CLI integration tests, fixed client to handle bd show array response and issue_type field mapping","dependencies":[{"issue_id":"overstory-uid","depends_on_id":"overstory-y72","type":"blocks","created_at":"2026-02-12T08:56:33.544099-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-uo1y","title":"[Epic] Phase 2: CLI Query Commands","description":"Four new CLI commands for post-mortem analysis: trace, errors, replay, costs. These are the primary interface for understanding swarm behavior after a run.\n\n## Goal\nGive the operator CLI tools to slice event data by agent, bead, run, or time range. All commands support --json for scripting.\n\n## Deliverables\n1. overstory trace \u003cagent|bead\u003e — chronological timeline of events for an agent or bead task\n2. overstory errors [--agent] [--run] — aggregated error view across all agents\n3. overstory replay [--run] [--agent] — interleaved chronological replay across multiple agents\n4. overstory costs [--agent] [--run] [--by-capability] — token/cost analysis and breakdown\n\n## Architecture Notes\n- All commands query events.db via EventStore interface\n- costs additionally queries metrics.db for token data\n- trace resolves bead IDs to agent names via SessionStore\n- replay without --run defaults to most recent run or last 24h of events\n- Human output uses ANSI colors consistent with existing reporter.ts patterns\n- Each command gets its own file in src/commands/ with colocated tests\n\n## Dependencies\nDepends on Phase 1 (EventStore, SessionStore must exist)","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:07:28.112969-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:53:33.145815-08:00","closed_at":"2026-02-13T20:53:33.145815-08:00","close_reason":"All 4 CLI query commands implemented: trace, errors, replay, costs. All tests passing.","dependencies":[{"issue_id":"overstory-uo1y","depends_on_id":"overstory-sp4j","type":"blocks","created_at":"2026-02-13T13:10:27.466627-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-uo2o","title":"Watchdog incorrectly flags coordinator as stalled while waiting for workers","description":"## Problem\n\nThe watchdog daemon sends 'coordinator stalled' nudges to the coordinator while it's intentionally waiting for worker agents to finish. This is because stalled detection treats all agents identically — it only checks lastActivity (updated on tool-start/tool-end events) against a threshold. The coordinator's normal work while waiting is conversational (waiting for mail), not tool-based, so lastActivity goes stale and the watchdog escalates.\n\nProgressive escalation (warn → nudge → triage → terminate) can even kill a healthy coordinator that's simply waiting.\n\n## Root Cause\n\n- `src/watchdog/daemon.ts:205-298` iterates ALL non-completed sessions with zero capability-aware filtering\n- `src/watchdog/health.ts:172-181` flags any agent as stalled if lastActivity exceeds staleThresholdMs, regardless of capability\n- `src/commands/log.ts:90` already defines `PERSISTENT_CAPABILITIES = new Set(['coordinator', 'monitor'])` but this is never imported or used by the watchdog\n\n## Recommended Fix\n\nAdd capability-aware logic to `evaluateHealth()` in `src/watchdog/health.ts`: skip stale/zombie detection for persistent capabilities (coordinator, monitor). These agents should only be checked for tmux liveness, not activity-based staleness.\n\nThis means importing/sharing the PERSISTENT_CAPABILITIES concept from log.ts (or defining it in types.ts) and adding an early return in evaluateHealth() that returns state='working' with action='none' for persistent agents, with a reconciliation note explaining the exemption.\n\n## Files Involved\n\n- `src/watchdog/health.ts` — primary fix location (evaluateHealth)\n- `src/watchdog/daemon.ts` — alternative fix location (session loop filtering)\n- `src/commands/log.ts:90` — existing PERSISTENT_CAPABILITIES constant to share/reuse\n- `src/types.ts` — possible home for shared PERSISTENT_CAPABILITIES constant","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-15T12:28:58.607734-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T17:04:26.997175-08:00","closed_at":"2026-02-15T17:04:26.997175-08:00","close_reason":"Fix already implemented - PERSISTENT_CAPABILITIES in health.ts exempts coordinator/monitor from time-based staleness checks"}
{"id":"overstory-uow","title":"mail read silently succeeds for nonexistent message IDs","description":"'overstory mail read nonexistent-id' reports 'Marked nonexistent-id as read' with exit 0 even though no such message exists. Should validate the message ID and return an error. In contrast, 'overstory mail reply nonexistent-id' correctly errors with 'Message not found'.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:11:07.145987-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:43:48.204637-08:00","closed_at":"2026-02-12T08:43:48.204637-08:00","close_reason":"Added existence check in MailClient.markRead — now throws MailError with message ID when the ID is not found, matching the pattern already used by reply()"}
{"id":"overstory-uox","title":"L0-5: Write CLAUDE.md project conventions","description":"Overstory project conventions file. Documents CLI commands, agent workflow, beads integration, mulch usage, hook patterns. This is the orchestrator's reference.","status":"closed","priority":0,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:20.300086-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:18:36.442366-08:00","closed_at":"2026-02-12T07:18:36.442366-08:00","close_reason":"Wrote comprehensive CLAUDE.md with project overview, architecture, coding conventions, CLI reference, and quality gates"}
{"id":"overstory-us0f","title":"Write tests for log command (src/commands/log.test.ts)","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:04:35.682723-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:32:05.333121-08:00","closed_at":"2026-02-13T09:32:05.333121-08:00","close_reason":"Test files already written and committed"}
{"id":"overstory-usoq","title":"Rewrite agents/lead.md: reframe identity as coordinator-not-doer","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T16:32:56.671499-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T16:41:27.486717-08:00","closed_at":"2026-02-18T16:41:27.486717-08:00","close_reason":"All 6 edits to agents/lead.md applied and review-verified: intro, role, scout exception, reviewer framing, propulsion principle, cost awareness all reframed to coordinator-not-doer identity"}
{"id":"overstory-uwg4","title":"Subagent overwrites root .claude/CLAUDE.md during e2e run","description":"During an overstory e2e run, the root .claude/CLAUDE.md was populated/modified unexpectedly. Root cause is unclear — could be a subagent escaping its worktree scope, or an agent-spawning function (e.g., sling, overlay generation) writing to the wrong path. Investigate what wrote to root .claude/CLAUDE.md and under what conditions. Check overlay.ts, sling.ts, hooks-deployer.ts, and any code that touches CLAUDE.md paths. Add a guard to prevent unintended writes to the orchestrator's .claude/ directory.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T14:14:28.829591-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T14:37:18.862226-08:00","closed_at":"2026-02-13T14:37:18.862226-08:00","close_reason":"Implemented in session: bash path guard, hook capture updates, CLAUDE.md overwrite guard, and orchestrator nudge fix"}
{"id":"overstory-v248","title":"Fix dashboard DB connection churn: hold stores open for poll loop","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T07:59:11.308317-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T08:09:45.994071-08:00","closed_at":"2026-02-20T08:09:45.994071-08:00","close_reason":"Fixed dashboard DB connection churn: added PreOpenedStores to gatherStatus(), openDashboardStores()/closeDashboardStores() to dashboard.ts. Each DB opened once per poll loop, closed on SIGINT or error. Backward compatible. Tests and quality gates pass."}
{"id":"overstory-v2o2","title":"Wire tier2Enabled into coordinator.ts --monitor auto-start","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T17:00:34.604918-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T17:04:36.940596-08:00","closed_at":"2026-02-18T17:04:36.940596-08:00","close_reason":"Wired tier2Enabled into coordinator --monitor auto-start: skips monitor.start() when tier2Enabled is false, adds 2 tests, updates beforeEach config. 86 tests pass."}
{"id":"overstory-v3b1","title":"Review: lead.md Phase 1 scout-first workflow update","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:29:04.545424-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T13:33:34.44722-08:00","closed_at":"2026-02-16T13:33:34.44722-08:00","close_reason":"Review PASS for lead.md Phase 1 update. All 8 acceptance criteria verified."}
{"id":"overstory-vajl","title":"Implement run concept and overstory run command","description":"Introduce the 'run' grouping concept and a CLI command to manage it.\n\n## Concept\nA 'run' groups all agents spawned from one coordinator session. It provides the top-level unit for post-mortem analysis — 'show me everything from that run.'\n\n## Run ID\nFormat: run-{ISO timestamp} (e.g., run-2026-02-13T10-00-00Z)\n\n## Storage\n- Active run ID in .overstory/current-run.txt (simple text file)\n- Run metadata in sessions.db (new runs table):\n```sql\nCREATE TABLE runs (\n  id TEXT PRIMARY KEY,\n  started_at TEXT NOT NULL,\n  completed_at TEXT,\n  agent_count INTEGER NOT NULL DEFAULT 0,\n  coordinator_session_id TEXT,\n  status TEXT NOT NULL DEFAULT 'active'\n    CHECK(status IN ('active','completed','failed'))\n);\n```\n\n## Run Lifecycle\n1. First overstory sling call checks for .overstory/current-run.txt\n2. If absent, creates new run, writes ID to current-run.txt\n3. Each sling call increments agent_count\n4. Run auto-completes when all member agents reach completed/zombie (detected by watchdog or explicit command)\n5. overstory clean resets current run\n\n## CLI Command\n```\noverstory run                    Show current run status\noverstory run list [--last \u003cn\u003e]  List recent runs\noverstory run complete           Mark current run as completed\noverstory run show \u003cid\u003e          Show run details (agents, duration, cost)\n```\n\n## Changes to existing code\n- src/commands/sling.ts: generate/inherit run_id, pass to SessionStore and EventStore\n- src/sessions/store.ts: add runs table and RunStore methods\n- src/commands/clean.ts: delete current-run.txt on clean\n\n## Tests (src/commands/run.test.ts)\n- Create run, show status\n- List recent runs\n- Run auto-completion logic\n- Run show with agent/cost details","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T13:10:05.120105-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:41:18.354247-08:00","closed_at":"2026-02-13T20:41:18.354247-08:00","close_reason":"Run concept fully implemented across overstory-e9d3 (RunStore), overstory-q9xo (run CLI), overstory-w00d (sling/clean integration)","dependencies":[{"issue_id":"overstory-vajl","depends_on_id":"overstory-c6ca","type":"blocks","created_at":"2026-02-13T13:10:39.013316-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-vajl","depends_on_id":"overstory-b3sa","type":"blocks","created_at":"2026-02-13T13:10:39.150887-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-vdg7","title":"Update lead.md Phase 1 to mandate parallel scout spawning","description":"Modify agents/lead.md to make scout-first workflow mandatory with parallel scouts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-16T13:16:37.148339-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T17:39:34.399486-08:00","closed_at":"2026-02-16T17:39:34.399486-08:00","close_reason":"Parallel scout spawning already mandated in prior commit c2229d3."}
{"id":"overstory-vm0","title":"L2-2: Implement hooks deployer (src/agents/hooks-deployer.ts)","description":"Deploy hooks config to agent worktree as .claude/settings.local.json. Reads templates/hooks.json.tmpl, fills agent name, writes to worktree. Configures SessionStart, UserPromptSubmit, Pre/PostToolUse, Stop, PreCompact hooks.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:11:45.827006-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:33:09.537094-08:00","closed_at":"2026-02-12T07:33:09.537094-08:00","close_reason":"All L2 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-vm0","depends_on_id":"overstory-05o","type":"blocks","created_at":"2026-02-12T07:13:40.792546-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-vo3e","title":"Wire SessionInsight analyzer to auto-record outcomes","description":"src/insights/analyzer.ts exists but is never called. Wire analyzeSessionInsights() into src/agents/lifecycle.ts session completion to automatically analyze tool events and record outcomes via mulch record with --outcome-status based on quality gate results. This closes the feedback loop without relying on agents to self-report, enabling mulch 0.4.3's confirmation scoring to accumulate real data.","notes":"Demoted from P2→P3. Blocked by vs8z which is now P3. Auto-insight wiring is future work — agents already record well manually.","status":"open","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-20T12:49:41.082187-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:09:54.88097-08:00","dependencies":[{"issue_id":"overstory-vo3e","depends_on_id":"overstory-vs8z","type":"blocks","created_at":"2026-02-20T12:49:52.06168-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-vs8z","title":"Add outcome recording flags to MulchClient.record()","description":"Wire --outcome-status, --outcome-duration, --outcome-test-results, --outcome-agent flags into src/mulch/client.ts record() method. Update agent overlay template quality gates (src/agents/overlay.ts) and agent definitions (agents/*.md) to instruct agents to pass outcome data when recording learnings after completing work. This gives mulch's confirmation-frequency scoring system real signal about which patterns work.","notes":"Demoted from P2→P3. Agent log analysis shows recording is already near-universal and high quality. Outcome flags are nice-to-have but the recording side doesn't need investment right now.","status":"closed","priority":3,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-20T12:49:36.802913-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:23:14.039048-08:00","closed_at":"2026-02-20T13:23:14.039048-08:00","close_reason":"Outcome flags (outcomeStatus, outcomeDuration, outcomeTestResults, outcomeAgent) added to record() in client.ts (mulch-client-builder). Overlay quality gates and builder.md updated with outcome flags (overlay-defs-builder)."}
{"id":"overstory-vu16","title":"Add test coverage for metrics command","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:40:23.227744-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:47:15.259885-08:00","closed_at":"2026-02-12T13:47:15.259885-08:00","close_reason":"Added comprehensive test coverage for metrics command with 16 test cases covering all requirements: help flags, empty/missing DB handling, output formatting, JSON mode, --last flag, merge tier distribution, and duration formatting. All tests pass, zero lint errors, typecheck clean."}
{"id":"overstory-vxx","title":"Test task: scout the codebase","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:00:56.934175-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:04:14.502201-08:00","closed_at":"2026-02-12T08:04:14.502201-08:00","close_reason":"Hands-on testing complete"}
{"id":"overstory-w00d","title":"Integrate run_id into sling and clean commands","description":"sling.ts: auto-create/inherit run_id via current-run.txt. clean.ts: delete current-run.txt on clean","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T19:20:56.601799-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T20:39:00.38154-08:00","closed_at":"2026-02-13T20:39:00.38154-08:00","close_reason":"Integrated run_id auto-creation in sling, cleanup in clean","dependencies":[{"issue_id":"overstory-w00d","depends_on_id":"overstory-e9d3","type":"blocks","created_at":"2026-02-13T19:21:03.006492-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-w4zv","title":"Stale escalation auto-bump (severity increases over time)","description":"When a stalled agent is not acknowledged, automatically bump severity over time. Track escalation start time and bump count in AgentSession. Add configurable bump interval to WatchdogConfig. Integrate with progressive nudging — each bump advances the nudge stage. After max bumps reached, transition to zombie/terminate. This is tightly coupled with the progressive nudging task and should be implemented together.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T06:51:23.819644-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T07:03:35.52015-08:00","closed_at":"2026-02-13T07:03:35.52015-08:00","close_reason":"Implemented as part of progressive nudging (overstory-5bic) — escalationLevel auto-bumps on each daemon tick while agent remains stalled, configured via nudgeIntervalMs","dependencies":[{"issue_id":"overstory-w4zv","depends_on_id":"overstory-5bic","type":"blocks","created_at":"2026-02-13T06:51:43.759142-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-wadc","title":"Scouts should write specs as files, not deliver via mail","description":"During e2e testing, scout agents are delivering entire spec documents via overstory mail messages to the coordinator. This causes the coordinator to try to manually rewrite/transcribe the specs. Scouts should default to writing specs as files (e.g. .overstory/specs/{bead-id}.md) using 'overstory spec write', and then notify the coordinator via a short mail message with the file path. The mail system should be used for notifications/status, not as a file transport mechanism.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T11:49:53.340879-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T12:41:29.428962-08:00","closed_at":"2026-02-13T12:41:29.428962-08:00","close_reason":"Added overstory spec write command (src/commands/spec.ts with 17 tests). Scouts now use overstory spec write to persist specs as files to .overstory/specs/\u003cbead-id\u003e.md instead of sending them via mail. Updated agents/scout.md with spec-write workflow, SPEC_VIA_MAIL failure mode, and mail-as-notification-only constraint."}
{"id":"overstory-wg9n","title":"Fix triage.test.ts timeout: triageAgent returns 'extend' when session.log exists but claude binary fails","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T09:09:44.846116-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:18:10.299416-08:00","closed_at":"2026-02-13T09:18:10.299416-08:00","close_reason":"Fixed triage.test.ts timeout by adding configurable timeoutMs to spawnClaude (default 30s). The subprocess is killed via setTimeout+proc.kill() if it exceeds the limit. Test passes timeoutMs: 500 to fail fast instead of hanging when the claude binary exists."}
{"id":"overstory-wgdi","title":"Doctor: config.yaml validation","description":"Validate config.yaml syntax, schema, and semantic correctness.\n\nChecks:\n- YAML parses without error\n- All required fields present: project.root, project.canonicalBranch, agents.maxConcurrent, agents.maxDepth, etc.\n- Value validation: maxConcurrent \u003e= 1, maxDepth \u003e= 0, non-negative timeouts\n- Threshold ordering: zombieThresholdMs \u003e staleThresholdMs\n- mulch.primeFormat in {markdown, xml, json}\n- project.root points to a real git repository (resolve and check)\n- Deprecated config keys detected and warned (tier1Enabled → tier0Enabled, tier2Enabled → tier1Enabled)\n\nSource references:\n- src/config.ts — loadConfig(), DEFAULT_CONFIG, validation logic\n- .overstory/config.yaml — real example\n\nOutput: pass/warn/fail. Malformed YAML or missing required fields = critical. Deprecated keys = warn.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:59:18.32135-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:49:03.908758-08:00","closed_at":"2026-02-15T12:49:03.908758-08:00","close_reason":"Implemented dependency, version, and config health checks with comprehensive test coverage. All quality gates pass.","dependencies":[{"issue_id":"overstory-wgdi","depends_on_id":"overstory-m55s","type":"blocks","created_at":"2026-02-13T22:00:18.473736-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-wgx","title":"prime --agent for nonexistent agent outputs full mulch context without warning","description":"Running 'overstory prime --agent nonexistent' succeeds (exit 0) and outputs a full context block including all mulch expertise, with only a subtle 'New agent - no prior sessions' line to indicate the agent doesn't exist. Should either warn that the agent name is not in the active sessions, or at minimum make the 'new agent' notice more prominent. Currently easy to miss that you've primed for the wrong agent name.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T10:09:45.565836-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T10:15:29.244925-08:00","closed_at":"2026-02-12T10:15:29.244925-08:00","close_reason":"Check sessions.json and identity store before outputting agent context, warn if agent not found"}
{"id":"overstory-wsuc","title":"Review: reviewer-ratio doctor check","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T08:08:13.248692-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T08:12:17.014439-08:00","closed_at":"2026-02-17T08:12:17.014439-08:00","close_reason":"Review complete: PASS"}
{"id":"overstory-ww0t","title":"Add --classification guidance to agent overlay instructions","description":"Update agent .md definitions and overlay template to guide agents on classifying mulch record entries (--classification foundational for core conventions, tactical for session-specific patterns, observational for one-off findings). The flag is already wired in MulchClient.record() but agents are never instructed to use it. Better classification improves mulch's pruning and budget sorting behavior.","status":"open","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-20T12:49:46.268871-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T12:49:46.268871-08:00"}
{"id":"overstory-wzaq","title":"Embed relevant mulch expertise directly in agent overlay","description":"In src/agents/overlay.ts, during overlay generation, if files are known call mulch prime --files \u003cfiles\u003e --budget 1000 and embed the result directly under a Relevant Expertise section in the overlay. Agents start with relevant context without needing to run mulch themselves. Still include the mulch prime command for when they need more. Tradeoff: larger overlays vs faster agent ramp-up. --budget 1000 keeps it bounded. Depends on expanded MulchClient (overstory-j53z).","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:42:21.90105-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:28:26.773836-08:00","closed_at":"2026-02-13T22:28:26.773836-08:00","close_reason":"Implemented as part of overstory-95za: sling.ts auto-fetches mulch prime --files when files scoped (4ab0), overlay embeds mulchExpertise with Pre-loaded Expertise section (wzaq).","dependencies":[{"issue_id":"overstory-wzaq","depends_on_id":"overstory-j53z","type":"blocks","created_at":"2026-02-13T21:42:32.341324-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-x4fm","title":"Rework: Fix MulchClient types and add --json parsing","description":"Fix incorrect types in src/types.ts to match actual mulch CLI JSON output. Change new methods to use --json flag and return typed results instead of raw strings. Fix --files flag to use spread args.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T22:03:42.558101-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T22:18:47.317422-08:00","closed_at":"2026-02-13T22:18:47.317422-08:00","close_reason":"Superseded by mulch-fix-builder (overstory-mbs6)"}
{"id":"overstory-x5z6","title":"Add universal git push block to hooks template + update tests","description":"Add guardless git push block to hooks.json.tmpl PreToolUse section, update 7 Bash guard count tests in hooks-deployer.test.ts, and update env guard test to exclude the universal guard.","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T07:19:06.574215-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T07:21:08.517978-08:00","closed_at":"2026-02-20T07:21:08.517978-08:00","close_reason":"Already implemented and merged to main (commit 4e4db5b). PreToolUse push guard added to hooks.json.tmpl, 7 test assertions updated in hooks-deployer.test.ts."}
{"id":"overstory-x6xm","title":"Block Task tool via hooks for coordinator/supervisor capabilities","description":"The coordinator agent uses Claude Code's built-in Task tool (subagents) instead of overstory sling for delegation. This bypasses the entire overstory system — no worktrees, no mail, no groups, no specs. Evidence from the current coordinator session: '4 Task agents launched' via Claude Code native UI, zero worktrees created, zero mail messages, no groups.json. Fix: Add 'Task' to blocked tools in hooks-deployer.ts for NON_IMPLEMENTATION_CAPABILITIES. Also consider blocking TeamCreate, SendMessage, and other Claude Code native team tools. Reference: Gastown also lacks this but plans structural enforcement via delegate mode.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T06:20:42.673062-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:45:08.747804-08:00","closed_at":"2026-02-13T06:45:08.747804-08:00","close_reason":"Added NATIVE_TEAM_TOOLS list (Task, TeamCreate, TeamDelete, SendMessage, TaskCreate, TaskUpdate, TaskList, TaskGet, TaskOutput, TaskStop). All overstory agents now get these blocked via PreToolUse hooks, enforcing use of overstory sling for delegation."}
{"id":"overstory-x7nj","title":"Write worktree.test.ts for overstory worktree command","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:22:15.720427-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:34:59.558145-08:00","closed_at":"2026-02-13T08:34:59.558145-08:00","close_reason":"Test files created and merged to main"}
{"id":"overstory-x9n3","title":"Dashboard excludes coordinator due to run-scoping filter (runId: null)","description":"Coordinator registers with runId: null (coordinator.ts:370) but dashboard filters by current run ID via store.getByRun() (status.ts:95) and a JS filter (dashboard.ts:148-150). SQL WHERE run_id = $run_id never matches NULL. Regression from run-scoping feature in 0.5.7. Fix: include runId IS NULL sessions when run-scoping is active, or have coordinator adopt the current run ID at startup. Workaround: overstory dashboard --all.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-19T13:28:06.975135-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T07:34:48.181474-08:00","closed_at":"2026-02-20T07:34:48.181474-08:00","close_reason":"Fixed: coordinator excluded from dashboard due to run-scoping filter (runId=null never matched SQL WHERE). Builder overstory-ftq2 patched status.ts and dashboard.ts to include null-runId sessions. Tests added and passing."}
{"id":"overstory-xhg8","title":"Migrate session readers and cleanup to SessionStore","description":"Replace sessions.json read/write in status display, worktree cleanup, nudge resolution, priming, clean, init, and watchdog files with the SQLite-backed SessionStore.\n\nFiles to migrate: src/commands/status.ts, src/commands/worktree.ts, src/commands/nudge.ts, src/commands/prime.ts, src/commands/clean.ts, src/commands/init.ts, src/watchdog/daemon.ts.\n\nReplace patterns:\n- loadSessions() JSON helpers -\u003e openSessionStore() from sessions/compat.ts\n- store.getActive() for active session queries\n- store.getAll() for full listing\n- store.remove() for cleanup\n- store.purge() for reset/clean operations\n- For init.ts: stop creating sessions.json (SessionStore auto-creates sessions.db)\n- For clean.ts: purge SessionStore (store.purge({all:true})) instead of resetting sessions.json\n- For worktree.ts: use store.remove() instead of filtering JSON array\n- For daemon.ts: use store.getActive(), store.updateState(), store.updateEscalation()\n\nUpdate all associated test files to use SessionStore instead of sessions.json fixtures.\n\nAcceptance criteria:\n- All 7 source files use SessionStore exclusively\n- All tests pass (bun test)\n- Type checking passes (tsc --noEmit)\n- Lint passes (biome check .)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T14:53:50.864086-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T19:16:13.149856-08:00","closed_at":"2026-02-13T19:16:13.149856-08:00","close_reason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed."}
{"id":"overstory-xj3m","title":"Write client.test.ts for src/mulch/client.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:20:22.707305-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:26:57.058321-08:00","closed_at":"2026-02-13T08:26:57.058321-08:00","close_reason":"Created client.test.ts with 18 tests using real mulch CLI"}
{"id":"overstory-xkvr","title":"Fix biome lint/format issues from merge batch","description":"Three files have biome issues after merge: (1) src/commands/mail.test.ts - formatting (multi-line arrays should be single-line), (2) src/doctor/merge-queue.test.ts - import organization, (3) src/doctor/merge-queue.ts:41 - noImplicitAnyLet lint error. Fix all three with bunx biome check --write . or manual edits. All quality gates must pass.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-16T07:35:43.904826-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:44:27.595379-08:00","closed_at":"2026-02-16T07:44:27.595379-08:00","close_reason":"Merged: biome lint/format issues fixed"}
{"id":"overstory-xkyq","title":"Lead 4: Data layer test coverage (metrics, triage, mulch client)","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T07:58:41.809109-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:55:07.564498-08:00","closed_at":"2026-02-13T08:55:07.564498-08:00","close_reason":"Test coverage blitz complete: 830 tests, 0 failures, 42 files. All 17 modules now have test coverage."}
{"id":"overstory-xn5","title":"sling --spec does not validate that spec file exists","description":"'overstory sling --spec /nonexistent/spec.md' succeeds and launches an agent with an overlay that says 'Spec: /nonexistent/spec.md' and instructs 'Read your task spec at the path above'. The agent will waste time trying to read a nonexistent file. Sling should validate the spec path exists before spawning.","status":"closed","priority":3,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:18:49.318108-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T08:43:21.436478-08:00","closed_at":"2026-02-12T08:43:21.436478-08:00","close_reason":"Added spec file existence validation in sling --spec. Uses Bun.file().exists() to check the spec path before spawning, throwing a ValidationError if the file does not exist."}
{"id":"overstory-xo8h","title":"Add mulch diff PostToolUse hook on git commit","description":"Add a PostToolUse Bash hook to templates/hooks.json.tmpl that detects git commit and runs mulch diff HEAD~1. Agents passively see what expertise records were affected by their commit without having to remember to check. Lightweight, zero cost when no mulch changes. Hook: read stdin, grep for git commit, run mulch diff HEAD~1 2\u003e/dev/null || true.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-20T13:09:45.68128-08:00","created_by":"Jaymin West","updated_at":"2026-02-20T13:30:13.313159-08:00","closed_at":"2026-02-20T13:30:13.313159-08:00","close_reason":"mulch diff PostToolUse hook implemented across 3 builders: template hook, init.ts buildHooksJson, and hooks-deployer test fix. All merged to main."}
{"id":"overstory-xxu7","title":"Add doctor checks for provider configuration","description":"Add health checks in the doctor system for multi-provider configuration.\n\nFILES: src/doctor/ (new check file or extend existing)\n\nChecks to add:\n1. Provider reachability: for each gateway provider, verify baseUrl is reachable (HTTP HEAD)\n2. Auth token presence: for each gateway provider, verify the referenced env var (authTokenEnv) is set in the environment\n3. Tool-use warning: for non-Anthropic models assigned to tool-heavy roles (builder, scout, merger), emit a warning that tool-use compat is not guaranteed\n4. Model format validation: verify provider-prefixed model strings have a valid provider reference\n5. Empty ANTHROPIC_API_KEY reminder: if any gateway provider is configured, check that tests/docs mention the ANTHROPIC_API_KEY='' requirement\n\nFollow existing doctor check patterns (see src/doctor/*.ts for conventions).","status":"open","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:13:58.066103-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:13:58.066103-08:00","dependencies":[{"issue_id":"overstory-xxu7","depends_on_id":"overstory-otwd","type":"blocks","created_at":"2026-02-19T12:14:11.951806-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-y2ob","title":"Beacon prompt not auto-submitted in interactive mode (sendKeys multiline bug)","description":"When overstory sling sends the multiline beacon prompt via tmux send-keys, the text is entered into Claude Code's TUI input buffer but NOT submitted. The newlines in the beacon text are inserted as literal newlines in the input field rather than triggering a submit. A manual Enter keypress is needed to actually submit the prompt. Fix: either send beacon as single line, escape newlines, or send a separate Enter keystroke after a delay.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:10:04.916741-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T13:17:14.333996-08:00","closed_at":"2026-02-12T13:17:14.333996-08:00","close_reason":"Flattened beacon to single line (parts joined by em-dash) and added newline-to-space guard in sendKeys() to prevent multiline tmux send-keys issues"}
{"id":"overstory-y58o","title":"Fix coordinator.test.ts timeout: startCoordinator writes session to sessions.json with correct fields","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T09:09:46.373923-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T09:21:21.599524-08:00","closed_at":"2026-02-13T09:21:21.599524-08:00","close_reason":"Fixed coordinator.test.ts mock.module leak: replaced mock.module() with DI pattern (CoordinatorDeps interface) matching daemon.ts _tmux/_triage/_nudge pattern. Tests now pass fake tmux/deployHooks via coordinatorCommand's deps parameter instead of process-global mock.module()."}
{"id":"overstory-y72","title":"Create shared test harness: real git repo + temp dir helpers","description":"Build a small shared test utility module (e.g. src/test-helpers.ts or test/helpers.ts) that provides: (1) createTempGitRepo() - initializes a real git repo in a temp dir with an initial commit, (2) cleanupTempDir() - rm -rf helper, (3) commitFile() - add and commit a file to a test repo. These helpers enable multiple test files to use real git instead of mocking Bun.spawn. Keeps test setup DRY across worktree, resolver, and sling tests.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T08:56:10.598442-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T09:00:03.92038-08:00","closed_at":"2026-02-12T09:00:03.92038-08:00","close_reason":"Created src/test-helpers.ts with createTempGitRepo(), commitFile(), cleanupTempDir() + src/test-helpers.test.ts (8 tests passing)"}
{"id":"overstory-y9ec","title":"Add --watchdog flag to coordinator start","description":"Add a --watchdog flag to 'overstory coordinator start' that auto-starts the Tier 0 watchdog daemon in the background when the coordinator is launched.\n\n## Context\nThe watchdog daemon (overstory watch) monitors agent health but must be started manually — easy to forget. The coordinator is the natural lifecycle owner: when it starts, agents will be spawned; when it stops, there's nothing to monitor.\n\n## Implementation Details\n\n### 1. Add --watchdog flag to startCoordinator (src/commands/coordinator.ts)\nAfter the coordinator tmux session is spawned and the beacon is sent, if --watchdog is present:\n- Shell out to 'overstory watch --background' using Bun.spawn\n- This reuses all existing watchdog logic (PID file management, duplicate detection, config loading) without refactoring watch.ts\n- Log that the watchdog was started (or warn if it failed / was already running)\n\n### 2. Auto-stop watchdog in stopCoordinator (src/commands/coordinator.ts)\nWhen stopping the coordinator, always check for and kill a running watchdog:\n- Read .overstory/watchdog.pid\n- Check if the PID is alive (process.kill(pid, 0))\n- If alive, kill it (process.kill(pid, SIGTERM)) and remove the PID file\n- Runs regardless of whether --watchdog was used at start — if the coordinator is going down, there's nothing to monitor\n- Import isProcessRunning from src/watchdog/health.ts (already exported)\n\n### 3. Update help text and --json output\n- Add --watchdog to the help string in COORDINATOR_HELP\n- Include watchdog: true/false in --json output of start\n- Include watchdogStopped: true/false in --json output of stop\n\n### 4. Add watchdog field to statusCoordinator\n- Check the PID file and report whether watchdog is running in status output\n\n### 5. Tests (src/commands/coordinator.test.ts)\nAdd tests using DI to avoid real subprocess spawns:\n- startCoordinator with --watchdog calls the watchdog spawn logic\n- startCoordinator without --watchdog does not start watchdog\n- stopCoordinator kills watchdog when PID file exists and process is alive\n- stopCoordinator cleans up stale PID file when process is dead\n- stopCoordinator works fine when no watchdog PID file exists\nDI approach: Add _watchdog to CoordinatorDeps with start and stop functions, similar to the existing _tmux pattern. Real implementation shells out to 'overstory watch --background' / reads PID file + kills. Tests inject fakes.\n\n## Files to modify\n- src/commands/coordinator.ts — main changes\n- src/commands/coordinator.test.ts — new tests\n\n## Verification\n1. bun test src/commands/coordinator.test.ts\n2. bun test (all tests pass)\n3. biome check . (lint clean)\n4. tsc --noEmit (types clean)\n5. Manual: overstory coordinator start --watchdog → verify watchdog.pid exists and process is alive\n6. Manual: overstory coordinator stop → verify watchdog process is killed and PID file removed","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-13T21:33:59.4982-08:00","created_by":"Jaymin West","updated_at":"2026-02-15T12:42:00.190547-08:00","closed_at":"2026-02-15T12:42:00.190547-08:00","close_reason":"Implemented --watchdog flag: auto-start on coordinator start, auto-stop on coordinator stop, status reporting, DI for testing, 288 lines of tests"}
{"id":"overstory-ye8f","title":"Flip OVERSTORY_GITIGNORE to wildcard+whitelist in init.ts","description":"Change init.ts gitignore constant and writeOverstoryGitignore function","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T07:17:58.622439-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T07:25:45.895158-08:00","closed_at":"2026-02-17T07:25:45.895158-08:00","close_reason":"Closed"}
{"id":"overstory-yg84","title":"costs --run returns empty: metrics.db missing run_id column","description":"## Problem\n\n`overstory costs --run \u003crun-id\u003e` always returns 'No session data found' even when `overstory run list` shows runs with agents and `overstory costs` (without --run) shows cost data for those same agents.\n\n## Root Cause\n\nThe --run code path in `src/commands/costs.ts:429-439` uses a two-step indirection that is fundamentally broken:\n\n1. Queries `sessions.db` via `sessionStore.getByRun(runId)` to find agent names belonging to a run\n2. Queries `metrics.db` via `metricsStore.getRecentSessions(1000)` and filters by those agent names\n\nThis fails because:\n\n**Problem A:** `metrics.db`'s `sessions` table has no `run_id` column. Schema is `(agent_name, bead_id)` as PK with no run association. Confirmed via `PRAGMA table_info(sessions)`.\n\n**Problem B:** `sessions.db` session rows are ephemeral — they get purged when agents complete or `overstory clean` runs. After a run completes, `getByRun()` returns empty because the session rows are gone, even though the `runs` table still records the run metadata (id, agent_count, status). In current state, sessions.db has only 1 row (zombie coordinator with NULL run_id) while metrics.db has 20 cost records.\n\n## Reproduction\n\n```bash\noverstory run list                    # Shows runs with agent counts\noverstory costs                       # Shows 20 sessions, $105.22 total\noverstory costs --run run-2026-02-19T00-31-12-810Z   # 'No session data found'\noverstory costs --run run-2026-02-16T15-03-37-730Z   # 'No session data found' (72 agents!)\n```\n\n## Proposed Fix\n\nAdd `run_id TEXT` column to `metrics.db`'s sessions table so cost queries can filter by run directly without depending on the ephemeral sessions.db lifecycle data.\n\n### Files to change:\n\n1. **`src/types.ts`** — Add `runId: string | null` to `SessionMetrics` interface\n2. **`src/metrics/store.ts`** — Add `run_id` column via migration (same pattern as `migrateTokenColumns`), add `getSessionsByRun(runId)` method to MetricsStore interface, update `recordSession` to accept and store run_id\n3. **`src/commands/log.ts`** — Pass `session.runId` through when calling `metricsStore.recordSession()` at session-end (the AgentSession already has run_id from sessions.db at that point)\n4. **`src/commands/costs.ts`** — Replace the broken indirection (lines 429-439) with direct `metricsStore.getSessionsByRun(runId)` call\n5. **`src/metrics/store.ts` tests** — Add test for `getSessionsByRun()`\n\n### Migration note:\nExisting metrics rows will have NULL run_id after the migration. This is acceptable — only new sessions recorded after the fix will have run_id populated. The --run query should still work correctly (returns only rows with matching run_id, older rows simply won't appear).","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-19T12:08:21.530768-08:00","created_by":"Jaymin West","updated_at":"2026-02-19T12:33:08.886395-08:00","closed_at":"2026-02-19T12:33:08.886395-08:00","close_reason":"Fixed costs --run by adding run_id column to metrics.db. Builder run-id-builder implemented: (1) runId field on SessionMetrics type, (2) run_id column with migration in metrics/store.ts, (3) getSessionsByRun() query method, (4) runId passed through in log.ts session-end, (5) costs.ts --run path uses direct query instead of broken cross-reference. All 1895 tests pass."}
{"id":"overstory-yhbn","title":"Phase 3: Auto-propulsion system (self-dispatching workers)","description":"Implement an auto-propulsion mechanism so agents self-execute when work is assigned rather than waiting for explicit commands. Core principle: when work appears on an agent's assignment, they MUST execute it. Key components: (1) Assignment binding - atomic association of a beads issue to an agent at spawn time (stored in agent session, not an .md file), (2) Hook-driven activation - SessionStart checks for bound work and begins immediately, (3) No idle state for workers - complete task, self-clean, exit. No lingering sessions, (4) Self-cleaning lifecycle: worker signals completion, pushes branch, requests own termination, (5) Task group tracking: auto-close task groups when all member issues resolve, notify coordinator. This replaces the current manual 'orchestrator decides everything' model with propulsion-driven autonomy.","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:50:50.06679-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T06:37:11.551274-08:00","closed_at":"2026-02-13T06:37:11.551274-08:00","close_reason":"Phase 3 auto-propulsion implemented: (1) builder.md updated with worker_done mail protocol and MISSING_WORKER_DONE failure mode, (2) overlay.ts quality gates now include worker_done signal step, (3) prime.ts injects activation context for bound tasks so agents self-start even if beacon is lost, (4) group.ts sends mail notification to coordinator on auto-close","dependencies":[{"issue_id":"overstory-yhbn","depends_on_id":"overstory-b3u0","type":"blocks","created_at":"2026-02-12T13:51:33.087222-08:00","created_by":"Jaymin West"},{"issue_id":"overstory-yhbn","depends_on_id":"overstory-p6pn","type":"blocks","created_at":"2026-02-12T13:51:33.648108-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-yhv6","title":"Beacon sendKeys requires extra Enter to trigger agent processing","description":"During dogfood testing, the agent spawned via 'overstory sling' sat idle after the beacon prompt was sent via tmux sendKeys. The Claude Code TUI showed the prompt text but never started processing it. A manual 'tmux send-keys Enter' was needed to trigger the agent. The 2s sleep in sling.ts (line ~356) before sendKeys may not be enough for Claude Code's TUI to fully initialize. Possible fixes: (1) increase the sleep, (2) poll tmux pane for readiness indicator before sending, (3) send an extra Enter after the beacon.","status":"closed","priority":2,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-12T13:50:45.144963-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T14:01:09.49012-08:00","closed_at":"2026-02-12T14:01:09.49012-08:00","close_reason":"Implemented typed mail protocol with 8 new message types + payload column, structural tool enforcement hooks, and beacon sendKeys fix"}
{"id":"overstory-yiey","title":"overstory spec write CLI command","status":"closed","priority":2,"issue_type":"feature","owner":"jayminwest@gmail.com","created_at":"2026-02-12T14:48:22.714956-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T14:56:03.380592-08:00","closed_at":"2026-02-12T14:56:03.380592-08:00","close_reason":"Implemented overstory spec write command with full test coverage. Command creates spec files at .overstory/specs/{bead-id}.md populated with beads issue metadata. Includes --force flag for overwriting existing specs. All quality gates pass."}
{"id":"overstory-yj6n","title":"Add NO_COLOR and --quiet support","description":"Support NO_COLOR env var (suppress ANSI codes) and --quiet flag (suppress non-error output). Standard for CI/scripting environments. Currently reporter.ts uses ANSI directly with no way to disable.","status":"closed","priority":2,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-15T17:04:32.941226-08:00","created_by":"Jaymin West","updated_at":"2026-02-16T07:56:40.055887-08:00","closed_at":"2026-02-16T07:56:40.055887-08:00","close_reason":"Merged: NO_COLOR env var and --quiet flag support added"}
{"id":"overstory-yoyx","title":"Inject base agent definition content into spawned agents","description":"Base agent definition files (agents/builder.md, scout.md, etc.) are copied to .overstory/agent-defs/ during init but never read or injected into agent context at runtime. The overlay template (overlay.md.tmpl) only contains Layer 2 (task-specific WHAT) but Layer 1 (role-specific HOW) is missing. Agents miss ~100+ lines per role: workflow instructions, propulsion principles, named failure modes, completion protocols, tool constraints. Fix: either have overlay.ts read and prepend the base def into CLAUDE.md, or have prime.ts inject it during SessionStart.","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T10:30:55.428064-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T10:35:19.839308-08:00","closed_at":"2026-02-13T10:35:19.839308-08:00","close_reason":"Inject base agent definition (Layer 1) into overlay CLAUDE.md: added baseDefinition field to OverlayConfig, read agent def file in sling.ts, added {{BASE_DEFINITION}} placeholder to overlay template"}
{"id":"overstory-ywno","title":"Migrate nudge.ts and prime.ts session readers to SessionStore","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T14:58:35.026666-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T19:16:13.153791-08:00","closed_at":"2026-02-13T19:16:13.153791-08:00","close_reason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed."}
{"id":"overstory-z5y","title":"L4-7: Implement init command (src/commands/init.ts)","description":"CLI: overstory init. Scaffolds .overstory/ in current project: creates config.yaml with defaults, agent-manifest.json, hooks.json, directories (agents/, worktrees/, specs/, logs/). Updates .gitignore with worktrees, logs, metrics.db, mail.db. Updates .claude/CLAUDE.md with overstory awareness.","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T07:12:37.582518-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T07:39:42.022851-08:00","closed_at":"2026-02-12T07:39:42.022851-08:00","close_reason":"All L4 modules implemented, lint+types clean","dependencies":[{"issue_id":"overstory-z5y","depends_on_id":"overstory-19p","type":"blocks","created_at":"2026-02-12T07:13:45.765542-08:00","created_by":"Jaymin West"}]}
{"id":"overstory-zbwi","title":"Review: merge_ready validation in mail.ts","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-17T08:08:11.958613-08:00","created_by":"Jaymin West","updated_at":"2026-02-17T08:12:17.013744-08:00","closed_at":"2026-02-17T08:12:17.013744-08:00","close_reason":"Review complete: PASS"}
{"id":"overstory-ze4","title":"Test sling edge case","description":"temp task for testing sling edge cases","status":"closed","priority":4,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-12T12:02:02.778813-08:00","created_by":"Jaymin West","updated_at":"2026-02-12T12:10:07.068336-08:00","closed_at":"2026-02-12T12:10:07.068336-08:00","close_reason":"temp test issues, closed after E2E validation"}
{"id":"overstory-zicy","title":"Fix dashboard.test.ts leaking stdout via infinite poll loop","status":"closed","priority":1,"issue_type":"bug","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:50:40.770657-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:55:07.567538-08:00","closed_at":"2026-02-13T08:55:07.567538-08:00","close_reason":"Test coverage blitz complete: 830 tests, 0 failures, 42 files. All 17 modules now have test coverage."}
{"id":"overstory-zq15","title":"Add root-user pre-flight guard to agent spawn commands","description":"When overstory runs as root (UID 0), the claude CLI rejects --dangerously-skip-permissions and the tmux session dies immediately. The current error is misleading ('no server running on /tmp/tmux-0/default'). Add a process.getuid?.() === 0 check in all 4 spawn commands (sling.ts, coordinator.ts, supervisor.ts, monitor.ts) that emits a clear error before attempting tmux creation. Also improve the sendKeys() error in tmux.ts to distinguish 'server not running' from 'session not found'. See GitHub issue #13 for context.","status":"closed","priority":3,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-18T06:39:50.273142-08:00","created_by":"Jaymin West","updated_at":"2026-02-18T16:55:21.808451-08:00","closed_at":"2026-02-18T16:55:21.808451-08:00","close_reason":"Root-user pre-flight guard added to sling, coordinator, supervisor, monitor spawn commands via isRunningAsRoot() pure function. sendKeys() in tmux.ts now distinguishes server-not-running from session-not-found errors. 2 builders completed, all 1879 tests pass."}
{"id":"overstory-zyz7","title":"Add DI for _spawnClaude to triage.ts + export pure helpers","status":"closed","priority":1,"issue_type":"task","owner":"jayminwest@gmail.com","created_at":"2026-02-13T08:20:18.874467-08:00","created_by":"Jaymin West","updated_at":"2026-02-13T08:26:50.046515-08:00","closed_at":"2026-02-13T08:26:50.046515-08:00","close_reason":"Exported buildTriagePrompt and classifyResponse, created triage.test.ts with 17 tests"}
